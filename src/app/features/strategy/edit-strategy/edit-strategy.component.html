<div class="regularText color-background">
  <div class="d-flex justify-between mb-40">
    <div>
      <h1 class="titleText mb-16">Edit Strategy</h1>
      <p>Design a strategy that supports your consistency with TradeSwitch.</p>
      
      <!-- Plugin Active Warning Message -->
      <div *ngIf="isPluginActive" class="plugin-warning-message border-left-4-red">
        <div class="d-flex align-items-center gap-10 w-min">
          <span class="material-symbols-outlined color-red-500" style="font-size: 18px;">warning</span>
          <p class="color-red-500 inputText mb-0 ml-10">
            <strong>Active plugin detected:</strong> You must deactivate the plugin to save strategy rules.
          </p>
        </div>
      </div>
    </div>
    <div class="action-buttons d-flex gap-16">
      <button 
        class="discard-btn p-10 inputText"
        (click)="discardChanges()"
      >
        Discard changes
      </button>
      <button 
        class="save-btn p-10 inputText"
        (click)="saveStrategy()"
        [disabled]="loading || isPluginActive"
        [class.disabled]="isPluginActive"
      >
        {{ loading ? 'Saving...' : (isPluginActive ? 'Plugin Active - Cannot Save' : 'Save Strategy') }}
      </button>
    </div>
  </div>

  <!-- Mini Strategy Card -->
  <div class="mini-strategy-card bg-gray-800 border-radius-8">
    <div class="strategy-info d-flex align-items-center gap-16">
      <!-- Strategy Icon -->
      <div class="strategy-icon d-flex align-items-center justify-center">
      </div>
      
      <!-- Strategy Details -->
      <div class="strategy-details">
        <!-- Strategy Name (Editable) -->
        <div class="strategy-name-container">
          @if (isEditingName) {
            <div class="strategy-name-input-container">
              <input 
                type="text" 
                class="strategy-name-input bg-transparent color-white border-none outline-none"
                [(ngModel)]="editingStrategyName"
                (keyup.enter)="saveStrategyName()"
                (keyup.escape)="cancelEditName()"
                #nameInput
              />
              <div class="input-actions">
                <span 
                  class="material-symbols-outlined action-icon cancel-icon" 
                  (click)="cancelEditName()"
                  title="Cancel"
                >
                  close
                </span>
                <span 
                  class="material-symbols-outlined action-icon confirm-icon" 
                  (click)="saveStrategyName()"
                  title="Save"
                >
                  check
                </span>
              </div>
            </div>
          } @else {
            <h3 class="strategy-name color-white mb-0 mr-4">{{ currentStrategyName }}</h3>
            <span class="material-symbols-outlined edit-icon" (click)="startEditName()">edit</span>
          }
        </div>
        
        <!-- Last Modified -->
        <p class="last-modified color-gray-400 mb-0">{{ lastModifiedText }}</p>
      </div>
    </div>
    
    <!-- Favorite Button -->
    <!--
      <button 
        class="favorite-btn d-flex align-items-center justify-center"
        [class.favorited]="isFavorited"
        (click)="toggleFavorite()"
      >
        <span class="icon-heart"></span>
      </button>
    -->
  </div>

  <!-- Panel de reglas disponibles -->
  <div class="rules d-flex flex-row">
    <!-- Desktop: Available Rules -->
    <div class="rules-container available_rules d-flex flex-col justify-start">
      <h2 class="subtitle mb-20 desktop-title">Available Rules</h2>
      @if (config && config.maxDailyTrades.isActive) {
      <app-edit-max-daily-trades></app-edit-max-daily-trades>
      } @if (config && config.riskReward.isActive) {
      <app-edit-risk-reward-ratio></app-edit-risk-reward-ratio>
      } @if (config && config.riskPerTrade.isActive) {
      <app-edit-risk-per-trade></app-edit-risk-per-trade>
      } @if (config && config.daysAllowed.isActive) {
      <app-edit-days-allowed></app-edit-days-allowed>
      } @if (config && config.assetsAllowed.isActive) {
      <app-edit-assets-allowed [availableSymbolsOptions]="availableInstruments"></app-edit-assets-allowed>
      } @if (config && config.hoursAllowed.isActive) {
      <app-edit-hours-allowed></app-edit-hours-allowed>
      }
    </div>
    
    <!-- Desktop: My Choices -->
    <div class="rules-container my_choices d-flex flex-col justify-start">
      <h2 class="subtitle mb-20 desktop-title">My Choices</h2>
      @if (myChoices && myChoices.maxDailyTrades.isActive) {
      <app-edit-max-daily-trades #maxDailyTradesRef></app-edit-max-daily-trades>
      } @if (myChoices && myChoices.riskReward.isActive) {
      <app-edit-risk-reward-ratio></app-edit-risk-reward-ratio>
      } @if (myChoices && myChoices.riskPerTrade.isActive) {
      <app-edit-risk-per-trade #riskPerTradeRef [userAccounts]="accountsData"></app-edit-risk-per-trade>
      } @if (myChoices && myChoices.daysAllowed.isActive) {
      <app-edit-days-allowed #daysAllowedRef></app-edit-days-allowed>
      } @if (myChoices && myChoices.assetsAllowed.isActive) {
      <app-edit-assets-allowed #assetsAllowedRef [availableSymbolsOptions]="availableInstruments"></app-edit-assets-allowed>
      } @if (myChoices && myChoices.hoursAllowed.isActive) {
      <app-edit-hours-allowed #hoursAllowedRef></app-edit-hours-allowed>
      }
    </div>
  </div>

  <!-- Mobile: Container Ãºnico con todas las reglas -->
  <div class="mobile-rules-container">
    <h2 class="subtitle mb-20">Rules</h2>
    @if (config && config.maxDailyTrades.isActive || myChoices && myChoices.maxDailyTrades.isActive) {
    <app-edit-max-daily-trades #maxDailyTradesRef></app-edit-max-daily-trades>
    } @if (config && config.riskReward.isActive || myChoices && myChoices.riskReward.isActive) {
    <app-edit-risk-reward-ratio></app-edit-risk-reward-ratio>
    } @if (config && config.riskPerTrade.isActive || myChoices && myChoices.riskPerTrade.isActive) {
    <app-edit-risk-per-trade #riskPerTradeRef></app-edit-risk-per-trade>
    } @if (config && config.daysAllowed.isActive || myChoices && myChoices.daysAllowed.isActive) {
    <app-edit-days-allowed #daysAllowedRef></app-edit-days-allowed>
    } @if (config && config.assetsAllowed.isActive || myChoices && myChoices.assetsAllowed.isActive) {
    <app-edit-assets-allowed #assetsAllowedRef [availableSymbolsOptions]="availableInstruments"></app-edit-assets-allowed>
    } @if (config && config.hoursAllowed.isActive || myChoices && myChoices.hoursAllowed.isActive) {
    <app-edit-hours-allowed #hoursAllowedRef></app-edit-hours-allowed>
    }
  </div>

  <app-edit-popup
    [visible]="editPopupVisible"
    [close]="closePopup"
  ></app-edit-popup>

  <app-confirm-popup
    [visible]="confirmPopupVisible"
    [cancel]="closeConfirmModal"
    [close]="confirmSave"
  ></app-confirm-popup>

  <app-loading-popup [visible]="loading"></app-loading-popup>
</div>
