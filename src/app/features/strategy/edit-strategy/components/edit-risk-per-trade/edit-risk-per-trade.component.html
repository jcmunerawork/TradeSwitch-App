<div class="config-row d-flex flex-col py-12 justify-between">
  <!-- Mensaje de error de validación -->
  @if (!isValid && config.isActive) {
  <div class="validation-error mb-3">
    <span class="error-message">{{ errorMessage }}</span>
  </div>
  }
  
  <!-- Toggle para activar/desactivar -->
  <div class="d-flex items-center mb-0">
    <label class="custom-checkbox m-6">
      <input
        type="checkbox"
        id="toggle-risk-per-trade"
        [checked]="config.isActive"
        (change)="onToggleActive($event)"
      />
      <span class="checkmark"></span>
    </label>

    <div class="label-container">
      <label
        for="toggle-risk-per-trade"
        [ngClass]="{ deactivated: !config.isActive }"
      >
        Limit my Risk per Trade
      </label>
    </div>
  </div>

  <!-- Contenido que se muestra solo cuando está activo -->
  @if (config.isActive) {
  <div class="risk-config-content">
    
    <!-- Opciones de tipo de tamaño -->
    <div class="option-group mb-12">
      <div class="option-row">
        <h4 class="option-title">Size Type</h4>
        <div class="button-group-inline">
          <button 
            class="option-button-small"
            [class.active]="selectedSizeType === 'max-size'"
            (click)="selectSizeType('max-size')"
          >
            Max
          </button>
          <button 
            class="option-button-small"
            [class.active]="selectedSizeType === 'fixed'"
            (click)="selectSizeType('fixed')"
          >
            Fixed
          </button>
        </div>
      </div>
      <div class="option-description" *ngIf="selectedSizeType">
        <p *ngIf="selectedSizeType === 'max-size'">You can trade up to the entered price.</p>
        <p *ngIf="selectedSizeType === 'fixed'">The trade must be exactly at this price.</p>
      </div>
    </div>

    <!-- Opciones de tipo de cálculo - Solo se muestra si se seleccionó un tipo de tamaño -->
    <div *ngIf="selectedSizeType" class="option-group mb-16">
      <div class="option-row">
        <h4 class="option-title">Calculation Type</h4>
        <div class="button-group-inline">
          <button 
            class="option-button-small"
            [class.active]="selectedCalculationType === 'by percentage'"
            (click)="selectCalculationType('by percentage')"
          >
            %
          </button>
          <button 
            class="option-button-small"
            [class.active]="selectedCalculationType === 'by price'"
            (click)="selectCalculationType('by price')"
          >
            $
          </button>
        </div>
      </div>
    </div>

    <!-- Configuración por porcentaje - Solo se muestra si se seleccionó "by percentage" -->
    <div *ngIf="selectedCalculationType === 'by percentage'" class="percentage-config">
      <!-- Selector de tipo de balance -->
      <div class="option-group mb-16">
        <div class="option-row">
          <h4 class="option-title">Balance Type</h4>
          <div class="button-group-inline">
            <button 
              class="option-button-small"
              [class.active]="selectedBalanceType === 'by actual balance'"
              (click)="selectBalanceType('by actual balance')"
            >
              Actual
            </button>
            <button 
              class="option-button-small"
              [class.active]="selectedBalanceType === 'by initial balance'"
              (click)="selectBalanceType('by initial balance')"
            >
              Initial
            </button>
          </div>
        </div>
      </div>

      <!-- Selector de cuenta - aparece después de elegir tipo de balance -->
      <div *ngIf="selectedBalanceType" class="account-select mb-12">
        <label for="account-select" class="input-label">Account</label>
        <select id="account-select" #accountSelect class="custom-input account-dropdown" (change)="onSelectAccount($event)">
          <option value="" selected disabled>Select an account</option>
          <option *ngFor="let acc of userAccounts" [value]="acc.accountID">
            {{ acc.accountID }} • {{ ((acc.accountName && acc.accountName.length > 22) ? (acc.accountName | slice:0:22) + '…' : (acc.accountName || 'Unnamed')) }}  —  $
            {{ (selectedBalanceType === 'by actual balance' ? accountActualBalances[acc.accountID] : acc.initialBalance) | number:'1.2-2' }}
          </option>
        </select>
      </div>

      <!-- Información del balance y cálculo - Solo se muestra si se seleccionó cuenta -->
      <div *ngIf="selectedBalanceType && selectedAccount" class="balance-info mb-12">
        <p class="balance-text">
          {{ selectedBalanceType === 'by actual balance' ? 'Actual Balance' : 'Initial Balance' }}: 
          <strong>${{ getCurrentBalance() | number:'1.2-2' }}</strong>
        </p>
        <p class="calculation-text">
          {{ percentageValue }}% = <strong>${{ getCalculatedAmount() | number:'1.2-2' }}</strong>
        </p>
      </div>

      <!-- Input de porcentaje - Solo se muestra si se seleccionó cuenta -->
      <div *ngIf="selectedBalanceType && selectedAccount" class="input-group">
        <label for="percentage-input" class="input-label">Percentage</label>
    <div class="input-with-suffix">
      <input
        type="number"
        id="percentage-input"
        [value]="percentageValue || ''"
        [placeholder]="'Enter a percentage'"
        (input)="onPercentageChange($event)"
            [disabled]="!selectedAccount"
        class="custom-input"
        min="0.01"
        max="100"
        step="0.01"
      />
      <span class="suffix">%</span>
        </div>
      </div>
    </div>

    <!-- Configuración por precio - Solo se muestra si se seleccionó "by price" -->
    <div *ngIf="selectedCalculationType === 'by price'" class="price-config">
      <div class="input-group">
        <label for="price-input" class="input-label">Price</label>
        <input
          type="text"
              id="price-input"
              [value]="priceInputValue"
              [placeholder]="'Enter an amount'"
              (input)="onPriceInput($event)"
              (focus)="onPriceFocus()"
              (blur)="onPriceBlur()"
              class="custom-input"
            />
      </div>
    </div>
  </div>
  }
</div>
