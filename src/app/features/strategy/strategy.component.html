<div class="regularText color-background">
  <div class="mb-20 d-flex justify-between">
    <div>
      <h2 class="titleText mb-30">My Strategy</h2>
      <p>Design a strategy that supports your consistency with TradeSwitch.</p>
    </div>
  </div>
  <!-- Control Bar -->
  <div class="control-bar d-flex flex-row justify-end align-items-center mb-20">
    <!-- Search Input -->
    <div class="search-container">
      <div class="search-input-wrapper">
        <span class="material-symbols-outlined search-icon" style="font-size: 20px;">search</span>
        <app-text-input
          placeholder="Search by name"
          [label]="''"
          (input)="onSearchChange($event)"
          class="search-input"
        ></app-text-input>
      </div>
    </div>
    
    <!-- Filter Button (commented out) -->
    <!-- <button class="filter-btn d-flex align-items-center gap-8">
      <span class="icon-filter"></span>
      <span>Filter</span>
    </button> -->
    
    <!-- New Strategy Button -->
    <button class="add-strategy-btn d-flex align-items-center gap-8" (click)="toggleStrategySelector()">
      <span class="material-symbols-outlined" style="font-size: 20px;">add</span>
      <span>Add Strategy</span>
    </button>
  </div>

  @if (showStrategySelector) {
    <div class="new-strategy-form d-flex align-items-center gap-12 mb-16">
      <input 
        type="text" 
        class="strategy-name-input" 
        placeholder="Enter strategy name"
        [(ngModel)]="newStrategyName"
        (keyup.enter)="onCreateNewStrategy()"
      >
      <button class="create-btn" (click)="onCreateNewStrategy()">Create</button>
      <button class="cancel-btn" (click)="onCancelNewStrategy()">Cancel</button>
    </div>
    }

  <!-- Plan Banner -->
  @if (showPlanBanner) {
  <div class="plan-banner" [class]="'plan-banner-' + planBannerType">
    <div class="banner-content">
      <div class="banner-icon">
        <span class="material-symbols-outlined" style="font-size: 20px;">info</span>
      </div>
      <div class="banner-message">
        <span>{{ planBannerMessage }}</span>
        <span class="upgrade-link" (click)="onUpgradePlan()">Upgrade anytime.</span>
      </div>
      <button class="banner-close" (click)="onCloseBanner()">
        <span class="material-symbols-outlined" style="font-size: 20px;">close</span>
      </button>
    </div>
  </div>
  }

  <!-- Primera validación: ¿Existe alguna estrategia en general? -->
  @if (userStrategies.length === 0 && !activeStrategy) {
  <!-- No hay estrategias en absoluto -->
  <div class="empty-strategies d-flex flex-col align-items-center">
    <div class="empty-icon">
      <span class="material-symbols-outlined" style="font-size: 28px;">content_paste_search</span>
    </div>
    <h3 class="empty-title">No strategies found</h3>
    <p class="empty-description">Create your first strategy to start trading with TradeSwitch.</p>
    <button class="create-first-btn" (click)="toggleStrategySelector()">
      Create First Strategy
    </button>
  </div>
  } @else {
  <!-- Hay al menos una estrategia, mostrar la activa -->
  @if (activeStrategy) {
  <div class="active-strategy d-flex flex-col mb-20">
    <h3 class="section-title">Active Strategy</h3>
    <p class="section-description">Currently active strategy configuration.</p>
    
    <!-- Strategy Card -->
    <app-strategy-card
      [strategy]="strategyCard"
      [showCustomizeButton]="true"
      customizeButtonText="Customize strategy"
      (edit)="onStrategyEdit($event)"
      (favorite)="onStrategyFavorite($event)"
      (moreOptions)="onStrategyMoreOptions($event)"
      (customize)="onStrategyCustomize($event)"
      (duplicate)="copyStrategy($event)"
      (delete)="deleteStrategy($event)"
    ></app-strategy-card>
  </div>
  }

  <!-- Other Strategies Section -->
  @if (userStrategies.length > 0) {
  <!-- Hay otras estrategias, mostrar las cards -->
  <div class="other-strategies d-flex flex-col">
    <h3 class="section-title">Other Strategies</h3>
    <p class="section-description">Manage your other strategy configurations.</p>
    
    <div class="strategies-grid">
      @for (strategy of filteredStrategies; track getStrategyId(strategy)) {
        @if (!strategy.status) {
        <app-strategy-card
          [strategy]="getCardDataByStrategyId(getStrategyId(strategy)) || {
            id: getStrategyId(strategy),
            name: strategy.name,
            status: 'Inactive',
            lastModified: formatDate(strategy.updated_at.toDate()),
            rules: 0,
            timesApplied: strategy.days_active || 0,
            winRate: 0,
            isFavorite: false
          }"
          [showCustomizeButton]="true"
          customizeButtonText="Activate strategy"
          (edit)="onStrategyEdit($event)"
          (favorite)="onStrategyFavorite($event)"
          (moreOptions)="onStrategyMoreOptions($event)"
          (customize)="activateStrategy($event)"
          (duplicate)="copyStrategy($event)"
          (delete)="deleteStrategy($event)"
        ></app-strategy-card>
        }
      }
    </div>
  </div>
  } @else if (activeStrategy && userStrategies.length === 0) {
  <!-- Solo tiene la estrategia activa y puede añadir más -->
  <div class="other-strategies d-flex flex-col">
    <h3 class="section-title">Other Strategies</h3>
    <p class="section-description">You can add more strategies to your plan.</p>
    
    <div class="empty-strategies d-flex flex-col align-items-center">
      <div class="empty-icon">
        <span class="material-symbols-outlined" style="font-size: 28px;">add_circle</span>
      </div>
      <h3 class="empty-title">Add more strategies</h3>
      <p class="empty-description">Your plan allows you to create additional strategies.</p>
      <button class="create-first-btn" (click)="toggleStrategySelector()">
        Create Additional Strategy
      </button>
    </div>
  </div>
  }
  }

  <!-- Validaciones adicionales para casos especiales -->
  @if (accountsData.length === 0 && userStrategies.length === 0 && !activeStrategy) {
  <div class="empty-strategies d-flex flex-col align-items-center">
    <div class="empty-icon">
      <span class="material-symbols-outlined" style="font-size: 28px;">group_add</span>
    </div>
    <h3 class="empty-title">No trading accounts found</h3>
    <p class="empty-description">You need to add a trading account before creating strategies.</p>
    <button class="create-first-btn" (click)="navigateToTradingAccounts()">
      Add Trading Account
    </button>
  </div>
  }

  @if (filteredStrategies.length === 0 && searchTerm && userStrategies.length > 0) {
  <div class="empty-strategies d-flex flex-col align-items-center">
    <div class="empty-icon">
      <span class="material-symbols-outlined" style="font-size: 28px;">search</span>
    </div>
    <h3 class="empty-title">No strategies found</h3>
    <p class="empty-description">No strategies match your search criteria.</p>
    <button class="create-first-btn" (click)="searchTerm = ''; filterStrategies()">
      Clear search
    </button>
  </div>
  }

<!-- Upgrade Modal -->
@if (showUpgradeModal) {
<div class="modal-overlay" (click)="onCloseUpgradeModal()">
  <div class="upgrade-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">Ready to expand your trading?</h2>
      <button class="modal-close" (click)="onCloseUpgradeModal()">
        <span class="material-symbols-outlined" style="font-size: 20px;">close</span>
      </button>
    </div>
    <div class="modal-body">
      <p class="modal-message">{{ upgradeModalMessage }}</p>
    </div>
    <div class="modal-footer">
      <button class="upgrade-btn" (click)="onSeeUpgradeOptions()">
        See upgrade options
      </button>
    </div>
  </div>
</div>
}