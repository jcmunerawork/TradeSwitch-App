<!-- Profile Details Section -->
<div class="profile-details-section">
  <div class="main-titles color-background d-flex flex-col mb-24">
    <h1 class="subtitle mb-8">Profile Details</h1>
    <h3 class="regularText">
      Manage your personal information and account settings.
    </h3>
  </div>

  <!-- Profile Information Form -->
  <div class="profile-form-section">
    <div class="form-card">
      <h2 class="form-title">Personal Information</h2>
      
      <form [formGroup]="profileForm" (ngSubmit)="onUpdateProfile()">
        <div class="form-grid">
          <div class="form-group">
            <label for="firstName" class="form-label">First Name</label>
            <input
              type="text"
              id="firstName"
              formControlName="firstName"
              class="form-input"
              [class.error]="profileForm.get('firstName')?.errors && profileForm.get('firstName')?.touched"
              placeholder="Enter your first name"
            />
            <div class="error-message" *ngIf="getFieldError('firstName')">
              {{ getFieldError('firstName') }}
            </div>
          </div>

          <div class="form-group">
            <label for="lastName" class="form-label">Last Name</label>
            <input
              type="text"
              id="lastName"
              formControlName="lastName"
              class="form-input"
              [class.error]="profileForm.get('lastName')?.errors && profileForm.get('lastName')?.touched"
              placeholder="Enter your last name"
            />
            <div class="error-message" *ngIf="getFieldError('lastName')">
              {{ getFieldError('lastName') }}
            </div>
          </div>

          <div class="form-group">
            <label for="email" class="form-label">Email Address</label>
            <input
              type="email"
              id="email"
              formControlName="email"
              class="form-input"
              [class.error]="profileForm.get('email')?.errors && profileForm.get('email')?.touched"
              placeholder="Enter your email address"
              readonly
            />
            <div class="form-note">Email cannot be changed</div>
          </div>

          <div class="form-group">
            <label for="phoneNumber" class="form-label">Phone Number</label>
            <input
              type="tel"
              id="phoneNumber"
              formControlName="phoneNumber"
              class="form-input"
              placeholder="Enter your phone number"
              readonly
            />
            <div class="form-note">Phone number cannot be changed</div>
          </div>

          <div class="form-group">
            <label for="birthday" class="form-label">Birthday</label>
            <input
              type="date"
              id="birthday"
              formControlName="birthday"
              class="form-input"
              [class.error]="profileForm.get('birthday')?.errors && profileForm.get('birthday')?.touched"
            />
            <div class="error-message" *ngIf="getFieldError('birthday')">
              {{ getFieldError('birthday') }}
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button
            type="submit"
            class="btn-primary"
            [disabled]="profileForm.invalid || isLoading"
          >
            <span *ngIf="isLoading" class="loading-spinner"></span>
            {{ isLoading ? 'Updating...' : 'Update Profile' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Password Change Section -->
  <div class="password-section">
    <div class="password-card">
      <div class="password-header">
        <h2 class="form-title">Change Password</h2>
        <p class="password-description">
          Update your password to keep your account secure.
        </p>
      </div>

      <button
        type="button"
        class="btn-secondary"
        (click)="togglePasswordForm()"
        [disabled]="isLoading"
      >
        {{ showPasswordForm ? 'Cancel' : 'Change Password' }}
      </button>

      <!-- Password Change Form -->
      <form
        *ngIf="showPasswordForm"
        [formGroup]="passwordForm"
        (ngSubmit)="onChangePassword()"
        class="password-form"
      >
        <div class="form-group">
          <app-password-input
            formControlName="currentPassword"
            label="Current Password"
            placeholder="Enter your current password"
            [required]="true"
            [showValidation]="false"
          ></app-password-input>
          <div class="error-message" *ngIf="getPasswordFieldError('currentPassword')">
            {{ getPasswordFieldError('currentPassword') }}
          </div>
        </div>

        <div class="form-group">
          <app-password-input
            formControlName="newPassword"
            label="New Password"
            placeholder="Enter your new password"
            [required]="true"
            [showValidation]="true"
            [userEmail]="user?.email || ''"
            [userName]="(user?.firstName || '') + ' ' + (user?.lastName || '')"
          ></app-password-input>
          <div class="error-message" *ngIf="getPasswordFieldError('newPassword')">
            {{ getPasswordFieldError('newPassword') }}
          </div>
        </div>

        <div class="form-group">
          <app-password-input
            formControlName="confirmPassword"
            label="Confirm New Password"
            placeholder="Confirm your new password"
            [required]="true"
            [showValidation]="false"
          ></app-password-input>
          <div class="error-message" *ngIf="getPasswordFieldError('confirmPassword')">
            {{ getPasswordFieldError('confirmPassword') }}
          </div>
        </div>

        <div class="form-actions">
          <button
            type="submit"
            class="btn-primary"
            [disabled]="passwordForm.invalid || isLoading"
          >
            <span *ngIf="isLoading" class="loading-spinner"></span>
            {{ isLoading ? 'Updating...' : 'Update Password' }}
          </button>
        </div>

        <!-- Success/Error Messages -->
        <div class="message success" *ngIf="passwordChangeMessage">
          {{ passwordChangeMessage }}
        </div>
        <div class="message error" *ngIf="passwordChangeError">
          {{ passwordChangeError }}
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Account Section -->
  <div class="delete-account-section">
    <div class="delete-account-card">
      <h2 class="form-title">Delete Account</h2>
      <p class="delete-account-description">
        Delete your account to permanently remove your data.
      </p>
    </div>

    <button 
      class="delete-account-btn" 
      (click)="showDeleteAccountModal()"
      [disabled]="isDeletingAccount"
    >
      {{ isDeletingAccount ? 'Deleting...' : 'Delete Account' }}
    </button>
  </div>

  <!-- Delete Account Modal -->
  <div class="delete-account-modal" *ngIf="showDeleteModal">
    <div class="modal-content">
      <h2 class="form-title">Delete Account</h2>
      <p class="delete-account-description">
        Are you sure you want to delete your account? This action will:
      </p>
      <ul class="deletion-warning-list">
        <li>Permanently delete all your data</li>
        <li>Remove all your trading accounts</li>
        <li>Delete all your strategies and configurations</li>
        <li>Remove your report history</li>
        <li>Delete all your subscriptions and payments</li>
        <li>This action CANNOT be undone</li>
      </ul>
      
      <div class="modal-actions">
        <button 
          class="delete-account-btn" 
          (click)="confirmDeleteAccount()"
          [disabled]="isDeletingAccount"
        >
          <span *ngIf="isDeletingAccount" class="loading-spinner"></span>
          {{ isDeletingAccount ? 'Deleting...' : 'Yes, Delete Account' }}
        </button>
        <button 
          class="cancel-account-btn" 
          (click)="cancelDeleteAccount()"
          [disabled]="isDeletingAccount"
        >
          Cancel
        </button>
      </div>

      <!-- Error Message -->
      <div class="error-message" *ngIf="deleteAccountError">
        {{ deleteAccountError }}
      </div>
    </div>
  </div>
</div>
