<div class="main-titles color-background d-flex flex-col mb-50">
  <h1 class="titleText mb-32">My Reports</h1>
  <h3 class="regularText">
    Visualize your consistency while growing with TradeSwitch.
  </h3>
</div>

<!-- Account Info and Actions Header -->
@if(accountsData.length > 0 && !loading) {
<div class="account-header d-flex justify-between align-items-center mb-32">
  <div class="account-info d-flex flex-col">
    <h2 class="account-name color-background">{{ getCurrentAccountName() }}</h2>
    <div class="account-details d-flex align-items-center gap-8">
      <span class="account-server color-secondary-300">{{ getCurrentAccountServer() }}</span>
    </div>
  </div>
  
  <div class="action-buttons d-flex gap-12">
    <button class="export-btn d-flex align-items-center gap-8" (click)="exportAllData()">
      <span class="icon-refresh"></span>
      <span>Export Data</span>
    </button>
    
    <button class="edit-strategy-btn d-flex align-items-center gap-8" (click)="goToEditStrategy()">
      <span class="icon-edit"></span>
      <span>Edit Strategy</span>
    </button>
    
    <div class="change-account-dropdown">
      <button class="change-account-btn d-flex align-items-center gap-8" (click)="toggleAccountDropdown()">
        <span>Change account</span>
        <span class="icon-chevron"></span>
      </button>
      
      @if(showAccountDropdown) {
      <div class="account-dropdown">
        @for(account of accountsData; track account.id) {
        <div class="account-option" (click)="selectAccount(account)">
          <div class="account-option-name">{{ account.accountName }}</div>
          <div class="account-option-server">{{ account.server }}</div>
        </div>
        }
      </div>
      }
    </div>
  </div>
</div>
}
@if(accountsData.length === 0 && !loading) {
<div
  class="no-accounts d-flex flex-col items-center justify-center px-50 pb-50"
>
  <span
    class="icon-info color-secondary-300 mb-20"
    style="font-size: 48px"
  ></span>
  <h2 class="subtitle mb-10 color-background">No accounts connected</h2>
  <p class="smallText color-secondary-300 mb-20">
    Connect a trading account to start tracking your performance and strategy
    adherence.
  </p>
  <a
    routerLink="/add-account"
    class="add-account-btn p-10 bg-primary-400 color-bg-black inputText"
  >
    Connect Account
  </a>
</div>
}

<div class="d-flex stats-card-container mb-24">
  <app-stat-card
    class="stat-card"
    title="Net P&L"
    [value]="stats?.netPnl ? stats?.netPnl : 0"
  ></app-stat-card>
  <app-stat-card
    class="stat-card"
    title="Trade win %"
    [value]="`${stats?.tradeWinPercent}%`"
  ></app-stat-card>
  <app-stat-card
    class="stat-card"
    title="Profit Factor"
    [value]="stats?.profitFactor"
  ></app-stat-card>
  <app-stat-card
    class="stat-card"
    title="Avg. win/loss trades"
    [value]="stats?.avgWinLossTrades"
  ></app-stat-card>
  <app-stat-card
    class="stat-card"
    title="Total trades"
    [value]="stats?.totalTrades"
  ></app-stat-card>
</div>
<div class="middle-container d-flex mb-24">
  <app-PnL-Graph
    [values]="accountHistory"
    (onYearChange)="onYearChange($event)"
  ></app-PnL-Graph>
  <app-win-loss-chart [values]="accountHistory"></app-win-loss-chart>
</div>
<app-calendar
  [groupedTrades]="accountHistory"
  [pluginHistory]="pluginHistory"
  (strategyFollowedPercentageChange)="onStrategyPercentageChange($event)"
></app-calendar>

<app-loading-popup [visible]="loading"></app-loading-popup>
