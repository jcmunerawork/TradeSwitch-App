@if (loading) {
  <!-- Loading State - Reemplaza todo el contenido -->
  <div class="loading-content regularText color-background d-flex flex-col align-items-center">
    <app-loading-spinner 
      title="Loading your trading data..." 
      description="Please wait while we fetch your account information.">
    </app-loading-spinner>
    
    @if (showReloadButton) {
    <button class="reload-btn" (click)="reloadData()">
      <span class="material-symbols-outlined" style="font-size: 18px;">refresh</span>
      Reload Data
    </button>
    }
  </div>
} @else {
<!-- Contenido principal -->
<div class="main-titles color-background d-flex flex-col mb-50">
  <h1 class="titleText mb-20">My Reports</h1>
  <h3 class="regularText">
    Visualize your consistency while growing with TradeSwitch.
  </h3>
</div>

<!-- Account Info and Actions Header -->
@if(accountsData.length > 0) {
<div class="account-header d-flex justify-between align-items-center mb-32">
  <div class="account-info d-flex flex-col">
    <div class="account-title-row d-flex align-items-center">
      <h2 class="account-name color-background">{{ getCurrentAccountName() }}</h2>
    </div>
    <div class="account-details d-flex align-items-center">
      <span class="account-server color-secondary-300">{{ getCurrentAccountServer() }}</span>
    </div>
  </div>
  
  <div class="action-buttons d-flex gap-12">
    @if (!loading) {
    <button class="refresh-data-btn d-flex align-items-center gap-8" (click)="refreshCurrentAccountData()">
      <span>Refresh Trade Data</span>
      <span class="material-symbols-outlined" style="font-size: 18px">refresh</span>
    </button>

    <button class="edit-strategy-btn d-flex align-items-center gap-8" (click)="goToEditStrategy()">
      <span>Edit Strategy</span>
      <span class="material-symbols-outlined" style="font-size: 18px">edit_square</span>
    </button>
    }
    
    <div class="change-account-dropdown">
      <button class="change-account-btn d-flex align-items-center gap-8" (click)="toggleAccountDropdown()">
        <span>Change account</span>
        <span class="material-symbols-outlined" style="font-size: 18px">keyboard_arrow_down</span>
      </button>
      
      @if(showAccountDropdown) {
      <div class="account-dropdown">
        <div class="account-dropdown-header d-flex justify-between align-items-center p-12">
          <span class="smallText color-secondary-300">Select Account</span>
          <button class="refresh-accounts-btn" (click)="refreshAccounts()" title="Refresh accounts">
            <span class="material-symbols-outlined" style="font-size: 16px;">refresh</span>
          </button>
        </div>
        @for(account of accountsData; track account.id) {
        <div class="account-option" (click)="selectAccount(account)">
          <div class="account-option-name">{{ account.accountName }}</div>
          <div class="account-option-server">{{ account.server }}</div>
        </div>
        }
      </div>
      }
    </div>
  </div>
</div>
}

@if(accountsData.length === 0) {
  <div class="empty-strategies d-flex flex-col align-items-center">
    <div class="empty-icon">
      <span class="material-symbols-outlined" style="font-size: 28px;">group_add</span>
    </div>
    <h3 class="empty-title">No trading accounts found</h3>
    <p class="empty-description">You need to add a trading account before creating strategies.</p>
    <button class="create-first-btn" (click)="navigateToTradingAccounts()">
      Add Trading Account
    </button>
  </div>
} @else {
<!-- Metrics Section with Loading State -->
@if (!loadingStates.metricsData) {
  <!-- Loading State for Metrics - Mostrar ANTES de la sección -->
  <div class="metrics-loading-container d-flex flex-col align-items-center justify-center p-50 mb-24">
    <app-loading-spinner 
      title="Loading metrics..." 
      description="Fetching your trading statistics.">
    </app-loading-spinner>
  </div>
} @else if (loadingStates.metricsData && stats) {
  <!-- Mostrar métricas cuando estén cargadas -->
  <div class="stats-card-container">
    <app-stat-card
      class="stat-card"
      title="Balance"
      [value]="realTimeBalance ?? undefined"
      formatType="currency"
      [loading]="isBalancesLoading()"
    ></app-stat-card>
    <app-stat-card
      class="stat-card"
      title="Total P&L"
      [value]="stats.netPnl"
      formatType="currency"
    ></app-stat-card>
    <app-stat-card
      class="stat-card"
      title="Trade win %"
      [value]="stats.tradeWinPercent"
      formatType="percentage"
    ></app-stat-card>
    <app-stat-card
      class="stat-card"
      title="Profit Factor"
      [value]="stats.profitFactor"
      formatType="number"
    ></app-stat-card>
    <app-stat-card
      class="stat-card"
      title="Total trades"
      [value]="stats.totalTrades"
      formatType="number"
    ></app-stat-card>
  </div>
}
<div class="middle-container d-flex mb-24">
  <app-PnL-Graph
    [values]="accountHistory"
    (onYearChange)="onYearChange($event)"
  ></app-PnL-Graph>
  <app-win-loss-chart [values]="accountHistory"></app-win-loss-chart>
</div>

<!-- Calendar Section with Loading State -->
@if (loadingStates.calendarData && accountHistory && accountHistory.length > 0) {
  <app-calendar
    [strategies]="strategies"
    [groupedTrades]="accountHistory"
    (strategyFollowedPercentageChange)="onStrategyPercentageChange($event)"
  ></app-calendar>
} @else if (!loadingStates.calendarData) {
  <!-- Loading State for Calendar -->
  <div class="calendar-loading-container d-flex flex-col align-items-center justify-center p-50">
    <app-loading-spinner 
      title="Loading calendar data..." 
      description="Processing your trading history for calendar view.">
    </app-loading-spinner>
  </div>
} @else {
  <!-- Empty State for Calendar -->
  <div class="calendar-empty-container d-flex flex-col align-items-center justify-center p-50">
    <p class="regularText color-secondary-300">No trading data available for calendar view.</p>
  </div>
}

<!-- Plan Limitation Modal -->
<app-plan-limitation-modal
  [modalData]="planLimitationModal"
  (closeModal)="onClosePlanLimitationModal()"
></app-plan-limitation-modal>
}
}
