<div class="calendar-grid d-flex flex-col p-22">
  <div class="calendar-titles mb-14">
    <!-- Título y Selector de meses en una sola línea -->
    <div class="calendar-header-row d-flex items-center justify-between">
      <p class="calendar-title">My Strategy</p>
      
      <!-- Selector de meses en el extremo derecho -->
      <div class="month-navigation d-flex align-items-center gap-12">
        <button 
          class="nav-arrow nav-arrow-left" 
          [disabled]="!canNavigateLeft()"
          (click)="navigateToPreviousMonth()"
          [class.disabled]="!canNavigateLeft()"
        >
          <span class="material-symbols-outlined" style="font-size: 20px;">chevron_left</span>
        </button>
        
        <p class="actual-month">{{ currentMonthYear }}</p>
        
        <button 
          class="nav-arrow nav-arrow-right" 
          [disabled]="!canNavigateRight()"
          (click)="navigateToNextMonth()"
          [class.disabled]="!canNavigateRight()"
        >
          <span class="material-symbols-outlined" style="font-size: 20px;">chevron_right</span>
        </button>
      </div>
      
      <!-- Export Data comentado -->
      <!--
      <button class="export-btn d-flex align-items-center gap-8" (click)="exportData()">
        <span>Export Data</span>
        <span class="material-symbols-outlined" style="font-size: 18px">call_made</span>
      </button>
      -->
    </div>
  </div>
  <div
    class="calendar-header mb-14 d-flex flex-center items-center justify-between"
  >
    @for (day of [ 'Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday',
    'Friday', 'Saturday' ]; track $index) {
    <div class="calendar-day-header smallText color-background">
      {{ day | slice : 0 : 3 }}
    </div>
    }
    <div class="week-header-title smallText color-background">
      Week
    </div>
  </div>
  <div class="calendar-content-wrapper d-flex">
    <div class="calendar-main">
      @for (week of calendar; track $index) {
      <div class="calendar-week d-flex smallText color-background">
        @for (cell of week; track $index) {
        <div
          class="calendar-cell"
          [ngClass]="{
            active: cell.tradesCount > 0,
            'positive-cell': cell.tradesCount > 0 && cell.followedStrategy,
            'negative-cell': cell.tradesCount > 0 && !cell.followedStrategy,
            'clickable': cell.tradesCount > 0,
            'outside-month': !cell.isCurrentMonth
          }"
          (click)="onDayClick(cell)"
        >
          @if (cell.isCurrentMonth) {
          <div class="cell-header">
            @if (cell.tradesCount > 0) {
            <div
              class="strategy-icon"
              [ngClass]="
                cell.followedStrategy ? 'positive-icon' : 'negative-icon'
              "
            >
              <span class="material-symbols-outlined" style="font-size: 20px;">{{ cell.followedStrategy ? 'check_box' : 'indeterminate_check_box' }}</span>
            </div>
            } @else {
            <div class="strategy-icon empty"></div>
            }
            <div class="day-number">
              {{ cell.date.getDate() }}
            </div>
          </div>
          
          @if (cell.tradesCount > 0) {
          <div class="cell-content d-flex flex-col">
            <div class="pnl-amount">
              {{ formatCurrency(cell.pnlTotal) }}
            </div>
            <div class="trades-info">
              {{ cell.tradesCount }} Trade{{ cell.tradesCount > 1 ? "s" : "" }}
            </div>
            <div class="win-percentage">
              {{ formatPercentage(cell.tradeWinPercent) }}
            </div>
          </div>
          }
          }
        </div>
        }
        
        <!-- Weekly Summary Card for this week - Desktop -->
        <div class="week-summary-card desktop-only" 
          [ngClass]="{
            'week-positive': getWeekTotal(week) > 0,
            'week-negative': getWeekTotal(week) < 0,
            'week-neutral': getWeekTotal(week) === 0
          }">
          <div class="week-header">
            <h4 class="week-title">Week {{ $index + 1 }}</h4>
          </div>
          <div class="week-content">
            <div class="week-total" [ngClass]="getWeekTotal(week) > 0 ? 'positive' : 'neutral'">
              {{ formatCurrency(getWeekTotal(week)) }}
            </div>
            <div class="week-days">
              {{ getWeekActiveDays(week) }} days
            </div>
          </div>
        </div>
      </div>
      }
    </div>
  </div>
  
  <!-- Weekly Summary Grid - Mobile -->
  <div class="weekly-summary-grid mobile-only">
    @for (week of calendar; track $index) {
    <div class="week-summary-card-mobile"
      [ngClass]="{
        'week-positive': getWeekTotal(week) > 0,
        'week-negative': getWeekTotal(week) < 0,
        'week-neutral': getWeekTotal(week) === 0
      }">
      <div class="week-header">
        <h4 class="week-title">Week {{ $index + 1 }}</h4>
      </div>
      <div class="week-content">
        <div class="week-total" [ngClass]="getWeekTotal(week) > 0 ? 'positive' : 'neutral'">
          {{ formatCurrency(getWeekTotal(week)) }}
        </div>
        <div class="week-days">
          {{ getWeekActiveDays(week) }} days
        </div>
      </div>
    </div>
    }
  </div>

  <!-- Trades Popup -->
  <app-trades-popup
    [visible]="showTradesPopup"
    [selectedDay]="selectedDay"
    [strategies]="strategies"
    (close)="onClosePopup()"
  ></app-trades-popup>
</div>