import './polyfills.server.mjs';
import{G as Gt,W as Hp,g as Wp,oa as dn,pc as hr,qc as $p,s as zt}from"./chunk-YCCZPWYV.mjs";import{Ha as hm,a as Qp,b as Yp,bb as __,c as Jp,d as Xp,e as Zp,f as em,g as tm,h as nm,i as rm,j as ot,k as S_,l as im,m as T_,n as jt,o as sm,p as E_,q as am,r as om,s as lm,t as cm,u as um,v as dm,w as Yi,x as ic}from"./chunk-RF6MMMYN.mjs";import{a as ee,b as Ze,c as ce,e as dr,f as A,g as jp,h as Kp,i as v_,k as x}from"./chunk-H4UZCO6D.mjs";var fm,pm,hn,sc,mm=dr(()=>{"use strict";fm=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},pm={};(function(){var n;function e(S,m){function y(){}y.prototype=m.prototype,S.D=m.prototype,S.prototype=new y,S.prototype.constructor=S,S.C=function(v,h,E){for(var d=Array(arguments.length-2),f=2;f<arguments.length;f++)d[f-2]=arguments[f];return m.prototype[h].apply(v,d)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(S,m,y){y||(y=0);var v=Array(16);if(typeof m=="string")for(var h=0;16>h;++h)v[h]=m.charCodeAt(y++)|m.charCodeAt(y++)<<8|m.charCodeAt(y++)<<16|m.charCodeAt(y++)<<24;else for(h=0;16>h;++h)v[h]=m[y++]|m[y++]<<8|m[y++]<<16|m[y++]<<24;m=S.g[0],y=S.g[1],h=S.g[2];var E=S.g[3],d=m+(E^y&(h^E))+v[0]+3614090360&4294967295;m=y+(d<<7&4294967295|d>>>25),d=E+(h^m&(y^h))+v[1]+3905402710&4294967295,E=m+(d<<12&4294967295|d>>>20),d=h+(y^E&(m^y))+v[2]+606105819&4294967295,h=E+(d<<17&4294967295|d>>>15),d=y+(m^h&(E^m))+v[3]+3250441966&4294967295,y=h+(d<<22&4294967295|d>>>10),d=m+(E^y&(h^E))+v[4]+4118548399&4294967295,m=y+(d<<7&4294967295|d>>>25),d=E+(h^m&(y^h))+v[5]+1200080426&4294967295,E=m+(d<<12&4294967295|d>>>20),d=h+(y^E&(m^y))+v[6]+2821735955&4294967295,h=E+(d<<17&4294967295|d>>>15),d=y+(m^h&(E^m))+v[7]+4249261313&4294967295,y=h+(d<<22&4294967295|d>>>10),d=m+(E^y&(h^E))+v[8]+1770035416&4294967295,m=y+(d<<7&4294967295|d>>>25),d=E+(h^m&(y^h))+v[9]+2336552879&4294967295,E=m+(d<<12&4294967295|d>>>20),d=h+(y^E&(m^y))+v[10]+4294925233&4294967295,h=E+(d<<17&4294967295|d>>>15),d=y+(m^h&(E^m))+v[11]+2304563134&4294967295,y=h+(d<<22&4294967295|d>>>10),d=m+(E^y&(h^E))+v[12]+1804603682&4294967295,m=y+(d<<7&4294967295|d>>>25),d=E+(h^m&(y^h))+v[13]+4254626195&4294967295,E=m+(d<<12&4294967295|d>>>20),d=h+(y^E&(m^y))+v[14]+2792965006&4294967295,h=E+(d<<17&4294967295|d>>>15),d=y+(m^h&(E^m))+v[15]+1236535329&4294967295,y=h+(d<<22&4294967295|d>>>10),d=m+(h^E&(y^h))+v[1]+4129170786&4294967295,m=y+(d<<5&4294967295|d>>>27),d=E+(y^h&(m^y))+v[6]+3225465664&4294967295,E=m+(d<<9&4294967295|d>>>23),d=h+(m^y&(E^m))+v[11]+643717713&4294967295,h=E+(d<<14&4294967295|d>>>18),d=y+(E^m&(h^E))+v[0]+3921069994&4294967295,y=h+(d<<20&4294967295|d>>>12),d=m+(h^E&(y^h))+v[5]+3593408605&4294967295,m=y+(d<<5&4294967295|d>>>27),d=E+(y^h&(m^y))+v[10]+38016083&4294967295,E=m+(d<<9&4294967295|d>>>23),d=h+(m^y&(E^m))+v[15]+3634488961&4294967295,h=E+(d<<14&4294967295|d>>>18),d=y+(E^m&(h^E))+v[4]+3889429448&4294967295,y=h+(d<<20&4294967295|d>>>12),d=m+(h^E&(y^h))+v[9]+568446438&4294967295,m=y+(d<<5&4294967295|d>>>27),d=E+(y^h&(m^y))+v[14]+3275163606&4294967295,E=m+(d<<9&4294967295|d>>>23),d=h+(m^y&(E^m))+v[3]+4107603335&4294967295,h=E+(d<<14&4294967295|d>>>18),d=y+(E^m&(h^E))+v[8]+1163531501&4294967295,y=h+(d<<20&4294967295|d>>>12),d=m+(h^E&(y^h))+v[13]+2850285829&4294967295,m=y+(d<<5&4294967295|d>>>27),d=E+(y^h&(m^y))+v[2]+4243563512&4294967295,E=m+(d<<9&4294967295|d>>>23),d=h+(m^y&(E^m))+v[7]+1735328473&4294967295,h=E+(d<<14&4294967295|d>>>18),d=y+(E^m&(h^E))+v[12]+2368359562&4294967295,y=h+(d<<20&4294967295|d>>>12),d=m+(y^h^E)+v[5]+4294588738&4294967295,m=y+(d<<4&4294967295|d>>>28),d=E+(m^y^h)+v[8]+2272392833&4294967295,E=m+(d<<11&4294967295|d>>>21),d=h+(E^m^y)+v[11]+1839030562&4294967295,h=E+(d<<16&4294967295|d>>>16),d=y+(h^E^m)+v[14]+4259657740&4294967295,y=h+(d<<23&4294967295|d>>>9),d=m+(y^h^E)+v[1]+2763975236&4294967295,m=y+(d<<4&4294967295|d>>>28),d=E+(m^y^h)+v[4]+1272893353&4294967295,E=m+(d<<11&4294967295|d>>>21),d=h+(E^m^y)+v[7]+4139469664&4294967295,h=E+(d<<16&4294967295|d>>>16),d=y+(h^E^m)+v[10]+3200236656&4294967295,y=h+(d<<23&4294967295|d>>>9),d=m+(y^h^E)+v[13]+681279174&4294967295,m=y+(d<<4&4294967295|d>>>28),d=E+(m^y^h)+v[0]+3936430074&4294967295,E=m+(d<<11&4294967295|d>>>21),d=h+(E^m^y)+v[3]+3572445317&4294967295,h=E+(d<<16&4294967295|d>>>16),d=y+(h^E^m)+v[6]+76029189&4294967295,y=h+(d<<23&4294967295|d>>>9),d=m+(y^h^E)+v[9]+3654602809&4294967295,m=y+(d<<4&4294967295|d>>>28),d=E+(m^y^h)+v[12]+3873151461&4294967295,E=m+(d<<11&4294967295|d>>>21),d=h+(E^m^y)+v[15]+530742520&4294967295,h=E+(d<<16&4294967295|d>>>16),d=y+(h^E^m)+v[2]+3299628645&4294967295,y=h+(d<<23&4294967295|d>>>9),d=m+(h^(y|~E))+v[0]+4096336452&4294967295,m=y+(d<<6&4294967295|d>>>26),d=E+(y^(m|~h))+v[7]+1126891415&4294967295,E=m+(d<<10&4294967295|d>>>22),d=h+(m^(E|~y))+v[14]+2878612391&4294967295,h=E+(d<<15&4294967295|d>>>17),d=y+(E^(h|~m))+v[5]+4237533241&4294967295,y=h+(d<<21&4294967295|d>>>11),d=m+(h^(y|~E))+v[12]+1700485571&4294967295,m=y+(d<<6&4294967295|d>>>26),d=E+(y^(m|~h))+v[3]+2399980690&4294967295,E=m+(d<<10&4294967295|d>>>22),d=h+(m^(E|~y))+v[10]+4293915773&4294967295,h=E+(d<<15&4294967295|d>>>17),d=y+(E^(h|~m))+v[1]+2240044497&4294967295,y=h+(d<<21&4294967295|d>>>11),d=m+(h^(y|~E))+v[8]+1873313359&4294967295,m=y+(d<<6&4294967295|d>>>26),d=E+(y^(m|~h))+v[15]+4264355552&4294967295,E=m+(d<<10&4294967295|d>>>22),d=h+(m^(E|~y))+v[6]+2734768916&4294967295,h=E+(d<<15&4294967295|d>>>17),d=y+(E^(h|~m))+v[13]+1309151649&4294967295,y=h+(d<<21&4294967295|d>>>11),d=m+(h^(y|~E))+v[4]+4149444226&4294967295,m=y+(d<<6&4294967295|d>>>26),d=E+(y^(m|~h))+v[11]+3174756917&4294967295,E=m+(d<<10&4294967295|d>>>22),d=h+(m^(E|~y))+v[2]+718787259&4294967295,h=E+(d<<15&4294967295|d>>>17),d=y+(E^(h|~m))+v[9]+3951481745&4294967295,S.g[0]=S.g[0]+m&4294967295,S.g[1]=S.g[1]+(h+(d<<21&4294967295|d>>>11))&4294967295,S.g[2]=S.g[2]+h&4294967295,S.g[3]=S.g[3]+E&4294967295}r.prototype.u=function(S,m){m===void 0&&(m=S.length);for(var y=m-this.blockSize,v=this.B,h=this.h,E=0;E<m;){if(h==0)for(;E<=y;)i(this,S,E),E+=this.blockSize;if(typeof S=="string"){for(;E<m;)if(v[h++]=S.charCodeAt(E++),h==this.blockSize){i(this,v),h=0;break}}else for(;E<m;)if(v[h++]=S[E++],h==this.blockSize){i(this,v),h=0;break}}this.h=h,this.o+=m},r.prototype.v=function(){var S=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);S[0]=128;for(var m=1;m<S.length-8;++m)S[m]=0;var y=8*this.o;for(m=S.length-8;m<S.length;++m)S[m]=y&255,y/=256;for(this.u(S),S=Array(16),m=y=0;4>m;++m)for(var v=0;32>v;v+=8)S[y++]=this.g[m]>>>v&255;return S};function s(S,m){var y=o;return Object.prototype.hasOwnProperty.call(y,S)?y[S]:y[S]=m(S)}function a(S,m){this.h=m;for(var y=[],v=!0,h=S.length-1;0<=h;h--){var E=S[h]|0;v&&E==m||(y[h]=E,v=!1)}this.g=y}var o={};function l(S){return-128<=S&&128>S?s(S,function(m){return new a([m|0],0>m?-1:0)}):new a([S|0],0>S?-1:0)}function c(S){if(isNaN(S)||!isFinite(S))return p;if(0>S)return b(c(-S));for(var m=[],y=1,v=0;S>=y;v++)m[v]=S/y|0,y*=4294967296;return new a(m,0)}function u(S,m){if(S.length==0)throw Error("number format error: empty string");if(m=m||10,2>m||36<m)throw Error("radix out of range: "+m);if(S.charAt(0)=="-")return b(u(S.substring(1),m));if(0<=S.indexOf("-"))throw Error('number format error: interior "-" character');for(var y=c(Math.pow(m,8)),v=p,h=0;h<S.length;h+=8){var E=Math.min(8,S.length-h),d=parseInt(S.substring(h,h+E),m);8>E?(E=c(Math.pow(m,E)),v=v.j(E).add(c(d))):(v=v.j(y),v=v.add(c(d)))}return v}var p=l(0),g=l(1),T=l(16777216);n=a.prototype,n.m=function(){if(w(this))return-b(this).m();for(var S=0,m=1,y=0;y<this.g.length;y++){var v=this.i(y);S+=(0<=v?v:4294967296+v)*m,m*=4294967296}return S},n.toString=function(S){if(S=S||10,2>S||36<S)throw Error("radix out of range: "+S);if(_(this))return"0";if(w(this))return"-"+b(this).toString(S);for(var m=c(Math.pow(S,6)),y=this,v="";;){var h=C(y,m).g;y=P(y,h.j(m));var E=((0<y.g.length?y.g[0]:y.h)>>>0).toString(S);if(y=h,_(y))return E+v;for(;6>E.length;)E="0"+E;v=E+v}},n.i=function(S){return 0>S?0:S<this.g.length?this.g[S]:this.h};function _(S){if(S.h!=0)return!1;for(var m=0;m<S.g.length;m++)if(S.g[m]!=0)return!1;return!0}function w(S){return S.h==-1}n.l=function(S){return S=P(this,S),w(S)?-1:_(S)?0:1};function b(S){for(var m=S.g.length,y=[],v=0;v<m;v++)y[v]=~S.g[v];return new a(y,~S.h).add(g)}n.abs=function(){return w(this)?b(this):this},n.add=function(S){for(var m=Math.max(this.g.length,S.g.length),y=[],v=0,h=0;h<=m;h++){var E=v+(this.i(h)&65535)+(S.i(h)&65535),d=(E>>>16)+(this.i(h)>>>16)+(S.i(h)>>>16);v=d>>>16,E&=65535,d&=65535,y[h]=d<<16|E}return new a(y,y[y.length-1]&-2147483648?-1:0)};function P(S,m){return S.add(b(m))}n.j=function(S){if(_(this)||_(S))return p;if(w(this))return w(S)?b(this).j(b(S)):b(b(this).j(S));if(w(S))return b(this.j(b(S)));if(0>this.l(T)&&0>S.l(T))return c(this.m()*S.m());for(var m=this.g.length+S.g.length,y=[],v=0;v<2*m;v++)y[v]=0;for(v=0;v<this.g.length;v++)for(var h=0;h<S.g.length;h++){var E=this.i(v)>>>16,d=this.i(v)&65535,f=S.i(h)>>>16,k=S.i(h)&65535;y[2*v+2*h]+=d*k,L(y,2*v+2*h),y[2*v+2*h+1]+=E*k,L(y,2*v+2*h+1),y[2*v+2*h+1]+=d*f,L(y,2*v+2*h+1),y[2*v+2*h+2]+=E*f,L(y,2*v+2*h+2)}for(v=0;v<m;v++)y[v]=y[2*v+1]<<16|y[2*v];for(v=m;v<2*m;v++)y[v]=0;return new a(y,0)};function L(S,m){for(;(S[m]&65535)!=S[m];)S[m+1]+=S[m]>>>16,S[m]&=65535,m++}function F(S,m){this.g=S,this.h=m}function C(S,m){if(_(m))throw Error("division by zero");if(_(S))return new F(p,p);if(w(S))return m=C(b(S),m),new F(b(m.g),b(m.h));if(w(m))return m=C(S,b(m)),new F(b(m.g),m.h);if(30<S.g.length){if(w(S)||w(m))throw Error("slowDivide_ only works with positive integers.");for(var y=g,v=m;0>=v.l(S);)y=K(y),v=K(v);var h=G(y,1),E=G(v,1);for(v=G(v,2),y=G(y,2);!_(v);){var d=E.add(v);0>=d.l(S)&&(h=h.add(y),E=d),v=G(v,1),y=G(y,1)}return m=P(S,h.j(m)),new F(h,m)}for(h=p;0<=S.l(m);){for(y=Math.max(1,Math.floor(S.m()/m.m())),v=Math.ceil(Math.log(y)/Math.LN2),v=48>=v?1:Math.pow(2,v-48),E=c(y),d=E.j(m);w(d)||0<d.l(S);)y-=v,E=c(y),d=E.j(m);_(E)&&(E=g),h=h.add(E),S=P(S,d)}return new F(h,S)}n.A=function(S){return C(this,S).h},n.and=function(S){for(var m=Math.max(this.g.length,S.g.length),y=[],v=0;v<m;v++)y[v]=this.i(v)&S.i(v);return new a(y,this.h&S.h)},n.or=function(S){for(var m=Math.max(this.g.length,S.g.length),y=[],v=0;v<m;v++)y[v]=this.i(v)|S.i(v);return new a(y,this.h|S.h)},n.xor=function(S){for(var m=Math.max(this.g.length,S.g.length),y=[],v=0;v<m;v++)y[v]=this.i(v)^S.i(v);return new a(y,this.h^S.h)};function K(S){for(var m=S.g.length+1,y=[],v=0;v<m;v++)y[v]=S.i(v)<<1|S.i(v-1)>>>31;return new a(y,S.h)}function G(S,m){var y=m>>5;m%=32;for(var v=S.g.length-y,h=[],E=0;E<v;E++)h[E]=0<m?S.i(E+y)>>>m|S.i(E+y+1)<<32-m:S.i(E+y);return new a(h,S.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,sc=pm.Md5=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=c,a.fromString=u,hn=pm.Integer=a}).apply(typeof fm<"u"?fm:typeof self<"u"?self:typeof window<"u"?window:{})});var oe=A(gt=>{"use strict";Object.defineProperty(gt,"__esModule",{value:!0});gt.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=gt.DEFAULT_MAX_SEND_MESSAGE_LENGTH=gt.Propagate=gt.LogVerbosity=gt.Status=void 0;var gm=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n}(gm||(gt.Status=gm={})),ym=function(n){return n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.ERROR=2]="ERROR",n[n.NONE=3]="NONE",n}(ym||(gt.LogVerbosity=ym={})),vm=function(n){return n[n.DEADLINE=1]="DEADLINE",n[n.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",n[n.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",n[n.CANCELLATION=8]="CANCELLATION",n[n.DEFAULTS=65535]="DEFAULTS",n}(vm||(gt.Propagate=vm={}));gt.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1;gt.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4*1024*1024});var ac=A((WP,b_)=>{b_.exports={name:"@grpc/grpc-js",version:"1.9.15",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:"^8.13.0 || >=10.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.6","@types/gulp-mocha":"0.0.32","@types/lodash":"^4.14.186","@types/mocha":"^5.2.6","@types/ncp":"^2.0.1","@types/pify":"^3.0.2","@types/semver":"^7.3.9","@typescript-eslint/eslint-plugin":"^5.59.11","@typescript-eslint/parser":"^5.59.11","@typescript-eslint/typescript-estree":"^5.59.11","clang-format":"^1.0.55",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.4",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.3.5","ts-node":"^10.9.1",typescript:"^5.1.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.8","@types/node":">=12.12.47"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]}});var Te=A(et=>{"use strict";var oc,lc,cc,uc;Object.defineProperty(et,"__esModule",{value:!0});et.isTracerEnabled=et.trace=et.log=et.setLoggerVerbosity=et.setLogger=et.getLogger=void 0;var Dn=oe(),w_=ce("process"),C_=ac().version,I_={error:(n,...e)=>{console.error("E "+n,...e)},info:(n,...e)=>{console.error("I "+n,...e)},debug:(n,...e)=>{console.error("D "+n,...e)}},fr=I_,zr=Dn.LogVerbosity.ERROR,A_=(lc=(oc=process.env.GRPC_NODE_VERBOSITY)!==null&&oc!==void 0?oc:process.env.GRPC_VERBOSITY)!==null&&lc!==void 0?lc:"";switch(A_.toUpperCase()){case"DEBUG":zr=Dn.LogVerbosity.DEBUG;break;case"INFO":zr=Dn.LogVerbosity.INFO;break;case"ERROR":zr=Dn.LogVerbosity.ERROR;break;case"NONE":zr=Dn.LogVerbosity.NONE;break;default:}var R_=()=>fr;et.getLogger=R_;var D_=n=>{fr=n};et.setLogger=D_;var N_=n=>{zr=n};et.setLoggerVerbosity=N_;var O_=(n,...e)=>{let t;if(n>=zr){switch(n){case Dn.LogVerbosity.DEBUG:t=fr.debug;break;case Dn.LogVerbosity.INFO:t=fr.info;break;case Dn.LogVerbosity.ERROR:t=fr.error;break}t||(t=fr.error),t&&t.bind(fr)(...e)}};et.log=O_;var x_=(uc=(cc=process.env.GRPC_NODE_TRACE)!==null&&cc!==void 0?cc:process.env.GRPC_TRACE)!==null&&uc!==void 0?uc:"",dc=new Set,Sm=new Set;for(let n of x_.split(","))n.startsWith("-")?Sm.add(n.substring(1)):dc.add(n);var k_=dc.has("all");function P_(n,e,t){Tm(e)&&(0,et.log)(n,new Date().toISOString()+" | v"+C_+" "+w_.pid+" | "+e+" | "+t)}et.trace=P_;function Tm(n){return!Sm.has(n)&&(k_||dc.has(n))}et.isTracerEnabled=Tm});var ua=A(Gr=>{"use strict";Object.defineProperty(Gr,"__esModule",{value:!0});Gr.getErrorCode=Gr.getErrorMessage=void 0;function M_(n){return n instanceof Error?n.message:String(n)}Gr.getErrorMessage=M_;function L_(n){return typeof n=="object"&&n!==null&&"code"in n&&typeof n.code=="number"?n.code:null}Gr.getErrorCode=L_});var rt=A(ha=>{"use strict";Object.defineProperty(ha,"__esModule",{value:!0});ha.Metadata=void 0;var F_=Te(),B_=oe(),U_=ua(),q_=/^[0-9a-z_.-]+$/,V_=/^[ -~]*$/;function z_(n){return q_.test(n)}function G_(n){return V_.test(n)}function _m(n){return n.endsWith("-bin")}function j_(n){return!n.startsWith("grpc-")}function da(n){return n.toLowerCase()}function Em(n,e){if(!z_(n))throw new Error('Metadata key "'+n+'" contains illegal characters');if(e!=null)if(_m(n)){if(!Buffer.isBuffer(e))throw new Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(e))throw new Error("keys that don't end with '-bin' must have String values");if(!G_(e))throw new Error('Metadata string value "'+e+'" contains illegal characters')}}var hc=class n{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){e=da(e),Em(e,t),this.internalRepr.set(e,[t])}add(e,t){e=da(e),Em(e,t);let r=this.internalRepr.get(e);r===void 0?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=da(e),this.internalRepr.delete(e)}get(e){return e=da(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let i=r[0];e[t]=Buffer.isBuffer(i)?Buffer.from(i):i}return e}clone(){let e=new n(this.options),t=e.internalRepr;for(let[r,i]of this.internalRepr){let s=i.map(a=>Buffer.isBuffer(a)?Buffer.from(a):a);t.set(r,s)}return e}merge(e){for(let[t,r]of e.internalRepr){let i=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,i)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(K_);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new n;for(let r of Object.keys(e)){if(r.charAt(0)===":")continue;let i=e[r];try{_m(r)?Array.isArray(i)?i.forEach(s=>{t.add(r,Buffer.from(s,"base64"))}):i!==void 0&&(j_(r)?i.split(",").forEach(s=>{t.add(r,Buffer.from(s.trim(),"base64"))}):t.add(r,Buffer.from(i,"base64"))):Array.isArray(i)?i.forEach(s=>{t.add(r,s)}):i!==void 0&&t.add(r,i)}catch(s){let a=`Failed to add metadata entry ${r}: ${i}. ${(0,U_.getErrorMessage)(s)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,F_.log)(B_.LogVerbosity.ERROR,a)}}return t}};ha.Metadata=hc;var K_=n=>Buffer.isBuffer(n)?n.toString("base64"):n});var yc=A(fa=>{"use strict";Object.defineProperty(fa,"__esModule",{value:!0});fa.CallCredentials=void 0;var gc=rt();function W_(n){return"getRequestHeaders"in n&&typeof n.getRequestHeaders=="function"}var jr=class n{static createFromMetadataGenerator(e){return new pc(e)}static createFromGoogleCredential(e){return n.createFromMetadataGenerator((t,r)=>{let i;W_(e)?i=e.getRequestHeaders(t.service_url):i=new Promise((s,a)=>{e.getRequestMetadata(t.service_url,(o,l)=>{if(o){a(o);return}if(!l){a(new Error("Headers not set by metadata plugin"));return}s(l)})}),i.then(s=>{let a=new gc.Metadata;for(let o of Object.keys(s))a.add(o,s[o]);r(null,a)},s=>{r(s)})})}static createEmpty(){return new mc}};fa.CallCredentials=jr;var fc=class n extends jr{constructor(e){super(),this.creds=e}generateMetadata(e){return x(this,null,function*(){let t=new gc.Metadata,r=yield Promise.all(this.creds.map(i=>i.generateMetadata(e)));for(let i of r)t.merge(i);return t})}compose(e){return new n(this.creds.concat([e]))}_equals(e){return this===e?!0:e instanceof n?this.creds.every((t,r)=>t._equals(e.creds[r])):!1}},pc=class n extends jr{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(i,s)=>{s!==void 0?t(s):r(i)})})}compose(e){return new fc([this,e])}_equals(e){return this===e?!0:e instanceof n?this.metadataGenerator===e.metadataGenerator:!1}},mc=class n extends jr{generateMetadata(e){return Promise.resolve(new gc.Metadata)}compose(e){return e}_equals(e){return e instanceof n}}});var Sc=A(Kr=>{"use strict";Object.defineProperty(Kr,"__esModule",{value:!0});Kr.getDefaultRootsData=Kr.CIPHER_SUITES=void 0;var H_=ce("fs");Kr.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;var bm=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,vc=null;function $_(){return bm?(vc===null&&(vc=H_.readFileSync(bm)),vc):null}Kr.getDefaultRootsData=$_});var ga=A(ma=>{"use strict";Object.defineProperty(ma,"__esModule",{value:!0});ma.ChannelCredentials=void 0;var Q_=ce("tls"),Y_=yc(),wm=Sc();function Tc(n,e){if(n&&!(n instanceof Buffer))throw new TypeError(`${e}, if provided, must be a Buffer.`)}var Wr=class{constructor(e){this.callCredentials=e||Y_.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var s;if(Tc(e,"Root certificate"),Tc(t,"Private key"),Tc(r,"Certificate chain"),t&&!r)throw new Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw new Error("Certificate chain must be given with accompanying private key");let a=(0,Q_.createSecureContext)({ca:(s=e??(0,wm.getDefaultRootsData)())!==null&&s!==void 0?s:void 0,key:t??void 0,cert:r??void 0,ciphers:wm.CIPHER_SUITES});return new pa(a,i??{})}static createFromSecureContext(e,t){return new pa(e,t??{})}static createInsecure(){return new Ec}};ma.ChannelCredentials=Wr;var Ec=class n extends Wr{constructor(e){super(e)}compose(e){throw new Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof n}},pa=class n extends Wr{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},t?.checkServerIdentity&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){let t=this.callCredentials.compose(e);return new _c(this,t)}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity:!1}},_c=class n extends Wr{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new n(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials):!1}}});var On=A(je=>{"use strict";Object.defineProperty(je,"__esModule",{value:!0});je.validateLoadBalancingConfig=je.getFirstUsableConfig=je.isLoadBalancerNameRegistered=je.createLoadBalancer=je.registerDefaultLoadBalancerType=je.registerLoadBalancerType=je.createChildChannelControlHelper=void 0;function J_(n,e){var t,r,i,s,a,o,l,c,u,p;return{createSubchannel:(r=(t=e.createSubchannel)===null||t===void 0?void 0:t.bind(e))!==null&&r!==void 0?r:n.createSubchannel.bind(n),updateState:(s=(i=e.updateState)===null||i===void 0?void 0:i.bind(e))!==null&&s!==void 0?s:n.updateState.bind(n),requestReresolution:(o=(a=e.requestReresolution)===null||a===void 0?void 0:a.bind(e))!==null&&o!==void 0?o:n.requestReresolution.bind(n),addChannelzChild:(c=(l=e.addChannelzChild)===null||l===void 0?void 0:l.bind(e))!==null&&c!==void 0?c:n.addChannelzChild.bind(n),removeChannelzChild:(p=(u=e.removeChannelzChild)===null||u===void 0?void 0:u.bind(e))!==null&&p!==void 0?p:n.removeChannelzChild.bind(n)}}je.createChildChannelControlHelper=J_;var Nn={},bc=null;function X_(n,e,t){Nn[n]={LoadBalancer:e,LoadBalancingConfig:t}}je.registerLoadBalancerType=X_;function Z_(n){bc=n}je.registerDefaultLoadBalancerType=Z_;function eb(n,e){let t=n.getLoadBalancerName();return t in Nn?new Nn[t].LoadBalancer(e):null}je.createLoadBalancer=eb;function tb(n){return n in Nn}je.isLoadBalancerNameRegistered=tb;function nb(n,e=!1){for(let t of n)if(t.getLoadBalancerName()in Nn)return t;return e&&bc?new Nn[bc].LoadBalancingConfig:null}je.getFirstUsableConfig=nb;function rb(n){if(!(n!==null&&typeof n=="object"))throw new Error("Load balancing config must be an object");let e=Object.keys(n);if(e.length!==1)throw new Error("Provided load balancing config has multiple conflicting entries");let t=e[0];if(t in Nn)return Nn[t].LoadBalancingConfig.createFromJson(n[t]);throw new Error(`Unrecognized load balancing config name ${t}`)}je.validateLoadBalancingConfig=rb});var wc=A(xn=>{"use strict";Object.defineProperty(xn,"__esModule",{value:!0});xn.extractAndSelectServiceConfig=xn.validateServiceConfig=xn.validateRetryThrottling=void 0;var ib=ce("os"),ya=oe(),sb=On(),va=/^\d+(\.\d{1,9})?s$/,ab="node";function ob(n){if("service"in n&&n.service!==""){if(typeof n.service!="string")throw new Error(`Invalid method config name: invalid service: expected type string, got ${typeof n.service}`);if("method"in n&&n.method!==""){if(typeof n.method!="string")throw new Error(`Invalid method config name: invalid method: expected type string, got ${typeof n.service}`);return{service:n.service,method:n.method}}else return{service:n.service}}else{if("method"in n&&n.method!==void 0)throw new Error("Invalid method config name: method set with empty or unset service");return{}}}function lb(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in n)||typeof n.initialBackoff!="string"||!va.test(n.initialBackoff))throw new Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in n)||typeof n.maxBackoff!="string"||!va.test(n.maxBackoff))throw new Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in n)||typeof n.backoffMultiplier!="number"||n.backoffMultiplier<=0)throw new Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in n&&Array.isArray(n.retryableStatusCodes)))throw new Error("Invalid method config retry policy: retryableStatusCodes is required");if(n.retryableStatusCodes.length===0)throw new Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let e of n.retryableStatusCodes)if(typeof e=="number"){if(!Object.values(ya.Status).includes(e))throw new Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if(typeof e=="string"){if(!Object.values(ya.Status).includes(e.toUpperCase()))throw new Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw new Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:n.maxAttempts,initialBackoff:n.initialBackoff,maxBackoff:n.maxBackoff,backoffMultiplier:n.backoffMultiplier,retryableStatusCodes:n.retryableStatusCodes}}function cb(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in n&&(typeof n.hedgingDelay!="string"||!va.test(n.hedgingDelay)))throw new Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in n&&Array.isArray(n.nonFatalStatusCodes))for(let t of n.nonFatalStatusCodes)if(typeof t=="number"){if(!Object.values(ya.Status).includes(t))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if(typeof t=="string"){if(!Object.values(ya.Status).includes(t.toUpperCase()))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let e={maxAttempts:n.maxAttempts};return n.hedgingDelay&&(e.hedgingDelay=n.hedgingDelay),n.nonFatalStatusCodes&&(e.nonFatalStatusCodes=n.nonFatalStatusCodes),e}function ub(n){var e;let t={name:[]};if(!("name"in n)||!Array.isArray(n.name))throw new Error("Invalid method config: invalid name array");for(let r of n.name)t.name.push(ob(r));if("waitForReady"in n){if(typeof n.waitForReady!="boolean")throw new Error("Invalid method config: invalid waitForReady");t.waitForReady=n.waitForReady}if("timeout"in n)if(typeof n.timeout=="object"){if(!("seconds"in n.timeout)||typeof n.timeout.seconds!="number")throw new Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in n.timeout)||typeof n.timeout.nanos!="number")throw new Error("Invalid method config: invalid timeout.nanos");t.timeout=n.timeout}else if(typeof n.timeout=="string"&&va.test(n.timeout)){let r=n.timeout.substring(0,n.timeout.length-1).split(".");t.timeout={seconds:r[0]|0,nanos:((e=r[1])!==null&&e!==void 0?e:0)|0}}else throw new Error("Invalid method config: invalid timeout");if("maxRequestBytes"in n){if(typeof n.maxRequestBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxRequestBytes=n.maxRequestBytes}if("maxResponseBytes"in n){if(typeof n.maxResponseBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxResponseBytes=n.maxResponseBytes}if("retryPolicy"in n){if("hedgingPolicy"in n)throw new Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");t.retryPolicy=lb(n.retryPolicy)}else"hedgingPolicy"in n&&(t.hedgingPolicy=cb(n.hedgingPolicy));return t}function Cm(n){if(!("maxTokens"in n)||typeof n.maxTokens!="number"||n.maxTokens<=0||n.maxTokens>1e3)throw new Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in n)||typeof n.tokenRatio!="number"||n.tokenRatio<=0)throw new Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+n.maxTokens.toFixed(3),tokenRatio:+n.tokenRatio.toFixed(3)}}xn.validateRetryThrottling=Cm;function Im(n){let e={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in n)if(typeof n.loadBalancingPolicy=="string")e.loadBalancingPolicy=n.loadBalancingPolicy;else throw new Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in n)if(Array.isArray(n.loadBalancingConfig))for(let r of n.loadBalancingConfig)e.loadBalancingConfig.push((0,sb.validateLoadBalancingConfig)(r));else throw new Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in n&&Array.isArray(n.methodConfig))for(let r of n.methodConfig)e.methodConfig.push(ub(r));"retryThrottling"in n&&(e.retryThrottling=Cm(n.retryThrottling));let t=[];for(let r of e.methodConfig)for(let i of r.name){for(let s of t)if(i.service===s.service&&i.method===s.method)throw new Error(`Invalid service config: duplicate name ${i.service}/${i.method}`);t.push(i)}return e}xn.validateServiceConfig=Im;function db(n){if(!("serviceConfig"in n))throw new Error("Invalid service config choice: missing service config");let e={serviceConfig:Im(n.serviceConfig)};if("clientLanguage"in n)if(Array.isArray(n.clientLanguage)){e.clientLanguage=[];for(let r of n.clientLanguage)if(typeof r=="string")e.clientLanguage.push(r);else throw new Error("Invalid service config choice: invalid clientLanguage")}else throw new Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in n)if(Array.isArray(n.clientHostname)){e.clientHostname=[];for(let r of n.clientHostname)if(typeof r=="string")e.clientHostname.push(r);else throw new Error("Invalid service config choice: invalid clientHostname")}else throw new Error("Invalid service config choice: invalid clientHostname");if("percentage"in n)if(typeof n.percentage=="number"&&0<=n.percentage&&n.percentage<=100)e.percentage=n.percentage;else throw new Error("Invalid service config choice: invalid percentage");let t=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let r in n)if(!t.includes(r))throw new Error(`Invalid service config choice: unexpected field ${r}`);return e}function hb(n,e){if(!Array.isArray(n))throw new Error("Invalid service config list");for(let t of n){let r=db(t);if(!(typeof r.percentage=="number"&&e>r.percentage)){if(Array.isArray(r.clientHostname)){let i=!1;for(let s of r.clientHostname)s===ib.hostname()&&(i=!0);if(!i)continue}if(Array.isArray(r.clientLanguage)){let i=!1;for(let s of r.clientLanguage)s===ab&&(i=!0);if(!i)continue}return r.serviceConfig}}throw new Error("No matching service config found")}function fb(n,e){for(let t of n)if(t.length>0&&t[0].startsWith("grpc_config=")){let r=t.join("").substring(12),i=JSON.parse(r);return hb(i,e)}return null}xn.extractAndSelectServiceConfig=fb});var yt=A(Sa=>{"use strict";Object.defineProperty(Sa,"__esModule",{value:!0});Sa.ConnectivityState=void 0;var Am=function(n){return n[n.IDLE=0]="IDLE",n[n.CONNECTING=1]="CONNECTING",n[n.READY=2]="READY",n[n.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",n[n.SHUTDOWN=4]="SHUTDOWN",n}(Am||(Sa.ConnectivityState=Am={}))});var lt=A(kn=>{"use strict";Object.defineProperty(kn,"__esModule",{value:!0});kn.uriToString=kn.splitHostPort=kn.parseUri=void 0;var pb=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function mb(n){let e=pb.exec(n);return e===null?null:{scheme:e[1],authority:e[2],path:e[3]}}kn.parseUri=mb;var Rm=/^\d+$/;function gb(n){if(n.startsWith("[")){let e=n.indexOf("]");if(e===-1)return null;let t=n.substring(1,e);if(t.indexOf(":")===-1)return null;if(n.length>e+1)if(n[e+1]===":"){let r=n.substring(e+2);return Rm.test(r)?{host:t,port:+r}:null}else return null;else return{host:t}}else{let e=n.split(":");return e.length===2?Rm.test(e[1])?{host:e[0],port:+e[1]}:null:{host:n}}}kn.splitHostPort=gb;function yb(n){let e="";return n.scheme!==void 0&&(e+=n.scheme+":"),n.authority!==void 0&&(e+="//"+n.authority+"/"),e+=n.path,e}kn.uriToString=yb});var Kt=A(vt=>{"use strict";Object.defineProperty(vt,"__esModule",{value:!0});vt.mapUriDefaultScheme=vt.getDefaultAuthority=vt.createResolver=vt.registerDefaultScheme=vt.registerResolver=void 0;var Ic=lt(),Hr={},Cc=null;function vb(n,e){Hr[n]=e}vt.registerResolver=vb;function Sb(n){Cc=n}vt.registerDefaultScheme=Sb;function Tb(n,e,t){if(n.scheme!==void 0&&n.scheme in Hr)return new Hr[n.scheme](n,e,t);throw new Error(`No resolver could be created for target ${(0,Ic.uriToString)(n)}`)}vt.createResolver=Tb;function Eb(n){if(n.scheme!==void 0&&n.scheme in Hr)return Hr[n.scheme].getDefaultAuthority(n);throw new Error(`Invalid target ${(0,Ic.uriToString)(n)}`)}vt.getDefaultAuthority=Eb;function _b(n){return n.scheme===void 0||!(n.scheme in Hr)?Cc!==null?{scheme:Cc,authority:void 0,path:(0,Ic.uriToString)(n)}:null:n}vt.mapUriDefaultScheme=_b});var Mn=A(Pn=>{"use strict";Object.defineProperty(Pn,"__esModule",{value:!0});Pn.QueuePicker=Pn.UnavailablePicker=Pn.PickResultType=void 0;var bb=rt(),wb=oe(),Ta=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.QUEUE=1]="QUEUE",n[n.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",n[n.DROP=3]="DROP",n}(Ta||(Pn.PickResultType=Ta={})),Ac=class{constructor(e){this.status=Object.assign({code:wb.Status.UNAVAILABLE,details:"No connection established",metadata:new bb.Metadata},e)}pick(e){return{pickResultType:Ta.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}};Pn.UnavailablePicker=Ac;var Rc=class{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:Ta.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}};Pn.QueuePicker=Rc});var Ji=A(Ea=>{"use strict";Object.defineProperty(Ea,"__esModule",{value:!0});Ea.BackoffTimeout=void 0;var Cb=1e3,Ib=1.6,Ab=12e4,Rb=.2;function Db(n,e){return Math.random()*(e-n)+n}var Dc=class{constructor(e,t){this.callback=e,this.initialDelay=Cb,this.multiplier=Ib,this.maxDelay=Ab,this.jitter=Rb,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||(r=(t=this.timerId).unref)===null||r===void 0||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+Db(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,(t=(e=this.timerId).ref)===null||t===void 0||t.call(e)}unref(){var e,t;this.hasRef=!1,(t=(e=this.timerId).unref)===null||t===void 0||t.call(e)}getEndTime(){return this.endTime}};Ea.BackoffTimeout=Dc});var ba=A(_a=>{"use strict";Object.defineProperty(_a,"__esModule",{value:!0});_a.ChildLoadBalancerHandler=void 0;var Nb=On(),Ob=yt(),xb="child_load_balancer_helper",Nc=class{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(t){this.parent=t,this.child=null}createSubchannel(t,r){return this.parent.channelControlHelper.createSubchannel(t,r)}updateState(t,r){var i;if(this.calledByPendingChild()){if(t===Ob.ConnectivityState.CONNECTING)return;(i=this.parent.currentChild)===null||i===void 0||i.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(t,r)}requestReresolution(){var t;let r=(t=this.parent.pendingChild)!==null&&t!==void 0?t:this.parent.currentChild;this.child===r&&this.parent.channelControlHelper.requestReresolution()}setChild(t){this.child=t}addChannelzChild(t){this.parent.channelControlHelper.addChannelzChild(t)}removeChannelzChild(t){this.parent.channelControlHelper.removeChannelzChild(t)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(this.currentChild===null||this.latestConfig===null||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let s=new this.ChildPolicyHelper(this),a=(0,Nb.createLoadBalancer)(t,s);s.setChild(a),this.currentChild===null?(this.currentChild=a,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=a,i=this.pendingChild)}else this.pendingChild===null?i=this.currentChild:i=this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return xb}};_a.ChildLoadBalancerHandler=Nc});var Nm=A(wa=>{"use strict";Object.defineProperty(wa,"__esModule",{value:!0});wa.ResolvingLoadBalancer=void 0;var kb=On(),Pb=wc(),it=yt(),Mb=Kt(),$r=Mn(),Lb=Ji(),Oc=oe(),Fb=rt(),Bb=Te(),Ub=oe(),qb=lt(),Vb=ba(),zb="resolving_load_balancer";function Dm(n){Bb.trace(Ub.LogVerbosity.DEBUG,zb,n)}var Gb=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function jb(n,e,t,r){for(let i of t.name)switch(r){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===n&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===n&&i.method===e)return!0}return!1}function Kb(n,e,t,r){for(let i of t)if(jb(n,e,i,r))return i;return null}function Wb(n){return function(t,r){var i,s;let a=t.split("/").filter(c=>c.length>0),o=(i=a[0])!==null&&i!==void 0?i:"",l=(s=a[1])!==null&&s!==void 0?s:"";if(n&&n.methodConfig)for(let c of Gb){let u=Kb(o,l,n.methodConfig,c);if(u)return{methodConfig:u,pickInformation:{},status:Oc.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:Oc.Status.OK,dynamicFilterFactories:[]}}}var xc=class{constructor(e,t,r,i,s){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=i,this.onFailedResolution=s,this.latestChildState=it.ConnectivityState.IDLE,this.latestChildPicker=new $r.QueuePicker(this),this.currentState=it.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,Pb.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(it.ConnectivityState.IDLE,new $r.QueuePicker(this)),this.childLoadBalancer=new Vb.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(Dm("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(o,l)=>{this.latestChildState=o,this.latestChildPicker=l,this.updateState(o,l)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,Mb.createResolver)(e,{onSuccessfulResolution:(o,l,c,u,p)=>{var g;this.backoffTimeout.stop(),this.backoffTimeout.reset();let T=null;l===null?c===null?(this.previousServiceConfig=null,T=this.defaultServiceConfig):this.previousServiceConfig===null?this.handleResolutionFailure(c):T=this.previousServiceConfig:(T=l,this.previousServiceConfig=l);let _=(g=T?.loadBalancingConfig)!==null&&g!==void 0?g:[],w=(0,kb.getFirstUsableConfig)(_,!0);if(w===null){this.handleResolutionFailure({code:Oc.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new Fb.Metadata});return}this.childLoadBalancer.updateAddressList(o,w,p);let b=T??this.defaultServiceConfig;this.onSuccessfulResolution(b,u??Wb(b))},onError:o=>{this.handleResolutionFailure(o)}},r);let a={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new Lb.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},a),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===it.ConnectivityState.IDLE&&this.updateState(it.ConnectivityState.CONNECTING,new $r.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){Dm((0,qb.uriToString)(this.target)+" "+it.ConnectivityState[this.currentState]+" -> "+it.ConnectivityState[e]),e===it.ConnectivityState.IDLE&&(t=new $r.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===it.ConnectivityState.IDLE&&(this.updateState(it.ConnectivityState.TRANSIENT_FAILURE,new $r.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===it.ConnectivityState.IDLE||this.currentState===it.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw new Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=it.ConnectivityState.IDLE,this.latestChildPicker=new $r.QueuePicker(this),this.currentState=it.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}};wa.ResolvingLoadBalancer=xc});var Om=A(Qr=>{"use strict";Object.defineProperty(Qr,"__esModule",{value:!0});Qr.channelOptionsEqual=Qr.recognizedOptions=void 0;Qr.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0};function Hb(n,e){let t=Object.keys(n).sort(),r=Object.keys(e).sort();if(t.length!==r.length)return!1;for(let i=0;i<t.length;i+=1)if(t[i]!==r[i]||n[t[i]]!==e[r[i]])return!1;return!0}Qr.channelOptionsEqual=Hb});var Ht=A(Wt=>{"use strict";Object.defineProperty(Wt,"__esModule",{value:!0});Wt.stringToSubchannelAddress=Wt.subchannelAddressToString=Wt.subchannelAddressEqual=Wt.isTcpSubchannelAddress=void 0;var $b=ce("net");function Xi(n){return"port"in n}Wt.isTcpSubchannelAddress=Xi;function Qb(n,e){return!n&&!e?!0:!n||!e?!1:Xi(n)?Xi(e)&&n.host===e.host&&n.port===e.port:!Xi(e)&&n.path===e.path}Wt.subchannelAddressEqual=Qb;function Yb(n){return Xi(n)?n.host+":"+n.port:n.path}Wt.subchannelAddressToString=Yb;var Jb=443;function Xb(n,e){return(0,$b.isIP)(n)?{host:n,port:e??Jb}:{path:n}}Wt.stringToSubchannelAddress=Xb});var Ca=A(Yr=>{"use strict";Object.defineProperty(Yr,"__esModule",{value:!0});Yr.addAdminServicesToServer=Yr.registerAdminService=void 0;var xm=[];function Zb(n,e){xm.push({getServiceDefinition:n,getHandlers:e})}Yr.registerAdminService=Zb;function ew(n){for(let{getServiceDefinition:e,getHandlers:t}of xm)n.addService(e(),t())}Yr.addAdminServicesToServer=ew});var km=A(St=>{"use strict";Object.defineProperty(St,"__esModule",{value:!0});St.ClientDuplexStreamImpl=St.ClientWritableStreamImpl=St.ClientReadableStreamImpl=St.ClientUnaryCallImpl=St.callErrorFromStatus=void 0;var tw=ce("events"),Fc=ce("stream"),Zi=oe();function nw(n,e){let t=`${n.code} ${Zi.Status[n.code]}: ${n.details}`,i=`${new Error(t).stack}
for call at
${e}`;return Object.assign(new Error(t),n,{stack:i})}St.callErrorFromStatus=nw;var kc=class extends tw.EventEmitter{constructor(){super()}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Zi.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}};St.ClientUnaryCallImpl=kc;var Pc=class extends Fc.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Zi.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}};St.ClientReadableStreamImpl=Pc;var Mc=class extends Fc.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Zi.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_write(e,t,r){var i;let s={callback:r},a=Number(t);Number.isNaN(a)||(s.flags=a),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};St.ClientWritableStreamImpl=Mc;var Lc=class extends Fc.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Zi.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}_write(e,t,r){var i;let s={callback:r},a=Number(t);Number.isNaN(a)||(s.flags=a),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};St.ClientDuplexStreamImpl=Lc});var Pm=A(Jr=>{"use strict";Object.defineProperty(Jr,"__esModule",{value:!0});Jr.InterceptingListenerImpl=Jr.isInterceptingListener=void 0;function rw(n){return n.onReceiveMetadata!==void 0&&n.onReceiveMetadata.length===1}Jr.isInterceptingListener=rw;var Bc=class{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextListener.onReceiveStatus(t)})}};Jr.InterceptingListenerImpl=Bc});var Kc=A(Tt=>{"use strict";Object.defineProperty(Tt,"__esModule",{value:!0});Tt.getInterceptingCall=Tt.InterceptingCall=Tt.RequesterBuilder=Tt.ListenerBuilder=Tt.InterceptorConfigurationError=void 0;var iw=rt(),Mm=Pm(),Lm=oe(),Fm=ua(),ts=class n extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,n)}};Tt.InterceptorConfigurationError=ts;var qc=class{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}};Tt.ListenerBuilder=qc;var Vc=class{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}};Tt.RequesterBuilder=Vc;var Uc={onReceiveMetadata:(n,e)=>{e(n)},onReceiveMessage:(n,e)=>{e(n)},onReceiveStatus:(n,e)=>{e(n)}},es={start:(n,e,t)=>{t(n,e)},sendMessage:(n,e)=>{e(n)},halfClose:n=>{n()},cancel:n=>{n()}},zc=class{constructor(e,t){var r,i,s,a;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:(r=t.start)!==null&&r!==void 0?r:es.start,sendMessage:(i=t.sendMessage)!==null&&i!==void 0?i:es.sendMessage,halfClose:(s=t.halfClose)!==null&&s!==void 0?s:es.halfClose,cancel:(a=t.cancel)!==null&&a!==void 0?a:es.cancel}:this.requester=es}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,i,s,a,o,l;let c={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:u=>{},onReceiveMessage:(a=(s=t?.onReceiveMessage)===null||s===void 0?void 0:s.bind(t))!==null&&a!==void 0?a:u=>{},onReceiveStatus:(l=(o=t?.onReceiveStatus)===null||o===void 0?void 0:o.bind(t))!==null&&l!==void 0?l:u=>{}};this.processingMetadata=!0,this.requester.start(e,c,(u,p)=>{var g,T,_;this.processingMetadata=!1;let w;if((0,Mm.isInterceptingListener)(p))w=p;else{let b={onReceiveMetadata:(g=p.onReceiveMetadata)!==null&&g!==void 0?g:Uc.onReceiveMetadata,onReceiveMessage:(T=p.onReceiveMessage)!==null&&T!==void 0?T:Uc.onReceiveMessage,onReceiveStatus:(_=p.onReceiveStatus)!==null&&_!==void 0?_:Uc.onReceiveStatus};w=new Mm.InterceptingListenerImpl(b,c)}this.nextCall.start(u,w),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}};Tt.InterceptingCall=zc;function sw(n,e,t){var r,i;let s=(r=t.deadline)!==null&&r!==void 0?r:1/0,a=t.host,o=(i=t.parent)!==null&&i!==void 0?i:null,l=t.propagate_flags,c=t.credentials,u=n.createCall(e,s,a,o,l);return c&&u.setCredentials(c),u}var Ia=class{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(i){this.call.cancelWithStatus(Lm.Status.INTERNAL,`Request message serialization failure: ${(0,Fm.getErrorMessage)(i)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:i=>{var s;(s=t?.onReceiveMetadata)===null||s===void 0||s.call(t,i)},onReceiveMessage:i=>{var s;let a;try{a=this.methodDefinition.responseDeserialize(i)}catch(o){r={code:Lm.Status.INTERNAL,details:`Response message parsing error: ${(0,Fm.getErrorMessage)(o)}`,metadata:new iw.Metadata},this.call.cancelWithStatus(r.code,r.details);return}(s=t?.onReceiveMessage)===null||s===void 0||s.call(t,a)},onReceiveStatus:i=>{var s,a;r?(s=t?.onReceiveStatus)===null||s===void 0||s.call(t,r):(a=t?.onReceiveStatus)===null||a===void 0||a.call(t,i)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}},Gc=class extends Ia{constructor(e,t){super(e,t)}start(e,t){var r,i;let s=!1,a={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:o=>{},onReceiveMessage:o=>{var l;s=!0,(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,o)},onReceiveStatus:o=>{var l,c;s||(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,null),(c=t?.onReceiveStatus)===null||c===void 0||c.call(t,o)}};super.start(e,a),this.call.startRead()}},jc=class extends Ia{};function aw(n,e,t){let r=sw(n,t.path,e);return t.responseStream?new jc(r,t):new Gc(r,t)}function ow(n,e,t,r){if(n.clientInterceptors.length>0&&n.clientInterceptorProviders.length>0)throw new ts("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(n.callInterceptors.length>0&&n.callInterceptorProviders.length>0)throw new ts("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];n.callInterceptors.length>0||n.callInterceptorProviders.length>0?i=[].concat(n.callInterceptors,n.callInterceptorProviders.map(o=>o(e))).filter(o=>o):i=[].concat(n.clientInterceptors,n.clientInterceptorProviders.map(o=>o(e))).filter(o=>o);let s=Object.assign({},t,{method_definition:e});return i.reduceRight((o,l)=>c=>l(c,o),o=>aw(r,o,e))(s)}Tt.getInterceptingCall=ow});var $c=A(Ra=>{"use strict";Object.defineProperty(Ra,"__esModule",{value:!0});Ra.Client=void 0;var $t=km(),lw=Qc(),cw=yt(),Ln=oe(),Xr=rt(),Aa=Kc(),Dt=Symbol(),Zr=Symbol(),ei=Symbol(),fn=Symbol();function Wc(n){return typeof n=="function"}function ti(n){return n.stack.split(`
`).slice(1).join(`
`)}var Hc=class{constructor(e,t,r={}){var i,s;if(r=Object.assign({},r),this[Zr]=(i=r.interceptors)!==null&&i!==void 0?i:[],delete r.interceptors,this[ei]=(s=r.interceptor_providers)!==null&&s!==void 0?s:[],delete r.interceptor_providers,this[Zr].length>0&&this[ei].length>0)throw new Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[fn]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[Dt]=r.channelOverride;else if(r.channelFactoryOverride){let a=r.channelFactoryOverride;delete r.channelFactoryOverride,this[Dt]=a(e,t,r)}else this[Dt]=new lw.ChannelImplementation(e,t,r)}close(){this[Dt].close()}getChannel(){return this[Dt]}waitForReady(e,t){let r=i=>{if(i){t(new Error("Failed to connect before the deadline"));return}let s;try{s=this[Dt].getConnectivityState(!0)}catch{t(new Error("The channel has been closed"));return}if(s===cw.ConnectivityState.READY)t();else try{this[Dt].watchConnectivityState(s,e,r)}catch{t(new Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(Wc(e))return{metadata:new Xr.Metadata,options:{},callback:e};if(Wc(t))return e instanceof Xr.Metadata?{metadata:e,options:{},callback:t}:{metadata:new Xr.Metadata,options:e,callback:t};if(!(e instanceof Xr.Metadata&&t instanceof Object&&Wc(r)))throw new Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,a,o){var l,c;let u=this.checkOptionalUnaryResponseArguments(s,a,o),p={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},g={argument:i,metadata:u.metadata,call:new $t.ClientUnaryCallImpl,channel:this[Dt],methodDefinition:p,callOptions:u.options,callback:u.callback};this[fn]&&(g=this[fn](g));let T=g.call,_={clientInterceptors:this[Zr],clientInterceptorProviders:this[ei],callInterceptors:(l=g.callOptions.interceptors)!==null&&l!==void 0?l:[],callInterceptorProviders:(c=g.callOptions.interceptor_providers)!==null&&c!==void 0?c:[]},w=(0,Aa.getInterceptingCall)(_,g.methodDefinition,g.callOptions,g.channel);T.call=w;let b=null,P=!1,L=new Error;return w.start(g.metadata,{onReceiveMetadata:F=>{T.emit("metadata",F)},onReceiveMessage(F){b!==null&&w.cancelWithStatus(Ln.Status.INTERNAL,"Too many responses received"),b=F},onReceiveStatus(F){if(!P){if(P=!0,F.code===Ln.Status.OK)if(b===null){let C=ti(L);g.callback((0,$t.callErrorFromStatus)({code:Ln.Status.INTERNAL,details:"No message received",metadata:F.metadata},C))}else g.callback(null,b);else{let C=ti(L);g.callback((0,$t.callErrorFromStatus)(F,C))}L=null,T.emit("status",F)}}}),w.sendMessage(i),w.halfClose(),T}makeClientStreamRequest(e,t,r,i,s,a){var o,l;let c=this.checkOptionalUnaryResponseArguments(i,s,a),u={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},p={metadata:c.metadata,call:new $t.ClientWritableStreamImpl(t),channel:this[Dt],methodDefinition:u,callOptions:c.options,callback:c.callback};this[fn]&&(p=this[fn](p));let g=p.call,T={clientInterceptors:this[Zr],clientInterceptorProviders:this[ei],callInterceptors:(o=p.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(l=p.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},_=(0,Aa.getInterceptingCall)(T,p.methodDefinition,p.callOptions,p.channel);g.call=_;let w=null,b=!1,P=new Error;return _.start(p.metadata,{onReceiveMetadata:L=>{g.emit("metadata",L)},onReceiveMessage(L){w!==null&&_.cancelWithStatus(Ln.Status.INTERNAL,"Too many responses received"),w=L},onReceiveStatus(L){if(!b){if(b=!0,L.code===Ln.Status.OK)if(w===null){let F=ti(P);p.callback((0,$t.callErrorFromStatus)({code:Ln.Status.INTERNAL,details:"No message received",metadata:L.metadata},F))}else p.callback(null,w);else{let F=ti(P);p.callback((0,$t.callErrorFromStatus)(L,F))}P=null,g.emit("status",L)}}}),g}checkMetadataAndOptions(e,t){let r,i;return e instanceof Xr.Metadata?(r=e,t?i=t:i={}):(e?i=e:i={},r=new Xr.Metadata),{metadata:r,options:i}}makeServerStreamRequest(e,t,r,i,s,a){var o,l;let c=this.checkMetadataAndOptions(s,a),u={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},p={argument:i,metadata:c.metadata,call:new $t.ClientReadableStreamImpl(r),channel:this[Dt],methodDefinition:u,callOptions:c.options};this[fn]&&(p=this[fn](p));let g=p.call,T={clientInterceptors:this[Zr],clientInterceptorProviders:this[ei],callInterceptors:(o=p.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(l=p.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},_=(0,Aa.getInterceptingCall)(T,p.methodDefinition,p.callOptions,p.channel);g.call=_;let w=!1,b=new Error;return _.start(p.metadata,{onReceiveMetadata(P){g.emit("metadata",P)},onReceiveMessage(P){g.push(P)},onReceiveStatus(P){if(!w){if(w=!0,g.push(null),P.code!==Ln.Status.OK){let L=ti(b);g.emit("error",(0,$t.callErrorFromStatus)(P,L))}b=null,g.emit("status",P)}}}),_.sendMessage(i),_.halfClose(),g}makeBidiStreamRequest(e,t,r,i,s){var a,o;let l=this.checkMetadataAndOptions(i,s),c={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},u={metadata:l.metadata,call:new $t.ClientDuplexStreamImpl(t,r),channel:this[Dt],methodDefinition:c,callOptions:l.options};this[fn]&&(u=this[fn](u));let p=u.call,g={clientInterceptors:this[Zr],clientInterceptorProviders:this[ei],callInterceptors:(a=u.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(o=u.callOptions.interceptor_providers)!==null&&o!==void 0?o:[]},T=(0,Aa.getInterceptingCall)(g,u.methodDefinition,u.callOptions,u.channel);p.call=T;let _=!1,w=new Error;return T.start(u.metadata,{onReceiveMetadata(b){p.emit("metadata",b)},onReceiveMessage(b){p.push(b)},onReceiveStatus(b){if(!_){if(_=!0,p.push(null),b.code!==Ln.Status.OK){let P=ti(w);p.emit("error",(0,$t.callErrorFromStatus)(b,P))}w=null,p.emit("status",b)}}}),p}};Ra.Client=Hc});var Jc=A(ni=>{"use strict";Object.defineProperty(ni,"__esModule",{value:!0});ni.loadPackageDefinition=ni.makeClientConstructor=void 0;var ns=$c(),uw={unary:ns.Client.prototype.makeUnaryRequest,server_stream:ns.Client.prototype.makeServerStreamRequest,client_stream:ns.Client.prototype.makeClientStreamRequest,bidi:ns.Client.prototype.makeBidiStreamRequest};function Yc(n){return["__proto__","prototype","constructor"].includes(n)}function Bm(n,e,t){t||(t={});class r extends ns.Client{}return Object.keys(n).forEach(i=>{if(Yc(i))return;let s=n[i],a;if(typeof i=="string"&&i.charAt(0)==="$")throw new Error("Method names cannot start with $");s.requestStream?s.responseStream?a="bidi":a="client_stream":s.responseStream?a="server_stream":a="unary";let o=s.requestSerialize,l=s.responseDeserialize,c=dw(uw[a],s.path,o,l);r.prototype[i]=c,Object.assign(r.prototype[i],s),s.originalName&&!Yc(s.originalName)&&(r.prototype[s.originalName]=r.prototype[i])}),r.service=n,r.serviceName=e,r}ni.makeClientConstructor=Bm;function dw(n,e,t,r){return function(...i){return n.call(this,e,t,r,...i)}}function hw(n){return"format"in n}function fw(n){let e={};for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let r=n[t],i=t.split(".");if(i.some(o=>Yc(o)))continue;let s=i[i.length-1],a=e;for(let o of i.slice(0,-1))a[o]||(a[o]={}),a=a[o];hw(r)?a[s]=r:a[s]=Bm(r,s,{})}return e}ni.loadPackageDefinition=fw});var cg=A((vM,lg)=>{"use strict";var pw=1/0,mw="[object Symbol]",gw=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,yw=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Na="\\ud800-\\udfff",Wm="\\u0300-\\u036f\\ufe20-\\ufe23",Hm="\\u20d0-\\u20f0",$m="\\u2700-\\u27bf",Qm="a-z\\xdf-\\xf6\\xf8-\\xff",vw="\\xac\\xb1\\xd7\\xf7",Sw="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Tw="\\u2000-\\u206f",Ew=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ym="A-Z\\xc0-\\xd6\\xd8-\\xde",Jm="\\ufe0e\\ufe0f",Xm=vw+Sw+Tw+Ew,Zc="['\u2019]",_w="["+Na+"]",Um="["+Xm+"]",Da="["+Wm+Hm+"]",Zm="\\d+",bw="["+$m+"]",eg="["+Qm+"]",tg="[^"+Na+Xm+Zm+$m+Qm+Ym+"]",Xc="\\ud83c[\\udffb-\\udfff]",ww="(?:"+Da+"|"+Xc+")",ng="[^"+Na+"]",eu="(?:\\ud83c[\\udde6-\\uddff]){2}",tu="[\\ud800-\\udbff][\\udc00-\\udfff]",ri="["+Ym+"]",rg="\\u200d",qm="(?:"+eg+"|"+tg+")",Cw="(?:"+ri+"|"+tg+")",Vm="(?:"+Zc+"(?:d|ll|m|re|s|t|ve))?",zm="(?:"+Zc+"(?:D|LL|M|RE|S|T|VE))?",ig=ww+"?",sg="["+Jm+"]?",Iw="(?:"+rg+"(?:"+[ng,eu,tu].join("|")+")"+sg+ig+")*",ag=sg+ig+Iw,Aw="(?:"+[bw,eu,tu].join("|")+")"+ag,Rw="(?:"+[ng+Da+"?",Da,eu,tu,_w].join("|")+")",Dw=RegExp(Zc,"g"),Nw=RegExp(Da,"g"),Ow=RegExp(Xc+"(?="+Xc+")|"+Rw+ag,"g"),xw=RegExp([ri+"?"+eg+"+"+Vm+"(?="+[Um,ri,"$"].join("|")+")",Cw+"+"+zm+"(?="+[Um,ri+qm,"$"].join("|")+")",ri+"?"+qm+"+"+Vm,ri+"+"+zm,Zm,Aw].join("|"),"g"),kw=RegExp("["+rg+Na+Wm+Hm+Jm+"]"),Pw=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Mw={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"ss"},Lw=typeof global=="object"&&global&&global.Object===Object&&global,Fw=typeof self=="object"&&self&&self.Object===Object&&self,Bw=Lw||Fw||Function("return this")();function Uw(n,e,t,r){var i=-1,s=n?n.length:0;for(r&&s&&(t=n[++i]);++i<s;)t=e(t,n[i],i,n);return t}function qw(n){return n.split("")}function Vw(n){return n.match(gw)||[]}function zw(n){return function(e){return n?.[e]}}var Gw=zw(Mw);function og(n){return kw.test(n)}function jw(n){return Pw.test(n)}function Kw(n){return og(n)?Ww(n):qw(n)}function Ww(n){return n.match(Ow)||[]}function Hw(n){return n.match(xw)||[]}var $w=Object.prototype,Qw=$w.toString,Gm=Bw.Symbol,jm=Gm?Gm.prototype:void 0,Km=jm?jm.toString:void 0;function Yw(n,e,t){var r=-1,i=n.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=n[r+e];return s}function Jw(n){if(typeof n=="string")return n;if(nC(n))return Km?Km.call(n):"";var e=n+"";return e=="0"&&1/n==-pw?"-0":e}function Xw(n,e,t){var r=n.length;return t=t===void 0?r:t,!e&&t>=r?n:Yw(n,e,t)}function Zw(n){return function(e){e=Oa(e);var t=og(e)?Kw(e):void 0,r=t?t[0]:e.charAt(0),i=t?Xw(t,1).join(""):e.slice(1);return r[n]()+i}}function eC(n){return function(e){return Uw(oC(sC(e).replace(Dw,"")),n,"")}}function tC(n){return!!n&&typeof n=="object"}function nC(n){return typeof n=="symbol"||tC(n)&&Qw.call(n)==mw}function Oa(n){return n==null?"":Jw(n)}var rC=eC(function(n,e,t){return e=e.toLowerCase(),n+(t?iC(e):e)});function iC(n){return aC(Oa(n).toLowerCase())}function sC(n){return n=Oa(n),n&&n.replace(yw,Gw).replace(Nw,"")}var aC=Zw("toUpperCase");function oC(n,e,t){return n=Oa(n),e=t?void 0:e,e===void 0?jw(n)?Hw(n):Vw(n):n.match(e)||[]}lg.exports=rC});var nu=A((SM,ug)=>{"use strict";ug.exports=lC;function lC(n,e){for(var t=new Array(arguments.length-1),r=0,i=2,s=!0;i<arguments.length;)t[r++]=arguments[i++];return new Promise(function(o,l){t[r]=function(u){if(s)if(s=!1,u)l(u);else{for(var p=new Array(arguments.length-1),g=0;g<p.length;)p[g++]=arguments[g];o.apply(null,p)}};try{n.apply(e||null,t)}catch(c){s&&(s=!1,l(c))}})}});var pg=A(fg=>{"use strict";var xa=fg;xa.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&e.charAt(t)==="=";)++r;return Math.ceil(e.length*3)/4-r};var ii=new Array(64),hg=new Array(123);for(Nt=0;Nt<64;)hg[ii[Nt]=Nt<26?Nt+65:Nt<52?Nt+71:Nt<62?Nt-4:Nt-59|43]=Nt++;var Nt;xa.encode=function(e,t,r){for(var i=null,s=[],a=0,o=0,l;t<r;){var c=e[t++];switch(o){case 0:s[a++]=ii[c>>2],l=(c&3)<<4,o=1;break;case 1:s[a++]=ii[l|c>>4],l=(c&15)<<2,o=2;break;case 2:s[a++]=ii[l|c>>6],s[a++]=ii[c&63],o=0;break}a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),a=0)}return o&&(s[a++]=ii[l],s[a++]=61,o===1&&(s[a++]=61)),i?(a&&i.push(String.fromCharCode.apply(String,s.slice(0,a))),i.join("")):String.fromCharCode.apply(String,s.slice(0,a))};var dg="invalid encoding";xa.decode=function(e,t,r){for(var i=r,s=0,a,o=0;o<e.length;){var l=e.charCodeAt(o++);if(l===61&&s>1)break;if((l=hg[l])===void 0)throw Error(dg);switch(s){case 0:a=l,s=1;break;case 1:t[r++]=a<<2|(l&48)>>4,a=l,s=2;break;case 2:t[r++]=(a&15)<<4|(l&60)>>2,a=l,s=3;break;case 3:t[r++]=(a&3)<<6|l,s=0;break}}if(s===1)throw Error(dg);return r-i};xa.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var gg=A((EM,mg)=>{"use strict";mg.exports=ka;function ka(){this._listeners={}}ka.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this};ka.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var r=this._listeners[e],i=0;i<r.length;)r[i].fn===t?r.splice(i,1):++i;return this};ka.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,r)}return this}});var bg=A((_M,_g)=>{"use strict";_g.exports=yg(yg);function yg(n){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),r=t[3]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3]}function s(l,c,u){e[0]=l,c[u]=t[3],c[u+1]=t[2],c[u+2]=t[1],c[u+3]=t[0]}n.writeFloatLE=r?i:s,n.writeFloatBE=r?s:i;function a(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],e[0]}function o(l,c){return t[3]=l[c],t[2]=l[c+1],t[1]=l[c+2],t[0]=l[c+3],e[0]}n.readFloatLE=r?a:o,n.readFloatBE=r?o:a}():function(){function e(r,i,s,a){var o=i<0?1:0;if(o&&(i=-i),i===0)r(1/i>0?0:2147483648,s,a);else if(isNaN(i))r(2143289344,s,a);else if(i>34028234663852886e22)r((o<<31|2139095040)>>>0,s,a);else if(i<11754943508222875e-54)r((o<<31|Math.round(i/1401298464324817e-60))>>>0,s,a);else{var l=Math.floor(Math.log(i)/Math.LN2),c=Math.round(i*Math.pow(2,-l)*8388608)&8388607;r((o<<31|l+127<<23|c)>>>0,s,a)}}n.writeFloatLE=e.bind(null,vg),n.writeFloatBE=e.bind(null,Sg);function t(r,i,s){var a=r(i,s),o=(a>>31)*2+1,l=a>>>23&255,c=a&8388607;return l===255?c?NaN:o*(1/0):l===0?o*1401298464324817e-60*c:o*Math.pow(2,l-150)*(c+8388608)}n.readFloatLE=t.bind(null,Tg),n.readFloatBE=t.bind(null,Eg)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),r=t[7]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3],c[u+4]=t[4],c[u+5]=t[5],c[u+6]=t[6],c[u+7]=t[7]}function s(l,c,u){e[0]=l,c[u]=t[7],c[u+1]=t[6],c[u+2]=t[5],c[u+3]=t[4],c[u+4]=t[3],c[u+5]=t[2],c[u+6]=t[1],c[u+7]=t[0]}n.writeDoubleLE=r?i:s,n.writeDoubleBE=r?s:i;function a(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],t[4]=l[c+4],t[5]=l[c+5],t[6]=l[c+6],t[7]=l[c+7],e[0]}function o(l,c){return t[7]=l[c],t[6]=l[c+1],t[5]=l[c+2],t[4]=l[c+3],t[3]=l[c+4],t[2]=l[c+5],t[1]=l[c+6],t[0]=l[c+7],e[0]}n.readDoubleLE=r?a:o,n.readDoubleBE=r?o:a}():function(){function e(r,i,s,a,o,l){var c=a<0?1:0;if(c&&(a=-a),a===0)r(0,o,l+i),r(1/a>0?0:2147483648,o,l+s);else if(isNaN(a))r(0,o,l+i),r(2146959360,o,l+s);else if(a>17976931348623157e292)r(0,o,l+i),r((c<<31|2146435072)>>>0,o,l+s);else{var u;if(a<22250738585072014e-324)u=a/5e-324,r(u>>>0,o,l+i),r((c<<31|u/4294967296)>>>0,o,l+s);else{var p=Math.floor(Math.log(a)/Math.LN2);p===1024&&(p=1023),u=a*Math.pow(2,-p),r(u*4503599627370496>>>0,o,l+i),r((c<<31|p+1023<<20|u*1048576&1048575)>>>0,o,l+s)}}}n.writeDoubleLE=e.bind(null,vg,0,4),n.writeDoubleBE=e.bind(null,Sg,4,0);function t(r,i,s,a,o){var l=r(a,o+i),c=r(a,o+s),u=(c>>31)*2+1,p=c>>>20&2047,g=4294967296*(c&1048575)+l;return p===2047?g?NaN:u*(1/0):p===0?u*5e-324*g:u*Math.pow(2,p-1075)*(g+4503599627370496)}n.readDoubleLE=t.bind(null,Tg,0,4),n.readDoubleBE=t.bind(null,Eg,4,0)}(),n}function vg(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function Sg(n,e,t){e[t]=n>>>24,e[t+1]=n>>>16&255,e[t+2]=n>>>8&255,e[t+3]=n&255}function Tg(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0}function Eg(n,e){return(n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3])>>>0}});var ru=A((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}});var Cg=A(wg=>{"use strict";var iu=wg;iu.length=function(e){for(var t=0,r=0,i=0;i<e.length;++i)r=e.charCodeAt(i),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(i+1)&64512)===56320?(++i,t+=4):t+=3;return t};iu.read=function(e,t,r){var i=r-t;if(i<1)return"";for(var s=null,a=[],o=0,l;t<r;)l=e[t++],l<128?a[o++]=l:l>191&&l<224?a[o++]=(l&31)<<6|e[t++]&63:l>239&&l<365?(l=((l&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,a[o++]=55296+(l>>10),a[o++]=56320+(l&1023)):a[o++]=(l&15)<<12|(e[t++]&63)<<6|e[t++]&63,o>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,a)),o=0);return s?(o&&s.push(String.fromCharCode.apply(String,a.slice(0,o))),s.join("")):String.fromCharCode.apply(String,a.slice(0,o))};iu.write=function(e,t,r){for(var i=r,s,a,o=0;o<e.length;++o)s=e.charCodeAt(o),s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=s&63|128):(s&64512)===55296&&((a=e.charCodeAt(o+1))&64512)===56320?(s=65536+((s&1023)<<10)+(a&1023),++o,t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=s&63|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=s&63|128);return r-i}});var Ag=A((wM,Ig)=>{"use strict";Ig.exports=cC;function cC(n,e,t){var r=t||8192,i=r>>>1,s=null,a=r;return function(l){if(l<1||l>i)return n(l);a+l>r&&(s=n(r),a=0);var c=e.call(s,a,a+=l);return a&7&&(a=(a|7)+1),c}}});var Dg=A((CM,Rg)=>{"use strict";Rg.exports=ke;var rs=Qt();function ke(n,e){this.lo=n>>>0,this.hi=e>>>0}var pr=ke.zero=new ke(0,0);pr.toNumber=function(){return 0};pr.zzEncode=pr.zzDecode=function(){return this};pr.length=function(){return 1};var uC=ke.zeroHash="\0\0\0\0\0\0\0\0";ke.fromNumber=function(e){if(e===0)return pr;var t=e<0;t&&(e=-e);var r=e>>>0,i=(e-r)/4294967296>>>0;return t&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new ke(r,i)};ke.from=function(e){if(typeof e=="number")return ke.fromNumber(e);if(rs.isString(e))if(rs.Long)e=rs.Long.fromString(e);else return ke.fromNumber(parseInt(e,10));return e.low||e.high?new ke(e.low>>>0,e.high>>>0):pr};ke.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+r*4294967296)}return this.lo+this.hi*4294967296};ke.prototype.toLong=function(e){return rs.Long?new rs.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var Fn=String.prototype.charCodeAt;ke.fromHash=function(e){return e===uC?pr:new ke((Fn.call(e,0)|Fn.call(e,1)<<8|Fn.call(e,2)<<16|Fn.call(e,3)<<24)>>>0,(Fn.call(e,4)|Fn.call(e,5)<<8|Fn.call(e,6)<<16|Fn.call(e,7)<<24)>>>0)};ke.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};ke.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};ke.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};ke.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}});var Qt=A(su=>{"use strict";var z=su;z.asPromise=nu();z.base64=pg();z.EventEmitter=gg();z.float=bg();z.inquire=ru();z.utf8=Cg();z.pool=Ag();z.LongBits=Dg();z.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);z.global=z.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||su;z.emptyArray=Object.freeze?Object.freeze([]):[];z.emptyObject=Object.freeze?Object.freeze({}):{};z.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};z.isString=function(e){return typeof e=="string"||e instanceof String};z.isObject=function(e){return e&&typeof e=="object"};z.isset=z.isSet=function(e,t){var r=e[t];return r!=null&&e.hasOwnProperty(t)?typeof r!="object"||(Array.isArray(r)?r.length:Object.keys(r).length)>0:!1};z.Buffer=function(){try{var n=z.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}}();z._Buffer_from=null;z._Buffer_allocUnsafe=null;z.newBuffer=function(e){return typeof e=="number"?z.Buffer?z._Buffer_allocUnsafe(e):new z.Array(e):z.Buffer?z._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};z.Array=typeof Uint8Array<"u"?Uint8Array:Array;z.Long=z.global.dcodeIO&&z.global.dcodeIO.Long||z.global.Long||z.inquire("long");z.key2Re=/^true|false|0|1$/;z.key32Re=/^-?(?:0|[1-9][0-9]*)$/;z.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;z.longToHash=function(e){return e?z.LongBits.from(e).toHash():z.LongBits.zeroHash};z.longFromHash=function(e,t){var r=z.LongBits.fromHash(e);return z.Long?z.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)};function Ng(n,e,t){for(var r=Object.keys(e),i=0;i<r.length;++i)(n[r[i]]===void 0||!t)&&(n[r[i]]=e[r[i]]);return n}z.merge=Ng;z.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function Og(n){function e(t,r){if(!(this instanceof e))return new e(t,r);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),r&&Ng(this,r)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}z.newError=Og;z.ProtocolError=Og("ProtocolError");z.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};z.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}};z.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};z._configure=function(){var n=z.Buffer;if(!n){z._Buffer_from=z._Buffer_allocUnsafe=null;return}z._Buffer_from=n.from!==Uint8Array.from&&n.from||function(t,r){return new n(t,r)},z._Buffer_allocUnsafe=n.allocUnsafe||function(t){return new n(t)}}});var Ma=A((AM,Mg)=>{"use strict";Mg.exports=se;var Et=Qt(),au,Pa=Et.LongBits,xg=Et.base64,kg=Et.utf8;function is(n,e,t){this.fn=n,this.len=e,this.next=void 0,this.val=t}function lu(){}function dC(n){this.head=n.head,this.tail=n.tail,this.len=n.len,this.next=n.states}function se(){this.len=0,this.head=new is(lu,0,0),this.tail=this.head,this.states=null}var Pg=function(){return Et.Buffer?function(){return(se.create=function(){return new au})()}:function(){return new se}};se.create=Pg();se.alloc=function(e){return new Et.Array(e)};Et.Array!==Array&&(se.alloc=Et.pool(se.alloc,Et.Array.prototype.subarray));se.prototype._push=function(e,t,r){return this.tail=this.tail.next=new is(e,t,r),this.len+=t,this};function cu(n,e,t){e[t]=n&255}function hC(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}function uu(n,e){this.len=n,this.next=void 0,this.val=e}uu.prototype=Object.create(is.prototype);uu.prototype.fn=hC;se.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new uu((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};se.prototype.int32=function(e){return e<0?this._push(du,10,Pa.fromNumber(e)):this.uint32(e)};se.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function du(n,e,t){for(;n.hi;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}se.prototype.uint64=function(e){var t=Pa.from(e);return this._push(du,t.length(),t)};se.prototype.int64=se.prototype.uint64;se.prototype.sint64=function(e){var t=Pa.from(e).zzEncode();return this._push(du,t.length(),t)};se.prototype.bool=function(e){return this._push(cu,1,e?1:0)};function ou(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}se.prototype.fixed32=function(e){return this._push(ou,4,e>>>0)};se.prototype.sfixed32=se.prototype.fixed32;se.prototype.fixed64=function(e){var t=Pa.from(e);return this._push(ou,4,t.lo)._push(ou,4,t.hi)};se.prototype.sfixed64=se.prototype.fixed64;se.prototype.float=function(e){return this._push(Et.float.writeFloatLE,4,e)};se.prototype.double=function(e){return this._push(Et.float.writeDoubleLE,8,e)};var fC=Et.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var i=0;i<e.length;++i)t[r+i]=e[i]};se.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(cu,1,0);if(Et.isString(e)){var r=se.alloc(t=xg.length(e));xg.decode(e,r,0),e=r}return this.uint32(t)._push(fC,t,e)};se.prototype.string=function(e){var t=kg.length(e);return t?this.uint32(t)._push(kg.write,t,e):this._push(cu,1,0)};se.prototype.fork=function(){return this.states=new dC(this),this.head=this.tail=new is(lu,0,0),this.len=0,this};se.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new is(lu,0,0),this.len=0),this};se.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this};se.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t};se._configure=function(n){au=n,se.create=Pg(),au._configure()}});var Bg=A((RM,Fg)=>{"use strict";Fg.exports=Yt;var Lg=Ma();(Yt.prototype=Object.create(Lg.prototype)).constructor=Yt;var Bn=Qt();function Yt(){Lg.call(this)}Yt._configure=function(){Yt.alloc=Bn._Buffer_allocUnsafe,Yt.writeBytesBuffer=Bn.Buffer&&Bn.Buffer.prototype instanceof Uint8Array&&Bn.Buffer.prototype.set.name==="set"?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var i=0;i<e.length;)t[r++]=e[i++]}};Yt.prototype.bytes=function(e){Bn.isString(e)&&(e=Bn._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(Yt.writeBytesBuffer,t,e),this};function pC(n,e,t){n.length<40?Bn.utf8.write(n,e,t):e.utf8Write?e.utf8Write(n,t):e.write(n,t)}Yt.prototype.string=function(e){var t=Bn.Buffer.byteLength(e);return this.uint32(t),t&&this._push(pC,t,e),this};Yt._configure()});var Fa=A((DM,Gg)=>{"use strict";Gg.exports=we;var Ot=Qt(),fu,Vg=Ot.LongBits,mC=Ot.utf8;function xt(n,e){return RangeError("index out of range: "+n.pos+" + "+(e||1)+" > "+n.len)}function we(n){this.buf=n,this.pos=0,this.len=n.length}var Ug=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new we(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new we(e);throw Error("illegal buffer")},zg=function(){return Ot.Buffer?function(t){return(we.create=function(i){return Ot.Buffer.isBuffer(i)?new fu(i):Ug(i)})(t)}:Ug};we.create=zg();we.prototype._slice=Ot.Array.prototype.subarray||Ot.Array.prototype.slice;we.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,xt(this,10);return e}}();we.prototype.int32=function(){return this.uint32()|0};we.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function hu(){var n=new Vg(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw xt(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,n}if(this.len-this.pos>4){for(;e<5;++e)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;e<5;++e){if(this.pos>=this.len)throw xt(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding")}we.prototype.bool=function(){return this.uint32()!==0};function La(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}we.prototype.fixed32=function(){if(this.pos+4>this.len)throw xt(this,4);return La(this.buf,this.pos+=4)};we.prototype.sfixed32=function(){if(this.pos+4>this.len)throw xt(this,4);return La(this.buf,this.pos+=4)|0};function qg(){if(this.pos+8>this.len)throw xt(this,8);return new Vg(La(this.buf,this.pos+=4),La(this.buf,this.pos+=4))}we.prototype.float=function(){if(this.pos+4>this.len)throw xt(this,4);var e=Ot.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};we.prototype.double=function(){if(this.pos+8>this.len)throw xt(this,4);var e=Ot.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};we.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw xt(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var i=Ot.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)};we.prototype.string=function(){var e=this.bytes();return mC.read(e,0,e.length)};we.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw xt(this,e);this.pos+=e}else do if(this.pos>=this.len)throw xt(this);while(this.buf[this.pos++]&128);return this};we.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(n=this.uint32()&7)!==4;)this.skipType(n);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos)}return this};we._configure=function(n){fu=n,we.create=zg(),fu._configure();var e=Ot.Long?"toLong":"toNumber";Ot.merge(we.prototype,{int64:function(){return hu.call(this)[e](!1)},uint64:function(){return hu.call(this)[e](!0)},sint64:function(){return hu.call(this).zzDecode()[e](!1)},fixed64:function(){return qg.call(this)[e](!0)},sfixed64:function(){return qg.call(this)[e](!1)}})}});var Hg=A((NM,Wg)=>{"use strict";Wg.exports=mr;var Kg=Fa();(mr.prototype=Object.create(Kg.prototype)).constructor=mr;var jg=Qt();function mr(n){Kg.call(this,n)}mr._configure=function(){jg.Buffer&&(mr.prototype._slice=jg.Buffer.prototype.slice)};mr.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};mr._configure()});var Qg=A((OM,$g)=>{"use strict";$g.exports=ss;var pu=Qt();(ss.prototype=Object.create(pu.EventEmitter.prototype)).constructor=ss;function ss(n,e,t){if(typeof n!="function")throw TypeError("rpcImpl must be a function");pu.EventEmitter.call(this),this.rpcImpl=n,this.requestDelimited=!!e,this.responseDelimited=!!t}ss.prototype.rpcCall=function n(e,t,r,i,s){if(!i)throw TypeError("request must be specified");var a=this;if(!s)return pu.asPromise(n,a,e,t,r,i);if(!a.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return a.rpcImpl(e,t[a.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(l,c){if(l)return a.emit("error",l,e),s(l);if(c===null){a.end(!0);return}if(!(c instanceof r))try{c=r[a.responseDelimited?"decodeDelimited":"decode"](c)}catch(u){return a.emit("error",u,e),s(u)}return a.emit("data",c,e),s(null,c)})}catch(o){a.emit("error",o,e),setTimeout(function(){s(o)},0);return}};ss.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var mu=A(Yg=>{"use strict";var gC=Yg;gC.Service=Qg()});var gu=A((kM,Jg)=>{"use strict";Jg.exports={}});var ey=A(Zg=>{"use strict";var st=Zg;st.build="minimal";st.Writer=Ma();st.BufferWriter=Bg();st.Reader=Fa();st.BufferReader=Hg();st.util=Qt();st.rpc=mu();st.roots=gu();st.configure=Xg;function Xg(){st.util._configure(),st.Writer._configure(st.BufferWriter),st.Reader._configure(st.BufferReader)}Xg()});var ny=A((MM,ty)=>{"use strict";ty.exports=yu;function yu(n,e){typeof n=="string"&&(e=n,n=void 0);var t=[];function r(s){if(typeof s!="string"){var a=i();if(yu.verbose&&console.log("codegen: "+a),a="return "+a,s){for(var o=Object.keys(s),l=new Array(o.length+1),c=new Array(o.length),u=0;u<o.length;)l[u]=o[u],c[u]=s[o[u++]];return l[u]=a,Function.apply(null,l).apply(null,c)}return Function(a)()}for(var p=new Array(arguments.length-1),g=0;g<p.length;)p[g]=arguments[++g];if(g=0,s=s.replace(/%([%dfijs])/g,function(_,w){var b=p[g++];switch(w){case"d":case"f":return String(Number(b));case"i":return String(Math.floor(b));case"j":return JSON.stringify(b);case"s":return String(b)}return"%"}),g!==p.length)throw Error("parameter count mismatch");return t.push(s),r}function i(s){return"function "+(s||e||"")+"("+(n&&n.join(",")||"")+`){
  `+t.join(`
  `)+`
}`}return r.toString=i,r}yu.verbose=!1});var iy=A((LM,ry)=>{"use strict";ry.exports=as;var yC=nu(),vC=ru(),vu=vC("fs");function as(n,e,t){return typeof e=="function"?(t=e,e={}):e||(e={}),t?!e.xhr&&vu&&vu.readFile?vu.readFile(n,function(i,s){return i&&typeof XMLHttpRequest<"u"?as.xhr(n,e,t):i?t(i):t(null,e.binary?s:s.toString("utf8"))}):as.xhr(n,e,t):yC(as,this,n,e)}as.xhr=function(e,t,r){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===4){if(i.status!==0&&i.status!==200)return r(Error("status "+i.status));if(t.binary){var a=i.response;if(!a){a=[];for(var o=0;o<i.responseText.length;++o)a.push(i.responseText.charCodeAt(o)&255)}return r(null,typeof Uint8Array<"u"?new Uint8Array(a):a)}return r(null,i.responseText)}},t.binary&&("overrideMimeType"in i&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.responseType="arraybuffer"),i.open("GET",e),i.send()}});var oy=A(ay=>{"use strict";var Tu=ay,sy=Tu.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},Su=Tu.normalize=function(e){e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var t=e.split("/"),r=sy(e),i="";r&&(i=t.shift()+"/");for(var s=0;s<t.length;)t[s]===".."?s>0&&t[s-1]!==".."?t.splice(--s,2):r?t.splice(s,1):++s:t[s]==="."?t.splice(s,1):++s;return i+t.join("/")};Tu.resolve=function(e,t,r){return r||(t=Su(t)),sy(t)?t:(r||(e=Su(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?Su(e+"/"+t):t)}});var ai=A((BM,uy)=>{"use strict";uy.exports=re;var Ba=qn();((re.prototype=Object.create(Ba.prototype)).constructor=re).className="Namespace";var Eu=Un(),Ua=Pe(),SC=vr(),gr,si,yr;re.fromJSON=function(e,t){return new re(e,t.options).addJSON(t.nested)};function ly(n,e){if(n&&n.length){for(var t={},r=0;r<n.length;++r)t[n[r].name]=n[r].toJSON(e);return t}}re.arrayToJSON=ly;re.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if(typeof e[r]!="string"&&e[r][0]<=t&&e[r][1]>t)return!0}return!1};re.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1};function re(n,e){Ba.call(this,n,e),this.nested=void 0,this._nestedArray=null,this._lookupCache={},this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0}function cy(n){n._nestedArray=null,n._lookupCache={};for(var e=n;e=e.parent;)e._lookupCache={};return n}Object.defineProperty(re.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=Ua.toArray(this.nested))}});re.prototype.toJSON=function(e){return Ua.toObject(["options",this.options,"nested",ly(this.nestedArray,e)])};re.prototype.addJSON=function(e){var t=this;if(e)for(var r=Object.keys(e),i=0,s;i<r.length;++i)s=e[r[i]],t.add((s.fields!==void 0?gr.fromJSON:s.values!==void 0?yr.fromJSON:s.methods!==void 0?si.fromJSON:s.id!==void 0?Eu.fromJSON:re.fromJSON)(r[i],s));return this};re.prototype.get=function(e){return this.nested&&this.nested[e]||null};re.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof yr)return this.nested[e].values;throw Error("no such enum: "+e)};re.prototype.add=function(e){if(!(e instanceof Eu&&e.extend!==void 0||e instanceof gr||e instanceof SC||e instanceof yr||e instanceof si||e instanceof re))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var t=this.get(e.name);if(t)if(t instanceof re&&e instanceof re&&!(t instanceof gr||t instanceof si)){for(var r=t.nestedArray,i=0;i<r.length;++i)e.add(r[i]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}this.nested[e.name]=e,this instanceof gr||this instanceof si||this instanceof yr||this instanceof Eu||e._edition||(e._edition=e._defaultEdition),this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0;for(var s=this;s=s.parent;)s._needsRecursiveFeatureResolution=!0,s._needsRecursiveResolve=!0;return e.onAdd(this),cy(this)};re.prototype.remove=function(e){if(!(e instanceof Ba))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),cy(this)};re.prototype.define=function(e,t){if(Ua.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&e[0]==="")throw Error("path must be relative");for(var r=this;e.length>0;){var i=e.shift();if(r.nested&&r.nested[i]){if(r=r.nested[i],!(r instanceof re))throw Error("path conflicts with non-namespace objects")}else r.add(r=new re(i))}return t&&r.addJSON(t),r};re.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;this._resolveFeaturesRecursive(this._edition);var e=this.nestedArray,t=0;for(this.resolve();t<e.length;)e[t]instanceof re?e[t++].resolveAll():e[t++].resolve();return this._needsRecursiveResolve=!1,this};re.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution?(this._needsRecursiveFeatureResolution=!1,e=this._edition||e,Ba.prototype._resolveFeaturesRecursive.call(this,e),this.nestedArray.forEach(t=>{t._resolveFeaturesRecursive(e)}),this):this};re.prototype.lookup=function(e,t,r){if(typeof t=="boolean"?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),Ua.isString(e)&&e.length){if(e===".")return this.root;e=e.split(".")}else if(!e.length)return this;var i=e.join(".");if(e[0]==="")return this.root.lookup(e.slice(1),t);var s=this.root._fullyQualifiedObjects&&this.root._fullyQualifiedObjects["."+i];if(s&&(!t||t.indexOf(s.constructor)>-1)||(s=this._lookupImpl(e,i),s&&(!t||t.indexOf(s.constructor)>-1)))return s;if(r)return null;for(var a=this;a.parent;){if(s=a.parent._lookupImpl(e,i),s&&(!t||t.indexOf(s.constructor)>-1))return s;a=a.parent}return null};re.prototype._lookupImpl=function(e,t){if(Object.prototype.hasOwnProperty.call(this._lookupCache,t))return this._lookupCache[t];var r=this.get(e[0]),i=null;if(r)e.length===1?i=r:r instanceof re&&(e=e.slice(1),i=r._lookupImpl(e,e.join(".")));else for(var s=0;s<this.nestedArray.length;++s)this._nestedArray[s]instanceof re&&(r=this._nestedArray[s]._lookupImpl(e,t))&&(i=r);return this._lookupCache[t]=i,i};re.prototype.lookupType=function(e){var t=this.lookup(e,[gr]);if(!t)throw Error("no such type: "+e);return t};re.prototype.lookupEnum=function(e){var t=this.lookup(e,[yr]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t};re.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[gr,yr]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t};re.prototype.lookupService=function(e){var t=this.lookup(e,[si]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t};re._configure=function(n,e,t){gr=n,si=e,yr=t}});var qa=A((UM,dy)=>{"use strict";dy.exports=pn;var _u=Un();((pn.prototype=Object.create(_u.prototype)).constructor=pn).className="MapField";var TC=Sr(),os=Pe();function pn(n,e,t,r,i,s){if(_u.call(this,n,e,r,void 0,void 0,i,s),!os.isString(t))throw TypeError("keyType must be a string");this.keyType=t,this.resolvedKeyType=null,this.map=!0}pn.fromJSON=function(e,t){return new pn(e,t.id,t.keyType,t.type,t.options,t.comment)};pn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return os.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};pn.prototype.resolve=function(){if(this.resolved)return this;if(TC.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return _u.prototype.resolve.call(this)};pn.d=function(e,t,r){return typeof r=="function"?r=os.decorateType(r).name:r&&typeof r=="object"&&(r=os.decorateEnum(r).name),function(s,a){os.decorateType(s.constructor).add(new pn(a,e,t,r))}}});var Va=A((qM,hy)=>{"use strict";hy.exports=Tr;var bu=qn();((Tr.prototype=Object.create(bu.prototype)).constructor=Tr).className="Method";var oi=Pe();function Tr(n,e,t,r,i,s,a,o,l){if(oi.isObject(i)?(a=i,i=s=void 0):oi.isObject(s)&&(a=s,s=void 0),!(e===void 0||oi.isString(e)))throw TypeError("type must be a string");if(!oi.isString(t))throw TypeError("requestType must be a string");if(!oi.isString(r))throw TypeError("responseType must be a string");bu.call(this,n,a),this.type=e||"rpc",this.requestType=t,this.requestStream=i?!0:void 0,this.responseType=r,this.responseStream=s?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=o,this.parsedOptions=l}Tr.fromJSON=function(e,t){return new Tr(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)};Tr.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return oi.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])};Tr.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),bu.prototype.resolve.call(this))}});var za=A((VM,py)=>{"use strict";py.exports=ct;var mn=ai();((ct.prototype=Object.create(mn.prototype)).constructor=ct).className="Service";var wu=Va(),ls=Pe(),EC=mu();function ct(n,e){mn.call(this,n,e),this.methods={},this._methodsArray=null}ct.fromJSON=function(e,t){var r=new ct(e,t.options);if(t.methods)for(var i=Object.keys(t.methods),s=0;s<i.length;++s)r.add(wu.fromJSON(i[s],t.methods[i[s]]));return t.nested&&r.addJSON(t.nested),t.edition&&(r._edition=t.edition),r.comment=t.comment,r._defaultEdition="proto3",r};ct.prototype.toJSON=function(e){var t=mn.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return ls.toObject(["edition",this._editionToJSON(),"options",t&&t.options||void 0,"methods",mn.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Object.defineProperty(ct.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=ls.toArray(this.methods))}});function fy(n){return n._methodsArray=null,n}ct.prototype.get=function(e){return this.methods[e]||mn.prototype.get.call(this,e)};ct.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;mn.prototype.resolve.call(this);for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return this};ct.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution?(e=this._edition||e,mn.prototype._resolveFeaturesRecursive.call(this,e),this.methodsArray.forEach(t=>{t._resolveFeaturesRecursive(e)}),this):this};ct.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof wu?(this.methods[e.name]=e,e.parent=this,fy(this)):mn.prototype.add.call(this,e)};ct.prototype.remove=function(e){if(e instanceof wu){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,fy(this)}return mn.prototype.remove.call(this,e)};ct.prototype.create=function(e,t,r){for(var i=new EC.Service(e,t,r),s=0,a;s<this.methodsArray.length;++s){var o=ls.lcFirst((a=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");i[o]=ls.codegen(["r","c"],ls.isReserved(o)?o+"_":o)("return this.rpcCall(m,q,s,r,c)")({m:a,q:a.resolvedRequestType.ctor,s:a.resolvedResponseType.ctor})}return i}});var Ga=A((zM,my)=>{"use strict";my.exports=Jt;var _C=Qt();function Jt(n){if(n)for(var e=Object.keys(n),t=0;t<e.length;++t)this[e[t]]=n[e[t]]}Jt.create=function(e){return this.$type.create(e)};Jt.encode=function(e,t){return this.$type.encode(e,t)};Jt.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)};Jt.decode=function(e){return this.$type.decode(e)};Jt.decodeDelimited=function(e){return this.$type.decodeDelimited(e)};Jt.verify=function(e){return this.$type.verify(e)};Jt.fromObject=function(e){return this.$type.fromObject(e)};Jt.toObject=function(e,t){return this.$type.toObject(e,t)};Jt.prototype.toJSON=function(){return this.$type.toObject(this,_C.toJSONOptions)}});var Cu=A((GM,yy)=>{"use strict";yy.exports=CC;var bC=kt(),gn=Sr(),gy=Pe();function wC(n){return"missing required '"+n.name+"'"}function CC(n){for(var e=gy.codegen(["r","l","e"],n.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(n.fieldsArray.filter(function(o){return o.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()")("if(t===e)")("break")("switch(t>>>3){"),t=0;t<n.fieldsArray.length;++t){var r=n._fieldsArray[t].resolve(),i=r.resolvedType instanceof bC?"int32":r.type,s="m"+gy.safeProp(r.name);e("case %i: {",r.id),r.map?(e("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),gn.defaults[r.keyType]!==void 0?e("k=%j",gn.defaults[r.keyType]):e("k=null"),gn.defaults[i]!==void 0?e("value=%j",gn.defaults[i]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",r.keyType)("case 2:"),gn.basic[i]===void 0?e("value=types[%i].decode(r,r.uint32())",t):e("value=r.%s()",i),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),gn.long[r.keyType]!==void 0?e('%s[typeof k==="object"?util.longToHash(k):k]=value',s):e("%s[k]=value",s)):r.repeated?(e("if(!(%s&&%s.length))",s,s)("%s=[]",s),gn.packed[i]!==void 0&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,i)("}else"),gn.basic[i]===void 0?e(r.delimited?"%s.push(types[%i].decode(r,undefined,((t&~7)|4)))":"%s.push(types[%i].decode(r,r.uint32()))",s,t):e("%s.push(r.%s())",s,i)):gn.basic[i]===void 0?e(r.delimited?"%s=types[%i].decode(r,undefined,((t&~7)|4))":"%s=types[%i].decode(r,r.uint32())",s,t):e("%s=r.%s()",s,i),e("break")("}")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),t=0;t<n._fieldsArray.length;++t){var a=n._fieldsArray[t];a.required&&e("if(!m.hasOwnProperty(%j))",a.name)("throw util.ProtocolError(%j,{instance:m})",wC(a))}return e("return m")}});var Ru=A((jM,vy)=>{"use strict";vy.exports=RC;var IC=kt(),Iu=Pe();function _t(n,e){return n.name+": "+e+(n.repeated&&e!=="array"?"[]":n.map&&e!=="object"?"{k:"+n.keyType+"}":"")+" expected"}function Au(n,e,t,r){if(e.resolvedType)if(e.resolvedType instanceof IC){n("switch(%s){",r)("default:")("return%j",_t(e,"enum value"));for(var i=Object.keys(e.resolvedType.values),s=0;s<i.length;++s)n("case %i:",e.resolvedType.values[i[s]]);n("break")("}")}else n("{")("var e=types[%i].verify(%s);",t,r)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.isInteger(%s))",r)("return%j",_t(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",r,r,r,r)("return%j",_t(e,"integer|Long"));break;case"float":case"double":n('if(typeof %s!=="number")',r)("return%j",_t(e,"number"));break;case"bool":n('if(typeof %s!=="boolean")',r)("return%j",_t(e,"boolean"));break;case"string":n("if(!util.isString(%s))",r)("return%j",_t(e,"string"));break;case"bytes":n('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',r,r,r)("return%j",_t(e,"buffer"));break}return n}function AC(n,e,t){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.key32Re.test(%s))",t)("return%j",_t(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.key64Re.test(%s))",t)("return%j",_t(e,"integer|Long key"));break;case"bool":n("if(!util.key2Re.test(%s))",t)("return%j",_t(e,"boolean key"));break}return n}function RC(n){var e=Iu.codegen(["m"],n.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),t=n.oneofsArray,r={};t.length&&e("var p={}");for(var i=0;i<n.fieldsArray.length;++i){var s=n._fieldsArray[i].resolve(),a="m"+Iu.safeProp(s.name);if(s.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",a,s.name),s.map)e("if(!util.isObject(%s))",a)("return%j",_t(s,"object"))("var k=Object.keys(%s)",a)("for(var i=0;i<k.length;++i){"),AC(e,s,"k[i]"),Au(e,s,i,a+"[k[i]]")("}");else if(s.repeated)e("if(!Array.isArray(%s))",a)("return%j",_t(s,"array"))("for(var i=0;i<%s.length;++i){",a),Au(e,s,i,a+"[i]")("}");else{if(s.partOf){var o=Iu.safeProp(s.partOf.name);r[s.partOf.name]===1&&e("if(p%s===1)",o)("return%j",s.partOf.name+": multiple values"),r[s.partOf.name]=1,e("p%s=1",o)}Au(e,s,i,a)}s.optional&&e("}")}return e("return null")}});var Ou=A(Ty=>{"use strict";var Sy=Ty,cs=kt(),Xt=Pe();function Du(n,e,t,r){var i=!1;if(e.resolvedType)if(e.resolvedType instanceof cs){n("switch(d%s){",r);for(var s=e.resolvedType.values,a=Object.keys(s),o=0;o<a.length;++o)s[a[o]]===e.typeDefault&&!i&&(n("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',r,r,r),e.repeated||n("break"),i=!0),n("case%j:",a[o])("case %i:",s[a[o]])("m%s=%j",r,s[a[o]])("break");n("}")}else n('if(typeof d%s!=="object")',r)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,t,r);else{var l=!1;switch(e.type){case"double":case"float":n("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":n("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":n("m%s=d%s|0",r,r);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,l)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,l?"true":"");break;case"bytes":n('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length >= 0)",r)("m%s=d%s",r,r);break;case"string":n("m%s=String(d%s)",r,r);break;case"bool":n("m%s=Boolean(d%s)",r,r);break}}return n}Sy.fromObject=function(e){var t=e.fieldsArray,r=Xt.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var i=0;i<t.length;++i){var s=t[i].resolve(),a=Xt.safeProp(s.name);s.map?(r("if(d%s){",a)('if(typeof d%s!=="object")',a)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",a)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",a),Du(r,s,i,a+"[ks[i]]")("}")("}")):s.repeated?(r("if(d%s){",a)("if(!Array.isArray(d%s))",a)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",a)("for(var i=0;i<d%s.length;++i){",a),Du(r,s,i,a+"[i]")("}")("}")):(s.resolvedType instanceof cs||r("if(d%s!=null){",a),Du(r,s,i,a),s.resolvedType instanceof cs||r("}"))}return r("return m")};function Nu(n,e,t,r){if(e.resolvedType)e.resolvedType instanceof cs?n("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",r,t,r,r,t,r,r):n("d%s=types[%i].toObject(m%s,o)",r,t,r);else{var i=!1;switch(e.type){case"double":case"float":n("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":i=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,i?"true":"",r);break;case"bytes":n("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:n("d%s=m%s",r,r);break}}return n}Sy.toObject=function(e){var t=e.fieldsArray.slice().sort(Xt.compareFieldsById);if(!t.length)return Xt.codegen()("return {}");for(var r=Xt.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),i=[],s=[],a=[],o=0;o<t.length;++o)t[o].partOf||(t[o].resolve().repeated?i:t[o].map?s:a).push(t[o]);if(i.length){for(r("if(o.arrays||o.defaults){"),o=0;o<i.length;++o)r("d%s=[]",Xt.safeProp(i[o].name));r("}")}if(s.length){for(r("if(o.objects||o.defaults){"),o=0;o<s.length;++o)r("d%s={}",Xt.safeProp(s[o].name));r("}")}if(a.length){for(r("if(o.defaults){"),o=0;o<a.length;++o){var l=a[o],c=Xt.safeProp(l.name);if(l.resolvedType instanceof cs)r("d%s=o.enums===String?%j:%j",c,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",c)("}else")("d%s=o.longs===String?%j:%i",c,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var u="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",c,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",c,u)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",c,c)("}")}else r("d%s=%j",c,l.typeDefault)}r("}")}var p=!1;for(o=0;o<t.length;++o){var l=t[o],g=e._fieldsArray.indexOf(l),c=Xt.safeProp(l.name);l.map?(p||(p=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",c,c)("d%s={}",c)("for(var j=0;j<ks2.length;++j){"),Nu(r,l,g,c+"[ks2[j]]")("}")):l.repeated?(r("if(m%s&&m%s.length){",c,c)("d%s=[]",c)("for(var j=0;j<m%s.length;++j){",c),Nu(r,l,g,c+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",c,l.name),Nu(r,l,g,c),l.partOf&&r("if(o.oneofs)")("d%s=%j",Xt.safeProp(l.partOf.name),l.name)),r("}")}return r("return d")}});var xu=A(Ey=>{"use strict";var DC=Ey,NC=Ga();DC[".google.protobuf.Any"]={fromObject:function(n){if(n&&n["@type"]){var e=n["@type"].substring(n["@type"].lastIndexOf("/")+1),t=this.lookup(e);if(t){var r=n["@type"].charAt(0)==="."?n["@type"].slice(1):n["@type"];return r.indexOf("/")===-1&&(r="/"+r),this.create({type_url:r,value:t.encode(t.fromObject(n)).finish()})}}return this.fromObject(n)},toObject:function(n,e){var t="type.googleapis.com/",r="",i="";if(e&&e.json&&n.type_url&&n.value){i=n.type_url.substring(n.type_url.lastIndexOf("/")+1),r=n.type_url.substring(0,n.type_url.lastIndexOf("/")+1);var s=this.lookup(i);s&&(n=s.decode(n.value))}if(!(n instanceof this.ctor)&&n instanceof NC){var a=n.$type.toObject(n,e),o=n.$type.fullName[0]==="."?n.$type.fullName.slice(1):n.$type.fullName;return r===""&&(r=t),i=r+o,a["@type"]=i,a}return this.toObject(n,e)}}});var Wa=A((HM,by)=>{"use strict";by.exports=he;var bt=ai();((he.prototype=Object.create(bt.prototype)).constructor=he).className="Type";var OC=kt(),Mu=vr(),ja=Un(),xC=qa(),kC=za(),ku=Ga(),Pu=Fa(),PC=Ma(),Ke=Pe(),MC=Lu(),LC=Cu(),FC=Ru(),_y=Ou(),BC=xu();function he(n,e){bt.call(this,n,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(he.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var n=Object.keys(this.fields),e=0;e<n.length;++e){var t=this.fields[n[e]],r=t.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=t}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=Ke.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=Ke.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=he.generateConstructor(this)())},set:function(n){var e=n.prototype;e instanceof ku||((n.prototype=new ku).constructor=n,Ke.merge(n.prototype,e)),n.$type=n.prototype.$type=this,Ke.merge(n,ku,!0),this._ctor=n;for(var t=0;t<this.fieldsArray.length;++t)this._fieldsArray[t].resolve();var r={};for(t=0;t<this.oneofsArray.length;++t)r[this._oneofsArray[t].resolve().name]={get:Ke.oneOfGetter(this._oneofsArray[t].oneof),set:Ke.oneOfSetter(this._oneofsArray[t].oneof)};t&&Object.defineProperties(n.prototype,r)}}});he.generateConstructor=function(e){for(var t=Ke.codegen(["p"],e.name),r=0,i;r<e.fieldsArray.length;++r)(i=e._fieldsArray[r]).map?t("this%s={}",Ke.safeProp(i.name)):i.repeated&&t("this%s=[]",Ke.safeProp(i.name));return t("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function Ka(n){return n._fieldsById=n._fieldsArray=n._oneofsArray=null,delete n.encode,delete n.decode,delete n.verify,n}he.fromJSON=function(e,t){var r=new he(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var i=Object.keys(t.fields),s=0;s<i.length;++s)r.add((typeof t.fields[i[s]].keyType<"u"?xC.fromJSON:ja.fromJSON)(i[s],t.fields[i[s]]));if(t.oneofs)for(i=Object.keys(t.oneofs),s=0;s<i.length;++s)r.add(Mu.fromJSON(i[s],t.oneofs[i[s]]));if(t.nested)for(i=Object.keys(t.nested),s=0;s<i.length;++s){var a=t.nested[i[s]];r.add((a.id!==void 0?ja.fromJSON:a.fields!==void 0?he.fromJSON:a.values!==void 0?OC.fromJSON:a.methods!==void 0?kC.fromJSON:bt.fromJSON)(i[s],a))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r};he.prototype.toJSON=function(e){var t=bt.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return Ke.toObject(["edition",this._editionToJSON(),"options",t&&t.options||void 0,"oneofs",bt.arrayToJSON(this.oneofsArray,e),"fields",bt.arrayToJSON(this.fieldsArray.filter(function(i){return!i.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};he.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;bt.prototype.resolveAll.call(this);var e=this.oneofsArray;for(r=0;r<e.length;)e[r++].resolve();for(var t=this.fieldsArray,r=0;r<t.length;)t[r++].resolve();return this};he.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution?(e=this._edition||e,bt.prototype._resolveFeaturesRecursive.call(this,e),this.oneofsArray.forEach(t=>{t._resolveFeatures(e)}),this.fieldsArray.forEach(t=>{t._resolveFeatures(e)}),this):this};he.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null};he.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof ja&&e.extend===void 0){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),Ka(this)}return e instanceof Mu?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),Ka(this)):bt.prototype.add.call(this,e)};he.prototype.remove=function(e){if(e instanceof ja&&e.extend===void 0){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),Ka(this)}if(e instanceof Mu){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),Ka(this)}return bt.prototype.remove.call(this,e)};he.prototype.isReservedId=function(e){return bt.isReservedId(this.reserved,e)};he.prototype.isReservedName=function(e){return bt.isReservedName(this.reserved,e)};he.prototype.create=function(e){return new this.ctor(e)};he.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=MC(this)({Writer:PC,types:t,util:Ke}),this.decode=LC(this)({Reader:Pu,types:t,util:Ke}),this.verify=FC(this)({types:t,util:Ke}),this.fromObject=_y.fromObject(this)({types:t,util:Ke}),this.toObject=_y.toObject(this)({types:t,util:Ke});var i=BC[e];if(i){var s=Object.create(this);s.fromObject=this.fromObject,this.fromObject=i.fromObject.bind(s),s.toObject=this.toObject,this.toObject=i.toObject.bind(s)}return this};he.prototype.encode=function(e,t){return this.setup().encode(e,t)};he.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()};he.prototype.decode=function(e,t){return this.setup().decode(e,t)};he.prototype.decodeDelimited=function(e){return e instanceof Pu||(e=Pu.create(e)),this.decode(e,e.uint32())};he.prototype.verify=function(e){return this.setup().verify(e)};he.prototype.fromObject=function(e){return this.setup().fromObject(e)};he.prototype.toObject=function(e,t){return this.setup().toObject(e,t)};he.d=function(e){return function(r){Ke.decorateType(r,e)}}});var Ya=A(($M,Iy)=>{"use strict";Iy.exports=ut;var Qa=ai();((ut.prototype=Object.create(Qa.prototype)).constructor=ut).className="Root";var Ha=Un(),Fu=kt(),UC=vr(),Vn=Pe(),Bu,Uu,us;function ut(n){Qa.call(this,"",n),this.deferred=[],this.files=[],this._edition="proto2",this._fullyQualifiedObjects={}}ut.fromJSON=function(e,t){return t||(t=new ut),e.options&&t.setOptions(e.options),t.addJSON(e.nested).resolveAll()};ut.prototype.resolvePath=Vn.path.resolve;ut.prototype.fetch=Vn.fetch;function Cy(){}ut.prototype.load=function n(e,t,r){typeof t=="function"&&(r=t,t=void 0);var i=this;if(!r)return Vn.asPromise(n,i,e,t);var s=r===Cy;function a(T,_){if(r){if(s)throw T;_&&_.resolveAll();var w=r;r=null,w(T,_)}}function o(T){var _=T.lastIndexOf("google/protobuf/");if(_>-1){var w=T.substring(_);if(w in us)return w}return null}function l(T,_){try{if(Vn.isString(_)&&_.charAt(0)==="{"&&(_=JSON.parse(_)),!Vn.isString(_))i.setOptions(_.options).addJSON(_.nested);else{Uu.filename=T;var w=Uu(_,i,t),b,P=0;if(w.imports)for(;P<w.imports.length;++P)(b=o(w.imports[P])||i.resolvePath(T,w.imports[P]))&&c(b);if(w.weakImports)for(P=0;P<w.weakImports.length;++P)(b=o(w.weakImports[P])||i.resolvePath(T,w.weakImports[P]))&&c(b,!0)}}catch(L){a(L)}!s&&!u&&a(null,i)}function c(T,_){if(T=o(T)||T,!(i.files.indexOf(T)>-1)){if(i.files.push(T),T in us){s?l(T,us[T]):(++u,setTimeout(function(){--u,l(T,us[T])}));return}if(s){var w;try{w=Vn.fs.readFileSync(T).toString("utf8")}catch(b){_||a(b);return}l(T,w)}else++u,i.fetch(T,function(b,P){if(--u,!!r){if(b){_?u||a(null,i):a(b);return}l(T,P)}})}}var u=0;Vn.isString(e)&&(e=[e]);for(var p=0,g;p<e.length;++p)(g=i.resolvePath("",e[p]))&&c(g);return s?(i.resolveAll(),i):(u||a(null,i),i)};ut.prototype.loadSync=function(e,t){if(!Vn.isNode)throw Error("not supported");return this.load(e,t,Cy)};ut.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return Qa.prototype.resolveAll.call(this)};var $a=/^[A-Z]/;function wy(n,e){var t=e.parent.lookup(e.extend);if(t){var r=new Ha(e.fullName,e.id,e.type,e.rule,void 0,e.options);return t.get(r.name)||(r.declaringField=e,e.extensionField=r,t.add(r)),!0}return!1}ut.prototype._handleAdd=function(e){if(e instanceof Ha)e.extend!==void 0&&!e.extensionField&&(wy(this,e)||this.deferred.push(e));else if(e instanceof Fu)$a.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof UC)){if(e instanceof Bu)for(var t=0;t<this.deferred.length;)wy(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);$a.test(e.name)&&(e.parent[e.name]=e)}(e instanceof Bu||e instanceof Fu||e instanceof Ha)&&(this._fullyQualifiedObjects[e.fullName]=e)};ut.prototype._handleRemove=function(e){if(e instanceof Ha){if(e.extend!==void 0)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof Fu)$a.test(e.name)&&delete e.parent[e.name];else if(e instanceof Qa){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);$a.test(e.name)&&delete e.parent[e.name]}delete this._fullyQualifiedObjects[e.fullName]};ut._configure=function(n,e,t){Bu=n,Uu=e,us=t}});var Pe=A((QM,Ry)=>{"use strict";var Ce=Ry.exports=Qt(),Ay=gu(),qu,Vu;Ce.codegen=ny();Ce.fetch=iy();Ce.path=oy();Ce.fs=Ce.inquire("fs");Ce.toArray=function(e){if(e){for(var t=Object.keys(e),r=new Array(t.length),i=0;i<t.length;)r[i]=e[t[i++]];return r}return[]};Ce.toObject=function(e){for(var t={},r=0;r<e.length;){var i=e[r++],s=e[r++];s!==void 0&&(t[i]=s)}return t};var qC=/\\/g,VC=/"/g;Ce.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)};Ce.safeProp=function(e){return!/^[$\w_]+$/.test(e)||Ce.isReserved(e)?'["'+e.replace(qC,"\\\\").replace(VC,'\\"')+'"]':"."+e};Ce.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var zC=/_([a-z])/g;Ce.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(zC,function(t,r){return r.toUpperCase()})};Ce.compareFieldsById=function(e,t){return e.id-t.id};Ce.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(Ce.decorateRoot.remove(e.$type),e.$type.name=t,Ce.decorateRoot.add(e.$type)),e.$type;qu||(qu=Wa());var r=new qu(t||e.name);return Ce.decorateRoot.add(r),r.ctor=e,Object.defineProperty(e,"$type",{value:r,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:r,enumerable:!1}),r};var GC=0;Ce.decorateEnum=function(e){if(e.$type)return e.$type;Vu||(Vu=kt());var t=new Vu("Enum"+GC++,e);return Ce.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t};Ce.setProperty=function(e,t,r,i){function s(a,o,l){var c=o.shift();if(c==="__proto__"||c==="prototype")return a;if(o.length>0)a[c]=s(a[c]||{},o,l);else{var u=a[c];if(u&&i)return a;u&&(l=[].concat(u).concat(l)),a[c]=l}return a}if(typeof e!="object")throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return t=t.split("."),s(e,t,r)};Object.defineProperty(Ce,"decorateRoot",{get:function(){return Ay.decorated||(Ay.decorated=new(Ya()))}})});var Sr=A(Dy=>{"use strict";var ds=Dy,jC=Pe(),KC=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function hs(n,e){var t=0,r={};for(e|=0;t<n.length;)r[KC[t+e]]=n[t++];return r}ds.basic=hs([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]);ds.defaults=hs([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",jC.emptyArray,null]);ds.long=hs([0,0,0,1,1],7);ds.mapKey=hs([0,0,0,5,5,0,0,0,1,1,0,2],2);ds.packed=hs([1,5,0,0,0,5,5,0,0,0,1,1,0])});var Un=A((JM,Oy)=>{"use strict";Oy.exports=Me;var ps=qn();((Me.prototype=Object.create(ps.prototype)).constructor=Me).className="Field";var Ny=kt(),zu=Sr(),Ie=Pe(),fs,WC=/^required|optional|repeated$/;Me.fromJSON=function(e,t){var r=new Me(e,t.id,t.type,t.rule,t.extend,t.options,t.comment);return t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r};function Me(n,e,t,r,i,s,a){if(Ie.isObject(r)?(a=i,s=r,r=i=void 0):Ie.isObject(i)&&(a=s,s=i,i=void 0),ps.call(this,n,s),!Ie.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!Ie.isString(t))throw TypeError("type must be a string");if(r!==void 0&&!WC.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(i!==void 0&&!Ie.isString(i))throw TypeError("extend must be a string");r==="proto3_optional"&&(r="optional"),this.rule=r&&r!=="optional"?r:void 0,this.type=t,this.id=e,this.extend=i||void 0,this.repeated=r==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=Ie.Long?zu.long[t]!==void 0:!1,this.bytes=t==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this.comment=a}Object.defineProperty(Me.prototype,"required",{get:function(){return this._features.field_presence==="LEGACY_REQUIRED"}});Object.defineProperty(Me.prototype,"optional",{get:function(){return!this.required}});Object.defineProperty(Me.prototype,"delimited",{get:function(){return this.resolvedType instanceof fs&&this._features.message_encoding==="DELIMITED"}});Object.defineProperty(Me.prototype,"packed",{get:function(){return this._features.repeated_field_encoding==="PACKED"}});Object.defineProperty(Me.prototype,"hasPresence",{get:function(){return this.repeated||this.map?!1:this.partOf||this.declaringField||this.extensionField||this._features.field_presence!=="IMPLICIT"}});Me.prototype.setOption=function(e,t,r){return ps.prototype.setOption.call(this,e,t,r)};Me.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Ie.toObject(["edition",this._editionToJSON(),"rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};Me.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=zu.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof fs?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof Ny&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof Ny)&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=Ie.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var e;Ie.base64.test(this.typeDefault)?Ie.base64.decode(this.typeDefault,e=Ie.newBuffer(Ie.base64.length(this.typeDefault)),0):Ie.utf8.write(this.typeDefault,e=Ie.newBuffer(Ie.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=Ie.emptyObject:this.repeated?this.defaultValue=Ie.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof fs&&(this.parent.ctor.prototype[this.name]=this.defaultValue),ps.prototype.resolve.call(this)};Me.prototype._inferLegacyProtoFeatures=function(e){if(e!=="proto2"&&e!=="proto3")return{};var t={};if(this.rule==="required"&&(t.field_presence="LEGACY_REQUIRED"),this.parent&&zu.defaults[this.type]===void 0){var r=this.parent.get(this.type.split(".").pop());r&&r instanceof fs&&r.group&&(t.message_encoding="DELIMITED")}return this.getOption("packed")===!0?t.repeated_field_encoding="PACKED":this.getOption("packed")===!1&&(t.repeated_field_encoding="EXPANDED"),t};Me.prototype._resolveFeatures=function(e){return ps.prototype._resolveFeatures.call(this,this._edition||e)};Me.d=function(e,t,r,i){return typeof t=="function"?t=Ie.decorateType(t).name:t&&typeof t=="object"&&(t=Ie.decorateEnum(t).name),function(a,o){Ie.decorateType(a.constructor).add(new Me(o,e,t,r,{default:i}))}};Me._configure=function(e){fs=e}});var vr=A((XM,Py)=>{"use strict";Py.exports=dt;var Xa=qn();((dt.prototype=Object.create(Xa.prototype)).constructor=dt).className="OneOf";var xy=Un(),Ja=Pe();function dt(n,e,t,r){if(Array.isArray(e)||(t=e,e=void 0),Xa.call(this,n,t),!(e===void 0||Array.isArray(e)))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=r}dt.fromJSON=function(e,t){return new dt(e,t.oneof,t.options,t.comment)};dt.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Ja.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])};function ky(n){if(n.parent)for(var e=0;e<n.fieldsArray.length;++e)n.fieldsArray[e].parent||n.parent.add(n.fieldsArray[e])}dt.prototype.add=function(e){if(!(e instanceof xy))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,ky(this),this};dt.prototype.remove=function(e){if(!(e instanceof xy))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),t=this.oneof.indexOf(e.name),t>-1&&this.oneof.splice(t,1),e.partOf=null,this};dt.prototype.onAdd=function(e){Xa.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}ky(this)};dt.prototype.onRemove=function(e){for(var t=0,r;t<this.fieldsArray.length;++t)(r=this.fieldsArray[t]).parent&&r.parent.remove(r);Xa.prototype.onRemove.call(this,e)};Object.defineProperty(dt.prototype,"isProto3Optional",{get:function(){if(this.fieldsArray==null||this.fieldsArray.length!==1)return!1;var n=this.fieldsArray[0];return n.options!=null&&n.options.proto3_optional===!0}});dt.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(i,s){Ja.decorateType(i.constructor).add(new dt(s,e)),Object.defineProperty(i,s,{get:Ja.oneOfGetter(e),set:Ja.oneOfSetter(e)})}}});var qn=A((ZM,My)=>{"use strict";My.exports=Ve;Ve.className="ReflectionObject";var HC=vr(),ms=Pe(),Za,$C={enum_type:"OPEN",field_presence:"EXPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"},QC={enum_type:"CLOSED",field_presence:"EXPLICIT",json_format:"LEGACY_BEST_EFFORT",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"EXPANDED",utf8_validation:"NONE"},YC={enum_type:"OPEN",field_presence:"IMPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"};function Ve(n,e){if(!ms.isString(n))throw TypeError("name must be a string");if(e&&!ms.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=n,this._edition=null,this._defaultEdition="proto2",this._features={},this._featuresResolved=!1,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(Ve.prototype,{root:{get:function(){for(var n=this;n.parent!==null;)n=n.parent;return n}},fullName:{get:function(){for(var n=[this.name],e=this.parent;e;)n.unshift(e.name),e=e.parent;return n.join(".")}}});Ve.prototype.toJSON=function(){throw Error()};Ve.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof Za&&t._handleAdd(this)};Ve.prototype.onRemove=function(e){var t=e.root;t instanceof Za&&t._handleRemove(this),this.parent=null,this.resolved=!1};Ve.prototype.resolve=function(){return this.resolved?this:(this.root instanceof Za&&(this.resolved=!0),this)};Ve.prototype._resolveFeaturesRecursive=function(e){return this._resolveFeatures(this._edition||e)};Ve.prototype._resolveFeatures=function(e){if(!this._featuresResolved){var t={};if(!e)throw new Error("Unknown edition for "+this.fullName);var r=Object.assign(this.options?Object.assign({},this.options.features):{},this._inferLegacyProtoFeatures(e));if(this._edition){if(e==="proto2")t=Object.assign({},QC);else if(e==="proto3")t=Object.assign({},YC);else if(e==="2023")t=Object.assign({},$C);else throw new Error("Unknown edition: "+e);this._features=Object.assign(t,r||{}),this._featuresResolved=!0;return}if(this.partOf instanceof HC){var i=Object.assign({},this.partOf._features);this._features=Object.assign(i,r||{})}else if(!this.declaringField)if(this.parent){var s=Object.assign({},this.parent._features);this._features=Object.assign(s,r||{})}else throw new Error("Unable to find a parent for "+this.fullName);this.extensionField&&(this.extensionField._features=this._features),this._featuresResolved=!0}};Ve.prototype._inferLegacyProtoFeatures=function(){return{}};Ve.prototype.getOption=function(e){if(this.options)return this.options[e]};Ve.prototype.setOption=function(e,t,r){return this.options||(this.options={}),/^features\./.test(e)?ms.setProperty(this.options,e,t,r):(!r||this.options[e]===void 0)&&(this.getOption(e)!==t&&(this.resolved=!1),this.options[e]=t),this};Ve.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var i=this.parsedOptions;if(r){var s=i.find(function(l){return Object.prototype.hasOwnProperty.call(l,e)});if(s){var a=s[e];ms.setProperty(a,r,t)}else s={},s[e]=ms.setProperty({},r,t),i.push(s)}else{var o={};o[e]=t,i.push(o)}return this};Ve.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)this.setOption(r[i],e[r[i]],t);return this};Ve.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e};Ve.prototype._editionToJSON=function(){if(!(!this._edition||this._edition==="proto3"))return this._edition};Ve._configure=function(n){Za=n}});var kt=A((eL,Fy)=>{"use strict";Fy.exports=Pt;var Gu=qn();((Pt.prototype=Object.create(Gu.prototype)).constructor=Pt).className="Enum";var Ly=ai(),eo=Pe();function Pt(n,e,t,r,i,s){if(Gu.call(this,n,t),e&&typeof e!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=r,this.comments=i||{},this.valuesOptions=s,this._valuesFeatures={},this.reserved=void 0,e)for(var a=Object.keys(e),o=0;o<a.length;++o)typeof e[a[o]]=="number"&&(this.valuesById[this.values[a[o]]=e[a[o]]]=a[o])}Pt.prototype._resolveFeatures=function(e){return e=this._edition||e,Gu.prototype._resolveFeatures.call(this,e),Object.keys(this.values).forEach(t=>{var r=Object.assign({},this._features);this._valuesFeatures[t]=Object.assign(r,this.valuesOptions&&this.valuesOptions[t]&&this.valuesOptions[t].features)}),this};Pt.fromJSON=function(e,t){var r=new Pt(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r};Pt.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return eo.toObject(["edition",this._editionToJSON(),"options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])};Pt.prototype.add=function(e,t,r,i){if(!eo.isString(e))throw TypeError("name must be a string");if(!eo.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==void 0)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return i&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[e]=i||null),this.comments[e]=r||null,this};Pt.prototype.remove=function(e){if(!eo.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(t==null)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this};Pt.prototype.isReservedId=function(e){return Ly.isReservedId(this.reserved,e)};Pt.prototype.isReservedName=function(e){return Ly.isReservedName(this.reserved,e)}});var Lu=A((tL,Uy)=>{"use strict";Uy.exports=XC;var JC=kt(),ju=Sr(),Ku=Pe();function By(n,e,t,r){return e.delimited?n("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",t,r,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):n("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",t,r,(e.id<<3|2)>>>0)}function XC(n){for(var e=Ku.codegen(["m","w"],n.name+"$encode")("if(!w)")("w=Writer.create()"),t,r,i=n.fieldsArray.slice().sort(Ku.compareFieldsById),t=0;t<i.length;++t){var s=i[t].resolve(),a=n._fieldsArray.indexOf(s),o=s.resolvedType instanceof JC?"int32":s.type,l=ju.basic[o];r="m"+Ku.safeProp(s.name),s.map?(e("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|ju.mapKey[s.keyType],s.keyType),l===void 0?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",a,r):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|l,o,r),e("}")("}")):s.repeated?(e("if(%s!=null&&%s.length){",r,r),s.packed&&ju.packed[o]!==void 0?e("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",o,r)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",r),l===void 0?By(e,s,a,r+"[i]"):e("w.uint32(%i).%s(%s[i])",(s.id<<3|l)>>>0,o,r)),e("}")):(s.optional&&e("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,s.name),l===void 0?By(e,s,a,r):e("w.uint32(%i).%s(%s)",(s.id<<3|l)>>>0,o,r))}return e("return w")}});var Vy=A((nL,qy)=>{"use strict";var ie=qy.exports=ey();ie.build="light";function ZC(n,e,t){return typeof e=="function"?(t=e,e=new ie.Root):e||(e=new ie.Root),e.load(n,t)}ie.load=ZC;function e0(n,e){return e||(e=new ie.Root),e.loadSync(n)}ie.loadSync=e0;ie.encoder=Lu();ie.decoder=Cu();ie.verifier=Ru();ie.converter=Ou();ie.ReflectionObject=qn();ie.Namespace=ai();ie.Root=Ya();ie.Enum=kt();ie.Type=Wa();ie.Field=Un();ie.OneOf=vr();ie.MapField=qa();ie.Service=za();ie.Method=Va();ie.Message=Ga();ie.wrappers=xu();ie.types=Sr();ie.util=Pe();ie.ReflectionObject._configure(ie.Root);ie.Namespace._configure(ie.Type,ie.Service,ie.Enum);ie.Root._configure(ie.Type);ie.Field._configure(ie.Type)});var Hu=A((rL,jy)=>{"use strict";jy.exports=Gy;var Wu=/[\s{}=;:[\],'"()<>]/g,t0=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,n0=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,r0=/^ *[*/]+ */,i0=/^\s*\*?\/*/,s0=/\n/g,a0=/\s/,o0=/\\(.?)/g,l0={0:"\0",r:"\r",n:`
`,t:"	"};function zy(n){return n.replace(o0,function(e,t){switch(t){case"\\":case"":return t;default:return l0[t]||""}})}Gy.unescape=zy;function Gy(n,e){n=n.toString();var t=0,r=n.length,i=1,s=0,a={},o=[],l=null;function c(C){return Error("illegal "+C+" (line "+i+")")}function u(){var C=l==="'"?n0:t0;C.lastIndex=t-1;var K=C.exec(n);if(!K)throw c("string");return t=C.lastIndex,b(l),l=null,zy(K[1])}function p(C){return n.charAt(C)}function g(C,K,G){var S={type:n.charAt(C++),lineEmpty:!1,leading:G},m;e?m=2:m=3;var y=C-m,v;do if(--y<0||(v=n.charAt(y))===`
`){S.lineEmpty=!0;break}while(v===" "||v==="	");for(var h=n.substring(C,K).split(s0),E=0;E<h.length;++E)h[E]=h[E].replace(e?i0:r0,"").trim();S.text=h.join(`
`).trim(),a[i]=S,s=i}function T(C){var K=_(C),G=n.substring(C,K),S=/^\s*\/\//.test(G);return S}function _(C){for(var K=C;K<r&&p(K)!==`
`;)K++;return K}function w(){if(o.length>0)return o.shift();if(l)return u();var C,K,G,S,m,y=t===0;do{if(t===r)return null;for(C=!1;a0.test(G=p(t));)if(G===`
`&&(y=!0,++i),++t===r)return null;if(p(t)==="/"){if(++t===r)throw c("comment");if(p(t)==="/")if(e){if(S=t,m=!1,T(t-1)){m=!0;do if(t=_(t),t===r||(t++,!y))break;while(T(t))}else t=Math.min(r,_(t)+1);m&&(g(S,t,y),y=!0),i++,C=!0}else{for(m=p(S=t+1)==="/";p(++t)!==`
`;)if(t===r)return null;++t,m&&(g(S,t-1,y),y=!0),++i,C=!0}else if((G=p(t))==="*"){S=t+1,m=e||p(S)==="*";do{if(G===`
`&&++i,++t===r)throw c("comment");K=G,G=p(t)}while(K!=="*"||G!=="/");++t,m&&(g(S,t-2,y),y=!0),C=!0}else return"/"}}while(C);var v=t;Wu.lastIndex=0;var h=Wu.test(p(v++));if(!h)for(;v<r&&!Wu.test(p(v));)++v;var E=n.substring(t,t=v);return(E==='"'||E==="'")&&(l=E),E}function b(C){o.push(C)}function P(){if(!o.length){var C=w();if(C===null)return null;b(C)}return o[0]}function L(C,K){var G=P(),S=G===C;if(S)return w(),!0;if(!K)throw c("token '"+G+"', '"+C+"' expected");return!1}function F(C){var K=null,G;return C===void 0?(G=a[i-1],delete a[i-1],G&&(e||G.type==="*"||G.lineEmpty)&&(K=G.leading?G.text:null)):(s<C&&P(),G=a[C],delete a[C],G&&!G.lineEmpty&&(e||G.type==="/")&&(K=G.leading?null:G.text)),K}return Object.defineProperty({next:w,peek:P,push:b,skip:L,cmnt:F},"line",{get:function(){return i}})}});var Yy=A((iL,Qy)=>{"use strict";Qy.exports=yn;yn.filename=null;yn.defaults={keepCase:!1};var c0=Hu(),Ky=Ya(),Wy=Wa(),Hy=Un(),u0=qa(),$y=vr(),d0=kt(),h0=za(),f0=Va(),p0=qn(),m0=Sr(),$u=Pe(),g0=/^[1-9][0-9]*$/,y0=/^-?[1-9][0-9]*$/,v0=/^0[x][0-9a-fA-F]+$/,S0=/^-?0[x][0-9a-fA-F]+$/,T0=/^0[0-7]+$/,E0=/^-?0[0-7]+$/,_0=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,Zt=/^[a-zA-Z_][a-zA-Z_0-9]*$/,en=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/;function yn(n,e,t){e instanceof Ky||(t=e,e=new Ky),t||(t=yn.defaults);var r=t.preferTrailingComment||!1,i=c0(n,t.alternateCommentMode||!1),s=i.next,a=i.push,o=i.peek,l=i.skip,c=i.cmnt,u=!0,p,g,T,_="proto2",w=e,b=[],P={},L=t.keepCase?function(D){return D}:$u.camelCase;function F(){b.forEach(D=>{D._edition=_,Object.keys(P).forEach(R=>{D.getOption(R)===void 0&&D.setOption(R,P[R],!0)})})}function C(D,R,O){var q=yn.filename;return O||(yn.filename=null),Error("illegal "+(R||"token")+" '"+D+"' ("+(q?q+", ":"")+"line "+i.line+")")}function K(){var D=[],R;do{if((R=s())!=='"'&&R!=="'")throw C(R);D.push(s()),l(R),R=o()}while(R==='"'||R==="'");return D.join("")}function G(D){var R=s();switch(R){case"'":case'"':return a(R),K();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return m(R,!0)}catch{if(D&&en.test(R))return R;throw C(R,"value")}}function S(D,R){var O,q;do if(R&&((O=o())==='"'||O==="'")){var U=K();if(D.push(U),_>=2023)throw C(U,"id")}else try{D.push([q=y(s()),l("to",!0)?y(s()):q])}catch(me){if(R&&en.test(O)&&_>=2023)D.push(O);else throw me}while(l(",",!0));var Y={options:void 0};Y.setOption=function(me,Ge){this.options===void 0&&(this.options={}),this.options[me]=Ge},k(Y,function(Ge){if(Ge==="option")ae(Y,Ge),l(";");else throw C(Ge)},function(){un(Y)})}function m(D,R){var O=1;switch(D.charAt(0)==="-"&&(O=-1,D=D.substring(1)),D){case"inf":case"INF":case"Inf":return O*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(g0.test(D))return O*parseInt(D,10);if(v0.test(D))return O*parseInt(D,16);if(T0.test(D))return O*parseInt(D,8);if(_0.test(D))return O*parseFloat(D);throw C(D,"number",R)}function y(D,R){switch(D){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!R&&D.charAt(0)==="-")throw C(D,"id");if(y0.test(D))return parseInt(D,10);if(S0.test(D))return parseInt(D,16);if(E0.test(D))return parseInt(D,8);throw C(D,"id")}function v(){if(p!==void 0)throw C("package");if(p=s(),!en.test(p))throw C(p,"name");w=w.define(p),l(";")}function h(){var D=o(),R;switch(D){case"weak":R=T||(T=[]),s();break;case"public":s();default:R=g||(g=[]);break}D=K(),l(";"),R.push(D)}function E(){if(l("="),_=K(),_<2023)throw C(_,"syntax");l(";")}function d(){if(l("="),_=K(),!["2023"].includes(_))throw C(_,"edition");l(";")}function f(D,R){switch(R){case"option":return ae(D,R),l(";"),!0;case"message":return Z(D,R),!0;case"enum":return Qe(D,R),!0;case"service":return m_(D,R),!0;case"extend":return y_(D,R),!0}return!1}function k(D,R,O){var q=i.line;if(D&&(typeof D.comment!="string"&&(D.comment=c()),D.filename=yn.filename),l("{",!0)){for(var U;(U=s())!=="}";)R(U);l(";",!0)}else O&&O(),l(";"),D&&(typeof D.comment!="string"||r)&&(D.comment=c(q)||D.comment)}function Z(D,R){if(!Zt.test(R=s()))throw C(R,"type name");var O=new Wy(R);k(O,function(U){if(!f(O,U))switch(U){case"map":be(O,U);break;case"required":if(_!=="proto2")throw C(U);case"repeated":X(O,U);break;case"optional":if(_==="proto3")X(O,"proto3_optional");else{if(_!=="proto2")throw C(U);X(O,"optional")}break;case"oneof":ze(O,U);break;case"extensions":S(O.extensions||(O.extensions=[]));break;case"reserved":S(O.reserved||(O.reserved=[]),!0);break;default:if(_==="proto2"||!en.test(U))throw C(U);a(U),X(O,"optional");break}}),D.add(O),D===w&&b.push(O)}function X(D,R,O){var q=s();if(q==="group"){de(D,R);return}for(;q.endsWith(".")||o().startsWith(".");)q+=s();if(!en.test(q))throw C(q,"type");var U=s();if(!Zt.test(U))throw C(U,"name");U=L(U),l("=");var Y=new Hy(U,y(s()),q,R,O);if(k(Y,function(Xe){if(Xe==="option")ae(Y,Xe),l(";");else throw C(Xe)},function(){un(Y)}),R==="proto3_optional"){var me=new $y("_"+U);Y.setOption("proto3_optional",!0),me.add(Y),D.add(me)}else D.add(Y);D===w&&b.push(Y)}function de(D,R){if(_>=2023)throw C("group");var O=s();if(!Zt.test(O))throw C(O,"name");var q=$u.lcFirst(O);O===q&&(O=$u.ucFirst(O)),l("=");var U=y(s()),Y=new Wy(O);Y.group=!0;var me=new Hy(q,U,O,R);me.filename=yn.filename,k(Y,function(Xe){switch(Xe){case"option":ae(Y,Xe),l(";");break;case"required":case"repeated":X(Y,Xe);break;case"optional":_==="proto3"?X(Y,"proto3_optional"):X(Y,"optional");break;case"message":Z(Y,Xe);break;case"enum":Qe(Y,Xe);break;case"reserved":S(Y.reserved||(Y.reserved=[]),!0);break;default:throw C(Xe)}}),D.add(Y).add(me)}function be(D){l("<");var R=s();if(m0.mapKey[R]===void 0)throw C(R,"type");l(",");var O=s();if(!en.test(O))throw C(O,"type");l(">");var q=s();if(!Zt.test(q))throw C(q,"name");l("=");var U=new u0(L(q),y(s()),R,O);k(U,function(me){if(me==="option")ae(U,me),l(";");else throw C(me)},function(){un(U)}),D.add(U)}function ze(D,R){if(!Zt.test(R=s()))throw C(R,"name");var O=new $y(L(R));k(O,function(U){U==="option"?(ae(O,U),l(";")):(a(U),X(O,"optional"))}),D.add(O)}function Qe(D,R){if(!Zt.test(R=s()))throw C(R,"name");var O=new d0(R);k(O,function(U){switch(U){case"option":ae(O,U),l(";");break;case"reserved":S(O.reserved||(O.reserved=[]),!0),O.reserved===void 0&&(O.reserved=[]);break;default:xe(O,U)}}),D.add(O),D===w&&b.push(O)}function xe(D,R){if(!Zt.test(R))throw C(R,"name");l("=");var O=y(s(),!0),q={options:void 0};q.getOption=function(U){return this.options[U]},q.setOption=function(U,Y){p0.prototype.setOption.call(q,U,Y)},q.setParsedOption=function(){},k(q,function(Y){if(Y==="option")ae(q,Y),l(";");else throw C(Y)},function(){un(q)}),D.add(R,O,q.comment,q.parsedOptions||q.options)}function ae(D,R){var O,q,U=!0;for(R==="option"&&(R=s());R!=="=";){if(R==="("){var Y=s();l(")"),R="("+Y+")"}if(U){if(U=!1,R.includes(".")&&!R.includes("(")){var me=R.split(".");O=me[0]+".",R=me[1];continue}O=R}else q=q?q+=R:R;R=s()}var Ge=q?O.concat(q):O,Xe=Ye(D,Ge);q=q&&q[0]==="."?q.slice(1):q,O=O&&O[O.length-1]==="."?O.slice(0,-1):O,Je(D,O,Xe,q)}function Ye(D,R){if(l("{",!0)){for(var O={};!l("}",!0);){if(!Zt.test(qe=s()))throw C(qe,"name");if(qe===null)throw C(qe,"end of input");var q,U=qe;if(l(":",!0),o()==="{")q=Ye(D,R+"."+qe);else if(o()==="["){q=[];var Y;if(l("[",!0)){do Y=G(!0),q.push(Y);while(l(",",!0));l("]"),typeof Y<"u"&&Se(D,R+"."+qe,Y)}}else q=G(!0),Se(D,R+"."+qe,q);var me=O[U];me&&(q=[].concat(me).concat(q)),O[U]=q,l(",",!0),l(";",!0)}return O}var Ge=G(!0);return Se(D,R,Ge),Ge}function Se(D,R,O){if(w===D&&/^features\./.test(R)){P[R]=O;return}D.setOption&&D.setOption(R,O)}function Je(D,R,O,q){D.setParsedOption&&D.setParsedOption(R,O,q)}function un(D){if(l("[",!0)){do ae(D,"option");while(l(",",!0));l("]")}return D}function m_(D,R){if(!Zt.test(R=s()))throw C(R,"service name");var O=new h0(R);k(O,function(U){if(!f(O,U))if(U==="rpc")g_(O,U);else throw C(U)}),D.add(O),D===w&&b.push(O)}function g_(D,R){var O=c(),q=R;if(!Zt.test(R=s()))throw C(R,"name");var U=R,Y,me,Ge,Xe;if(l("("),l("stream",!0)&&(me=!0),!en.test(R=s())||(Y=R,l(")"),l("returns"),l("("),l("stream",!0)&&(Xe=!0),!en.test(R=s())))throw C(R);Ge=R,l(")");var ca=new f0(U,q,Y,Ge,me,Xe);ca.comment=O,k(ca,function(rc){if(rc==="option")ae(ca,rc),l(";");else throw C(rc)}),D.add(ca)}function y_(D,R){if(!en.test(R=s()))throw C(R,"reference");var O=R;k(null,function(U){switch(U){case"required":case"repeated":X(D,U,O);break;case"optional":_==="proto3"?X(D,"proto3_optional",O):X(D,"optional",O);break;default:if(_==="proto2"||!en.test(U))throw C(U);a(U),X(D,"optional",O);break}})}for(var qe;(qe=s())!==null;)switch(qe){case"package":if(!u)throw C(qe);v();break;case"import":if(!u)throw C(qe);h();break;case"syntax":if(!u)throw C(qe);E();break;case"edition":if(!u)throw C(qe);d();break;case"option":ae(w,qe),l(";",!0);break;default:if(f(w,qe)){u=!1;continue}throw C(qe)}return F(),yn.filename=null,{package:p,imports:g,weakImports:T,root:e}}});var Zy=A((sL,Xy)=>{"use strict";Xy.exports=Mt;var b0=/\/|\./;function Mt(n,e){b0.test(n)||(n="google/protobuf/"+n+".proto",e={nested:{google:{nested:{protobuf:{nested:e}}}}}),Mt[n]=e}Mt("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var Jy;Mt("duration",{Duration:Jy={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});Mt("timestamp",{Timestamp:Jy});Mt("empty",{Empty:{fields:{}}});Mt("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});Mt("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});Mt("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});Mt.get=function(e){return Mt[e]||null}});var tv=A((aL,ev)=>{"use strict";var zn=ev.exports=Vy();zn.build="full";zn.tokenize=Hu();zn.parse=Yy();zn.common=Zy();zn.Root._configure(zn.Type,zn.parse,zn.common)});var to=A((oL,nv)=>{"use strict";nv.exports=tv()});var Qu=A((lL,w0)=>{w0.exports={nested:{google:{nested:{protobuf:{options:{go_package:"google.golang.org/protobuf/types/descriptorpb",java_package:"com.google.protobuf",java_outer_classname:"DescriptorProtos",csharp_namespace:"Google.Protobuf.Reflection",objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{FileDescriptorSet:{edition:"proto2",fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}},extensions:[[536e6,536e6]]},Edition:{edition:"proto2",values:{EDITION_UNKNOWN:0,EDITION_LEGACY:900,EDITION_PROTO2:998,EDITION_PROTO3:999,EDITION_2023:1e3,EDITION_2024:1001,EDITION_1_TEST_ONLY:1,EDITION_2_TEST_ONLY:2,EDITION_99997_TEST_ONLY:99997,EDITION_99998_TEST_ONLY:99998,EDITION_99999_TEST_ONLY:99999,EDITION_MAX:2147483647}},FileDescriptorProto:{edition:"proto2",fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10},weakDependency:{rule:"repeated",type:"int32",id:11},optionDependency:{rule:"repeated",type:"string",id:15},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12},edition:{type:"Edition",id:14}}},DescriptorProto:{edition:"proto2",fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10},visibility:{type:"SymbolVisibility",id:11}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2},options:{type:"ExtensionRangeOptions",id:3}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},ExtensionRangeOptions:{edition:"proto2",fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999},declaration:{rule:"repeated",type:"Declaration",id:2,options:{retention:"RETENTION_SOURCE"}},features:{type:"FeatureSet",id:50},verification:{type:"VerificationState",id:3,options:{default:"UNVERIFIED",retention:"RETENTION_SOURCE"}}},extensions:[[1e3,536870911]],nested:{Declaration:{fields:{number:{type:"int32",id:1},fullName:{type:"string",id:2},type:{type:"string",id:3},reserved:{type:"bool",id:5},repeated:{type:"bool",id:6}},reserved:[[4,4]]},VerificationState:{values:{DECLARATION:0,UNVERIFIED:1}}}},FieldDescriptorProto:{edition:"proto2",fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8},proto3Optional:{type:"bool",id:17}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REPEATED:3,LABEL_REQUIRED:2}}}},OneofDescriptorProto:{edition:"proto2",fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{edition:"proto2",fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3},reservedRange:{rule:"repeated",type:"EnumReservedRange",id:4},reservedName:{rule:"repeated",type:"string",id:5},visibility:{type:"SymbolVisibility",id:6}},nested:{EnumReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},EnumValueDescriptorProto:{edition:"proto2",fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{edition:"proto2",fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{edition:"proto2",fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{edition:"proto2",fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31,options:{default:!0}},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},swiftPrefix:{type:"string",id:39},phpClassPrefix:{type:"string",id:40},phpNamespace:{type:"string",id:41},phpMetadataNamespace:{type:"string",id:44},rubyPackage:{type:"string",id:45},features:{type:"FeatureSet",id:50},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[42,42],"php_generic_services",[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{edition:"proto2",fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},deprecatedLegacyJsonFieldConflicts:{type:"bool",id:11,options:{deprecated:!0}},features:{type:"FeatureSet",id:12},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4],[5,5],[6,6],[8,8],[9,9]]},FieldOptions:{edition:"proto2",fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},unverifiedLazy:{type:"bool",id:15},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10,options:{deprecated:!0}},debugRedact:{type:"bool",id:16},retention:{type:"OptionRetention",id:17},targets:{rule:"repeated",type:"OptionTargetType",id:19},editionDefaults:{rule:"repeated",type:"EditionDefault",id:20},features:{type:"FeatureSet",id:21},featureSupport:{type:"FeatureSupport",id:22},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4],[18,18]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}},OptionRetention:{values:{RETENTION_UNKNOWN:0,RETENTION_RUNTIME:1,RETENTION_SOURCE:2}},OptionTargetType:{values:{TARGET_TYPE_UNKNOWN:0,TARGET_TYPE_FILE:1,TARGET_TYPE_EXTENSION_RANGE:2,TARGET_TYPE_MESSAGE:3,TARGET_TYPE_FIELD:4,TARGET_TYPE_ONEOF:5,TARGET_TYPE_ENUM:6,TARGET_TYPE_ENUM_ENTRY:7,TARGET_TYPE_SERVICE:8,TARGET_TYPE_METHOD:9}},EditionDefault:{fields:{edition:{type:"Edition",id:3},value:{type:"string",id:2}}},FeatureSupport:{fields:{editionIntroduced:{type:"Edition",id:1},editionDeprecated:{type:"Edition",id:2},deprecationWarning:{type:"string",id:3},editionRemoved:{type:"Edition",id:4}}}}},OneofOptions:{edition:"proto2",fields:{features:{type:"FeatureSet",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{edition:"proto2",fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},deprecatedLegacyJsonFieldConflicts:{type:"bool",id:6,options:{deprecated:!0}},features:{type:"FeatureSet",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[5,5]]},EnumValueOptions:{edition:"proto2",fields:{deprecated:{type:"bool",id:1},features:{type:"FeatureSet",id:2},debugRedact:{type:"bool",id:3},featureSupport:{type:"FieldOptions.FeatureSupport",id:4},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{edition:"proto2",fields:{features:{type:"FeatureSet",id:34},deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{edition:"proto2",fields:{deprecated:{type:"bool",id:33},idempotencyLevel:{type:"IdempotencyLevel",id:34,options:{default:"IDEMPOTENCY_UNKNOWN"}},features:{type:"FeatureSet",id:35},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],nested:{IdempotencyLevel:{values:{IDEMPOTENCY_UNKNOWN:0,NO_SIDE_EFFECTS:1,IDEMPOTENT:2}}}},UninterpretedOption:{edition:"proto2",fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},FeatureSet:{edition:"proto2",fields:{fieldPresence:{type:"FieldPresence",id:1,options:{retention:"RETENTION_RUNTIME",targets:"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_2023","edition_defaults.value":"EXPLICIT"}},enumType:{type:"EnumType",id:2,options:{retention:"RETENTION_RUNTIME",targets:"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"OPEN"}},repeatedFieldEncoding:{type:"RepeatedFieldEncoding",id:3,options:{retention:"RETENTION_RUNTIME",targets:"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"PACKED"}},utf8Validation:{type:"Utf8Validation",id:4,options:{retention:"RETENTION_RUNTIME",targets:"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"VERIFY"}},messageEncoding:{type:"MessageEncoding",id:5,options:{retention:"RETENTION_RUNTIME",targets:"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_LEGACY","edition_defaults.value":"LENGTH_PREFIXED"}},jsonFormat:{type:"JsonFormat",id:6,options:{retention:"RETENTION_RUNTIME",targets:"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"ALLOW"}},enforceNamingStyle:{type:"EnforceNamingStyle",id:7,options:{retention:"RETENTION_SOURCE",targets:"TARGET_TYPE_METHOD","feature_support.edition_introduced":"EDITION_2024","edition_defaults.edition":"EDITION_2024","edition_defaults.value":"STYLE2024"}},defaultSymbolVisibility:{type:"VisibilityFeature.DefaultSymbolVisibility",id:8,options:{retention:"RETENTION_SOURCE",targets:"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2024","edition_defaults.edition":"EDITION_2024","edition_defaults.value":"EXPORT_TOP_LEVEL"}}},extensions:[[1e3,9994],[9995,9999],[1e4,1e4]],reserved:[[999,999]],nested:{FieldPresence:{values:{FIELD_PRESENCE_UNKNOWN:0,EXPLICIT:1,IMPLICIT:2,LEGACY_REQUIRED:3}},EnumType:{values:{ENUM_TYPE_UNKNOWN:0,OPEN:1,CLOSED:2}},RepeatedFieldEncoding:{values:{REPEATED_FIELD_ENCODING_UNKNOWN:0,PACKED:1,EXPANDED:2}},Utf8Validation:{values:{UTF8_VALIDATION_UNKNOWN:0,VERIFY:2,NONE:3}},MessageEncoding:{values:{MESSAGE_ENCODING_UNKNOWN:0,LENGTH_PREFIXED:1,DELIMITED:2}},JsonFormat:{values:{JSON_FORMAT_UNKNOWN:0,ALLOW:1,LEGACY_BEST_EFFORT:2}},EnforceNamingStyle:{values:{ENFORCE_NAMING_STYLE_UNKNOWN:0,STYLE2024:1,STYLE_LEGACY:2}},VisibilityFeature:{fields:{},reserved:[[1,536870911]],nested:{DefaultSymbolVisibility:{values:{DEFAULT_SYMBOL_VISIBILITY_UNKNOWN:0,EXPORT_ALL:1,EXPORT_TOP_LEVEL:2,LOCAL_ALL:3,STRICT:4}}}}}},FeatureSetDefaults:{edition:"proto2",fields:{defaults:{rule:"repeated",type:"FeatureSetEditionDefault",id:1},minimumEdition:{type:"Edition",id:4},maximumEdition:{type:"Edition",id:5}},nested:{FeatureSetEditionDefault:{fields:{edition:{type:"Edition",id:3},overridableFeatures:{type:"FeatureSet",id:4},fixedFeatures:{type:"FeatureSet",id:5}},reserved:[[1,1],[2,2],"features"]}}},SourceCodeInfo:{edition:"proto2",fields:{location:{rule:"repeated",type:"Location",id:1}},extensions:[[536e6,536e6]],nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1,options:{packed:!0}},span:{rule:"repeated",type:"int32",id:2,options:{packed:!0}},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{edition:"proto2",fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1,options:{packed:!0}},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4},semantic:{type:"Semantic",id:5}},nested:{Semantic:{values:{NONE:0,SET:1,ALIAS:2}}}}}},SymbolVisibility:{edition:"proto2",values:{VISIBILITY_UNSET:0,VISIBILITY_LOCAL:1,VISIBILITY_EXPORT:2}}}}}}}}});var cv=A((J,lv)=>{"use strict";var ht=to();lv.exports=J=ht.descriptor=ht.Root.fromJSON(Qu()).lookup(".google.protobuf");var rv=ht.Namespace,gs=ht.Root,vn=ht.Enum,tn=ht.Type,Gn=ht.Field,C0=ht.MapField,no=ht.OneOf,ys=ht.Service,ro=ht.Method;gs.fromDescriptor=function(e){typeof e.length=="number"&&(e=J.FileDescriptorSet.decode(e));var t=new gs;if(e.file)for(var r,i,s=0,a;s<e.file.length;++s){i=t,(r=e.file[s]).package&&r.package.length&&(i=t.define(r.package));var o=M0(r);if(r.name&&r.name.length&&t.files.push(i.filename=r.name),r.messageType)for(a=0;a<r.messageType.length;++a)i.add(tn.fromDescriptor(r.messageType[a],o));if(r.enumType)for(a=0;a<r.enumType.length;++a)i.add(vn.fromDescriptor(r.enumType[a],o));if(r.extension)for(a=0;a<r.extension.length;++a)i.add(Gn.fromDescriptor(r.extension[a],o));if(r.service)for(a=0;a<r.service.length;++a)i.add(ys.fromDescriptor(r.service[a],o));var l=li(r.options,J.FileOptions);if(l){var c=Object.keys(l);for(a=0;a<c.length;++a)i.setOption(c[a],l[c[a]])}}return t.resolveAll()};gs.prototype.toDescriptor=function(e){var t=J.FileDescriptorSet.create();return iv(this,t.file,e),t};function iv(n,e,t){var r=J.FileDescriptorProto.create({name:n.filename||(n.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});L0(t,r),n instanceof gs||(r.package=n.fullName.substring(1));for(var i=0,s;i<n.nestedArray.length;++i)(s=n._nestedArray[i])instanceof tn?r.messageType.push(s.toDescriptor(t)):s instanceof vn?r.enumType.push(s.toDescriptor()):s instanceof Gn?r.extension.push(s.toDescriptor(t)):s instanceof ys?r.service.push(s.toDescriptor()):s instanceof rv&&iv(s,e,t);r.options=ci(n.options,J.FileOptions),r.messageType.length+r.enumType.length+r.extension.length+r.service.length&&e.push(r)}var I0=0;tn.fromDescriptor=function(e,t,r){typeof e.length=="number"&&(e=J.DescriptorProto.decode(e));var i=new tn(e.name.length?e.name:"Type"+I0++,li(e.options,J.MessageOptions)),s;if(r||(i._edition=t),e.oneofDecl)for(s=0;s<e.oneofDecl.length;++s)i.add(no.fromDescriptor(e.oneofDecl[s]));if(e.field)for(s=0;s<e.field.length;++s){var a=Gn.fromDescriptor(e.field[s],t,!0);i.add(a),e.field[s].hasOwnProperty("oneofIndex")&&i.oneofsArray[e.field[s].oneofIndex].add(a)}if(e.extension)for(s=0;s<e.extension.length;++s)i.add(Gn.fromDescriptor(e.extension[s],t,!0));if(e.nestedType)for(s=0;s<e.nestedType.length;++s)i.add(tn.fromDescriptor(e.nestedType[s],t,!0)),e.nestedType[s].options&&e.nestedType[s].options.mapEntry&&i.setOption("map_entry",!0);if(e.enumType)for(s=0;s<e.enumType.length;++s)i.add(vn.fromDescriptor(e.enumType[s],t,!0));if(e.extensionRange&&e.extensionRange.length)for(i.extensions=[],s=0;s<e.extensionRange.length;++s)i.extensions.push([e.extensionRange[s].start,e.extensionRange[s].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(i.reserved=[],e.reservedRange)for(s=0;s<e.reservedRange.length;++s)i.reserved.push([e.reservedRange[s].start,e.reservedRange[s].end]);if(e.reservedName)for(s=0;s<e.reservedName.length;++s)i.reserved.push(e.reservedName[s])}return i};tn.prototype.toDescriptor=function(e){var t=J.DescriptorProto.create({name:this.name}),r;for(r=0;r<this.fieldsArray.length;++r){var i;if(t.field.push(i=this._fieldsArray[r].toDescriptor(e)),this._fieldsArray[r]instanceof C0){var s=Yu(this._fieldsArray[r].keyType,this._fieldsArray[r].resolvedKeyType,!1),a=Yu(this._fieldsArray[r].type,this._fieldsArray[r].resolvedType,!1),o=a===11||a===14?this._fieldsArray[r].resolvedType&&ov(this.parent,this._fieldsArray[r].resolvedType)||this._fieldsArray[r].type:void 0;t.nestedType.push(J.DescriptorProto.create({name:i.typeName,field:[J.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),J.FieldDescriptorProto.create({name:"value",number:2,label:1,type:a,typeName:o})],options:J.MessageOptions.create({mapEntry:!0})}))}}for(r=0;r<this.oneofsArray.length;++r)t.oneofDecl.push(this._oneofsArray[r].toDescriptor());for(r=0;r<this.nestedArray.length;++r)this._nestedArray[r]instanceof Gn?t.field.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof tn?t.nestedType.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof vn&&t.enumType.push(this._nestedArray[r].toDescriptor());if(this.extensions)for(r=0;r<this.extensions.length;++r)t.extensionRange.push(J.DescriptorProto.ExtensionRange.create({start:this.extensions[r][0],end:this.extensions[r][1]}));if(this.reserved)for(r=0;r<this.reserved.length;++r)typeof this.reserved[r]=="string"?t.reservedName.push(this.reserved[r]):t.reservedRange.push(J.DescriptorProto.ReservedRange.create({start:this.reserved[r][0],end:this.reserved[r][1]}));return t.options=ci(this.options,J.MessageOptions),t};var A0=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;Gn.fromDescriptor=function(e,t,r){if(typeof e.length=="number"&&(e=J.DescriptorProto.decode(e)),typeof e.number!="number")throw Error("missing field id");var i;e.typeName&&e.typeName.length?i=e.typeName:i=x0(e.type);var s;switch(e.label){case 1:s=void 0;break;case 2:s="required";break;case 3:s="repeated";break;default:throw Error("illegal label: "+e.label)}var a=e.extendee;e.extendee!==void 0&&(a=a.length?a:void 0);var o=new Gn(e.name.length?e.name:"field"+e.number,e.number,i,s,a);if(r||(o._edition=t),o.options=li(e.options,J.FieldOptions),e.proto3_optional&&(o.options.proto3_optional=!0),e.defaultValue&&e.defaultValue.length){var l=e.defaultValue;switch(l){case"true":case"TRUE":l=!0;break;case"false":case"FALSE":l=!1;break;default:var c=A0.exec(l);c&&(l=parseInt(l));break}o.setOption("default",l)}return k0(e.type)&&(t==="proto3"?e.options&&!e.options.packed&&o.setOption("packed",!1):(!t||t==="proto2")&&e.options&&e.options.packed&&o.setOption("packed",!0)),o};Gn.prototype.toDescriptor=function(e){var t=J.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=ht.util.ucFirst(this.name),t.label=3;else{switch(t.type=Yu(this.type,this.resolve().resolvedType,this.delimited)){case 10:case 11:case 14:t.typeName=this.resolvedType?ov(this.parent,this.resolvedType):this.type;break}this.rule==="repeated"?t.label=3:this.required&&e==="proto2"?t.label=2:t.label=1}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=ci(this.options,J.FieldOptions),this.options.default!=null&&(t.defaultValue=String(this.options.default)),this.options.proto3_optional&&(t.proto3_optional=!0)),e==="proto3"?this.packed||((t.options||(t.options=J.FieldOptions.create())).packed=!1):(!e||e==="proto2")&&this.packed&&((t.options||(t.options=J.FieldOptions.create())).packed=!0),t};var R0=0;vn.fromDescriptor=function(e,t,r){typeof e.length=="number"&&(e=J.EnumDescriptorProto.decode(e));var i={};if(e.value)for(var s=0;s<e.value.length;++s){var a=e.value[s].name,o=e.value[s].number||0;i[a&&a.length?a:"NAME"+o]=o}var l=new vn(e.name&&e.name.length?e.name:"Enum"+R0++,i,li(e.options,J.EnumOptions));return r||(l._edition=t),l};vn.prototype.toDescriptor=function(){for(var e=[],t=0,r=Object.keys(this.values);t<r.length;++t)e.push(J.EnumValueDescriptorProto.create({name:r[t],number:this.values[r[t]]}));return J.EnumDescriptorProto.create({name:this.name,value:e,options:ci(this.options,J.EnumOptions)})};var D0=0;no.fromDescriptor=function(e){return typeof e.length=="number"&&(e=J.OneofDescriptorProto.decode(e)),new no(e.name&&e.name.length?e.name:"oneof"+D0++)};no.prototype.toDescriptor=function(){return J.OneofDescriptorProto.create({name:this.name})};var N0=0;ys.fromDescriptor=function(e,t,r){typeof e.length=="number"&&(e=J.ServiceDescriptorProto.decode(e));var i=new ys(e.name&&e.name.length?e.name:"Service"+N0++,li(e.options,J.ServiceOptions));if(r||(i._edition=t),e.method)for(var s=0;s<e.method.length;++s)i.add(ro.fromDescriptor(e.method[s]));return i};ys.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return J.ServiceDescriptorProto.create({name:this.name,method:e,options:ci(this.options,J.ServiceOptions)})};var O0=0;ro.fromDescriptor=function(e){return typeof e.length=="number"&&(e=J.MethodDescriptorProto.decode(e)),new ro(e.name&&e.name.length?e.name:"Method"+O0++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,li(e.options,J.MethodOptions))};ro.prototype.toDescriptor=function(){return J.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:ci(this.options,J.MethodOptions)})};function x0(n){switch(n){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+n)}function k0(n){switch(n){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function Yu(n,e,t){switch(n){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(e instanceof vn)return 14;if(e instanceof tn)return t?10:11;throw Error("illegal type: "+n)}function sv(n,e){for(var t={},r=0,i,s;r<e.fieldsArray.length;++r)if((s=(i=e._fieldsArray[r]).name)!=="uninterpretedOption"&&Object.prototype.hasOwnProperty.call(n,s)){var a=P0(s);i.resolvedType instanceof tn?t[a]=sv(n[s],i.resolvedType):i.resolvedType instanceof vn?t[a]=i.resolvedType.valuesById[n[s]]:t[a]=n[s]}return t}function li(n,e){if(n)return sv(e.toObject(n),e)}function av(n,e){for(var t={},r=Object.keys(n),i=0;i<r.length;++i){var s=r[i],a=ht.util.camelCase(s);if(Object.prototype.hasOwnProperty.call(e.fields,a)){var o=e.fields[a];o.resolvedType instanceof tn?t[a]=av(n[s],o.resolvedType):t[a]=n[s],o.repeated&&!Array.isArray(t[a])&&(t[a]=[t[a]])}}return t}function ci(n,e){if(n)return e.fromObject(av(n,e))}function ov(n,e){var t=n.fullName.split("."),r=e.fullName.split("."),i=0,s=0,a=r.length-1;if(!(n instanceof gs)&&e instanceof rv)for(;i<t.length&&s<a&&t[i]===r[s];){var o=e.lookup(t[i++],!0);if(o!==null&&o!==e)break;++s}else for(;i<t.length&&s<a&&t[i]===r[s];++i,++s);return r.slice(s).join(".")}function P0(n){return n.substring(0,1)+n.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}function M0(n){if(n.syntax==="editions")switch(n.edition){case J.Edition.EDITION_2023:return"2023";default:throw new Error("Unsupported edition "+n.edition)}return n.syntax==="proto3"?"proto3":"proto2"}function L0(n,e){if(n)if(n==="proto2"||n==="proto3")e.syntax=n;else switch(e.syntax="editions",n){case"2023":e.edition=J.Edition.EDITION_2023;break;default:throw new Error("Unsupported edition "+n)}}});var uv=A((cL,F0)=>{F0.exports={nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}}});var dv=A((uL,B0)=>{B0.exports={nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var hv=A((dL,U0)=>{U0.exports={nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var gv=A(jn=>{"use strict";Object.defineProperty(jn,"__esModule",{value:!0});jn.addCommonProtos=jn.loadProtosWithOptionsSync=jn.loadProtosWithOptions=void 0;var fv=ce("fs"),pv=ce("path"),ui=to();function mv(n,e){let t=n.resolvePath;n.resolvePath=(r,i)=>{if(pv.isAbsolute(i))return i;for(let s of e){let a=pv.join(s,i);try{return fv.accessSync(a,fv.constants.R_OK),a}catch{continue}}return process.emitWarning(`${i} not found in any of the include paths ${e}`),t(r,i)}}function q0(n,e){return x(this,null,function*(){let t=new ui.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))return Promise.reject(new Error("The includeDirs option must be an array"));mv(t,e.includeDirs)}let r=yield t.load(n,e);return r.resolveAll(),r})}jn.loadProtosWithOptions=q0;function V0(n,e){let t=new ui.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))throw new Error("The includeDirs option must be an array");mv(t,e.includeDirs)}let r=t.loadSync(n,e);return r.resolveAll(),r}jn.loadProtosWithOptionsSync=V0;function z0(){let n=uv(),e=Qu(),t=dv(),r=hv();ui.common("api",n.nested.google.nested.protobuf.nested),ui.common("descriptor",e.nested.google.nested.protobuf.nested),ui.common("source_context",t.nested.google.nested.protobuf.nested),ui.common("type",r.nested.google.nested.protobuf.nested)}jn.addCommonProtos=z0});var yv=A((vs,Ju)=>{"use strict";(function(n,e){function t(r){return r.default||r}typeof define=="function"&&define.amd?define([],function(){var r={};return e(r),t(r)}):typeof vs=="object"?(e(vs),typeof Ju=="object"&&(Ju.exports=t(vs))):function(){var r={};e(r),n.Long=t(r)}()})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:vs,function(n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(d,f,k){this.low=d|0,this.high=f|0,this.unsigned=!!k}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function r(d){return(d&&d.__isLong__)===!0}function i(d){var f=Math.clz32(d&-d);return d?31-f:f}t.isLong=r;var s={},a={};function o(d,f){var k,Z,X;return f?(d>>>=0,(X=0<=d&&d<256)&&(Z=a[d],Z)?Z:(k=c(d,0,!0),X&&(a[d]=k),k)):(d|=0,(X=-128<=d&&d<128)&&(Z=s[d],Z)?Z:(k=c(d,d<0?-1:0,!1),X&&(s[d]=k),k))}t.fromInt=o;function l(d,f){if(isNaN(d))return f?C:F;if(f){if(d<0)return C;if(d>=b)return y}else{if(d<=-P)return v;if(d+1>=P)return m}return d<0?l(-d,f).neg():c(d%w|0,d/w|0,f)}t.fromNumber=l;function c(d,f,k){return new t(d,f,k)}t.fromBits=c;var u=Math.pow;function p(d,f,k){if(d.length===0)throw Error("empty string");if(typeof f=="number"?(k=f,f=!1):f=!!f,d==="NaN"||d==="Infinity"||d==="+Infinity"||d==="-Infinity")return f?C:F;if(k=k||10,k<2||36<k)throw RangeError("radix");var Z;if((Z=d.indexOf("-"))>0)throw Error("interior hyphen");if(Z===0)return p(d.substring(1),f,k).neg();for(var X=l(u(k,8)),de=F,be=0;be<d.length;be+=8){var ze=Math.min(8,d.length-be),Qe=parseInt(d.substring(be,be+ze),k);if(ze<8){var xe=l(u(k,ze));de=de.mul(xe).add(l(Qe))}else de=de.mul(X),de=de.add(l(Qe))}return de.unsigned=f,de}t.fromString=p;function g(d,f){return typeof d=="number"?l(d,f):typeof d=="string"?p(d,f):c(d.low,d.high,typeof f=="boolean"?f:d.unsigned)}t.fromValue=g;var T=65536,_=1<<24,w=T*T,b=w*w,P=b/2,L=o(_),F=o(0);t.ZERO=F;var C=o(0,!0);t.UZERO=C;var K=o(1);t.ONE=K;var G=o(1,!0);t.UONE=G;var S=o(-1);t.NEG_ONE=S;var m=c(-1,2147483647,!1);t.MAX_VALUE=m;var y=c(-1,-1,!0);t.MAX_UNSIGNED_VALUE=y;var v=c(0,-2147483648,!1);t.MIN_VALUE=v;var h=t.prototype;h.toInt=function(){return this.unsigned?this.low>>>0:this.low},h.toNumber=function(){return this.unsigned?(this.high>>>0)*w+(this.low>>>0):this.high*w+(this.low>>>0)},h.toString=function(f){if(f=f||10,f<2||36<f)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(v)){var k=l(f),Z=this.div(k),X=Z.mul(k).sub(this);return Z.toString(f)+X.toInt().toString(f)}else return"-"+this.neg().toString(f);for(var de=l(u(f,6),this.unsigned),be=this,ze="";;){var Qe=be.div(de),xe=be.sub(Qe.mul(de)).toInt()>>>0,ae=xe.toString(f);if(be=Qe,be.isZero())return ae+ze;for(;ae.length<6;)ae="0"+ae;ze=""+ae+ze}},h.getHighBits=function(){return this.high},h.getHighBitsUnsigned=function(){return this.high>>>0},h.getLowBits=function(){return this.low},h.getLowBitsUnsigned=function(){return this.low>>>0},h.getNumBitsAbs=function(){if(this.isNegative())return this.eq(v)?64:this.neg().getNumBitsAbs();for(var f=this.high!=0?this.high:this.low,k=31;k>0&&(f&1<<k)==0;k--);return this.high!=0?k+33:k+1},h.isSafeInteger=function(){var f=this.high>>21;return f?this.unsigned?!1:f===-1&&!(this.low===0&&this.high===-2097152):!0},h.isZero=function(){return this.high===0&&this.low===0},h.eqz=h.isZero,h.isNegative=function(){return!this.unsigned&&this.high<0},h.isPositive=function(){return this.unsigned||this.high>=0},h.isOdd=function(){return(this.low&1)===1},h.isEven=function(){return(this.low&1)===0},h.equals=function(f){return r(f)||(f=g(f)),this.unsigned!==f.unsigned&&this.high>>>31===1&&f.high>>>31===1?!1:this.high===f.high&&this.low===f.low},h.eq=h.equals,h.notEquals=function(f){return!this.eq(f)},h.neq=h.notEquals,h.ne=h.notEquals,h.lessThan=function(f){return this.comp(f)<0},h.lt=h.lessThan,h.lessThanOrEqual=function(f){return this.comp(f)<=0},h.lte=h.lessThanOrEqual,h.le=h.lessThanOrEqual,h.greaterThan=function(f){return this.comp(f)>0},h.gt=h.greaterThan,h.greaterThanOrEqual=function(f){return this.comp(f)>=0},h.gte=h.greaterThanOrEqual,h.ge=h.greaterThanOrEqual,h.compare=function(f){if(r(f)||(f=g(f)),this.eq(f))return 0;var k=this.isNegative(),Z=f.isNegative();return k&&!Z?-1:!k&&Z?1:this.unsigned?f.high>>>0>this.high>>>0||f.high===this.high&&f.low>>>0>this.low>>>0?-1:1:this.sub(f).isNegative()?-1:1},h.comp=h.compare,h.negate=function(){return!this.unsigned&&this.eq(v)?v:this.not().add(K)},h.neg=h.negate,h.add=function(f){r(f)||(f=g(f));var k=this.high>>>16,Z=this.high&65535,X=this.low>>>16,de=this.low&65535,be=f.high>>>16,ze=f.high&65535,Qe=f.low>>>16,xe=f.low&65535,ae=0,Ye=0,Se=0,Je=0;return Je+=de+xe,Se+=Je>>>16,Je&=65535,Se+=X+Qe,Ye+=Se>>>16,Se&=65535,Ye+=Z+ze,ae+=Ye>>>16,Ye&=65535,ae+=k+be,ae&=65535,c(Se<<16|Je,ae<<16|Ye,this.unsigned)},h.subtract=function(f){return r(f)||(f=g(f)),this.add(f.neg())},h.sub=h.subtract,h.multiply=function(f){if(this.isZero())return this;if(r(f)||(f=g(f)),e){var k=e.mul(this.low,this.high,f.low,f.high);return c(k,e.get_high(),this.unsigned)}if(f.isZero())return this.unsigned?C:F;if(this.eq(v))return f.isOdd()?v:F;if(f.eq(v))return this.isOdd()?v:F;if(this.isNegative())return f.isNegative()?this.neg().mul(f.neg()):this.neg().mul(f).neg();if(f.isNegative())return this.mul(f.neg()).neg();if(this.lt(L)&&f.lt(L))return l(this.toNumber()*f.toNumber(),this.unsigned);var Z=this.high>>>16,X=this.high&65535,de=this.low>>>16,be=this.low&65535,ze=f.high>>>16,Qe=f.high&65535,xe=f.low>>>16,ae=f.low&65535,Ye=0,Se=0,Je=0,un=0;return un+=be*ae,Je+=un>>>16,un&=65535,Je+=de*ae,Se+=Je>>>16,Je&=65535,Je+=be*xe,Se+=Je>>>16,Je&=65535,Se+=X*ae,Ye+=Se>>>16,Se&=65535,Se+=de*xe,Ye+=Se>>>16,Se&=65535,Se+=be*Qe,Ye+=Se>>>16,Se&=65535,Ye+=Z*ae+X*xe+de*Qe+be*ze,Ye&=65535,c(Je<<16|un,Ye<<16|Se,this.unsigned)},h.mul=h.multiply,h.divide=function(f){if(r(f)||(f=g(f)),f.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&f.low===-1&&f.high===-1)return this;var k=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,f.low,f.high);return c(k,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?C:F;var Z,X,de;if(this.unsigned){if(f.unsigned||(f=f.toUnsigned()),f.gt(this))return C;if(f.gt(this.shru(1)))return G;de=C}else{if(this.eq(v)){if(f.eq(K)||f.eq(S))return v;if(f.eq(v))return K;var be=this.shr(1);return Z=be.div(f).shl(1),Z.eq(F)?f.isNegative()?K:S:(X=this.sub(f.mul(Z)),de=Z.add(X.div(f)),de)}else if(f.eq(v))return this.unsigned?C:F;if(this.isNegative())return f.isNegative()?this.neg().div(f.neg()):this.neg().div(f).neg();if(f.isNegative())return this.div(f.neg()).neg();de=F}for(X=this;X.gte(f);){Z=Math.max(1,Math.floor(X.toNumber()/f.toNumber()));for(var ze=Math.ceil(Math.log(Z)/Math.LN2),Qe=ze<=48?1:u(2,ze-48),xe=l(Z),ae=xe.mul(f);ae.isNegative()||ae.gt(X);)Z-=Qe,xe=l(Z,this.unsigned),ae=xe.mul(f);xe.isZero()&&(xe=K),de=de.add(xe),X=X.sub(ae)}return de},h.div=h.divide,h.modulo=function(f){if(r(f)||(f=g(f)),e){var k=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,f.low,f.high);return c(k,e.get_high(),this.unsigned)}return this.sub(this.div(f).mul(f))},h.mod=h.modulo,h.rem=h.modulo,h.not=function(){return c(~this.low,~this.high,this.unsigned)},h.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},h.clz=h.countLeadingZeros,h.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},h.ctz=h.countTrailingZeros,h.and=function(f){return r(f)||(f=g(f)),c(this.low&f.low,this.high&f.high,this.unsigned)},h.or=function(f){return r(f)||(f=g(f)),c(this.low|f.low,this.high|f.high,this.unsigned)},h.xor=function(f){return r(f)||(f=g(f)),c(this.low^f.low,this.high^f.high,this.unsigned)},h.shiftLeft=function(f){return r(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low<<f,this.high<<f|this.low>>>32-f,this.unsigned):c(0,this.low<<f-32,this.unsigned)},h.shl=h.shiftLeft,h.shiftRight=function(f){return r(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low>>>f|this.high<<32-f,this.high>>f,this.unsigned):c(this.high>>f-32,this.high>=0?0:-1,this.unsigned)},h.shr=h.shiftRight,h.shiftRightUnsigned=function(f){return r(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low>>>f|this.high<<32-f,this.high>>>f,this.unsigned):f===32?c(this.high,0,this.unsigned):c(this.high>>>f-32,0,this.unsigned)},h.shru=h.shiftRightUnsigned,h.shr_u=h.shiftRightUnsigned,h.rotateLeft=function(f){var k;return r(f)&&(f=f.toInt()),(f&=63)===0?this:f===32?c(this.high,this.low,this.unsigned):f<32?(k=32-f,c(this.low<<f|this.high>>>k,this.high<<f|this.low>>>k,this.unsigned)):(f-=32,k=32-f,c(this.high<<f|this.low>>>k,this.low<<f|this.high>>>k,this.unsigned))},h.rotl=h.rotateLeft,h.rotateRight=function(f){var k;return r(f)&&(f=f.toInt()),(f&=63)===0?this:f===32?c(this.high,this.low,this.unsigned):f<32?(k=32-f,c(this.high<<k|this.low>>>f,this.low<<k|this.high>>>f,this.unsigned)):(f-=32,k=32-f,c(this.low<<k|this.high>>>f,this.high<<k|this.low>>>f,this.unsigned))},h.rotr=h.rotateRight,h.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},h.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},h.toBytes=function(f){return f?this.toBytesLE():this.toBytesBE()},h.toBytesLE=function(){var f=this.high,k=this.low;return[k&255,k>>>8&255,k>>>16&255,k>>>24,f&255,f>>>8&255,f>>>16&255,f>>>24]},h.toBytesBE=function(){var f=this.high,k=this.low;return[f>>>24,f>>>16&255,f>>>8&255,f&255,k>>>24,k>>>16&255,k>>>8&255,k&255]},t.fromBytes=function(f,k,Z){return Z?t.fromBytesLE(f,k):t.fromBytesBE(f,k)},t.fromBytesLE=function(f,k){return new t(f[0]|f[1]<<8|f[2]<<16|f[3]<<24,f[4]|f[5]<<8|f[6]<<16|f[7]<<24,k)},t.fromBytesBE=function(f,k){return new t(f[4]<<24|f[5]<<16|f[6]<<8|f[7],f[0]<<24|f[1]<<16|f[2]<<8|f[3],k)},typeof BigInt=="function"&&(t.fromBigInt=function(f,k){var Z=Number(BigInt.asIntN(32,f)),X=Number(BigInt.asIntN(32,f>>BigInt(32)));return c(Z,X,k)},t.fromValue=function(f,k){return typeof f=="bigint"?t.fromBigInt(f,k):g(f,k)},h.toBigInt=function(){var f=BigInt(this.low>>>0),k=BigInt(this.unsigned?this.high>>>0:this.high);return k<<BigInt(32)|f});var E=n.default=t})});var td=A(Ne=>{"use strict";Object.defineProperty(Ne,"__esModule",{value:!0});Ne.loadFileDescriptorSetFromObject=Ne.loadFileDescriptorSetFromBuffer=Ne.fromJSON=Ne.loadSync=Ne.load=Ne.IdempotencyLevel=Ne.isAnyExtension=Ne.Long=void 0;var G0=cg(),nn=to(),Zu=cv(),ed=gv(),j0=yv();Ne.Long=j0;function K0(n){return"@type"in n&&typeof n["@type"]=="string"}Ne.isAnyExtension=K0;var Tv;(function(n){n.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",n.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",n.IDEMPOTENT="IDEMPOTENT"})(Tv=Ne.IdempotencyLevel||(Ne.IdempotencyLevel={}));var Ev={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function W0(n,e){return n===""?e:n+"."+e}function H0(n){return n instanceof nn.Service||n instanceof nn.Type||n instanceof nn.Enum}function $0(n){return n instanceof nn.Namespace||n instanceof nn.Root}function _v(n,e){let t=W0(e,n.name);return H0(n)?[[t,n]]:$0(n)&&typeof n.nested<"u"?Object.keys(n.nested).map(r=>_v(n.nested[r],t)).reduce((r,i)=>r.concat(i),[]):[]}function vv(n,e){return function(r){return n.toObject(n.decode(r),e)}}function Sv(n){return function(t){if(Array.isArray(t))throw new Error(`Failed to serialize message: expected object with ${n.name} structure, got array instead`);let r=n.fromObject(t);return n.encode(r).finish()}}function Q0(n){return(n||[]).reduce((e,t)=>{for(let[r,i]of Object.entries(t))switch(r){case"uninterpreted_option":e.uninterpreted_option.push(t.uninterpreted_option);break;default:e[r]=i}return e},{deprecated:!1,idempotency_level:Tv.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function Y0(n,e,t,r){let i=n.resolvedRequestType,s=n.resolvedResponseType;return{path:"/"+e+"/"+n.name,requestStream:!!n.requestStream,responseStream:!!n.responseStream,requestSerialize:Sv(i),requestDeserialize:vv(i,t),responseSerialize:Sv(s),responseDeserialize:vv(s,t),originalName:G0(n.name),requestType:Xu(i,r),responseType:Xu(s,r),options:Q0(n.parsedOptions)}}function J0(n,e,t,r){let i={};for(let s of n.methodsArray)i[s.name]=Y0(s,e,t,r);return i}function Xu(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:t.$type.toObject(t,Ev),fileDescriptorProtos:e}}function X0(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:t.$type.toObject(t,Ev),fileDescriptorProtos:e}}function Z0(n,e,t,r){if(n instanceof nn.Service)return J0(n,e,t,r);if(n instanceof nn.Type)return Xu(n,r);if(n instanceof nn.Enum)return X0(n,r);throw new Error("Type mismatch in reflection object handling")}function io(n,e){let t={};n.resolveAll();let i=n.toDescriptor("proto3").file.map(s=>Buffer.from(Zu.FileDescriptorProto.encode(s).finish()));for(let[s,a]of _v(n,""))t[s]=Z0(a,s,e,i);return t}function bv(n,e){e=e||{};let t=nn.Root.fromDescriptor(n);return t.resolveAll(),io(t,e)}function eI(n,e){return(0,ed.loadProtosWithOptions)(n,e).then(t=>io(t,e))}Ne.load=eI;function tI(n,e){let t=(0,ed.loadProtosWithOptionsSync)(n,e);return io(t,e)}Ne.loadSync=tI;function nI(n,e){e=e||{};let t=nn.Root.fromJSON(n);return t.resolveAll(),io(t,e)}Ne.fromJSON=nI;function rI(n,e){let t=Zu.FileDescriptorSet.decode(n);return bv(t,e)}Ne.loadFileDescriptorSetFromBuffer=rI;function iI(n,e){let t=Zu.FileDescriptorSet.fromObject(n);return bv(t,e)}Ne.loadFileDescriptorSetFromObject=iI;(0,ed.addCommonProtos)()});var Er=A(ge=>{"use strict";Object.defineProperty(ge,"__esModule",{value:!0});ge.setup=ge.getChannelzServiceDefinition=ge.getChannelzHandlers=ge.unregisterChannelzRef=ge.registerChannelzSocket=ge.registerChannelzServer=ge.registerChannelzSubchannel=ge.registerChannelzChannel=ge.ChannelzCallTracker=ge.ChannelzChildrenTracker=ge.ChannelzTrace=void 0;var wv=ce("net"),Ss=yt(),Es=oe(),sI=Ht(),aI=Ca(),oI=Jc();function nd(n){return{channel_id:n.id,name:n.name}}function ad(n){return{subchannel_id:n.id,name:n.name}}function lI(n){return{server_id:n.id}}function ao(n){return{socket_id:n.id,name:n.name}}var Cv=32,rd=class{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let i=new Date;this.events.push({description:t,severity:e,timestamp:i,childChannel:r?.kind==="channel"?r:void 0,childSubchannel:r?.kind==="subchannel"?r:void 0}),this.events.length>=Cv*2&&(this.events=this.events.slice(Cv)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:Sn(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:Sn(e.timestamp),channel_ref:e.childChannel?nd(e.childChannel):null,subchannel_ref:e.childSubchannel?ad(e.childSubchannel):null}))}}};ge.ChannelzTrace=rd;var id=class{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,i;switch(e.kind){case"channel":{let s=(t=this.channelChildren.get(e.id))!==null&&t!==void 0?t:{ref:e,count:0};s.count+=1,this.channelChildren.set(e.id,s);break}case"subchannel":{let s=(r=this.subchannelChildren.get(e.id))!==null&&r!==void 0?r:{ref:e,count:0};s.count+=1,this.subchannelChildren.set(e.id,s);break}case"socket":{let s=(i=this.socketChildren.get(e.id))!==null&&i!==void 0?i:{ref:e,count:0};s.count+=1,this.socketChildren.set(e.id,s);break}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t));break}}}getChildLists(){let e=[];for(let{ref:i}of this.channelChildren.values())e.push(i);let t=[];for(let{ref:i}of this.subchannelChildren.values())t.push(i);let r=[];for(let{ref:i}of this.socketChildren.values())r.push(i);return{channels:e,subchannels:t,sockets:r}}};ge.ChannelzChildrenTracker=id;var sd=class{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}};ge.ChannelzCallTracker=sd;var cI=1;function oo(){return cI++}var Ts=[],od=[],Kn=[],ld=[];function uI(n,e,t){let r=oo(),i={id:r,name:n,kind:"channel"};return t&&(Ts[r]={ref:i,getInfo:e}),i}ge.registerChannelzChannel=uI;function dI(n,e,t){let r=oo(),i={id:r,name:n,kind:"subchannel"};return t&&(od[r]={ref:i,getInfo:e}),i}ge.registerChannelzSubchannel=dI;function hI(n,e){let t=oo(),r={id:t,kind:"server"};return e&&(Kn[t]={ref:r,getInfo:n}),r}ge.registerChannelzServer=hI;function fI(n,e,t){let r=oo(),i={id:r,name:n,kind:"socket"};return t&&(ld[r]={ref:i,getInfo:e}),i}ge.registerChannelzSocket=fI;function pI(n){switch(n.kind){case"channel":delete Ts[n.id];return;case"subchannel":delete od[n.id];return;case"server":delete Kn[n.id];return;case"socket":delete ld[n.id];return}}ge.unregisterChannelzRef=pI;function mI(n){let e=Number.parseInt(n,16);return[e/256|0,e%256]}function Iv(n){if(n==="")return[];let e=n.split(":").map(r=>mI(r));return[].concat(...e)}function gI(n){if((0,wv.isIPv4)(n))return Buffer.from(Uint8Array.from(n.split(".").map(e=>Number.parseInt(e))));if((0,wv.isIPv6)(n)){let e,t,r=n.indexOf("::");r===-1?(e=n,t=""):(e=n.substring(0,r),t=n.substring(r+2));let i=Buffer.from(Iv(e)),s=Buffer.from(Iv(t)),a=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,a,s])}else return null}function Rv(n){switch(n){case Ss.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case Ss.ConnectivityState.IDLE:return{state:"IDLE"};case Ss.ConnectivityState.READY:return{state:"READY"};case Ss.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case Ss.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function Sn(n){if(!n)return null;let e=n.getTime();return{seconds:e/1e3|0,nanos:e%1e3*1e6}}function Dv(n){let e=n.getInfo();return{ref:nd(n.ref),data:{target:e.target,state:Rv(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:Sn(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},channel_ref:e.children.channels.map(t=>nd(t)),subchannel_ref:e.children.subchannels.map(t=>ad(t))}}function yI(n,e){let t=Number.parseInt(n.request.channel_id),r=Ts[t];if(r===void 0){e({code:Es.Status.NOT_FOUND,details:"No channel data found for id "+t});return}e(null,{channel:Dv(r)})}function vI(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_channel_id);for(;i<Ts.length;i++){let s=Ts[i];if(s!==void 0&&(r.push(Dv(s)),r.length>=t))break}e(null,{channel:r,end:i>=Kn.length})}function Nv(n){let e=n.getInfo();return{ref:lI(n.ref),data:{calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:Sn(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},listen_socket:e.listenerChildren.sockets.map(t=>ao(t))}}function SI(n,e){let t=Number.parseInt(n.request.server_id),r=Kn[t];if(r===void 0){e({code:Es.Status.NOT_FOUND,details:"No server data found for id "+t});return}e(null,{server:Nv(r)})}function TI(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_server_id);for(;i<Kn.length;i++){let s=Kn[i];if(s!==void 0&&(r.push(Nv(s)),r.length>=t))break}e(null,{server:r,end:i>=Kn.length})}function EI(n,e){let t=Number.parseInt(n.request.subchannel_id),r=od[t];if(r===void 0){e({code:Es.Status.NOT_FOUND,details:"No subchannel data found for id "+t});return}let i=r.getInfo(),s={ref:ad(r.ref),data:{target:i.target,state:Rv(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:Sn(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(a=>ao(a))};e(null,{subchannel:s})}function Av(n){var e;return(0,sI.isTcpSubchannelAddress)(n)?{address:"tcpip_address",tcpip_address:{ip_address:(e=gI(n.host))!==null&&e!==void 0?e:void 0,port:n.port}}:{address:"uds_address",uds_address:{filename:n.path}}}function _I(n,e){var t,r,i,s,a;let o=Number.parseInt(n.request.socket_id),l=ld[o];if(l===void 0){e({code:Es.Status.NOT_FOUND,details:"No socket data found for id "+o});return}let c=l.getInfo(),u=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:(t=c.security.cipherSuiteStandardName)!==null&&t!==void 0?t:void 0,other_name:(r=c.security.cipherSuiteOtherName)!==null&&r!==void 0?r:void 0,local_certificate:(i=c.security.localCertificate)!==null&&i!==void 0?i:void 0,remote_certificate:(s=c.security.remoteCertificate)!==null&&s!==void 0?s:void 0}}:null,p={ref:ao(l.ref),local:c.localAddress?Av(c.localAddress):null,remote:c.remoteAddress?Av(c.remoteAddress):null,remote_name:(a=c.remoteName)!==null&&a!==void 0?a:void 0,security:u,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:Sn(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:Sn(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:Sn(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:Sn(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}};e(null,{socket:p})}function bI(n,e){let t=Number.parseInt(n.request.server_id),r=Kn[t];if(r===void 0){e({code:Es.Status.NOT_FOUND,details:"No server data found for id "+t});return}let i=Number.parseInt(n.request.start_socket_id),s=Number.parseInt(n.request.max_results),o=r.getInfo().sessionChildren.sockets.sort((u,p)=>u.id-p.id),l=[],c=0;for(;c<o.length&&!(o[c].id>=i&&(l.push(ao(o[c])),l.length>=s));c++);e(null,{socket_ref:l,end:c>=o.length})}function Ov(){return{GetChannel:yI,GetTopChannels:vI,GetServer:SI,GetServers:TI,GetSubchannel:EI,GetSocket:_I,GetServerSockets:bI}}ge.getChannelzHandlers=Ov;var so=null;function xv(){if(so)return so;let n=td().loadSync,e=n("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return so=(0,oI.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service,so}ge.getChannelzServiceDefinition=xv;function wI(){(0,aI.registerAdminService)(xv,Ov)}ge.setup=wI});var kv=A(co=>{"use strict";Object.defineProperty(co,"__esModule",{value:!0});co.Subchannel=void 0;var fe=yt(),CI=Ji(),cd=Te(),lo=oe(),II=lt(),AI=Ht(),di=Er(),RI="subchannel",DI=~(1<<31),ud=class{constructor(e,t,r,i,s){var a;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=i,this.connector=s,this.connectivityState=fe.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new di.ChannelzCallTracker,this.childrenTracker=new di.ChannelzChildrenTracker,this.streamTracker=new di.ChannelzCallTracker;let o={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new CI.BackoffTimeout(()=>{this.handleBackoffTimer()},o),this.backoffTimeout.unref(),this.subchannelAddressString=(0,AI.subchannelAddressToString)(t),this.keepaliveTime=(a=r["grpc.keepalive_time_ms"])!==null&&a!==void 0?a:-1,r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new di.ChannelzTrace,this.channelzRef=(0,di.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){cd.trace(lo.LogVerbosity.DEBUG,RI,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){cd.trace(lo.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([fe.ConnectivityState.TRANSIENT_FAILURE],fe.ConnectivityState.CONNECTING):this.transitionToState([fe.ConnectivityState.TRANSIENT_FAILURE],fe.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,DI);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(t=>{this.transitionToState([fe.ConnectivityState.CONNECTING],fe.ConnectivityState.READY)?(this.transport=t,this.channelzEnabled&&this.childrenTracker.refChild(t.getChannelzRef()),t.addDisconnectListener(r=>{this.transitionToState([fe.ConnectivityState.READY],fe.ConnectivityState.IDLE),r&&this.keepaliveTime>0&&(this.keepaliveTime*=2,cd.log(lo.LogVerbosity.ERROR,`Connection to ${(0,II.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):t.shutdown()},t=>{this.transitionToState([fe.ConnectivityState.CONNECTING],fe.ConnectivityState.TRANSIENT_FAILURE,`${t}`)})}transitionToState(e,t,r){var i,s;if(e.indexOf(this.connectivityState)===-1)return!1;this.trace(fe.ConnectivityState[this.connectivityState]+" -> "+fe.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+fe.ConnectivityState[t]);let a=this.connectivityState;switch(this.connectivityState=t,t){case fe.ConnectivityState.READY:this.stopBackoff();break;case fe.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case fe.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(i=this.transport)===null||i===void 0||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case fe.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(s=this.transport)===null||s===void 0||s.shutdown(),this.transport=null;break;default:throw new Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let o of this.stateListeners)o(this,a,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,this.refcount===0&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,di.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([fe.ConnectivityState.CONNECTING,fe.ConnectivityState.READY],fe.ConnectivityState.IDLE)}))}unrefIfOneRef(){return this.refcount===1?(this.unref(),!0):!1}createCall(e,t,r,i){if(!this.transport)throw new Error("Cannot create call, subchannel not READY");let s;return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),s={onCallEnd:a=>{a.code===lo.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):s={},this.transport.createCall(e,t,r,i,s)}startConnecting(){process.nextTick(()=>{this.transitionToState([fe.ConnectivityState.IDLE],fe.ConnectivityState.CONNECTING)||this.connectivityState===fe.ConnectivityState.TRANSIENT_FAILURE&&(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([fe.ConnectivityState.TRANSIENT_FAILURE],fe.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}};co.Subchannel=ud});var pd=A($n=>{"use strict";Object.defineProperty($n,"__esModule",{value:!0});$n.setup=$n.DEFAULT_PORT=void 0;var Pv=Kt(),Lv=ce("dns"),Fv=ce("util"),NI=wc(),dd=oe(),hd=rt(),OI=Te(),xI=oe(),Wn=lt(),Mv=ce("net"),kI=Ji(),PI="dns_resolver";function Hn(n){OI.trace(xI.LogVerbosity.DEBUG,PI,n)}$n.DEFAULT_PORT=443;var MI=3e4,LI=Fv.promisify(Lv.resolveTxt),FI=Fv.promisify(Lv.lookup);function BI(...n){let e=[];for(let t=0;t<Math.max.apply(null,n.map(r=>r.length));t++)for(let r of n)t<r.length&&e.push(r[t]);return e}var fd=class{constructor(e,t,r){var i,s,a;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,Hn("Resolver constructed for target "+(0,Wn.uriToString)(e));let o=(0,Wn.splitHostPort)(e.path);o===null?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,Mv.isIPv4)(o.host)||(0,Mv.isIPv6)(o.host)?(this.ipResult=[{host:o.host,port:(i=o.port)!==null&&i!==void 0?i:$n.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=o.host,this.port=(s=o.port)!==null&&s!==void 0?s:$n.DEFAULT_PORT),this.percentage=Math.random()*100,r["grpc.service_config_disable_resolution"]===1&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:dd.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,Wn.uriToString)(this.target)}`,metadata:new hd.Metadata};let l={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoff=new kI.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},l),this.backoff.unref(),this.minTimeBetweenResolutionsMs=(a=r["grpc.dns_min_time_between_resolutions_ms"])!==null&&a!==void 0?a:MI,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(this.ipResult!==null){this.returnedIpResult||(Hn("Returning IP address for target "+(0,Wn.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(this.dnsHostname===null)Hn("Failed to parse DNS address "+(0,Wn.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:dd.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,Wn.uriToString)(this.target)}`,metadata:new hd.Metadata})}),this.stopNextResolutionTimer();else{if(this.pendingLookupPromise!==null)return;Hn("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=FI(e,{all:!0}),this.pendingLookupPromise.then(t=>{if(this.pendingLookupPromise===null)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let r=t.filter(a=>a.family===4),i=t.filter(a=>a.family===6);this.latestLookupResult=BI(i,r).map(a=>({host:a.address,port:+this.port}));let s="["+this.latestLookupResult.map(a=>a.host+":"+a.port).join(",")+"]";if(Hn("Resolved addresses for target "+(0,Wn.uriToString)(this.target)+": "+s),this.latestLookupResult.length===0){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},t=>{this.pendingLookupPromise!==null&&(Hn("Resolution error for target "+(0,Wn.uriToString)(this.target)+": "+t.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&this.pendingTxtPromise===null&&(this.pendingTxtPromise=LI(e),this.pendingTxtPromise.then(t=>{if(this.pendingTxtPromise!==null){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,NI.extractAndSelectServiceConfig)(t,this.percentage)}catch(r){this.latestServiceConfigError={code:dd.Status.UNAVAILABLE,details:`Parsing service config failed with error ${r.message}`,metadata:new hd.Metadata}}this.latestLookupResult!==null&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},t=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)===null||t===void 0?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){this.pendingLookupPromise===null&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){this.pendingLookupPromise===null&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?Hn('resolution update delayed by "min time between resolutions" rate limit'):Hn("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}};function UI(){(0,Pv.registerResolver)("dns",fd),(0,Pv.registerDefaultScheme)("dns")}$n.setup=UI});var md=A(pi=>{"use strict";Object.defineProperty(pi,"__esModule",{value:!0});pi.getProxiedConnection=pi.mapProxyName=void 0;var _s=Te(),hi=oe(),qI=Kt(),VI=ce("http"),zI=ce("tls"),GI=Te(),Bv=Ht(),fi=lt(),jI=ce("url"),KI=pd(),WI="proxy";function Qn(n){GI.trace(hi.LogVerbosity.DEBUG,WI,n)}function HI(){let n="",e="";if(process.env.grpc_proxy)e="grpc_proxy",n=process.env.grpc_proxy;else if(process.env.https_proxy)e="https_proxy",n=process.env.https_proxy;else if(process.env.http_proxy)e="http_proxy",n=process.env.http_proxy;else return{};let t;try{t=new jI.URL(n)}catch{return(0,_s.log)(hi.LogVerbosity.ERROR,`cannot parse value of "${e}" env var`),{}}if(t.protocol!=="http:")return(0,_s.log)(hi.LogVerbosity.ERROR,`"${t.protocol}" scheme not supported in proxy URI`),{};let r=null;t.username&&(t.password?((0,_s.log)(hi.LogVerbosity.INFO,"userinfo found in proxy URI"),r=`${t.username}:${t.password}`):r=t.username);let i=t.hostname,s=t.port;s===""&&(s="80");let a={address:`${i}:${s}`};return r&&(a.creds=r),Qn("Proxy server "+a.address+" set by environment variable "+e),a}function $I(){let n=process.env.no_grpc_proxy,e="no_grpc_proxy";return n||(n=process.env.no_proxy,e="no_proxy"),n?(Qn("No proxy server list set by environment variable "+e),n.split(",")):[]}function QI(n,e){var t;let r={target:n,extraOptions:{}};if(((t=e["grpc.enable_http_proxy"])!==null&&t!==void 0?t:1)===0||n.scheme==="unix")return r;let i=HI();if(!i.address)return r;let s=(0,fi.splitHostPort)(n.path);if(!s)return r;let a=s.host;for(let l of $I())if(l===a)return Qn("Not using proxy for target in no_proxy list: "+(0,fi.uriToString)(n)),r;let o={"grpc.http_connect_target":(0,fi.uriToString)(n)};return i.creds&&(o["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:o}}pi.mapProxyName=QI;function YI(n,e,t){var r;if(!("grpc.http_connect_target"in e))return Promise.resolve({});let i=e["grpc.http_connect_target"],s=(0,fi.parseUri)(i);if(s===null)return Promise.resolve({});let a=(0,fi.splitHostPort)(s.path);if(a===null)return Promise.resolve({});let o=`${a.host}:${(r=a.port)!==null&&r!==void 0?r:KI.DEFAULT_PORT}`,l={method:"CONNECT",path:o},c={Host:o};(0,Bv.isTcpSubchannelAddress)(n)?(l.host=n.host,l.port=n.port):l.socketPath=n.path,"grpc.http_connect_creds"in e&&(c["Proxy-Authorization"]="Basic "+Buffer.from(e["grpc.http_connect_creds"]).toString("base64")),l.headers=c;let u=(0,Bv.subchannelAddressToString)(n);return Qn("Using proxy "+u+" to connect to "+l.path),new Promise((p,g)=>{let T=VI.request(l);T.once("connect",(_,w,b)=>{var P;if(T.removeAllListeners(),w.removeAllListeners(),_.statusCode===200)if(Qn("Successfully connected to "+l.path+" through proxy "+u),"secureContext"in t){let L=(0,qI.getDefaultAuthority)(s),F=(0,fi.splitHostPort)(L),C=(P=F?.host)!==null&&P!==void 0?P:L,K=zI.connect(Object.assign({host:C,servername:C,socket:w},t),()=>{Qn("Successfully established a TLS connection to "+l.path+" through proxy "+u),p({socket:K,realTarget:s})});K.on("error",G=>{Qn("Failed to establish a TLS connection to "+l.path+" through proxy "+u+" with error "+G.message),g()})}else Qn("Successfully established a plaintext connection to "+l.path+" through proxy "+u),p({socket:w,realTarget:s});else(0,_s.log)(hi.LogVerbosity.ERROR,"Failed to connect to "+l.path+" through proxy "+u+" with status "+_.statusCode),g()}),T.once("error",_=>{T.removeAllListeners(),(0,_s.log)(hi.LogVerbosity.ERROR,"Failed to connect to proxy "+u+" with error "+_.message),g()}),T.end()})}pi.getProxiedConnection=YI});var yd=A(uo=>{"use strict";Object.defineProperty(uo,"__esModule",{value:!0});uo.StreamDecoder=void 0;var Tn=function(n){return n[n.NO_DATA=0]="NO_DATA",n[n.READING_SIZE=1]="READING_SIZE",n[n.READING_MESSAGE=2]="READING_MESSAGE",n}(Tn||{}),gd=class{constructor(e){this.maxReadMessageLength=e,this.readState=Tn.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t=0,r,i=[];for(;t<e.length;)switch(this.readState){case Tn.NO_DATA:this.readCompressFlag=e.slice(t,t+1),t+=1,this.readState=Tn.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case Tn.READING_SIZE:if(r=Math.min(e.length-t,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,t,t+r),this.readSizeRemaining-=r,t+=r,this.readSizeRemaining===0){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.maxReadMessageLength!==-1&&this.readMessageSize>this.maxReadMessageLength)throw new Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=Tn.READING_MESSAGE;else{let s=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=Tn.NO_DATA,i.push(s)}}break;case Tn.READING_MESSAGE:if(r=Math.min(e.length-t,this.readMessageRemaining),this.readPartialMessage.push(e.slice(t,t+r)),this.readMessageRemaining-=r,t+=r,this.readMessageRemaining===0){let s=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),a=Buffer.concat(s,this.readMessageSize+5);this.readState=Tn.NO_DATA,i.push(a)}break;default:throw new Error("Unexpected read state")}return i}};uo.StreamDecoder=gd});var Uv=A(ho=>{"use strict";Object.defineProperty(ho,"__esModule",{value:!0});ho.Http2SubchannelCall=void 0;var En=ce("http2"),JI=ce("os"),ue=oe(),Yn=rt(),XI=yd(),ZI=Te(),eA=oe(),tA="subchannel_call";function nA(n){for(let[e,t]of Object.entries(JI.constants.errno))if(t===n)return e;return"Unknown system error "+n}var vd=class{constructor(e,t,r,i,s){var a;this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=s,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=ue.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;let o=(a=i.getOptions()["grpc.max_receive_message_length"])!==null&&a!==void 0?a:ue.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new XI.StreamDecoder(o),e.on("response",(l,c)=>{let u="";for(let p of Object.keys(l))u+="		"+p+": "+l[p]+`
`;switch(this.trace(`Received server headers:
`+u),l[":status"]){case 400:this.mappedStatusCode=ue.Status.INTERNAL;break;case 401:this.mappedStatusCode=ue.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=ue.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=ue.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=ue.Status.UNAVAILABLE;break;default:this.mappedStatusCode=ue.Status.UNKNOWN}if(c&En.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(l);else{let p;try{p=Yn.Metadata.fromHttp2Headers(l)}catch(g){this.endCall({code:ue.Status.UNKNOWN,details:g.message,metadata:new Yn.Metadata});return}this.listener.onReceiveMetadata(p)}}),e.on("trailers",l=>{this.handleTrailers(l)}),e.on("data",l=>{if(this.statusOutput)return;this.trace("receive HTTP/2 data frame of length "+l.length);let c;try{c=this.decoder.write(l)}catch(u){this.cancelWithStatus(ue.Status.RESOURCE_EXHAUSTED,u.message);return}for(let u of c)this.trace("parsed message of length "+u.length),this.callEventTracker.addMessageReceived(),this.tryPush(u)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var l;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),((l=this.finalStatus)===null||l===void 0?void 0:l.code)===ue.Status.OK)return;let c,u="";switch(e.rstCode){case En.constants.NGHTTP2_NO_ERROR:if(this.finalStatus!==null)return;c=ue.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`;break;case En.constants.NGHTTP2_REFUSED_STREAM:c=ue.Status.UNAVAILABLE,u="Stream refused by server";break;case En.constants.NGHTTP2_CANCEL:c=ue.Status.CANCELLED,u="Call cancelled";break;case En.constants.NGHTTP2_ENHANCE_YOUR_CALM:c=ue.Status.RESOURCE_EXHAUSTED,u="Bandwidth exhausted or memory limit exceeded";break;case En.constants.NGHTTP2_INADEQUATE_SECURITY:c=ue.Status.PERMISSION_DENIED,u="Protocol not secure enough";break;case En.constants.NGHTTP2_INTERNAL_ERROR:c=ue.Status.INTERNAL,this.internalError===null?u=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:this.internalError.code==="ECONNRESET"||this.internalError.code==="ETIMEDOUT"?(c=ue.Status.UNAVAILABLE,u=this.internalError.message):u=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:c=ue.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:c,details:u,metadata:new Yn.Metadata,rstCode:e.rstCode})})}),e.on("error",l=>{l.code!=="ERR_HTTP2_STREAM_ERROR"&&(this.trace("Node error event: message="+l.message+" code="+l.code+" errno="+nA(l.errno)+" syscall="+l.syscall),this.internalError=l),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:ue.Status.UNAVAILABLE,details:"Connection dropped",metadata:new Yn.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){ZI.trace(eA.LogVerbosity.DEBUG,tA,"["+this.callId+"] "+e)}endCall(e){(this.finalStatus===null||this.finalStatus.code===ue.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){this.finalStatus!==null&&(this.finalStatus.code!==ue.Status.OK||this.readsClosed&&this.unpushedReadMessages.length===0&&!this.isReadFilterPending&&!this.isPushPending)&&this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,!this.statusOutput&&(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){this.callEventTracker.onStreamEnd(!0);let t="";for(let l of Object.keys(e))t+="		"+l+": "+e[l]+`
`;this.trace(`Received server trailers:
`+t);let r;try{r=Yn.Metadata.fromHttp2Headers(e)}catch{r=new Yn.Metadata}let i=r.getMap(),s=this.mappedStatusCode;if(s===ue.Status.UNKNOWN&&typeof i["grpc-status"]=="string"){let l=Number(i["grpc-status"]);l in ue.Status&&(s=l,this.trace("received status code "+l+" from server")),r.remove("grpc-status")}let a="";if(typeof i["grpc-message"]=="string"){try{a=decodeURI(i["grpc-message"])}catch{a=i["grpc-message"]}r.remove("grpc-message"),this.trace('received status details string "'+a+'" from server')}let o={code:s,details:a,metadata:r};this.endCall(o)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;((e=this.finalStatus)===null||e===void 0?void 0:e.code)===ue.Status.OK?t=En.constants.NGHTTP2_NO_ERROR:t=En.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new Yn.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(this.finalStatus!==null&&this.finalStatus.code!==ue.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=i=>{process.nextTick(()=>{var s;let a=ue.Status.UNAVAILABLE;i?.code==="ERR_STREAM_WRITE_AFTER_END"&&(a=ue.Status.INTERNAL),i&&this.cancelWithStatus(a,`Write error: ${i.message}`),(s=e.callback)===null||s===void 0||s.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(i){this.endCall({code:ue.Status.UNAVAILABLE,details:`Write failed with error ${i.message}`,metadata:new Yn.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}};ho.Http2SubchannelCall=vd});var Sd=A(fo=>{"use strict";Object.defineProperty(fo,"__esModule",{value:!0});fo.getNextCallNumber=void 0;var rA=0;function iA(){return rA++}fo.getNextCallNumber=iA});var zv=A(mo=>{"use strict";Object.defineProperty(mo,"__esModule",{value:!0});mo.Http2SubchannelConnector=void 0;var wd=ce("http2"),qv=ce("tls"),Td=Er(),bs=oe(),sA=md(),gi=Te(),Vv=Kt(),po=Ht(),mi=lt(),aA=ce("net"),oA=Uv(),lA=Sd(),Ed="transport",cA="transport_flowctrl",uA=ac().version,{HTTP2_HEADER_AUTHORITY:dA,HTTP2_HEADER_CONTENT_TYPE:hA,HTTP2_HEADER_METHOD:fA,HTTP2_HEADER_PATH:pA,HTTP2_HEADER_TE:mA,HTTP2_HEADER_USER_AGENT:gA}=wd.constants,yA=2e4,vA=Buffer.from("too_many_pings","ascii"),_d=class{constructor(e,t,r,i){this.session=e,this.options=r,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=yA,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new Td.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,po.subchannelAddressToString)(t),r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,Td.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${uA}`,r["grpc.secondary_user_agent"]].filter(s=>s).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=r["grpc.keepalive_permit_without_calls"]===1:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(s,a,o)=>{let l=!1;s===wd.constants.NGHTTP2_ENHANCE_YOUR_CALM&&o&&o.equals(vA)&&(l=!0),this.trace("connection closed by GOAWAY with code "+s+" and data "+o?.toString()),this.reportDisconnectToOwner(l)}),e.once("error",s=>{this.trace("connection closed with error "+s.message)}),gi.isTracerEnabled(Ed)&&(e.on("remoteSettings",s=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))}),e.on("localSettings",s=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let i=this.session.socket,s=i.remoteAddress?(0,po.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,a=i.localAddress?(0,po.stringToSubchannelAddress)(i.localAddress,i.localPort):null,o;if(this.session.encrypted){let c=i,u=c.getCipher(),p=c.getCertificate(),g=c.getPeerCertificate();o={cipherSuiteStandardName:(e=u.standardName)!==null&&e!==void 0?e:null,cipherSuiteOtherName:u.standardName?null:u.name,localCertificate:p&&"raw"in p?p.raw:null,remoteCertificate:g&&"raw"in g?g.raw:null}}else o=null;return{remoteAddress:s,localAddress:a,security:o,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:(t=this.session.state.localWindowSize)!==null&&t!==void 0?t:null,remoteFlowControlWindow:(r=this.session.state.remoteWindowSize)!==null&&r!==void 0?r:null}}trace(e){gi.trace(bs.LogVerbosity.DEBUG,Ed,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){gi.trace(bs.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){gi.trace(bs.LogVerbosity.DEBUG,cA,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){gi.trace(bs.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),(t=(e=this.keepaliveTimeoutId).unref)===null||t===void 0||t.call(e));try{this.session.ping((r,i,s)=>{r&&(this.keepaliveTrace("Ping failed with error "+r.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch{this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):!this.keepaliveTimerId&&!this.keepaliveTimeoutId&&(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)===null||t===void 0?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),this.activeCalls.size===0&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),this.activeCalls.size===1&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,i,s){let a=e.toHttp2Headers();a[dA]=t,a[gA]=this.userAgent,a[hA]="application/grpc",a[fA]="POST",a[pA]=r,a[mA]="trailers";let o;try{o=this.session.request(a)}catch(u){throw this.handleDisconnect(),u}this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed);let l,c;return this.channelzEnabled?(this.streamTracker.addCallStarted(),l={addMessageSent:()=>{var u;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var p;(p=s.onCallEnd)===null||p===void 0||p.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var p;u?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),(p=s.onStreamEnd)===null||p===void 0||p.call(s,u)}}):l={addMessageSent:()=>{var u;(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var p;(p=s.onCallEnd)===null||p===void 0||p.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var p;(p=s.onStreamEnd)===null||p===void 0||p.call(s,u)}},c=new oA.Http2SubchannelCall(o,l,i,this,(0,lA.getNextCallNumber)()),this.addActiveCall(c),c}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,Td.unregisterChannelzRef)(this.channelzRef)}},bd=class{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){gi.trace(bs.LogVerbosity.DEBUG,Ed,(0,mi.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,i){return this.isShutdown?Promise.reject():new Promise((s,a)=>{var o,l,c;let u;i.realTarget?(u=(0,mi.uriToString)(i.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,mi.uriToString)(i.realTarget))):(u=null,this.trace("creating HTTP/2 session to "+(0,po.subchannelAddressToString)(e)));let p=(0,Vv.getDefaultAuthority)((o=i.realTarget)!==null&&o!==void 0?o:this.channelTarget),g=t._getConnectionOptions()||{};g.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?g.maxSessionMemory=r["grpc-node.max_session_memory"]:g.maxSessionMemory=Number.MAX_SAFE_INTEGER;let T="http://";if("secureContext"in g){if(T="https://",r["grpc.ssl_target_name_override"]){let b=r["grpc.ssl_target_name_override"];g.checkServerIdentity=(P,L)=>(0,qv.checkServerIdentity)(b,L),g.servername=b}else{let b=(c=(l=(0,mi.splitHostPort)(p))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";g.servername=b}i.socket&&(g.createConnection=(b,P)=>i.socket)}else g.createConnection=(b,P)=>i.socket?i.socket:aA.connect(e);g=Object.assign(Object.assign(Object.assign({},g),e),{enableTrace:r["grpc-node.tls_enable_trace"]===1});let _=wd.connect(T+p,g);this.session=_;let w="Failed to connect";_.unref(),_.once("connect",()=>{_.removeAllListeners(),s(new _d(_,e,r,u)),this.session=null}),_.once("close",()=>{this.session=null,setImmediate(()=>{a(`${w} (${new Date().toISOString()})`)})}),_.once("error",b=>{w=b.message,this.trace("connection failed with error "+w)})})}connect(e,t,r){var i,s;if(this.isShutdown)return Promise.reject();let a=t._getConnectionOptions()||{};if("secureContext"in a){if(a.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let o=r["grpc.ssl_target_name_override"];a.checkServerIdentity=(l,c)=>(0,qv.checkServerIdentity)(o,c),a.servername=o}else if("grpc.http_connect_target"in r){let o=(0,Vv.getDefaultAuthority)((i=(0,mi.parseUri)(r["grpc.http_connect_target"]))!==null&&i!==void 0?i:{path:"localhost"}),l=(0,mi.splitHostPort)(o);a.servername=(s=l?.host)!==null&&s!==void 0?s:o}r["grpc-node.tls_enable_trace"]&&(a.enableTrace=!0)}return(0,sA.getProxiedConnection)(e,r,a).then(o=>this.createSession(e,t,r,o))}shutdown(){var e;this.isShutdown=!0,(e=this.session)===null||e===void 0||e.close(),this.session=null}};mo.Http2SubchannelConnector=bd});var Gv=A(yi=>{"use strict";Object.defineProperty(yi,"__esModule",{value:!0});yi.getSubchannelPool=yi.SubchannelPool=void 0;var SA=Om(),TA=kv(),EA=Ht(),_A=lt(),bA=zv(),wA=1e4,ws=class{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let i=this.pool[t].filter(s=>!s.subchannel.unrefIfOneRef());i.length>0&&(e=!1),this.pool[t]=i}e&&this.cleanupTimer!==null&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;this.cleanupTimer===null&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},wA),(t=(e=this.cleanupTimer).unref)===null||t===void 0||t.call(e))}getOrCreateSubchannel(e,t,r,i){this.ensureCleanupTask();let s=(0,_A.uriToString)(e);if(s in this.pool){let o=this.pool[s];for(let l of o)if((0,EA.subchannelAddressEqual)(t,l.subchannelAddress)&&(0,SA.channelOptionsEqual)(r,l.channelArguments)&&i._equals(l.channelCredentials))return l.subchannel}let a=new TA.Subchannel(e,t,r,i,new bA.Http2SubchannelConnector(e));return s in this.pool||(this.pool[s]=[]),this.pool[s].push({subchannelAddress:t,channelArguments:r,channelCredentials:i,subchannel:a}),a.ref(),a}};yi.SubchannelPool=ws;var CA=new ws;function IA(n){return n?CA:new ws}yi.getSubchannelPool=IA});var Id=A(vi=>{"use strict";Object.defineProperty(vi,"__esModule",{value:!0});vi.FilterStackFactory=vi.FilterStack=void 0;var go=class{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMessage(t);return t}receiveMessage(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}};vi.FilterStack=go;var Cd=class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new go(this.factories.map(e=>e.createFilter()))}};vi.FilterStackFactory=Cd});var Ad=A(yo=>{"use strict";Object.defineProperty(yo,"__esModule",{value:!0});yo.CompressionAlgorithms=void 0;var jv=function(n){return n[n.identity=0]="identity",n[n.deflate=1]="deflate",n[n.gzip=2]="gzip",n}(jv||(yo.CompressionAlgorithms=jv={}))});var Dd=A(vo=>{"use strict";Object.defineProperty(vo,"__esModule",{value:!0});vo.BaseFilter=void 0;var Rd=class{sendMetadata(e){return x(this,null,function*(){return e})}receiveMetadata(e){return e}sendMessage(e){return x(this,null,function*(){return e})}receiveMessage(e){return x(this,null,function*(){return e})}receiveTrailers(e){return e}};vo.BaseFilter=Rd});var Hv=A(Ti=>{"use strict";Object.defineProperty(Ti,"__esModule",{value:!0});Ti.CompressionFilterFactory=Ti.CompressionFilter=void 0;var So=ce("zlib"),Wv=Ad(),To=oe(),AA=Dd(),RA=Te(),DA=n=>typeof n=="number"&&typeof Wv.CompressionAlgorithms[n]=="string",Si=class{writeMessage(e,t){return x(this,null,function*(){let r=e;t&&(r=yield this.compressMessage(r));let i=Buffer.allocUnsafe(r.length+5);return i.writeUInt8(t?1:0,0),i.writeUInt32BE(r.length,1),r.copy(i,5),i})}readMessage(e){return x(this,null,function*(){let t=e.readUInt8(0)===1,r=e.slice(5);return t&&(r=yield this.decompressMessage(r)),r})}},_r=class extends Si{compressMessage(e){return x(this,null,function*(){return e})}writeMessage(e,t){return x(this,null,function*(){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r})}decompressMessage(e){return Promise.reject(new Error('Received compressed message but "grpc-encoding" header was identity'))}},Nd=class extends Si{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{So.deflate(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,s=[],a=So.createInflate();a.on("data",o=>{s.push(o),i+=o.byteLength,this.maxRecvMessageLength!==-1&&i>this.maxRecvMessageLength&&(a.destroy(),r({code:To.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),a.on("end",()=>{t(Buffer.concat(s))}),a.write(e),a.end()})}},Od=class extends Si{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{So.gzip(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,s=[],a=So.createGunzip();a.on("data",o=>{s.push(o),i+=o.byteLength,this.maxRecvMessageLength!==-1&&i>this.maxRecvMessageLength&&(a.destroy(),r({code:To.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),a.on("end",()=>{t(Buffer.concat(s))}),a.write(e),a.end()})}},xd=class extends Si{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(new Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(new Error(`Compression method not supported: ${this.compressionName}`))}};function Kv(n,e){switch(n){case"identity":return new _r;case"deflate":return new Nd(e);case"gzip":return new Od(e);default:return new xd(n)}}var Eo=class extends AA.BaseFilter{constructor(e,t){var r,i;super(),this.sharedFilterConfig=t,this.sendCompression=new _r,this.receiveCompression=new _r,this.currentCompressionAlgorithm="identity";let s=e["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=(r=e["grpc.max_receive_message_length"])!==null&&r!==void 0?r:To.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,s!==void 0)if(DA(s)){let a=Wv.CompressionAlgorithms[s],o=(i=t.serverSupportedEncodingHeader)===null||i===void 0?void 0:i.split(",");(!o||o.includes(a))&&(this.currentCompressionAlgorithm=a,this.sendCompression=Kv(this.currentCompressionAlgorithm,-1))}else RA.log(To.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${s}`)}sendMetadata(e){return x(this,null,function*(){let t=yield e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),this.currentCompressionAlgorithm==="identity"?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t})}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let i=t[0];typeof i=="string"&&(this.receiveCompression=Kv(i,this.maxReceiveMessageLength))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new _r,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}sendMessage(e){return x(this,null,function*(){var t;let r=yield e,i;return this.sendCompression instanceof _r?i=!1:i=(((t=r.flags)!==null&&t!==void 0?t:0)&2)===0,{message:yield this.sendCompression.writeMessage(r.message,i),flags:r.flags}})}receiveMessage(e){return x(this,null,function*(){return this.receiveCompression.readMessage(yield e)})}};Ti.CompressionFilter=Eo;var kd=class{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new Eo(this.options,this.sharedFilterConfig)}};Ti.CompressionFilterFactory=kd});var _o=A(rn=>{"use strict";Object.defineProperty(rn,"__esModule",{value:!0});rn.deadlineToString=rn.getRelativeTimeout=rn.getDeadlineTimeoutString=rn.minDeadline=void 0;function NA(...n){let e=1/0;for(let t of n){let r=t instanceof Date?t.getTime():t;r<e&&(e=r)}return e}rn.minDeadline=NA;var OA=[["m",1],["S",1e3],["M",60*1e3],["H",60*60*1e3]];function xA(n){let e=new Date().getTime();n instanceof Date&&(n=n.getTime());let t=Math.max(n-e,0);for(let[r,i]of OA){let s=t/i;if(s<1e8)return String(Math.ceil(s))+r}throw new Error("Deadline is too far in the future")}rn.getDeadlineTimeoutString=xA;var kA=2147483647;function PA(n){let e=n instanceof Date?n.getTime():n,t=new Date().getTime(),r=e-t;return r<0?0:r>kA?1/0:r}rn.getRelativeTimeout=PA;function MA(n){if(n instanceof Date)return n.toISOString();{let e=new Date(n);return Number.isNaN(e.getTime())?""+n:e.toISOString()}}rn.deadlineToString=MA});var wo=A(bo=>{"use strict";Object.defineProperty(bo,"__esModule",{value:!0});bo.restrictControlPlaneStatusCode=void 0;var sn=oe(),LA=[sn.Status.OK,sn.Status.INVALID_ARGUMENT,sn.Status.NOT_FOUND,sn.Status.ALREADY_EXISTS,sn.Status.FAILED_PRECONDITION,sn.Status.ABORTED,sn.Status.OUT_OF_RANGE,sn.Status.DATA_LOSS];function FA(n,e){return LA.includes(n)?{code:sn.Status.INTERNAL,details:`Invalid status from control plane: ${n} ${sn.Status[n]} ${e}`}:{code:n,details:e}}bo.restrictControlPlaneStatusCode=FA});var Qv=A(Ao=>{"use strict";Object.defineProperty(Ao,"__esModule",{value:!0});Ao.LoadBalancingCall=void 0;var $v=yt(),Co=oe(),BA=_o(),Io=rt(),Cs=Mn(),UA=lt(),qA=Te(),Pd=wo(),VA=ce("http2"),zA="load_balancing_call",Md=class{constructor(e,t,r,i,s,a,o){var l,c;this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=a,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let u=this.methodName.split("/"),p="";u.length>=2&&(p=u[1]);let g=(c=(l=(0,UA.splitHostPort)(this.host))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";this.serviceUrl=`https://${g}/${p}`}trace(e){qA.trace(Co.LogVerbosity.DEBUG,zA,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,i;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let s=Object.assign(Object.assign({},e),{progress:t});(r=this.listener)===null||r===void 0||r.onReceiveStatus(s),(i=this.onCallEnded)===null||i===void 0||i.call(this,s.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw new Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),i=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+Cs.PickResultType[r.pickResultType]+" subchannel: "+i+" status: "+((e=r.status)===null||e===void 0?void 0:e.code)+" "+((t=r.status)===null||t===void 0?void 0:t.details)),r.pickResultType){case Cs.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(o=>{var l,c,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let p=this.metadata.clone();if(p.merge(o),p.get("authorization").length>1&&this.outputStatus({code:Co.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new Io.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==$v.ConnectivityState.READY){this.trace("Picked subchannel "+i+" has state "+$v.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&p.set("grpc-timeout",(0,BA.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(p,this.host,this.methodName,{onReceiveMetadata:g=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(g)},onReceiveMessage:g=>{this.trace("Received message"),this.listener.onReceiveMessage(g)},onReceiveStatus:g=>{this.trace("Received status"),g.rstCode===VA.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(g,"REFUSED"):this.outputStatus(g,"PROCESSED")}})}catch(g){this.trace("Failed to start call on picked subchannel "+i+" with error "+g.message),this.outputStatus({code:Co.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+g.message,metadata:new Io.Metadata},"NOT_STARTED");return}(c=(l=this.callConfig).onCommitted)===null||c===void 0||c.call(l),(u=r.onCallStarted)===null||u===void 0||u.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},o=>{let{code:l,details:c}=(0,Pd.restrictControlPlaneStatusCode)(typeof o.code=="number"?o.code:Co.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${o.message}`);this.outputStatus({code:l,details:c,metadata:new Io.Metadata},"PROCESSED")});break;case Cs.PickResultType.DROP:let{code:s,details:a}=(0,Pd.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:s,details:a,metadata:r.status.metadata},"DROP")});break;case Cs.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:o,details:l}=(0,Pd.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:o,details:l,metadata:r.status.metadata},"PROCESSED")})}break;case Cs.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new Io.Metadata},"PROCESSED")}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw new Error("Method not implemented.")}getCallNumber(){return this.callNumber}};Ao.LoadBalancingCall=Md});var Jv=A(Do=>{"use strict";Object.defineProperty(Do,"__esModule",{value:!0});Do.ResolvingCall=void 0;var Ei=oe(),Ro=_o(),Yv=rt(),GA=Te(),jA=wo(),KA="resolving_call",Ld=class{constructor(e,t,r,i,s,a){this.channel=e,this.method=t,this.filterStackFactory=i,this.credentials=s,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&Ei.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(Ei.Status.CANCELLED,"Cancelled by parent call")}),r.flags&Ei.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,Ro.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){GA.trace(Ei.LogVerbosity.DEBUG,KA,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,Ro.deadlineToString)(this.deadline));let e=(0,Ro.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(Ei.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(r=>r(t)),process.nextTick(()=>{var r;(r=this.listener)===null||r===void 0||r.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw new Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(i=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,i.message),this.pendingHalfClose&&r.halfClose()},i=>{this.cancelWithStatus(i.code,i.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw new Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if(e.type==="NONE"){this.channel.queueCallForConfig(this);return}else if(e.type==="ERROR"){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==Ei.Status.OK){let{code:r,details:i}=(0,jA.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:r,details:i,metadata:new Yv.Metadata});return}if(t.methodConfig.timeout){let r=new Date;r.setSeconds(r.getSeconds()+t.methodConfig.timeout.seconds),r.setMilliseconds(r.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,Ro.minDeadline)(this.deadline,r),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(r=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(r,{onReceiveMetadata:i=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(i))},onReceiveMessage:i=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(i).then(s=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(s),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},s=>{this.cancelWithStatus(s.code,s.details)})},onReceiveStatus:i=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=i:this.outputStatus(i)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},r=>{this.outputStatus(r)})}reportResolverError(e){var t;!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new Yv.Metadata})}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}};Do.ResolvingCall=Ld});var Xv=A(Jn=>{"use strict";Object.defineProperty(Jn,"__esModule",{value:!0});Jn.RetryingCall=Jn.MessageBufferTracker=Jn.RetryThrottler=void 0;var No=oe(),WA=rt(),HA=Te(),$A="retrying_call",Bd=class{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}};Jn.RetryThrottler=Bd;var Ud=class{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;return this.limitPerCall-i<e||this.totalLimit-this.totalAllocated<e?!1:(this.allocatedPerCall.set(t,i+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;if(i<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${i}`);this.allocatedPerCall.set(t,i-e)}freeAll(e){var t;let r=(t=this.allocatedPerCall.get(e))!==null&&t!==void 0?t:0;if(this.totalAllocated<r)throw new Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}};Jn.MessageBufferTracker=Ud;var Fd="grpc-previous-rpc-attempts",qd=class{constructor(e,t,r,i,s,a,o,l,c){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=a,this.callNumber=o,this.bufferTracker=l,this.retryThrottler=c,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let u=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(u.initialBackoff.substring(0,u.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){HA.trace(No.LogVerbosity.DEBUG,$A,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;(t=this.listener)===null||t===void 0||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new WA.Metadata});for(let{call:r}of this.underlyingCalls)r.cancelWithStatus(e,t)}getPeer(){return this.committedCallIndex!==null?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return(t=this.writeBuffer[e-this.writeBufferOffset])!==null&&t!==void 0?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if(this.state!=="COMMITTED")return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let r=this.getBufferEntry(t);r.allocated&&this.bufferTracker.free(r.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if(this.state!=="COMMITTED"&&this.underlyingCalls[e].state!=="COMPLETED"){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&this.underlyingCalls[t].state!=="COMPLETED"&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(No.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if(this.state==="COMMITTED")return;let e=-1,t=-1;for(let[r,i]of this.underlyingCalls.entries())i.state==="ACTIVE"&&i.nextMessageToSend>e&&(e=i.nextMessageToSend,t=r);t===-1?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(r=>r===t||r.toString().toLowerCase()===No.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=(e=this.callConfig)===null||e===void 0?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,i=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,i),r}maybeRetryCall(e,t){if(this.state!=="RETRY"){t(!1);return}let r=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(r.maxAttempts,5)){t(!1);return}let i;if(e===null)i=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else i=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var s,a;if(this.state!=="RETRY"){t(!1);return}(!((a=(s=this.retryThrottler)===null||s===void 0?void 0:s.canRetryCall())!==null&&a!==void 0)||a)&&(t(!0),this.attempts+=1,this.startNewAttempt())},i)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var i,s,a;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList((i=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)!==null&&i!==void 0?i:[],e.code)){(s=this.retryThrottler)===null||s===void 0||s.addCallFailed();let o;if(r===null)o=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else o=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),this.countActiveCalls()===0&&(this.commitCall(t),this.reportStatus(e))},o)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?((a=this.retryThrottler)===null||a===void 0||a.addCallFailed(),this.maybeRetryCall(r,o=>{o||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e));break}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(t.length===0)return null;try{return parseInt(t[0])}catch{return-1}}handleChildStatus(e,t){var r;if(this.underlyingCalls[t].state==="COMPLETED")return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===No.Status.OK){(r=this.retryThrottler)===null||r===void 0||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if(this.state==="COMMITTED"){this.reportStatus(e);return}let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i);break}}maybeStartHedgingAttempt(){if(this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let i=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(i.maxAttempts,5))return;let s=(e=i.hedgingDelay)!==null&&e!==void 0?e:"0s",a=Number(s.substring(0,s.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},a*1e3),(r=(t=this.hedgingTimer).unref)===null||r===void 0||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,i=this.initialMetadata.clone();r>0&&i.set(Fd,`${r}`);let s=!1;e.start(i,{onReceiveMetadata:a=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),s=!0,r>0&&a.set(Fd,`${r}`),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMetadata(a)},onReceiveMessage:a=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMessage(a)},onReceiveStatus:a=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!s&&r>0&&a.metadata.set(Fd,`${r}`),this.handleChildStatus(a,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let i=this.underlyingCalls[e],s=i.nextMessageToSend;(r=(t=this.getBufferEntry(s)).callback)===null||r===void 0||r.call(t),this.clearSentMessages(),i.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if(t.state!=="COMPLETED"&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:i=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose();break;case"FREED":break}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let i={message:t,flags:e.flags},s=this.getNextBufferIndex(),a={entryType:"MESSAGE",message:i,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(a),a.allocated){(r=e.callback)===null||r===void 0||r.call(e);for(let[o,l]of this.underlyingCalls.entries())l.state==="ACTIVE"&&l.nextMessageToSend===s&&l.call.sendMessageWithContext({callback:c=>{this.handleChildWriteCompleted(o)}},t)}else{if(this.commitCallWithMostMessages(),this.committedCallIndex===null)return;let o=this.underlyingCalls[this.committedCallIndex];a.callback=e.callback,o.state==="ACTIVE"&&o.nextMessageToSend===s&&o.call.sendMessageWithContext({callback:l=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){this.trace("startRead called"),this.readStarted=!0;for(let e of this.underlyingCalls)e?.state==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1});for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw new Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}};Jn.RetryingCall=qd});var xo=A(Oo=>{"use strict";Object.defineProperty(Oo,"__esModule",{value:!0});Oo.BaseSubchannelWrapper=void 0;var Vd=class{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}};Oo.BaseSubchannelWrapper=Vd});var tS=A(Mo=>{"use strict";Object.defineProperty(Mo,"__esModule",{value:!0});Mo.InternalChannel=void 0;var QA=ga(),YA=Nm(),JA=Gv(),Zv=Mn(),Is=oe(),XA=Id(),ZA=Hv(),eS=Kt(),zd=Te(),eR=md(),ko=lt(),an=yt(),As=Er(),tR=Qv(),nR=_o(),rR=Jv(),Gd=Sd(),iR=wo(),jd=Xv(),sR=xo(),aR=2147483647,oR=1e3,lR=30*60*1e3,Po=new Map,cR=1<<24,uR=1<<20,Kd=class extends sR.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(r,i,s,a)=>{t.throttleKeepalive(a)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}},Wd=class{constructor(e,t,r){var i,s,a,o,l,c,u,p;if(this.credentials=t,this.options=r,this.connectivityState=an.ConnectivityState.IDLE,this.currentPicker=new Zv.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new As.ChannelzCallTracker,this.childrenTracker=new As.ChannelzChildrenTracker,typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof QA.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.originalTarget=e;let g=(0,ko.parseUri)(e);if(g===null)throw new Error(`Could not parse target name "${e}"`);let T=(0,eS.mapUriDefaultScheme)(g);if(T===null)throw new Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},aR),(s=(i=this.callRefTimer).unref)===null||s===void 0||s.call(i),this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new As.ChannelzTrace,this.channelzRef=(0,As.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,eS.getDefaultAuthority)(T);let _=(0,eR.mapProxyName)(T,r);this.target=_.target,this.options=Object.assign({},this.options,_.extraOptions),this.subchannelPool=(0,JA.getSubchannelPool)(((a=r["grpc.use_local_subchannel_pool"])!==null&&a!==void 0?a:0)===0),this.retryBufferTracker=new jd.MessageBufferTracker((o=r["grpc.retry_buffer_size"])!==null&&o!==void 0?o:cR,(l=r["grpc.per_rpc_retry_buffer_size"])!==null&&l!==void 0?l:uR),this.keepaliveTime=(c=r["grpc.keepalive_time_ms"])!==null&&c!==void 0?c:-1,this.idleTimeoutMs=Math.max((u=r["grpc.client_idle_timeout_ms"])!==null&&u!==void 0?u:lR,oR);let w={createSubchannel:(P,L)=>{let F=this.subchannelPool.getOrCreateSubchannel(this.target,P,Object.assign({},this.options,L),this.credentials);F.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",F.getChannelzRef());let C=new Kd(F,this);return this.wrappedSubchannels.add(C),C},updateState:(P,L)=>{this.currentPicker=L;let F=this.pickQueue.slice();this.pickQueue=[],F.length>0&&this.callRefTimerUnref();for(let C of F)C.doPick();this.updateState(P)},requestReresolution:()=>{throw new Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:P=>{this.channelzEnabled&&this.childrenTracker.refChild(P)},removeChannelzChild:P=>{this.channelzEnabled&&this.childrenTracker.unrefChild(P)}};this.resolvingLoadBalancer=new YA.ResolvingLoadBalancer(this.target,w,r,(P,L)=>{P.retryThrottling?Po.set(this.getTarget(),new jd.RetryThrottler(P.retryThrottling.maxTokens,P.retryThrottling.tokenRatio,Po.get(this.getTarget()))):Po.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=L,this.currentResolutionError=null,process.nextTick(()=>{let F=this.configSelectionQueue;this.configSelectionQueue=[],F.length>0&&this.callRefTimerUnref();for(let C of F)C.getConfig()})},P=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+P.code+' and details "'+P.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),this.configSelector===null&&(this.currentResolutionError=Object.assign(Object.assign({},(0,iR.restrictControlPlaneStatusCode)(P.code,P.details)),{metadata:P.metadata}));let L=this.configSelectionQueue;this.configSelectionQueue=[],L.length>0&&this.callRefTimerUnref();for(let F of L)F.reportResolverError(P)}),this.filterStackFactory=new XA.FilterStackFactory([new ZA.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));let b=new Error;(0,zd.trace)(Is.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+`) Channel constructed 
`+((p=b.stack)===null||p===void 0?void 0:p.substring(b.stack.indexOf(`
`)+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,zd.trace)(t??Is.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,ko.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,i;!((t=(e=this.callRefTimer).hasRef)===null||t===void 0)&&t.call(e)||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(i=(r=this.callRefTimer).ref)===null||i===void 0||i.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(t=(e=this.callRefTimer).unref)===null||t===void 0||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(r=>r===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){(0,zd.trace)(Is.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,ko.uriToString)(this.target)+" "+an.ConnectivityState[this.connectivityState]+" -> "+an.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+an.ConnectivityState[e]),this.connectivityState=e;let t=this.connectivityStateWatchers.slice();for(let r of t)e!==r.currentState&&(r.timer&&clearTimeout(r.timer),this.removeConnectivityStateWatcher(r),r.callback());e!==an.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime){this.keepaliveTime=e;for(let t of this.wrappedSubchannels)t.throttleKeepalive(e)}}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return this.resolvingLoadBalancer.exitIdle(),this.configSelector?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(an.ConnectivityState.IDLE),this.currentPicker=new Zv.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,r;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let s=new Date().valueOf()-this.lastActivityTimestamp.valueOf();s>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-s)},e),(r=(t=this.idleTimer).unref)===null||r===void 0||r.call(t)}maybeStartIdleTimer(){this.connectivityState!==an.ConnectivityState.SHUTDOWN&&!this.idleTimer&&this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===Is.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,i,s){let a=(0,Gd.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+a+'] method="'+t+'"'),new tR.LoadBalancingCall(this,e,t,r,i,s,a)}createRetryingCall(e,t,r,i,s){let a=(0,Gd.getNextCallNumber)();return this.trace("createRetryingCall ["+a+'] method="'+t+'"'),new jd.RetryingCall(this,e,t,r,i,s,a,this.retryBufferTracker,Po.get(this.getTarget()))}createInnerCall(e,t,r,i,s){return this.options["grpc.enable_retries"]===0?this.createLoadBalancingCall(e,t,r,i,s):this.createRetryingCall(e,t,r,i,s)}createResolvingCall(e,t,r,i,s){let a=(0,Gd.getNextCallNumber)();this.trace("createResolvingCall ["+a+'] method="'+e+'", deadline='+(0,nR.deadlineToString)(t));let o={deadline:t,flags:s??Is.Propagate.DEFAULTS,host:r??this.defaultAuthority,parentCall:i},l=new rR.ResolvingCall(this,e,o,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),a);return this.onCallStart(),l.addStatusWatcher(c=>{this.onCallEnd(c)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(an.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,As.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,ko.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===an.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");let i=null;if(t!==1/0){let a=t instanceof Date?t:new Date(t),o=new Date;if(t===-1/0||a<=o){process.nextTick(r,new Error("Deadline passed without connectivity state change"));return}i=setTimeout(()=>{this.removeConnectivityStateWatcher(s),r(new Error("Deadline passed without connectivity state change"))},a.getTime()-o.getTime())}let s={currentState:e,callback:r,timer:i};this.connectivityStateWatchers.push(s)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===an.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");return this.createResolvingCall(e,t,r,i,s)}};Mo.InternalChannel=Wd});var Qc=A(Lo=>{"use strict";Object.defineProperty(Lo,"__esModule",{value:!0});Lo.ChannelImplementation=void 0;var dR=ga(),hR=tS(),Hd=class{constructor(e,t,r){if(typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof dR.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.internalChannel=new hR.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,i,s)}};Lo.ChannelImplementation=Hd});var uS=A(wt=>{"use strict";Object.defineProperty(wt,"__esModule",{value:!0});wt.Http2ServerCallStream=wt.ServerDuplexStreamImpl=wt.ServerWritableStreamImpl=wt.ServerReadableStreamImpl=wt.ServerUnaryCallImpl=void 0;var oS=ce("events"),_i=ce("http2"),Yd=ce("stream"),nS=ce("zlib"),pe=oe(),Jd=rt(),fR=yd(),lS=Te(),Ds=ua(),cS="server_call";function Rs(n){lS.trace(pe.LogVerbosity.DEBUG,cS,n)}var pR="grpc-accept-encoding",mR="grpc-encoding",rS="grpc-message",iS="grpc-status",sS="grpc-timeout",gR=/(\d{1,8})\s*([HMSmun])/,yR={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},vR={[pR]:"identity,deflate,gzip",[mR]:"identity"},aS={[_i.constants.HTTP2_HEADER_STATUS]:_i.constants.HTTP_STATUS_OK,[_i.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},SR={waitForTrailers:!0},$d=class extends oS.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};wt.ServerUnaryCallImpl=$d;var Fo=class extends Yd.Readable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};wt.ServerReadableStreamImpl=Fo;var Ns=class extends Yd.Writable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=i,this.cancelled=!1,this.trailingMetadata=new Jd.Metadata,this.call.setupSurfaceCall(this),this.on("error",s=>{this.call.sendError(s),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let i=this.call.serializeMessage(e);if(!this.call.write(i)){this.call.once("drain",r);return}}catch(i){this.emit("error",{details:(0,Ds.getErrorMessage)(i),code:pe.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:pe.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}};wt.ServerWritableStreamImpl=Ns;var bi=class extends Yd.Duplex{constructor(e,t,r,i,s){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=i,this.cancelled=!1,this.trailingMetadata=new Jd.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,s),this.on("error",a=>{this.call.sendError(a),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}};wt.ServerDuplexStreamImpl=bi;bi.prototype._read=Fo.prototype._read;bi.prototype._write=Ns.prototype._write;bi.prototype._final=Ns.prototype._final;var Qd=class extends oS.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=pe.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=pe.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",i=>{}),this.stream.once("close",()=>{var i;Rs("Request to method "+((i=this.handler)===null||i===void 0?void 0:i.path)+" stream closed with rstCode "+this.stream.rstCode),this.statusSent||(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:pe.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){let r=e.subarray(5);if(t==="identity")return r;if(t==="deflate"||t==="gzip"){let i;return t==="deflate"?i=nS.createInflate():i=nS.createGunzip(),new Promise((s,a)=>{let o=0,l=[];i.on("data",c=>{l.push(c),o+=c.byteLength,this.maxReceiveMessageSize!==-1&&o>this.maxReceiveMessageSize&&(i.destroy(),a({code:pe.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),i.on("end",()=>{s(Buffer.concat(l))}),i.write(r),i.end()})}else return Promise.reject({code:pe.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},aS),vR),t);this.stream.respond(r,SR)}receiveMetadata(e){let t=Jd.Metadata.fromHttp2Headers(e);lS.isTracerEnabled(cS)&&Rs("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get(sS);if(r.length>0){let i=r[0].toString().match(gR);if(i===null){let o=new Error("Invalid deadline");return o.code=pe.Status.OUT_OF_RANGE,this.sendError(o),t}let s=+i[1]*yR[i[2]]|0,a=new Date;this.deadline=a.setMilliseconds(a.getMilliseconds()+s),this.deadlineTimer=setTimeout(TR,s,this),t.remove(sS)}return t.remove(_i.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(_i.constants.HTTP2_HEADER_TE),t.remove(_i.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:i}=this,s=0,a=this,o=[],l=this.maxReceiveMessageSize;this.stream.on("data",c),this.stream.on("end",u),this.stream.on("error",u);function c(p){if(s+=p.byteLength,l!==-1&&s>l){i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),r({code:pe.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${s} vs. ${l})`});return}o.push(p)}function u(p){if(i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),p!==void 0){r({code:pe.Status.INTERNAL,details:p.message});return}if(s===0){r({code:pe.Status.INTERNAL,details:"received empty unary message"});return}a.emit("receiveMessage");let g=Buffer.concat(o,s),_=g.readUInt8(0)===1?e:"identity",w=a.getDecompressedMessage(g,_);if(Buffer.isBuffer(w)){t(a.deserializeMessageWithInternalError(w));return}w.then(b=>t(a.deserializeMessageWithInternalError(b)),b=>r(b.code?b:{code:pe.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}})}deserializeMessageWithInternalError(e){return x(this,null,function*(){try{return this.deserializeMessage(e)}catch(t){throw{details:(0,Ds.getErrorMessage)(t),code:pe.Status.INTERNAL}}})}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,i=Buffer.allocUnsafe(r+5);return i.writeUInt8(0,0),i.writeUInt32BE(r,1),t.copy(i,5),i}deserializeMessage(e){return this.handler.deserialize(e)}sendUnaryMessage(e,t,r,i){return x(this,null,function*(){if(!this.checkCancelled()){if(r===void 0&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let s=this.serializeMessage(t);this.write(s),this.sendStatus({code:pe.Status.OK,details:"OK",metadata:r})}catch(s){this.sendError({details:(0,Ds.getErrorMessage)(s),code:pe.Status.INTERNAL})}}})}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===pe.Status.OK),!this.checkCancelled())if(Rs("Request to method "+((t=this.handler)===null||t===void 0?void 0:t.path)+" ended with status code: "+pe.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var i;let s=Object.assign({[iS]:e.code,[rS]:encodeURI(e.details)},(i=e.metadata)===null||i===void 0?void 0:i.toHttp2Headers());this.stream.sendTrailers(s),this.statusSent=!0}),this.stream.end());else{let i=Object.assign(Object.assign({[iS]:e.code,[rS]:encodeURI(e.details)},aS),(r=e.metadata)===null||r===void 0?void 0:r.toHttp2Headers());this.stream.respond(i,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:pe.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&e.metadata!==void 0?e.metadata:null};"code"in e&&typeof e.code=="number"&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&typeof e.details=="string"&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(this.maxSendMessageSize!==-1&&e.length>this.maxSendMessageSize){this.sendError({code:pe.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new fR.StreamDecoder(this.maxReceiveMessageSize),i=!1,s=!1,a=!1,o=()=>x(this,null,function*(){!a&&i&&!s&&(a=!0,yield this.pushOrBufferMessage(e,null))});this.stream.on("data",l=>x(this,null,function*(){let c;try{c=r.write(l)}catch(u){this.sendError({code:pe.Status.RESOURCE_EXHAUSTED,details:u.message});return}s=!0,this.stream.pause();for(let u of c){this.emit("receiveMessage");let g=u.readUInt8(0)===1?t:"identity",T;try{T=yield this.getDecompressedMessage(u,g)}catch(_){this.sendError(_);return}if(!T)return;yield this.pushOrBufferMessage(e,T)}s=!1,this.stream.resume(),yield o()})),this.stream.once("end",()=>x(this,null,function*(){i=!0,yield o()}))}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(t===null||r===!1){this.canPush=!1;break}}return this.canPush}pushOrBufferMessage(e,t){return x(this,null,function*(){this.isPushPending?this.bufferedMessages.push(t):yield this.pushMessage(e,t)})}pushMessage(e,t){return x(this,null,function*(){if(t===null){Rs("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}Rs("Received message of length "+t.length),this.isPushPending=!0;try{let r=yield this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let i=(0,Ds.getErrorCode)(r);(i===null||i<pe.Status.OK||i>pe.Status.UNAUTHENTICATED)&&(i=pe.Status.INTERNAL),e.emit("error",{details:(0,Ds.getErrorMessage)(r),code:i})}this.isPushPending=!1,this.bufferedMessages.length>0&&(yield this.pushMessage(e,this.bufferedMessages.shift()))})}getPeer(){var e;let t=(e=this.stream.session)===null||e===void 0?void 0:e.socket;return t?.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}};wt.Http2ServerCallStream=Qd;function TR(n){let e=new Error("Deadline exceeded");e.code=pe.Status.DEADLINE_EXCEEDED,n.sendError(e),n.cancelled=!0,n.emit("cancelled","deadline")}});var eh=A(Bo=>{"use strict";Object.defineProperty(Bo,"__esModule",{value:!0});Bo.ServerCredentials=void 0;var dS=Sc(),Os=class{static createInsecure(){return new Xd}static createSsl(e,t,r=!1){if(e!==null&&!Buffer.isBuffer(e))throw new TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw new TypeError("keyCertPairs must be an array");if(typeof r!="boolean")throw new TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let a=0;a<t.length;a++){let o=t[a];if(o===null||typeof o!="object")throw new TypeError(`keyCertPair[${a}] must be an object`);if(!Buffer.isBuffer(o.private_key))throw new TypeError(`keyCertPair[${a}].private_key must be a Buffer`);if(!Buffer.isBuffer(o.cert_chain))throw new TypeError(`keyCertPair[${a}].cert_chain must be a Buffer`);i.push(o.cert_chain),s.push(o.private_key)}return new Zd({ca:e||(0,dS.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:dS.CIPHER_SUITES})}};Bo.ServerCredentials=Os;var Xd=class extends Os{_isSecure(){return!1}_getSettings(){return null}},Zd=class extends Os{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}});var pS=A(Vo=>{"use strict";Object.defineProperty(Vo,"__esModule",{value:!0});Vo.Server=void 0;var Xn=ce("http2"),_n=oe(),br=uS(),ER=eh(),hS=Kt(),Uo=Te(),Lt=Ht(),_R=lt(),at=Er(),qo=~(1<<31),bR=~(1<<31),wR=2e4,{HTTP2_HEADER_PATH:fS}=Xn.constants,CR="server";function IR(){}function th(n){return{code:_n.Status.UNIMPLEMENTED,details:`The server does not implement the method ${n}`}}function AR(n,e){let t=th(e);switch(n){case"unary":return(r,i)=>{i(t,null)};case"clientStream":return(r,i)=>{i(t,null)};case"serverStream":return r=>{r.emit("error",t)};case"bidi":return r=>{r.emit("error",t)};default:throw new Error(`Invalid handlerType ${n}`)}}var nh=class{constructor(e){var t,r,i,s;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new at.ChannelzTrace,this.callTracker=new at.ChannelzCallTracker,this.listenerChildrenTracker=new at.ChannelzChildrenTracker,this.sessionChildrenTracker=new at.ChannelzChildrenTracker,this.options=e??{},this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,at.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=(t=this.options["grpc.max_connection_age_ms"])!==null&&t!==void 0?t:qo,this.maxConnectionAgeGraceMs=(r=this.options["grpc.max_connection_age_grace_ms"])!==null&&r!==void 0?r:qo,this.keepaliveTimeMs=(i=this.options["grpc.keepalive_time_ms"])!==null&&i!==void 0?i:bR,this.keepaliveTimeoutMs=(s=this.options["grpc.keepalive_timeout_ms"])!==null&&s!==void 0?s:wR,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,i;let s=this.sessions.get(e),a=e.socket,o=a.remoteAddress?(0,Lt.stringToSubchannelAddress)(a.remoteAddress,a.remotePort):null,l=a.localAddress?(0,Lt.stringToSubchannelAddress)(a.localAddress,a.localPort):null,c;if(e.encrypted){let p=a,g=p.getCipher(),T=p.getCertificate(),_=p.getPeerCertificate();c={cipherSuiteStandardName:(t=g.standardName)!==null&&t!==void 0?t:null,cipherSuiteOtherName:g.standardName?null:g.name,localCertificate:T&&"raw"in T?T.raw:null,remoteCertificate:_&&"raw"in _?_.raw:null}}else c=null;return{remoteAddress:o,localAddress:l,security:c,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:(r=e.state.localWindowSize)!==null&&r!==void 0?r:null,remoteFlowControlWindow:(i=e.state.remoteWindowSize)!==null&&i!==void 0?i:null}}}trace(e){Uo.trace(_n.LogVerbosity.DEBUG,CR,"("+this.channelzRef.id+") "+e)}addProtoService(){throw new Error("Not implemented. Use addService() instead")}addService(e,t){if(e===null||typeof e!="object"||t===null||typeof t!="object")throw new Error("addService() requires two objects as arguments");let r=Object.keys(e);if(r.length===0)throw new Error("Cannot add an empty service to a server");r.forEach(i=>{let s=e[i],a;s.requestStream?s.responseStream?a="bidi":a="clientStream":s.responseStream?a="serverStream":a="unary";let o=t[i],l;if(o===void 0&&typeof s.originalName=="string"&&(o=t[s.originalName]),o!==void 0?l=o.bind(t):l=AR(a,i),this.register(s.path,l,s.responseSerialize,s.requestDeserialize,a)===!1)throw new Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(e===null||typeof e!="object")throw new Error("removeService() requires object as argument");Object.keys(e).forEach(r=>{let i=e[r];this.unregister(i.path)})}bind(e,t){throw new Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(this.started===!0)throw new Error("server is already started");if(this.shutdown)throw new Error("bindAsync called after shutdown");if(typeof e!="string")throw new TypeError("port must be a string");if(t===null||!(t instanceof ER.ServerCredentials))throw new TypeError("creds must be a ServerCredentials object");if(typeof r!="function")throw new TypeError("callback must be a function");let i=(0,_R.parseUri)(e);if(i===null)throw new Error(`Could not parse port "${e}"`);let s=(0,hS.mapUriDefaultScheme)(i);if(s===null)throw new Error(`Could not get a default scheme for port "${e}"`);let a={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?a.maxSessionMemory=this.options["grpc-node.max_session_memory"]:a.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(a.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let o=(T,_)=>{process.nextTick(()=>r(T,_))},l=()=>{let T;if(t._isSecure()){let _=Object.assign(a,t._getSettings());_.enableTrace=this.options["grpc-node.tls_enable_trace"]===1,T=Xn.createSecureServer(_),T.on("secureConnection",w=>{w.on("error",b=>{this.trace("An incoming TLS connection closed with error: "+b.message)})})}else T=Xn.createServer(a);return T.setTimeout(0,IR),this._setupHandlers(T),T},c=(T,_,w)=>T.length===0?Promise.resolve({port:_,count:w}):Promise.all(T.map(b=>{this.trace("Attempting to bind "+(0,Lt.subchannelAddressToString)(b));let P;(0,Lt.isTcpSubchannelAddress)(b)?P={host:b.host,port:_}:P=b;let L=l();return new Promise((F,C)=>{let K=G=>{this.trace("Failed to bind "+(0,Lt.subchannelAddressToString)(b)+" with error "+G.message),F(G)};L.once("error",K),L.listen(P,()=>{if(this.shutdown){L.close(),F(new Error("bindAsync failed because server is shutdown"));return}let G=L.address(),S;typeof G=="string"?S={path:G}:S={host:G.address,port:G.port};let m=(0,at.registerChannelzSocket)((0,Lt.subchannelAddressToString)(S),()=>({localAddress:S,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(m),this.http2ServerList.push({server:L,channelzRef:m}),this.trace("Successfully bound "+(0,Lt.subchannelAddressToString)(S)),F("port"in S?S.port:_),L.removeListener("error",K)})})})).then(b=>{let P=0;for(let L of b)if(typeof L=="number"&&(P+=1,L!==_))throw new Error("Invalid state: multiple port numbers added from single address");return{port:_,count:P+w}}),u=T=>{if(T.length===0)return Promise.resolve({port:0,count:0});let _=T[0],w=l();return new Promise((b,P)=>{let L=F=>{this.trace("Failed to bind "+(0,Lt.subchannelAddressToString)(_)+" with error "+F.message),b(u(T.slice(1)))};w.once("error",L),w.listen(_,()=>{if(this.shutdown){w.close(),b({port:0,count:0});return}let F=w.address(),C={host:F.address,port:F.port},K=(0,at.registerChannelzSocket)((0,Lt.subchannelAddressToString)(C),()=>({localAddress:C,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(K),this.http2ServerList.push({server:w,channelzRef:K}),this.trace("Successfully bound "+(0,Lt.subchannelAddressToString)(C)),b(c(T.slice(1),F.port,1)),w.removeListener("error",L)})})},p={onSuccessfulResolution:(T,_,w)=>{if(p.onSuccessfulResolution=()=>{},this.shutdown&&o(new Error("bindAsync failed because server is shutdown"),0),T.length===0){o(new Error(`No addresses resolved for port ${e}`),0);return}let b;(0,Lt.isTcpSubchannelAddress)(T[0])?T[0].port===0?b=u(T):b=c(T,T[0].port,0):b=c(T,1,0),b.then(P=>{if(P.count===0){let L=`No address added out of total ${T.length} resolved`;Uo.log(_n.LogVerbosity.ERROR,L),o(new Error(L),0)}else P.count<T.length&&Uo.log(_n.LogVerbosity.INFO,`WARNING Only ${P.count} addresses added out of total ${T.length} resolved`),o(null,P.port)},P=>{let L=`No address added out of total ${T.length} resolved`;Uo.log(_n.LogVerbosity.ERROR,L),o(new Error(L),0)})},onError:T=>{o(new Error(T.details),0)}};(0,hS.createResolver)(s,p,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,at.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(Xn.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,at.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,i,s){return this.handlers.has(e)?!1:(this.handlers.set(e,{func:t,serialize:r,deserialize:i,type:s,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(this.http2ServerList.length===0||this.http2ServerList.every(({server:e})=>e.listening!==!0))throw new Error("server must be bound in order to start");if(this.started===!0)throw new Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=s=>{this.channelzEnabled&&(0,at.unregisterChannelzRef)(this.channelzRef),e(s)},r=0;function i(){r--,r===0&&t()}this.started=!1,this.shutdown=!0;for(let{server:s,channelzRef:a}of this.http2ServerList)s.listening&&(r++,s.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(a),(0,at.unregisterChannelzRef)(a)),i()}));this.sessions.forEach((s,a)=>{a.closed||(r+=1,a.close(i))}),r===0&&t()}addHttp2Port(){throw new Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[Xn.constants.HTTP2_HEADER_CONTENT_TYPE];return typeof r!="string"||!r.startsWith("application/grpc")?(e.respond({[Xn.constants.HTTP2_HEADER_STATUS]:Xn.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1):!0}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return t===void 0?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let i=new br.Http2ServerCallStream(t,null,this.options);e.code===void 0&&(e.code=_n.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed()),i.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),r?.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed();return}let i=t[fS],s=this._retrieveHandler(i);if(!s){this._respondWithError(th(i),e,r);return}let a=new br.Http2ServerCallStream(e,s,this.options);a.once("callEnd",o=>{o===_n.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(a.once("streamEnd",o=>{o?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),a.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),a.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(a,s,t)||(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed(),a.sendError({code:_n.Status.INTERNAL,details:`Unknown handler type: ${s.type}`}))}_streamHandler(e,t){if(this._verifyContentType(e,t)!==!0)return;let r=t[fS],i=this._retrieveHandler(r);if(!i){this._respondWithError(th(r),e,null);return}let s=new br.Http2ServerCallStream(e,i,this.options);this._runHandlerForCall(s,i,t)||s.sendError({code:_n.Status.INTERNAL,details:`Unknown handler type: ${i.type}`})}_runHandlerForCall(e,t,r){var i;let s=e.receiveMetadata(r),a=(i=s.get("grpc-encoding")[0])!==null&&i!==void 0?i:"identity";s.remove("grpc-encoding");let{type:o}=t;if(o==="unary")RR(e,t,s,a);else if(o==="clientStream")DR(e,t,s,a);else if(o==="serverStream")NR(e,t,s,a);else if(o==="bidi")OR(e,t,s,a);else return!1;return!0}_setupHandlers(e){if(e===null)return;let t=e.address(),r="null";t&&(typeof t=="string"?r=t:r=t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",s=>{var a,o,l,c,u;if(!this.started){s.destroy();return}let p=(0,at.registerChannelzSocket)((a=s.socket.remoteAddress)!==null&&a!==void 0?a:"unknown",this.getChannelzSessionInfoGetter(s),this.channelzEnabled),g={ref:p,streamTracker:new at.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(s,g);let T=s.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+T),this.sessionChildrenTracker.refChild(p));let _=null,w=null,b=!1;if(this.maxConnectionAgeMs!==qo){let L=this.maxConnectionAgeMs/10,F=Math.random()*L*2-L;_=(l=(o=setTimeout(()=>{var C,K;b=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+T);try{s.goaway(Xn.constants.NGHTTP2_NO_ERROR,~(1<<31),Buffer.from("max_age"))}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==qo&&(w=(K=(C=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs)).unref)===null||K===void 0?void 0:K.call(C))},this.maxConnectionAgeMs+F)).unref)===null||l===void 0?void 0:l.call(o)}let P=(u=(c=setInterval(()=>{var L,F;let C=(F=(L=setTimeout(()=>{b=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+T),s.close()},this.keepaliveTimeoutMs)).unref)===null||F===void 0?void 0:F.call(L);try{s.ping((K,G,S)=>{clearTimeout(C)})}catch{s.destroy()}},this.keepaliveTimeMs)).unref)===null||u===void 0?void 0:u.call(c);s.on("close",()=>{this.channelzEnabled&&(b||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+T),this.sessionChildrenTracker.unrefChild(p),(0,at.unregisterChannelzRef)(p)),_&&clearTimeout(_),w&&clearTimeout(w),P&&clearTimeout(P),this.sessions.delete(s)})})}};Vo.Server=nh;function RR(n,e,t,r){return x(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new br.ServerUnaryCallImpl(n,t,i);e.func(s,(a,o,l,c)=>{n.sendUnaryMessage(a,o,l,c)})}catch(i){n.sendError(i)}})}function DR(n,e,t,r){let i=new br.ServerReadableStreamImpl(n,t,e.deserialize,r);function s(a,o,l,c){i.destroy(),n.sendUnaryMessage(a,o,l,c)}n.cancelled||(i.on("error",s),e.func(i,s))}function NR(n,e,t,r){return x(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new br.ServerWritableStreamImpl(n,t,e.serialize,i);e.func(s)}catch(i){n.sendError(i)}})}function OR(n,e,t,r){let i=new br.ServerDuplexStreamImpl(n,t,e.serialize,e.deserialize,r);n.cancelled||e.func(i)}});var mS=A(zo=>{"use strict";Object.defineProperty(zo,"__esModule",{value:!0});zo.StatusBuilder=void 0;var rh=class{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return this.code!==null&&(e.code=this.code),this.details!==null&&(e.details=this.details),this.metadata!==null&&(e.metadata=this.metadata),e}};zo.StatusBuilder=rh});var ih=A(Zn=>{"use strict";Object.defineProperty(Zn,"__esModule",{value:!0});Zn.isDuration=Zn.durationToMs=Zn.msToDuration=void 0;function xR(n){return{seconds:n/1e3|0,nanos:n%1e3*1e6|0}}Zn.msToDuration=xR;function kR(n){return n.seconds*1e3+n.nanos/1e6|0}Zn.durationToMs=kR;function PR(n){return typeof n.seconds=="number"&&typeof n.nanos=="number"}Zn.isDuration=PR});var hh=A(er=>{"use strict";var sh;Object.defineProperty(er,"__esModule",{value:!0});er.setup=er.OutlierDetectionLoadBalancer=er.OutlierDetectionLoadBalancingConfig=void 0;var jo=yt(),yS=oe(),wr=ih(),vS=fh(),SS=On(),MR=ba(),LR=Mn(),gS=Ht(),FR=xo(),BR=Te(),UR="outlier_detection";function Le(n){BR.trace(yS.LogVerbosity.DEBUG,UR,n)}var dh="outlier_detection",qR=((sh=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)!==null&&sh!==void 0?sh:"true")==="true",VR={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},zR={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function wi(n,e,t,r){if(e in n&&typeof n[e]!==t){let i=r?`${r}.${e}`:e;throw new Error(`outlier detection config ${i} parse error: expected ${t}, got ${typeof n[e]}`)}}function ah(n,e,t){let r=t?`${t}.${e}`:e;if(e in n){if(!(0,wr.isDuration)(n[e]))throw new Error(`outlier detection config ${r} parse error: expected Duration, got ${typeof n[e]}`);if(!(n[e].seconds>=0&&n[e].seconds<=315576e6&&n[e].nanos>=0&&n[e].nanos<=999999999))throw new Error(`outlier detection config ${r} parse error: values out of range for non-negative Duaration`)}}function Go(n,e,t){let r=t?`${t}.${e}`:e;if(wi(n,e,"number",t),e in n&&!(n[e]>=0&&n[e]<=100))throw new Error(`outlier detection config ${r} parse error: value out of range for percentage (0-100)`)}var xs=class n{constructor(e,t,r,i,s,a,o){if(this.childPolicy=o,o.length>0&&o[0].getLoadBalancerName()==="pick_first")throw new Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=e??1e4,this.baseEjectionTimeMs=t??3e4,this.maxEjectionTimeMs=r??3e5,this.maxEjectionPercent=i??10,this.successRateEjection=s?Object.assign(Object.assign({},VR),s):null,this.failurePercentageEjection=a?Object.assign(Object.assign({},zR),a):null}getLoadBalancerName(){return dh}toJsonObject(){return{interval:(0,wr.msToDuration)(this.intervalMs),base_ejection_time:(0,wr.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,wr.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new n(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(ah(e,"interval"),ah(e,"base_ejection_time"),ah(e,"max_ejection_time"),Go(e,"max_ejection_percent"),"success_rate_ejection"in e){if(typeof e.success_rate_ejection!="object")throw new Error("outlier detection config success_rate_ejection must be an object");wi(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),Go(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),wi(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),wi(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if(typeof e.failure_percentage_ejection!="object")throw new Error("outlier detection config failure_percentage_ejection must be an object");Go(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),Go(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),wi(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),wi(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new n(e.interval?(0,wr.durationToMs)(e.interval):null,e.base_ejection_time?(0,wr.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,wr.durationToMs)(e.max_ejection_time):null,(t=e.max_ejection_percent)!==null&&t!==void 0?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(SS.validateLoadBalancingConfig))}};er.OutlierDetectionLoadBalancingConfig=xs;var lh=class extends FR.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((r,i,s,a)=>{if(this.childSubchannelState=s,!this.ejected)for(let o of this.stateListeners)o(this,i,s,a)})}getConnectivityState(){return this.ejected?jo.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){this.ejected=!0;for(let e of this.stateListeners)e(this,this.childSubchannelState,jo.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){this.ejected=!1;for(let e of this.stateListeners)e(this,jo.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}};function oh(){return{success:0,failure:0}}var ch=class{constructor(){this.activeBucket=oh(),this.inactiveBucket=oh()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=oh()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}},uh=class{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType===LR.PickResultType.COMPLETE){let r=t.subchannel,i=r.getMapEntry();if(i){let s=t.onCallEnded;return this.countCalls&&(s=a=>{var o;a===yS.Status.OK?i.counter.addSuccess():i.counter.addFailure(),(o=t.onCallEnded)===null||o===void 0||o.call(t,a)}),Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel(),onCallEnded:s})}else return Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel()})}else return t}},Ko=class{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new MR.ChildLoadBalancerHandler((0,vS.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let i=e.createSubchannel(t,r),s=this.addressMap.get((0,gS.subchannelAddressToString)(t)),a=new lh(i,s);return s?.currentEjectionTimestamp!==null&&a.eject(),s?.subchannelWrappers.push(a),a},updateState:(t,r)=>{t===jo.ConnectivityState.READY?e.updateState(t,new uh(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return this.latestConfig!==null&&(this.latestConfig.getSuccessRateEjectionConfig()!==null||this.latestConfig.getFailurePercentageEjectionConfig()!==null)}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())t.currentEjectionTimestamp!==null&&(e+=1);return e*100/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;Le("Running success rate check");let r=t.request_volume,i=0,s=[];for(let[p,g]of this.addressMap){let T=g.counter.getLastSuccesses(),_=g.counter.getLastFailures();Le("Stats for "+p+": successes="+T+" failures="+_+" targetRequestVolume="+r),T+_>=r&&(i+=1,s.push(T/(T+_)))}if(Le("Found "+i+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+s+"]"),i<t.minimum_hosts)return;let a=s.reduce((p,g)=>p+g)/s.length,o=0;for(let p of s){let g=p-a;o+=g*g}let l=o/s.length,c=Math.sqrt(l),u=a-c*(t.stdev_factor/1e3);Le("stdev="+c+" ejectionThreshold="+u);for(let[p,g]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let T=g.counter.getLastSuccesses(),_=g.counter.getLastFailures();if(T+_<r)continue;let w=T/(T+_);if(Le("Checking candidate "+p+" successRate="+w),w<u){let b=Math.random()*100;Le("Candidate "+p+" randomNumber="+b+" enforcement_percentage="+t.enforcement_percentage),b<t.enforcement_percentage&&(Le("Ejecting candidate "+p),this.eject(g,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;Le("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let i of this.addressMap.values()){let s=i.counter.getLastSuccesses(),a=i.counter.getLastFailures();s+a>=t.request_volume&&(r+=1)}if(!(r<t.minimum_hosts))for(let[i,s]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let a=s.counter.getLastSuccesses(),o=s.counter.getLastFailures();if(Le("Candidate successes="+a+" failures="+o),a+o<t.request_volume)continue;if(o*100/(o+a)>t.threshold){let c=Math.random()*100;Le("Candidate "+i+" randomNumber="+c+" enforcement_percentage="+t.enforcement_percentage),c<t.enforcement_percentage&&(Le("Ejecting candidate "+i),this.eject(s,e))}}}eject(e,t){e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1;for(let r of e.subchannelWrappers)r.eject()}uneject(e){e.currentEjectionTimestamp=null;for(let t of e.subchannelWrappers)t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),(r=(t=this.ejectionTimer).unref)===null||r===void 0||r.call(t)}runChecks(){let e=new Date;if(Le("Ejection timer running"),this.switchAllBuckets(),!!this.latestConfig){this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e);for(let[t,r]of this.addressMap.entries())if(r.currentEjectionTimestamp===null)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let i=this.latestConfig.getBaseEjectionTimeMs(),s=this.latestConfig.getMaxEjectionTimeMs(),a=new Date(r.currentEjectionTimestamp.getTime());a.setMilliseconds(a.getMilliseconds()+Math.min(i*r.ejectionTimeMultiplier,Math.max(i,s))),a<new Date&&(Le("Unejecting "+t),this.uneject(r))}}}updateAddressList(e,t,r){if(!(t instanceof xs))return;let i=new Set;for(let a of e)i.add((0,gS.subchannelAddressToString)(a));for(let a of i)this.addressMap.has(a)||(Le("Adding map entry for "+a),this.addressMap.set(a,{counter:new ch,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let a of this.addressMap.keys())i.has(a)||(Le("Removing map entry for "+a),this.addressMap.delete(a));let s=(0,SS.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,s,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){Le("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let a=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(a)}else Le("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else{Le("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer);for(let a of this.addressMap.values())this.uneject(a),a.ejectionTimeMultiplier=0}this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return dh}};er.OutlierDetectionLoadBalancer=Ko;function GR(){qR&&(0,vS.registerLoadBalancerType)(dh,Ko,xs)}er.setup=GR});var fh=A(H=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0});H.OutlierDetectionLoadBalancingConfig=H.BaseSubchannelWrapper=H.registerAdminService=H.FilterStackFactory=H.BaseFilter=H.PickResultType=H.QueuePicker=H.UnavailablePicker=H.ChildLoadBalancerHandler=H.subchannelAddressToString=H.validateLoadBalancingConfig=H.getFirstUsableConfig=H.registerLoadBalancerType=H.createChildChannelControlHelper=H.BackoffTimeout=H.durationToMs=H.uriToString=H.createResolver=H.registerResolver=H.log=H.trace=void 0;var TS=Te();Object.defineProperty(H,"trace",{enumerable:!0,get:function(){return TS.trace}});Object.defineProperty(H,"log",{enumerable:!0,get:function(){return TS.log}});var ES=Kt();Object.defineProperty(H,"registerResolver",{enumerable:!0,get:function(){return ES.registerResolver}});Object.defineProperty(H,"createResolver",{enumerable:!0,get:function(){return ES.createResolver}});var jR=lt();Object.defineProperty(H,"uriToString",{enumerable:!0,get:function(){return jR.uriToString}});var KR=ih();Object.defineProperty(H,"durationToMs",{enumerable:!0,get:function(){return KR.durationToMs}});var WR=Ji();Object.defineProperty(H,"BackoffTimeout",{enumerable:!0,get:function(){return WR.BackoffTimeout}});var Wo=On();Object.defineProperty(H,"createChildChannelControlHelper",{enumerable:!0,get:function(){return Wo.createChildChannelControlHelper}});Object.defineProperty(H,"registerLoadBalancerType",{enumerable:!0,get:function(){return Wo.registerLoadBalancerType}});Object.defineProperty(H,"getFirstUsableConfig",{enumerable:!0,get:function(){return Wo.getFirstUsableConfig}});Object.defineProperty(H,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return Wo.validateLoadBalancingConfig}});var HR=Ht();Object.defineProperty(H,"subchannelAddressToString",{enumerable:!0,get:function(){return HR.subchannelAddressToString}});var $R=ba();Object.defineProperty(H,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return $R.ChildLoadBalancerHandler}});var ph=Mn();Object.defineProperty(H,"UnavailablePicker",{enumerable:!0,get:function(){return ph.UnavailablePicker}});Object.defineProperty(H,"QueuePicker",{enumerable:!0,get:function(){return ph.QueuePicker}});Object.defineProperty(H,"PickResultType",{enumerable:!0,get:function(){return ph.PickResultType}});var QR=Dd();Object.defineProperty(H,"BaseFilter",{enumerable:!0,get:function(){return QR.BaseFilter}});var YR=Id();Object.defineProperty(H,"FilterStackFactory",{enumerable:!0,get:function(){return YR.FilterStackFactory}});var JR=Ca();Object.defineProperty(H,"registerAdminService",{enumerable:!0,get:function(){return JR.registerAdminService}});var XR=xo();Object.defineProperty(H,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return XR.BaseSubchannelWrapper}});var ZR=hh();Object.defineProperty(H,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return ZR.OutlierDetectionLoadBalancingConfig}})});var _S=A(Ho=>{"use strict";Object.defineProperty(Ho,"__esModule",{value:!0});Ho.setup=void 0;var eD=Kt(),mh=class{constructor(e,t,r){this.listener=t,this.addresses=[],this.hasReturnedResult=!1;let i;e.authority===""?i="/"+e.path:i=e.path,this.addresses=[{path:i}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}};function tD(){(0,eD.registerResolver)("unix",mh)}Ho.setup=tD});var AS=A(Yo=>{"use strict";Object.defineProperty(Yo,"__esModule",{value:!0});Yo.setup=void 0;var bS=ce("net"),$o=oe(),gh=rt(),wS=Kt(),CS=lt(),nD=Te(),rD="ip_resolver";function IS(n){nD.trace($o.LogVerbosity.DEBUG,rD,n)}var yh="ipv4",vh="ipv6",iD=443,Qo=class{constructor(e,t,r){var i;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,IS("Resolver constructed for target "+(0,CS.uriToString)(e));let s=[];if(!(e.scheme===yh||e.scheme===vh)){this.error={code:$o.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new gh.Metadata};return}let a=e.path.split(",");for(let o of a){let l=(0,CS.splitHostPort)(o);if(l===null){this.error={code:$o.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${o}`,metadata:new gh.Metadata};return}if(e.scheme===yh&&!(0,bS.isIPv4)(l.host)||e.scheme===vh&&!(0,bS.isIPv6)(l.host)){this.error={code:$o.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${o}`,metadata:new gh.Metadata};return}s.push({host:l.host,port:(i=l.port)!==null&&i!==void 0?i:iD})}this.addresses=s,IS("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}};function sD(){(0,wS.registerResolver)(yh,Qo),(0,wS.registerResolver)(vh,Qo)}Yo.setup=sD});var NS=A(on=>{"use strict";Object.defineProperty(on,"__esModule",{value:!0});on.setup=on.PickFirstLoadBalancer=on.shuffled=on.PickFirstLoadBalancingConfig=void 0;var RS=On(),We=yt(),Jo=Mn(),aD=Te(),oD=oe(),lD="pick_first";function Sh(n){aD.trace(oD.LogVerbosity.DEBUG,lD,n)}var ks="pick_first",cD=250,Ps=class n{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return ks}toJsonObject(){return{[ks]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&typeof e.shuffleAddressList!="boolean")throw new Error("pick_first config field shuffleAddressList must be a boolean if provided");return new n(e.shuffleAddressList===!0)}};on.PickFirstLoadBalancingConfig=Ps;var Th=class{constructor(e){this.subchannel=e}pick(e){return{pickResultType:Jo.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}};function DS(n){let e=n.slice();for(let t=e.length-1;t>1;t--){let r=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[r],e[r]=i}return e}on.shuffled=DS;var Xo=class{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=We.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(t,r,i,s,a)=>{this.onSubchannelStateUpdate(t,r,i,a)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(We.ConnectivityState.READY,new Th(this.currentPick)):this.children.length===0?this.updateState(We.ConnectivityState.IDLE,new Jo.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(We.ConnectivityState.TRANSIENT_FAILURE,new Jo.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(We.ConnectivityState.CONNECTING,new Jo.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){this.stickyTransientFailureMode=!0;for(let{subchannel:e}of this.children)e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(this.currentPick!==null){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,i){var s;if(!((s=this.currentPick)===null||s===void 0)&&s.realSubchannelEquals(e)){r!==We.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[a,o]of this.children.entries())if(e.realSubchannelEquals(o.subchannel)){r===We.ConnectivityState.READY&&this.pickSubchannel(o.subchannel),r===We.ConnectivityState.TRANSIENT_FAILURE&&(o.hasReportedTransientFailure=!0,i&&(this.lastError=i),this.maybeEnterStickyTransientFailureMode(),a===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(a+1)),o.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let i=r.subchannel.getConnectivityState();if(i===We.ConnectivityState.IDLE||i===We.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===We.ConnectivityState.IDLE&&(Sh("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var i;(i=this.children[e])===null||i===void 0||i.subchannel.startConnecting()})),this.connectionDelayTimeout=(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},cD)).unref)===null||r===void 0?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(Sh("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,this.currentPick!==null&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){Sh(We.ConnectivityState[this.currentState]+" -> "+We.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(r=>({subchannel:this.channelControlHelper.createSubchannel(r,{}),hasReportedTransientFailure:!1}));for(let{subchannel:r}of t)r.ref(),this.channelControlHelper.addChannelzChild(r.getChannelzRef());this.resetSubchannelList(),this.children=t;for(let{subchannel:r}of this.children)if(r.addConnectivityStateListener(this.subchannelStateListener),r.getConnectivityState()===We.ConnectivityState.READY){this.pickSubchannel(r);return}for(let r of this.children)r.subchannel.getConnectivityState()===We.ConnectivityState.TRANSIENT_FAILURE&&(r.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof Ps&&(t.getShuffleAddressList()&&(e=DS(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===We.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return ks}};on.PickFirstLoadBalancer=Xo;function uD(){(0,RS.registerLoadBalancerType)(ks,Xo,Ps),(0,RS.registerDefaultLoadBalancerType)(ks)}on.setup=uD});var xS=A(Ci=>{"use strict";Object.defineProperty(Ci,"__esModule",{value:!0});Ci.setup=Ci.RoundRobinLoadBalancer=void 0;var dD=On(),He=yt(),Zo=Mn(),hD=Ht(),fD=Te(),pD=oe(),mD="round_robin";function OS(n){fD.trace(pD.LogVerbosity.DEBUG,mD,n)}var el="round_robin",Eh=class n{getLoadBalancerName(){return el}constructor(){}toJsonObject(){return{[el]:{}}}static createFromJson(e){return new n}},_h=class{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:Zo.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}},tl=class{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=He.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(t,r,i,s,a)=>{this.calculateAndUpdateState(),(i===He.ConnectivityState.TRANSIENT_FAILURE||i===He.ConnectivityState.IDLE)&&(a&&(this.lastError=a),this.channelControlHelper.requestReresolution(),t.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(He.ConnectivityState.READY)>0){let e=this.subchannels.filter(r=>r.getConnectivityState()===He.ConnectivityState.READY),t=0;this.currentReadyPicker!==null&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()),t<0&&(t=0)),this.updateState(He.ConnectivityState.READY,new _h(e,t))}else this.countSubchannelsWithState(He.ConnectivityState.CONNECTING)>0?this.updateState(He.ConnectivityState.CONNECTING,new Zo.QueuePicker(this)):this.countSubchannelsWithState(He.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(He.ConnectivityState.TRANSIENT_FAILURE,new Zo.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(He.ConnectivityState.IDLE,new Zo.QueuePicker(this))}updateState(e,t){OS(He.ConnectivityState[this.currentState]+" -> "+He.ConnectivityState[e]),e===He.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){this.resetSubchannelList(),OS("Connect to address list "+e.map(r=>(0,hD.subchannelAddressToString)(r))),this.subchannels=e.map(r=>this.channelControlHelper.createSubchannel(r,{}));for(let r of this.subchannels){r.ref(),r.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(r.getChannelzRef());let i=r.getConnectivityState();(i===He.ConnectivityState.IDLE||i===He.ConnectivityState.TRANSIENT_FAILURE)&&r.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return el}};Ci.RoundRobinLoadBalancer=tl;function gD(){(0,dD.registerLoadBalancerType)(el,tl,Eh)}Ci.setup=gD});var LS=A(B=>{"use strict";Object.defineProperty(B,"__esModule",{value:!0});B.experimental=B.addAdminServicesToServer=B.getChannelzHandlers=B.getChannelzServiceDefinition=B.InterceptorConfigurationError=B.InterceptingCall=B.RequesterBuilder=B.ListenerBuilder=B.StatusBuilder=B.getClientChannel=B.ServerCredentials=B.Server=B.setLogVerbosity=B.setLogger=B.load=B.loadObject=B.CallCredentials=B.ChannelCredentials=B.waitForClientReady=B.closeClient=B.Channel=B.makeGenericClientConstructor=B.makeClientConstructor=B.loadPackageDefinition=B.Client=B.compressionAlgorithms=B.propagate=B.connectivityState=B.status=B.logVerbosity=B.Metadata=B.credentials=void 0;var nl=yc();Object.defineProperty(B,"CallCredentials",{enumerable:!0,get:function(){return nl.CallCredentials}});var yD=Qc();Object.defineProperty(B,"Channel",{enumerable:!0,get:function(){return yD.ChannelImplementation}});var vD=Ad();Object.defineProperty(B,"compressionAlgorithms",{enumerable:!0,get:function(){return vD.CompressionAlgorithms}});var SD=yt();Object.defineProperty(B,"connectivityState",{enumerable:!0,get:function(){return SD.ConnectivityState}});var rl=ga();Object.defineProperty(B,"ChannelCredentials",{enumerable:!0,get:function(){return rl.ChannelCredentials}});var kS=$c();Object.defineProperty(B,"Client",{enumerable:!0,get:function(){return kS.Client}});var bh=oe();Object.defineProperty(B,"logVerbosity",{enumerable:!0,get:function(){return bh.LogVerbosity}});Object.defineProperty(B,"status",{enumerable:!0,get:function(){return bh.Status}});Object.defineProperty(B,"propagate",{enumerable:!0,get:function(){return bh.Propagate}});var PS=Te(),wh=Jc();Object.defineProperty(B,"loadPackageDefinition",{enumerable:!0,get:function(){return wh.loadPackageDefinition}});Object.defineProperty(B,"makeClientConstructor",{enumerable:!0,get:function(){return wh.makeClientConstructor}});Object.defineProperty(B,"makeGenericClientConstructor",{enumerable:!0,get:function(){return wh.makeClientConstructor}});var TD=rt();Object.defineProperty(B,"Metadata",{enumerable:!0,get:function(){return TD.Metadata}});var ED=pS();Object.defineProperty(B,"Server",{enumerable:!0,get:function(){return ED.Server}});var _D=eh();Object.defineProperty(B,"ServerCredentials",{enumerable:!0,get:function(){return _D.ServerCredentials}});var bD=mS();Object.defineProperty(B,"StatusBuilder",{enumerable:!0,get:function(){return bD.StatusBuilder}});B.credentials={combineChannelCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),combineCallCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),createInsecure:rl.ChannelCredentials.createInsecure,createSsl:rl.ChannelCredentials.createSsl,createFromSecureContext:rl.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:nl.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:nl.CallCredentials.createFromGoogleCredential,createEmpty:nl.CallCredentials.createEmpty};var wD=n=>n.close();B.closeClient=wD;var CD=(n,e,t)=>n.waitForReady(e,t);B.waitForClientReady=CD;var ID=(n,e)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};B.loadObject=ID;var AD=(n,e,t)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};B.load=AD;var RD=n=>{PS.setLogger(n)};B.setLogger=RD;var DD=n=>{PS.setLoggerVerbosity(n)};B.setLogVerbosity=DD;var ND=n=>kS.Client.prototype.getChannel.call(n);B.getClientChannel=ND;var il=Kc();Object.defineProperty(B,"ListenerBuilder",{enumerable:!0,get:function(){return il.ListenerBuilder}});Object.defineProperty(B,"RequesterBuilder",{enumerable:!0,get:function(){return il.RequesterBuilder}});Object.defineProperty(B,"InterceptingCall",{enumerable:!0,get:function(){return il.InterceptingCall}});Object.defineProperty(B,"InterceptorConfigurationError",{enumerable:!0,get:function(){return il.InterceptorConfigurationError}});var MS=Er();Object.defineProperty(B,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return MS.getChannelzServiceDefinition}});Object.defineProperty(B,"getChannelzHandlers",{enumerable:!0,get:function(){return MS.getChannelzHandlers}});var OD=Ca();Object.defineProperty(B,"addAdminServicesToServer",{enumerable:!0,get:function(){return OD.addAdminServicesToServer}});var xD=fh();B.experimental=xD;var kD=pd(),PD=_S(),MD=AS(),LD=NS(),FD=xS(),BD=hh(),UD=Er();kD.setup(),PD.setup(),MD.setup(),LD.setup(),FD.setup(),BD.setup(),UD.setup()});import{TextEncoder as qD,inspect as VD,TextDecoder as o2}from"util";import{randomBytes as zD}from"crypto";function jD(n){Wi=n}function KD(n){return VD(n,{depth:100})}function Ii(){return Rr.logLevel}function V(n,...e){if(Rr.logLevel<=jt.DEBUG){let t=e.map(hp);Rr.debug(`Firestore (${Wi}): ${n}`,...t)}}function Ut(n,...e){if(Rr.logLevel<=jt.ERROR){let t=e.map(hp);Rr.error(`Firestore (${Wi}): ${n}`,...t)}}function Oi(n,...e){if(Rr.logLevel<=jt.WARN){let t=e.map(hp);Rr.warn(`Firestore (${Wi}): ${n}`,...t)}}function hp(n){if(typeof n=="string")return n;try{return KD(n)}catch{return n}}function W(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,wT(n,r,t)}function wT(n,e,t){let r=`FIRESTORE (${Wi}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{let i=JSON.stringify(t);r+=" CONTEXT: "+i}catch{r+=" CONTEXT: "+t}throw Ut(r),new Error(r)}function le(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||wT(e,i,r)}function $(n,e){return n}function WD(n){if(!n)return new kh;switch(n.type){case"firstParty":return new Fh(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new M(I.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function HD(n){return zD(n)}function ne(n,e){return n<e?-1:n>e?1:0}function fp(n,e){let t=Math.min(n.length,e.length);for(let r=0;r<t;r++){let i=n.charAt(r),s=e.charAt(r);if(i!==s)return Ch(i)===Ch(s)?ne(i,s):Ch(i)?1:-1}return ne(n.length,e.length)}function Ch(n){let e=n.charCodeAt(0);return e>=$D&&e<=QD}function Dr(n,e,t){return n.length!==e.length?!1:n.every((r,i)=>t(r,e[i]))}function CT(n,e,t){if(!t)throw new M(I.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function JD(n,e,t,r){if(e===!0&&r===!0)throw new M(I.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function qS(n){if(!j.isDocumentKey(n))throw new M(I.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function VS(n){if(j.isDocumentKey(n))throw new M(I.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function IT(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function jl(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=XD(n);return e?`a custom ${e} object`:"an object"}}else return typeof n=="function"?"a function":W(12329,{type:typeof n})}function XD(n){return n.constructor?n.constructor.name:null}function nt(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new M(I.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=jl(n);throw new M(I.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function ZD(n,e){if(e<=0)throw new M(I.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function Re(n,e){let t={typeString:n};return e&&(t.value=e),t}function na(n,e){if(!IT(n))throw new M(I.INVALID_ARGUMENT,"JSON must be an object");let t;for(let r in e)if(e[r]){let i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}let a=n[r];if(i&&typeof a!==i){t=`JSON field '${r}' must be a ${i}.`;break}else if(s!==void 0&&a!==s.value){t=`Expected '${r}' field to equal '${s.value}'`;break}}if(t)throw new M(I.INVALID_ARGUMENT,t);return!0}function eN(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=Q.fromTimestamp(r===1e9?new Ee(t+1,0):new Ee(t,r));return new Nr(i,j.empty(),e)}function tN(n){return new Nr(n.readTime,n.key,Us)}function nN(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0||(t=j.comparator(n.documentKey,e.documentKey),t!==0)?t:ne(n.largestBatchId,e.largestBatchId)}function Hi(n){return x(this,null,function*(){if(n.code===I.FAILED_PRECONDITION&&n.message===rN)V("LocalStore","Unexpectedly lost primary lease");else throw n})}function iN(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function $i(n){return n.name==="IndexedDbTransactionError"}function lN(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=jS(e)),e=cN(n.get(t),e);return jS(e)}function cN(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+=ll+aN;break;case ll:t+=ll+oN;break;default:t+=s}}return t}function jS(n){return n+ll+sN}function KS(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function lr(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function qT(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function CN(n){return Buffer.from(n,"base64").toString("binary")}function IN(n){return Buffer.from(n,"binary").toString("base64")}function AN(n){let e="";for(let t=0;t<n.length;++t)e+=String.fromCharCode(n[t]);return e}function RN(n){let e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}function wn(n){if(le(!!n,39018),typeof n=="string"){let e=0,t=DN.exec(n);if(le(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}else{let e=ve(n.seconds),t=ve(n.nanos);return{seconds:e,nanos:t}}}function ve(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Cn(n){return typeof n=="string"?$e.fromBase64String(n):$e.fromUint8Array(n)}function mp(n){return(n?.mapValue?.fields||{})[zT]?.stringValue===VT}function NN(n,e){let t={fields:{[zT]:{stringValue:VT},[jT]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return e&&mp(e)&&(e=Kl(e)),e&&(t.fields[GT]=e),{mapValue:t}}function Kl(n){let e=n.mapValue.fields[GT];return mp(e)?Kl(e):e}function qs(n){let e=wn(n.mapValue.fields[jT].timestampValue);return new Ee(e.seconds,e.nanos)}function ON(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new M(I.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ml(n.options.projectId,e)}function Wl(n){return n==null}function Vs(n){return n===0&&1/n===-1/0}function xN(n){return typeof n=="number"&&Number.isInteger(n)&&!Vs(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function nr(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?mp(n)?4:$T(n)?9007199254740991:HT(n)?10:11:W(28295,{value:n})}function Ft(n,e){if(n===e)return!0;let t=nr(n),r=nr(e);if(t!==r)return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return qs(n).isEqual(qs(e));case 3:return kN(n,e);case 5:return n.stringValue===e.stringValue;case 6:return MN(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return PN(n,e);case 2:return LN(n,e);case 9:return Dr(n.arrayValue.values||[],e.arrayValue.values||[],Ft);case 10:case 11:return FN(n,e);case 9007199254740991:return!0;default:return W(52216,{left:n})}}function kN(n,e){if(typeof n.timestampValue=="string"&&typeof e.timestampValue=="string"&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;let t=wn(n.timestampValue),r=wn(e.timestampValue);return t.seconds===r.seconds&&t.nanos===r.nanos}function PN(n,e){return ve(n.geoPointValue.latitude)===ve(e.geoPointValue.latitude)&&ve(n.geoPointValue.longitude)===ve(e.geoPointValue.longitude)}function MN(n,e){return Cn(n.bytesValue).isEqual(Cn(e.bytesValue))}function LN(n,e){if("integerValue"in n&&"integerValue"in e)return ve(n.integerValue)===ve(e.integerValue);if("doubleValue"in n&&"doubleValue"in e){let t=ve(n.doubleValue),r=ve(e.doubleValue);return t===r?Vs(t)===Vs(r):isNaN(t)&&isNaN(r)}return!1}function FN(n,e){let t=n.mapValue.fields||{},r=e.mapValue.fields||{};if(KS(t)!==KS(r))return!1;for(let i in t)if(t.hasOwnProperty(i)&&(r[i]===void 0||!Ft(t[i],r[i])))return!1;return!0}function zs(n,e){return(n.values||[]).find(t=>Ft(t,e))!==void 0}function Mi(n,e){if(n===e)return 0;let t=nr(n),r=nr(e);if(t!==r)return ne(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ne(n.booleanValue,e.booleanValue);case 2:return BN(n,e);case 3:return WS(n.timestampValue,e.timestampValue);case 4:return WS(qs(n),qs(e));case 5:return fp(n.stringValue,e.stringValue);case 6:return VN(n.bytesValue,e.bytesValue);case 7:return UN(n.referenceValue,e.referenceValue);case 8:return qN(n.geoPointValue,e.geoPointValue);case 9:return WT(n.arrayValue,e.arrayValue);case 10:return zN(n.mapValue,e.mapValue);case 11:return GN(n.mapValue,e.mapValue);default:throw W(23264,{leftType:t})}}function BN(n,e){let t=ve(n.integerValue||n.doubleValue),r=ve(e.integerValue||e.doubleValue);return t<r?-1:t>r?1:t===r?0:isNaN(t)?isNaN(r)?0:-1:1}function WS(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ne(n,e);let t=wn(n),r=wn(e),i=ne(t.seconds,r.seconds);return i!==0?i:ne(t.nanos,r.nanos)}function UN(n,e){let t=n.split("/"),r=e.split("/");for(let i=0;i<t.length&&i<r.length;i++){let s=ne(t[i],r[i]);if(s!==0)return s}return ne(t.length,r.length)}function qN(n,e){let t=ne(ve(n.latitude),ve(e.latitude));return t!==0?t:ne(ve(n.longitude),ve(e.longitude))}function VN(n,e){let t=Cn(n),r=Cn(e);return t.compareTo(r)}function WT(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=Mi(t[i],r[i]);if(s)return s}return ne(t.length,r.length)}function zN(n,e){let t=n.fields||{},r=e.fields||{},i=t[Pi]?.arrayValue,s=r[Pi]?.arrayValue,a=ne(i?.values?.length||0,s?.values?.length||0);return a!==0?a:WT(i,s)}function GN(n,e){if(n===sl.mapValue&&e===sl.mapValue)return 0;if(n===sl.mapValue)return 1;if(e===sl.mapValue)return-1;let t=n.fields||{},r=Object.keys(t),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let a=0;a<r.length&&a<s.length;++a){let o=fp(r[a],s[a]);if(o!==0)return o;let l=Mi(t[r[a]],i[s[a]]);if(l!==0)return l}return ne(r.length,s.length)}function Li(n){return Sp(n)}function Sp(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?KN(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?jN(n.bytesValue):"referenceValue"in n?HN(n.referenceValue):"geoPointValue"in n?WN(n.geoPointValue):"arrayValue"in n?QN(n.arrayValue):"mapValue"in n?$N(n.mapValue):W(61005,{value:n})}function jN(n){return Cn(n).toBase64()}function KN(n){let e=wn(n);return`time(${e.seconds},${e.nanos})`}function WN(n){return`geo(${n.latitude},${n.longitude})`}function HN(n){return j.fromName(n).toString()}function $N(n){let e=Object.keys(n.fields||{}).sort(),t="{",r=!0;for(let i of e)r?r=!1:t+=",",t+=`${i}:${Sp(n.fields[i])}`;return t+"}"}function QN(n){let e="[",t=!0;for(let r of n.values||[])t?t=!1:e+=",",e+=Sp(r);return e+"]"}function Hl(n){switch(nr(n)){case 0:return 4;case 1:return 4;case 2:return 8;case 3:return 16;case 4:let e=Kl(n);return e?16+Hl(e):16;case 5:return n.stringValue.length*2;case 6:return Cn(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 8:return 16;case 9:return JN(n.arrayValue);case 10:case 11:return YN(n.mapValue);default:throw W(13486,{value:n})}}function YN(n){let e=0;return lr(n.fields,(t,r)=>{e+=t.length+Hl(r)}),e}function JN(n){return(n.values||[]).reduce((e,t)=>e+Hl(t),0)}function HS(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Gh(n){return!!n&&"integerValue"in n}function XN(n){return!!n&&"doubleValue"in n}function ZN(n){return Gh(n)||XN(n)}function Tp(n){return!!n&&"arrayValue"in n}function $S(n){return!!n&&"nullValue"in n}function QS(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function cl(n){return!!n&&"mapValue"in n}function HT(n){return(n?.mapValue?.fields||{})[yp]?.stringValue===vp}function Fs(n){if(n.geoPointValue)return{geoPointValue:ee({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:ee({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return lr(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Fs(r)),e}else if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Fs(n.arrayValue.values[t]);return e}else return ee({},n)}function $T(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===KT}function QT(n){let e=[];return lr(n.fields,(t,r)=>{let i=new mt([t]);if(cl(r)){let a=QT(r.mapValue).fields;if(a.length===0)e.push(i);else for(let o of a)e.push(i.child(o))}else e.push(i)}),new Ct(e)}function eO(n,e,t){let r=e.data.field(n),i=t.data.field(n);return r!==null&&i!==null?Mi(r,i):W(42886)}function YT(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],a=n.position[i];if(s.field.isKeyField())r=j.comparator(j.fromName(a.referenceValue),t.key);else{let o=t.data.field(s.field);r=Mi(a,o)}if(s.dir==="desc"&&(r=r*-1),r!==0)break}return r}function tO(n,e,t){let r=YT(n,e,t);return n.inclusive?r>=0:r>0}function nO(n,e,t){let r=YT(n,e,t);return n.inclusive?r<=0:r<0}function YS(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++){let r=n.position[t],i=e.position[t];if(!Ft(r,i))return!1}return!0}function rO(n){return n.field.canonicalString()+n.dir}function iO(n){return`${n.field.canonicalString()} (${n.dir})`}function sO(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}function JT(n){return n.op==="and"}function XT(n){return aO(n)&&JT(n)}function aO(n){for(let e of n.filters)if(e instanceof Vt)return!1;return!0}function jh(n){if(n instanceof De)return n.field.canonicalString()+n.op.toString()+Li(n.value);if(XT(n))return n.filters.map(e=>jh(e)).join(",");{let e=n.filters.map(t=>jh(t)).join(",");return`${n.op}(${e})`}}function ZT(n,e){if(n instanceof De)return oO(n,e);if(n instanceof Vt)return lO(n,e);W(19439)}function oO(n,e){return e instanceof De&&n.op===e.op&&n.field.isEqual(e.field)&&Ft(n.value,e.value)}function lO(n,e){return e instanceof Vt&&n.op===e.op&&n.filters.length===e.filters.length?n.filters.reduce((r,i,s)=>r&&ZT(i,e.filters[s]),!0):!1}function eE(n){return n instanceof De?uO(n):n instanceof Vt?cO(n):"Filter"}function cO(n){return n.op.toString()+" {"+n.getFilters().map(eE).join(" ,")+"}"}function uO(n){return`${n.field.canonicalString()} ${n.op} ${Li(n.value)}`}function tE(n,e){return(e.arrayValue?.values||[]).map(t=>j.fromName(t.referenceValue))}function JS(n,e=null,t=[],r=[],i=null,s=null,a=null){return new Xh(n,e,t,r,i,s,a)}function Ep(n){let e=$(n);if(e.memoizedCanonicalId===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>jh(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>rO(r)).join(","),Wl(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Li(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Li(r)).join(",")),e.memoizedCanonicalId=t}return e.memoizedCanonicalId}function dO(n){let e=n.path.canonicalString();return n.collectionGroup!==null&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>eE(t)).join(", ")}]`),Wl(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>iO(t)).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>Li(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>Li(t)).join(",")),`Target(${e})`}function _p(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!sO(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!ZT(n.filters[t],e.filters[t]))return!1;return n.collectionGroup!==e.collectionGroup||!n.path.isEqual(e.path)||!YS(n.startAt,e.startAt)?!1:YS(n.endAt,e.endAt)}function Zh(n){return j.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function hO(n,e,t,r,i,s,a,o){return new rr(n,e,t,r,i,s,a,o)}function $l(n){return new rr(n)}function fO(n,e){return new rr(e,null,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function XS(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function pO(n){let e=new Be(mt.comparator);return n.filters.forEach(t=>{t.getFlattenedFilters().forEach(i=>{i.isInequality()&&(e=e.add(i.field))})}),e}function mO(n){return j.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function nE(n){return n.collectionGroup!==null}function Gs(n){let e=$(n);if(e.memoizedNormalizedOrderBy===null){e.memoizedNormalizedOrderBy=[];let t=new Set;for(let s of e.explicitOrderBy)e.memoizedNormalizedOrderBy.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";pO(e).forEach(s=>{!t.has(s.canonicalString())&&!s.isKeyField()&&e.memoizedNormalizedOrderBy.push(new Or(s,r))}),t.has(mt.keyField().canonicalString())||e.memoizedNormalizedOrderBy.push(new Or(mt.keyField(),r))}return e.memoizedNormalizedOrderBy}function Bt(n){let e=$(n);return e.memoizedTarget||(e.memoizedTarget=gO(e,Gs(n))),e.memoizedTarget}function gO(n,e){if(n.limitType==="F")return JS(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Or(i.field,s)});let t=n.endAt?new Fi(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Fi(n.startAt.position,n.startAt.inclusive):null;return JS(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function bp(n,e){let t=n.filters.concat([e]);return new rr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function yO(n,e){let t=n.explicitOrderBy.concat([e]);return new rr(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function yl(n,e,t){return new rr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ql(n,e){return _p(Bt(n),Bt(e))&&n.limitType===e.limitType}function rE(n){return`${Ep(Bt(n))}|lt:${n.limitType}`}function Ai(n){return`Query(target=${dO(Bt(n))}; limitType=${n.limitType})`}function Yl(n,e){return e.isFoundDocument()&&vO(n,e)&&SO(n,e)&&TO(n,e)&&EO(n,e)}function vO(n,e){let t=e.key.path;return n.collectionGroup!==null?e.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(t):j.isDocumentKey(n.path)?n.path.isEqual(t):n.path.isImmediateParentOf(t)}function SO(n,e){for(let t of Gs(n))if(!t.field.isKeyField()&&e.data.field(t.field)===null)return!1;return!0}function TO(n,e){for(let t of n.filters)if(!t.matches(e))return!1;return!0}function EO(n,e){return!(n.startAt&&!nO(n.startAt,Gs(n),e)||n.endAt&&!tO(n.endAt,Gs(n),e))}function _O(n){return n.collectionGroup||(n.path.length%2===1?n.path.lastSegment():n.path.get(n.path.length-2))}function iE(n){return(e,t)=>{let r=!1;for(let i of Gs(n)){let s=bO(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function bO(n,e,t){let r=n.field.isKeyField()?j.comparator(e.key,t.key):eO(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return W(19790,{direction:n.dir})}}function An(){return wO}function Ms(...n){let e=sE;for(let t of n)e=e.insert(t.key,t);return e}function CO(){return js()}function aE(n){let e=sE;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Cr(){return js()}function oE(){return js()}function js(){return new In(n=>n.toString(),(n,e)=>n.isEqual(e))}function AO(){return IO}function te(...n){let e=RO;for(let t of n)e=e.add(t);return e}function NO(){return DO}function wp(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Vs(e)?"-0":e}}function lE(n){return{integerValue:""+n}}function OO(n,e){return xN(e)?lE(e):wp(n,e)}function xO(n,e,t){return n instanceof Ui?NN(t,e):n instanceof xr?uE(n,e):n instanceof kr?dE(n,e):MO(n,e)}function kO(n,e,t){return n instanceof xr?uE(n,e):n instanceof kr?dE(n,e):t}function cE(n,e){return n instanceof qi?ZN(e)?e:{integerValue:0}:null}function PO(n,e){return n instanceof xr&&e instanceof xr||n instanceof kr&&e instanceof kr?Dr(n.elements,e.elements,Ft):n instanceof qi&&e instanceof qi?Ft(n.operand,e.operand):n instanceof Ui&&e instanceof Ui}function uE(n,e){let t=hE(e);for(let r of n.elements)t.some(i=>Ft(i,r))||t.push(r);return{arrayValue:{values:t}}}function dE(n,e){let t=hE(e);for(let r of n.elements)t=t.filter(i=>!Ft(i,r));return{arrayValue:{values:t}}}function MO(n,e){let t=cE(n,e),r=ZS(t)+ZS(n.operand);return Gh(t)&&Gh(n.operand)?lE(r):wp(n.serializer,r)}function ZS(n){return ve(n.integerValue||n.doubleValue)}function hE(n){return Tp(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function LO(n,e){return n.field.isEqual(e.field)&&PO(n.transform,e.transform)}function FO(n,e){return n===void 0&&e===void 0?!0:n&&e?Dr(n,e,(t,r)=>LO(t,r)):!1}function Jl(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists!==void 0?n.exists===e.isFoundDocument():!0}function fE(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new zi(n.key,pt.none()):new Pr(n.key,n.data,pt.none());{let t=n.data,r=ft.empty(),i=new Be(mt.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);a===null&&s.length>1&&(s=s.popLast(),a=t.field(s)),a===null?r.delete(s):r.set(s,a),i=i.add(s)}return new cn(n.key,r,new Ct(i.toArray()),pt.none())}}function BO(n,e,t){n instanceof Pr?qO(n,e,t):n instanceof cn?zO(n,e,t):jO(n,e,t)}function Bs(n,e,t,r){return n instanceof Pr?VO(n,e,t,r):n instanceof cn?GO(n,e,t,r):KO(n,e,t)}function UO(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=cE(r.transform,i||null);s!=null&&(t===null&&(t=ft.empty()),t.set(r.field,s))}return t||null}function eT(n,e){return n.type!==e.type||!n.key.isEqual(e.key)||!n.precondition.isEqual(e.precondition)||!FO(n.fieldTransforms,e.fieldTransforms)?!1:n.type===0?n.value.isEqual(e.value):n.type===1?n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask):!0}function qO(n,e,t){let r=n.value.clone(),i=mE(n.fieldTransforms,e,t.transformResults);r.setAll(i),e.convertToFoundDocument(t.version,r).setHasCommittedMutations()}function VO(n,e,t,r){if(!Jl(n.precondition,e))return t;let i=n.value.clone(),s=gE(n.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}function zO(n,e,t){if(!Jl(n.precondition,e)){e.convertToUnknownDocument(t.version);return}let r=mE(n.fieldTransforms,e,t.transformResults),i=e.data;i.setAll(pE(n)),i.setAll(r),e.convertToFoundDocument(t.version,i).setHasCommittedMutations()}function GO(n,e,t,r){if(!Jl(n.precondition,e))return t;let i=gE(n.fieldTransforms,r,e),s=e.data;return s.setAll(pE(n)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),t===null?null:t.unionWith(n.fieldMask.fields).unionWith(n.fieldTransforms.map(a=>a.field))}function pE(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function mE(n,e,t){let r=new Map;le(n.length===t.length,32656,{serverTransformResultCount:t.length,fieldTransformCount:n.length});for(let i=0;i<t.length;i++){let s=n[i],a=s.transform,o=e.data.field(s.field);r.set(s.field,kO(a,o,t[i]))}return r}function gE(n,e,t){let r=new Map;for(let i of n){let s=i.transform,a=t.data.field(i.field);r.set(i.field,xO(s,a,e))}return r}function jO(n,e,t){e.convertToNoDocument(t.version).setHasCommittedMutations()}function KO(n,e,t){return Jl(n.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):t}function WO(n){switch(n){case I.OK:return W(64938);case I.CANCELLED:case I.UNKNOWN:case I.DEADLINE_EXCEEDED:case I.RESOURCE_EXHAUSTED:case I.INTERNAL:case I.UNAVAILABLE:case I.UNAUTHENTICATED:return!1;case I.INVALID_ARGUMENT:case I.NOT_FOUND:case I.ALREADY_EXISTS:case I.PERMISSION_DENIED:case I.FAILED_PRECONDITION:case I.ABORTED:case I.OUT_OF_RANGE:case I.UNIMPLEMENTED:case I.DATA_LOSS:return!0;default:return W(15467,{code:n})}}function HO(n){return WO(n)&&n!==I.ABORTED}function ul(n){if(n===void 0)return Ut("GRPC error has no .code"),I.UNKNOWN;switch(n){case Fe.OK:return I.OK;case Fe.CANCELLED:return I.CANCELLED;case Fe.UNKNOWN:return I.UNKNOWN;case Fe.DEADLINE_EXCEEDED:return I.DEADLINE_EXCEEDED;case Fe.RESOURCE_EXHAUSTED:return I.RESOURCE_EXHAUSTED;case Fe.INTERNAL:return I.INTERNAL;case Fe.UNAVAILABLE:return I.UNAVAILABLE;case Fe.UNAUTHENTICATED:return I.UNAUTHENTICATED;case Fe.INVALID_ARGUMENT:return I.INVALID_ARGUMENT;case Fe.NOT_FOUND:return I.NOT_FOUND;case Fe.ALREADY_EXISTS:return I.ALREADY_EXISTS;case Fe.PERMISSION_DENIED:return I.PERMISSION_DENIED;case Fe.FAILED_PRECONDITION:return I.FAILED_PRECONDITION;case Fe.ABORTED:return I.ABORTED;case Fe.OUT_OF_RANGE:return I.OUT_OF_RANGE;case Fe.UNIMPLEMENTED:return I.UNIMPLEMENTED;case Fe.DATA_LOSS:return I.DATA_LOSS;default:return W(39323,{code:n})}}function yE(){return new qD}function tT(n){let e=yE().encode(n),t=new sc;return t.update(e),new Uint8Array(t.digest())}function nT(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0),a=new hn([t,r],0),o=new hn([i,s],0);return[a,o]}function al(){return new _e(j.comparator)}function rT(){return new _e(j.comparator)}function JO(n,e,t,r,i){let s={localCacheCount:n,existenceFilterCount:e.count,databaseId:t.database,projectId:t.projectId},a=e.unchangedNames;return a&&(s.bloomFilter={applied:i===0,hashCount:a?.hashCount??0,bitmapLength:a?.bits?.bitmap?.length??0,padding:a?.bits?.padding??0,mightContain:o=>r?.mightContain(o)??!1}),s}function tx(n){let e=n.code===void 0?I.UNKNOWN:ul(n.code);return new M(e,n.message||"")}function uf(n,e){return n.useProto3Json||Wl(e)?e:{value:e}}function nx(n){let e;return typeof n=="object"?e=n.value:e=n,Wl(e)?null:e}function bn(n,e){if(n.useProto3Json){let r=new Date(e.seconds*1e3).toISOString().replace(/\.\d*/,"").replace("Z",""),i=("000000000"+e.nanoseconds).slice(-9);return`${r}.${i}Z`}else return{seconds:""+e.seconds,nanos:e.nanoseconds}}function vE(n){let e=wn(n);return new Ee(e.seconds,e.nanos)}function SE(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function rx(n,e){return n.useProto3Json?(le(e===void 0||typeof e=="string",58123),$e.fromBase64String(e||"")):(le(e===void 0||e instanceof Buffer||e instanceof Uint8Array,16193),$e.fromUint8Array(e||new Uint8Array))}function ix(n,e){return bn(n,e.toTimestamp())}function ln(n){return le(!!n,49232),Q.fromTimestamp(vE(n))}function Cp(n,e){return df(n,e).canonicalString()}function df(n,e){let t=ax(n).child("documents");return e===void 0?t:t.child(e)}function TE(n){let e=ye.fromString(n);return le(IE(e),10190,{key:e.toString()}),e}function Ws(n,e){return Cp(n.databaseId,e.path)}function Ih(n,e){let t=TE(e);if(t.get(1)!==n.databaseId.projectId)throw new M(I.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new M(I.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new j(_E(t))}function EE(n,e){return Cp(n.databaseId,e)}function sx(n){let e=TE(n);return e.length===4?ye.emptyPath():_E(e)}function hf(n){return new ye(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function ax(n){return new ye(["projects",n.projectId,"databases",n.database])}function _E(n){return le(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function iT(n,e,t){return{name:Ws(n,e),fields:t.value.mapValue.fields}}function ox(n,e){let t;if("targetChange"in e){e.targetChange;let r=lx(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=rx(n,e.targetChange.resumeToken),a=e.targetChange.cause,o=a&&tx(a);t=new Tl(r,i,s,o||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Ih(n,r.document.name),s=ln(r.document.updateTime),a=r.document.createTime?ln(r.document.createTime):Q.min(),o=new ft({mapValue:{fields:r.document.fields}}),l=qt.newFoundDocument(i,s,a,o),c=r.targetIds||[],u=r.removedTargetIds||[];t=new xi(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Ih(n,r.document),s=r.readTime?ln(r.readTime):Q.min(),a=qt.newNoDocument(i,s),o=r.removedTargetIds||[];t=new xi([],o,a.key,a)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Ih(n,r.document),s=r.removedTargetIds||[];t=new xi([],s,i,null)}else if("filter"in e){e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,a=new af(i,s),o=r.targetId;t=new Sl(o,a)}else return W(11601,{change:e});return t}function lx(n){return n==="NO_CHANGE"?0:n==="ADD"?1:n==="REMOVE"?2:n==="CURRENT"?3:n==="RESET"?4:W(39313,{state:n})}function cx(n){if(!("targetChange"in n))return Q.min();let e=n.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?Q.min():ln(e.readTime)}function ux(n,e){let t;if(e instanceof Pr)t={update:iT(n,e.key,e.value)};else if(e instanceof zi)t={delete:Ws(n,e.key)};else if(e instanceof cn)t={update:iT(n,e.key,e.data),updateMask:Vx(e.fieldMask)};else if(e instanceof tf)t={verify:Ws(n,e.key)};else return W(16599,{mutationType:e.type});return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>px(n,r))),e.precondition.isNone||(t.currentDocument=dx(n,e.precondition)),t}function dx(n,e){return e.updateTime!==void 0?{updateTime:ix(n,e.updateTime)}:e.exists!==void 0?{exists:e.exists}:W(27497)}function hx(n,e){let t=n.updateTime?ln(n.updateTime):ln(e);return t.isEqual(Q.min())&&(t=ln(e)),new ef(t,n.transformResults||[])}function fx(n,e){return n&&n.length>0?(le(e!==void 0,14353),n.map(t=>hx(t,e))):[]}function px(n,e){let t=e.transform;if(t instanceof Ui)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof xr)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof kr)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof qi)return{fieldPath:e.field.canonicalString(),increment:t.operand};throw W(20930,{transform:e.transform})}function mx(n,e){return{documents:[EE(n,e.path)]}}function bE(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=EE(n,i);let s=Tx(e.filters);s&&(t.structuredQuery.where=s);let a=_x(e.orderBy);a&&(t.structuredQuery.orderBy=a);let o=uf(n,e.limit);return o!==null&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt=wx(e.startAt)),e.endAt&&(t.structuredQuery.endAt=Cx(e.endAt)),{queryTarget:t,parent:i}}function gx(n){let e=sx(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){le(r===1,65062);let u=t.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=Ex(t.where));let a=[];t.orderBy&&(a=bx(t.orderBy));let o=null;t.limit&&(o=nx(t.limit));let l=null;t.startAt&&(l=Ix(t.startAt));let c=null;return t.endAt&&(c=Ax(t.endAt)),hO(e,i,a,s,o,"F",l,c)}function yx(n,e){let t=vx(e.purpose);return t==null?null:{"goog-listen-tags":t}}function vx(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return W(28987,{purpose:n})}}function Sx(n,e){let t,r=e.target;if(Zh(r)?t={documents:mx(n,r)}:t={query:bE(n,r).queryTarget},t.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){t.resumeToken=SE(n,e.resumeToken);let i=uf(n,e.expectedCount);i!==null&&(t.expectedCount=i)}else if(e.snapshotVersion.compareTo(Q.min())>0){t.readTime=bn(n,e.snapshotVersion.toTimestamp());let i=uf(n,e.expectedCount);i!==null&&(t.expectedCount=i)}return t}function Tx(n){if(n.length!==0)return CE(Vt.create(n,"and"))}function Ex(n){let e=wE(n);return e instanceof Vt&&XT(e)?e.getFilters():[e]}function wE(n){return n.unaryFilter!==void 0?Bx(n):n.fieldFilter!==void 0?Ux(n):n.compositeFilter!==void 0?qx(n):W(30097,{filter:n})}function _x(n){if(n.length!==0)return n.map(e=>Px(e))}function bx(n){return n.map(e=>Mx(e))}function wx(n){return{before:n.inclusive,values:n.position}}function Cx(n){return{before:!n.inclusive,values:n.position}}function Ix(n){let e=!!n.before,t=n.values||[];return new Fi(t,e)}function Ax(n){let e=!n.before,t=n.values||[];return new Fi(t,e)}function Rx(n){return XO[n]}function Dx(n){switch(n){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function Nx(n){return ZO[n]}function Ox(n){return ex[n]}function xx(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return W(58110);default:return W(50506)}}function kx(n){switch(n){case"AND":return"and";case"OR":return"or";default:return W(1026)}}function Ri(n){return{fieldPath:n.canonicalString()}}function Ni(n){return mt.fromServerFormat(n.fieldPath)}function Px(n){return{field:Ri(n.field),direction:Rx(n.dir)}}function Mx(n){return new Or(Ni(n.field),Dx(n.direction))}function CE(n){return n instanceof De?Fx(n):n instanceof Vt?Lx(n):W(54877,{filter:n})}function Lx(n){let e=n.getFilters().map(t=>CE(t));return e.length===1?e[0]:{compositeFilter:{op:Ox(n.op),filters:e}}}function Fx(n){if(n.op==="=="){if(QS(n.value))return{unaryFilter:{field:Ri(n.field),op:"IS_NAN"}};if($S(n.value))return{unaryFilter:{field:Ri(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(QS(n.value))return{unaryFilter:{field:Ri(n.field),op:"IS_NOT_NAN"}};if($S(n.value))return{unaryFilter:{field:Ri(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ri(n.field),op:Nx(n.op),value:n.value}}}function Bx(n){switch(n.unaryFilter.op){case"IS_NAN":let e=Ni(n.unaryFilter.field);return De.create(e,"==",{doubleValue:NaN});case"IS_NULL":let t=Ni(n.unaryFilter.field);return De.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=Ni(n.unaryFilter.field);return De.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=Ni(n.unaryFilter.field);return De.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return W(61313);default:return W(60726)}}function Ux(n){return De.create(Ni(n.fieldFilter.field),xx(n.fieldFilter.op),n.fieldFilter.value)}function qx(n){return Vt.create(n.compositeFilter.filters.map(e=>wE(e)),kx(n.compositeFilter.op))}function Vx(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function IE(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}function zx(n){let e=gx({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?yl(e,e.limit,"L"):e}function Gx(n){return{name:n.name,query:zx(n.bundledQuery),readTime:ln(n.readTime)}}function jx(n){return{id:n.id,version:n.version,createTime:ln(n.createTime)}}function lT([n,e],[t,r]){let i=ne(n,t);return i===0?ne(e,r):i}function a1(n,e){return new vf(n,e)}function l1(){return new _e(j.comparator)}function c1(n){return new If(n)}function d1(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}function f1(n,e,t,r){return new Of(n,e,t,r)}function RE(n,e){return x(this,null,function*(){let t=$(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next(a=>(s=a,t.initializeUserComponents(e),t.mutationQueue.getAllMutationBatches(i))).next(a=>{let o=[],l=[],c=te();for(let u of s){o.push(u.batchId);for(let p of u.mutations)c=c.add(p.key)}for(let u of a){l.push(u.batchId);for(let p of u.mutations)c=c.add(p.key)}return t.localDocuments.getDocuments(i,c).next(u=>({affectedDocuments:u,removedBatchIds:o,addedBatchIds:l}))})})})}function p1(n,e){let t=$(n),r=Ee.now(),i=e.reduce((o,l)=>o.add(l.key),te()),s,a;return t.persistence.runTransaction("Locally write mutations","readwrite",o=>{let l=An(),c=te();return t.remoteDocuments.getEntries(o,i).next(u=>{l=u,l.forEach((p,g)=>{g.isValidDocument()||(c=c.add(p))})}).next(()=>t.localDocuments.getOverlayedDocuments(o,l)).next(u=>{s=u;let p=[];for(let g of e){let T=UO(g,s.get(g.key).overlayedDocument);T!=null&&p.push(new cn(g.key,T,QT(T.value.mapValue),pt.exists(!0)))}return t.mutationQueue.addMutationBatch(o,r,p,e)}).next(u=>{a=u;let p=u.applyToLocalDocumentSet(s,c);return t.documentOverlayCache.saveOverlays(o,u.batchId,p)})}).then(()=>({batchId:a.batchId,changes:aE(s)}))}function m1(n,e){let t=$(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});return C1(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,g1(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function g1(n){let e=te();for(let t=0;t<n.mutationResults.length;++t)n.mutationResults[t].transformResults.length>0&&(e=e.add(n.batch.mutations[t].key));return e}function y1(n,e){let t=$(n);return t.persistence.runTransaction("Reject batch","readwrite-primary",r=>{let i;return t.mutationQueue.lookupMutationBatch(r,e).next(s=>(le(s!==null,37113),i=s.keys(),t.mutationQueue.removeMutationBatch(r,s))).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,i)).next(()=>t.localDocuments.getDocuments(r,i))})}function DE(n){let e=$(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.targetCache.getLastRemoteSnapshotVersion(t))}function v1(n,e){let t=$(n),r=e.snapshotVersion,i=t.targetDataByTarget;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let a=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=t.targetDataByTarget;let o=[];e.targetChanges.forEach((u,p)=>{let g=i.get(p);if(!g)return;o.push(t.targetCache.removeMatchingKeys(s,u.removedDocuments,p).next(()=>t.targetCache.addMatchingKeys(s,u.addedDocuments,p)));let T=g.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(p)!==null?T=T.withResumeToken($e.EMPTY_BYTE_STRING,Q.min()).withLastLimboFreeSnapshotVersion(Q.min()):u.resumeToken.approximateByteSize()>0&&(T=T.withResumeToken(u.resumeToken,r)),i=i.insert(p,T),T1(g,T,u)&&o.push(t.targetCache.updateTargetData(s,T))});let l=An(),c=te();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&o.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),o.push(S1(s,a,e.documentUpdates).next(u=>{l=u.changedDocuments,c=u.existenceChangedKeys})),!r.isEqual(Q.min())){let u=t.targetCache.getLastRemoteSnapshotVersion(s).next(p=>t.targetCache.setTargetsMetadata(s,s.currentSequenceNumber,r));o.push(u)}return N.waitFor(o).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(t.targetDataByTarget=i,s))}function S1(n,e,t){let r=te(),i=te();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let a=An();return t.forEach((o,l)=>{let c=s.get(o);l.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(o)),l.isNoDocument()&&l.version.isEqual(Q.min())?(e.removeEntry(o,l.readTime),a=a.insert(o,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),a=a.insert(o,l)):V(Ip,"Ignoring outdated watch update for ",o,". Current version:",c.version," Watch version:",l.version)}),{changedDocuments:a,existenceChangedKeys:i}})}function T1(n,e,t){return n.resumeToken.approximateByteSize()===0||e.snapshotVersion.toMicroseconds()-n.snapshotVersion.toMicroseconds()>=h1?!0:t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size>0}function E1(n,e){return x(this,null,function*(){let t=$(n);try{yield t.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>N.forEach(e,i=>N.forEach(i.addedKeys,s=>t.persistence.referenceDelegate.addReference(r,i.targetId,s)).next(()=>N.forEach(i.removedKeys,s=>t.persistence.referenceDelegate.removeReference(r,i.targetId,s)))))}catch(r){if($i(r))V(Ip,"Failed to update sequence numbers: "+r);else throw r}for(let r of e){let i=r.targetId;if(!r.fromCache){let s=t.targetDataByTarget.get(i),a=s.snapshotVersion,o=s.withLastLimboFreeSnapshotVersion(a);t.targetDataByTarget=t.targetDataByTarget.insert(i,o)}}})}function _1(n,e){let t=$(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=gp),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function b1(n,e){let t=$(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.targetCache.getTargetData(r,e).next(s=>s?(i=s,N.resolve(i)):t.targetCache.allocateTargetId(r).next(a=>(i=new Hs(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.targetCache.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.targetDataByTarget.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.targetDataByTarget=t.targetDataByTarget.insert(r.targetId,r),t.targetIdByTarget.set(e,r.targetId)),r})}function w1(n,e,t){let r=$(n),i=r.targetIdByTarget.get(t);return i!==void 0?N.resolve(r.targetDataByTarget.get(i)):r.targetCache.getTargetData(e,t)}function xf(n,e,t){return x(this,null,function*(){let r=$(n),i=r.targetDataByTarget.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,a=>r.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if($i(a))V(Ip,`Failed to update sequence numbers for target ${e}: ${a}`);else throw a}r.targetDataByTarget=r.targetDataByTarget.remove(e),r.targetIdByTarget.delete(i.target)})}function NE(n,e,t){let r=$(n),i=Q.min(),s=te();return r.persistence.runTransaction("Execute query","readwrite",a=>w1(r,a,Bt(e)).next(o=>{if(o)return i=o.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(a,o.targetId).next(l=>{s=l})}).next(()=>r.queryEngine.getDocumentsMatchingQuery(a,e,t?i:Q.min(),t?s:te())).next(o=>(I1(r,_O(e),o),{documents:o,remoteKeys:s})))}function C1(n,e,t,r){let i=t.batch,s=i.keys(),a=N.resolve();return s.forEach(o=>{a=a.next(()=>r.getEntry(e,o)).next(l=>{let c=t.docVersions.get(o);le(c!==null,48541),l.version.compareTo(c)<0&&(i.applyToRemoteDocument(l,t),l.isValidDocument()&&(l.setReadTime(t.commitVersion),r.addEntry(l)))})}),a.next(()=>n.mutationQueue.removeMutationBatch(e,i))}function I1(n,e,t){let r=n.collectionGroupReadTime.get(e)||Q.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.collectionGroupReadTime.set(e,r)}function R1(){return tm()?8:iN(em())>0?6:4}function D1(){return 268435456+Math.round(2147483648*Math.random())}function Dh(){return ol===null?ol=D1():ol++,"0x"+ol.toString(16)}function N1(n){return new Promise((e,t)=>{n((r,i)=>{r?t(r):e(i)})})}function Nh(n,e,t,r){le(e===null||e.type==="OAuth",36936);let i=new Ar.Metadata;return e&&e.headers.forEach((s,a)=>i.set(a,s)),t&&t.headers.forEach((s,a)=>i.set(a,s)),r&&i.set("X-Firebase-GMPID",r),i.set("X-Goog-Api-Client",x1),i.set("Google-Cloud-Resource-Prefix",n),i.set("x-goog-request-params",n),i}function L1(){let n=bT.fromJSON(P1,M1);return Ar.loadPackageDefinition(n)}function F1(n){let e=L1();return new Bf(e,n)}function B1(){return new Lf}function Zl(n){return new _l(n,!1)}function K1(n,e,t,r){return new zf(n,e,t,r)}function W1(n,e,t){let r=$(n);return r.verifyInitialized(),new qf(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}function H1(n,e,t){let r=$(n);return r.verifyInitialized(),new Uf(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}function Y1(n,e,t,r,i){return new jf(n,e,t,r,i)}function ec(n){return x(this,null,function*(){if(qr(n))for(let e of n.onNetworkStatusChange)yield e(!0)})}function ra(n){return x(this,null,function*(){for(let e of n.onNetworkStatusChange)yield e(!1)})}function J1(n){return x(this,null,function*(){let e=$(n);V(Mr,"RemoteStore shutting down."),e.offlineCauses.add(5),yield ra(e),e.connectivityMonitor.shutdown(),e.onlineStateTracker.set("Unknown")})}function xE(n,e){let t=$(n);t.listenTargets.has(e.targetId)||(t.listenTargets.set(e.targetId,e),Np(t)?Dp(t):Qi(t).isOpen()&&Rp(t,e))}function Ap(n,e){let t=$(n),r=Qi(t);t.listenTargets.delete(e),r.isOpen()&&kE(t,e),t.listenTargets.size===0&&(r.isOpen()?r.markIdle():qr(t)&&t.onlineStateTracker.set("Unknown"))}function Rp(n,e){if(n.watchChangeAggregator.recordPendingTargetRequest(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Q.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Qi(n).watch(e)}function kE(n,e){n.watchChangeAggregator.recordPendingTargetRequest(e),Qi(n).unwatch(e)}function Dp(n){n.watchChangeAggregator=new cf({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),getTargetDataForTarget:e=>n.listenTargets.get(e)||null,getDatabaseId:()=>n.datastore.serializer.databaseId}),Qi(n).start(),n.onlineStateTracker.handleWatchStreamStart()}function Np(n){return qr(n)&&!Qi(n).isStarted()&&n.listenTargets.size>0}function qr(n){return $(n).offlineCauses.size===0}function PE(n){n.watchChangeAggregator=void 0}function X1(n){return x(this,null,function*(){n.onlineStateTracker.set("Online")})}function Z1(n){return x(this,null,function*(){n.listenTargets.forEach((e,t)=>{Rp(n,e)})})}function ek(n,e){return x(this,null,function*(){PE(n),Np(n)?(n.onlineStateTracker.handleWatchStreamFailure(e),Dp(n)):n.onlineStateTracker.set("Unknown")})}function tk(n,e,t){return x(this,null,function*(){if(n.onlineStateTracker.set("Online"),e instanceof Tl&&e.state===2&&e.cause){try{yield rk(n,e)}catch(r){V(Mr,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Dl(n,r)}return}if(e instanceof xi?n.watchChangeAggregator.handleDocumentChange(e):e instanceof Sl?n.watchChangeAggregator.handleExistenceFilter(e):n.watchChangeAggregator.handleTargetChange(e),!t.isEqual(Q.min()))try{let r=yield DE(n.localStore);t.compareTo(r)>=0&&(yield nk(n,t))}catch(r){V(Mr,"Failed to raise snapshot:",r),yield Dl(n,r)}})}function Dl(n,e,t){return x(this,null,function*(){if($i(e))n.offlineCauses.add(1),yield ra(n),n.onlineStateTracker.set("Offline"),t||(t=()=>DE(n.localStore)),n.asyncQueue.enqueueRetryable(()=>x(null,null,function*(){V(Mr,"Retrying IndexedDB access"),yield t(),n.offlineCauses.delete(1),yield ec(n)}));else throw e})}function ME(n,e){return e().catch(t=>Dl(n,t,e))}function nk(n,e){let t=n.watchChangeAggregator.createRemoteEvent(e);return t.targetChanges.forEach((r,i)=>{if(r.resumeToken.approximateByteSize()>0){let s=n.listenTargets.get(i);s&&n.listenTargets.set(i,s.withResumeToken(r.resumeToken,e))}}),t.targetMismatches.forEach((r,i)=>{let s=n.listenTargets.get(r);if(!s)return;n.listenTargets.set(r,s.withResumeToken($e.EMPTY_BYTE_STRING,s.snapshotVersion)),kE(n,r);let a=new Hs(s.target,r,i,s.sequenceNumber);Rp(n,a)}),n.remoteSyncer.applyRemoteEvent(t)}function rk(n,e){return x(this,null,function*(){let t=e.cause;for(let r of e.targetIds)n.listenTargets.has(r)&&(yield n.remoteSyncer.rejectListen(r,t),n.listenTargets.delete(r),n.watchChangeAggregator.removeTarget(r))})}function tc(n){return x(this,null,function*(){let e=$(n),t=cr(e),r=e.writePipeline.length>0?e.writePipeline[e.writePipeline.length-1].batchId:gp;for(;ik(e);)try{let i=yield _1(e.localStore,r);if(i===null){e.writePipeline.length===0&&t.markIdle();break}else r=i.batchId,sk(e,i)}catch(i){yield Dl(e,i)}LE(e)&&FE(e)})}function ik(n){return qr(n)&&n.writePipeline.length<Q1}function sk(n,e){n.writePipeline.push(e);let t=cr(n);t.isOpen()&&t.handshakeComplete&&t.writeMutations(e.mutations)}function LE(n){return qr(n)&&!cr(n).isStarted()&&n.writePipeline.length>0}function FE(n){cr(n).start()}function ak(n){return x(this,null,function*(){cr(n).writeHandshake()})}function ok(n){return x(this,null,function*(){let e=cr(n);for(let t of n.writePipeline)e.writeMutations(t.mutations)})}function lk(n,e,t){return x(this,null,function*(){let r=n.writePipeline.shift(),i=rf.from(r,e,t);yield ME(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield tc(n)})}function ck(n,e){return x(this,null,function*(){e&&cr(n).handshakeComplete&&(yield uk(n,e)),LE(n)&&FE(n)})}function uk(n,e){return x(this,null,function*(){if(HO(e.code)){let t=n.writePipeline.shift();cr(n).inhibitBackoff(),yield ME(n,()=>n.remoteSyncer.rejectFailedWrite(t.batchId,e)),yield tc(n)}})}function dk(n){return x(this,null,function*(){let e=$(n);e.offlineCauses.add(4),yield ra(e),e.onlineStateTracker.set("Unknown"),e.offlineCauses.delete(4),yield ec(e)})}function hT(n,e){return x(this,null,function*(){let t=$(n);t.asyncQueue.verifyOperationInProgress(),V(Mr,"RemoteStore received new credentials");let r=qr(t);t.offlineCauses.add(3),yield ra(t),r&&t.onlineStateTracker.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.offlineCauses.delete(3),yield ec(t)})}function hk(n,e){return x(this,null,function*(){let t=$(n);e?(t.offlineCauses.delete(2),yield ec(t)):e||(t.offlineCauses.add(2),yield ra(t),t.onlineStateTracker.set("Unknown"))})}function Qi(n){return n.watchStream||(n.watchStream=H1(n.datastore,n.asyncQueue,{onConnected:X1.bind(null,n),onOpen:Z1.bind(null,n),onClose:ek.bind(null,n),onWatchChange:tk.bind(null,n)}),n.onNetworkStatusChange.push(e=>x(null,null,function*(){e?(n.watchStream.inhibitBackoff(),Np(n)?Dp(n):n.onlineStateTracker.set("Unknown")):(yield n.watchStream.stop(),PE(n))}))),n.watchStream}function cr(n){return n.writeStream||(n.writeStream=W1(n.datastore,n.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:ak.bind(null,n),onClose:ck.bind(null,n),onHandshakeComplete:ok.bind(null,n),onMutationResult:lk.bind(null,n)}),n.onNetworkStatusChange.push(e=>x(null,null,function*(){e?(n.writeStream.inhibitBackoff(),yield tc(n)):(yield n.writeStream.stop(),n.writePipeline.length>0&&(V(Mr,`Stopping write stream with ${n.writePipeline.length} pending writes`),n.writePipeline=[]))}))),n.writeStream}function Op(n,e){if(Ut(fk,`${e}: ${n}`),$i(n))return new M(I.UNAVAILABLE,`${e}: ${n}`);throw n}function pk(){return new Hf}function BE(){return new In(n=>rE(n),Ql)}function xp(n,e){return x(this,null,function*(){let t=$(n),r=3,i=e.query,s=t.queries.get(i);s?!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(r=2):(s=new Wf,r=e.listensToRemoteStore()?0:1);try{switch(r){case 0:s.viewSnap=yield t.onListen(i,!0);break;case 1:s.viewSnap=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i);break;default:break}}catch(a){let o=Op(a,`Initialization of query '${Ai(e.query)}' failed`);e.onError(o);return}t.queries.set(i,s),s.listeners.push(e),e.applyOnlineStateChange(t.onlineState),s.viewSnap&&e.onViewSnapshot(s.viewSnap)&&Pp(t)})}function kp(n,e){return x(this,null,function*(){let t=$(n),r=e.query,i=3,s=t.queries.get(r);if(s){let a=s.listeners.indexOf(e);a>=0&&(s.listeners.splice(a,1),s.listeners.length===0?i=e.listensToRemoteStore()?0:1:!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function mk(n,e){let t=$(n),r=!1;for(let i of e){let s=i.query,a=t.queries.get(s);if(a){for(let o of a.listeners)o.onViewSnapshot(i)&&(r=!0);a.viewSnap=i}}r&&Pp(t)}function gk(n,e,t){let r=$(n),i=r.queries.get(e);if(i)for(let s of i.listeners)s.onError(t);r.queries.delete(e)}function yk(n,e){let t=$(n);t.onlineState=e;let r=!1;t.queries.forEach((i,s)=>{for(let a of s.listeners)a.applyOnlineStateChange(e)&&(r=!0)}),r&&Pp(t)}function vk(n,e){let t=$(n),r=t.queries;t.queries=BE(),r.forEach((i,s)=>{for(let a of s.listeners)a.onError(e)})}function Pp(n){n.snapshotsInSyncListeners.forEach(e=>{e.next()})}function Sk(n,e){let t=r=>{switch(r){case 0:return 1;case 2:return 2;case 3:return 2;case 1:return 0;default:return W(20277,{change:r})}};return t(n)-t(e)}function Tk(n,e,t,r,i,s,a){let o=new Xf(n,e,t,r,i,s);return a&&(o._isPrimaryClient=!0),o}function Ek(n,e,t=!0){return x(this,null,function*(){let r=WE(n),i,s=r.queryViewsByQuery.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.computeInitialSnapshot()):i=yield qE(r,e,t,!0),i})}function _k(n,e){return x(this,null,function*(){let t=WE(n);yield qE(t,e,!0,!1)})}function qE(n,e,t,r){return x(this,null,function*(){let i=yield b1(n.localStore,Bt(e)),s=i.targetId,a=n.sharedClientState.addLocalQueryTarget(s,t),o;return r&&(o=yield bk(n,e,s,a==="current",i.resumeToken)),n.isPrimaryClient&&t&&xE(n.remoteStore,i),o})}function bk(n,e,t,r,i){return x(this,null,function*(){n.applyDocChanges=(p,g,T)=>kk(n,p,g,T);let s=yield NE(n.localStore,e,!0),a=new Qf(e,s.remoteKeys),o=a.computeDocChanges(s.documents),l=Ks.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=a.applyChanges(o,n.isPrimaryClient,l);KE(n,t,c.limboChanges);let u=new Yf(e,t,a);return n.queryViewsByQuery.set(e,u),n.queriesByTarget.has(t)?n.queriesByTarget.get(t).push(e):n.queriesByTarget.set(t,[e]),c.snapshot})}function wk(n,e,t){return x(this,null,function*(){let r=$(n),i=r.queryViewsByQuery.get(e),s=r.queriesByTarget.get(i.targetId);if(s.length>1){r.queriesByTarget.set(i.targetId,s.filter(a=>!Ql(a,e))),r.queryViewsByQuery.delete(e);return}r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield xf(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Ap(r.remoteStore,i.targetId),Zf(r,i.targetId)}).catch(Hi))):(Zf(r,i.targetId),yield xf(r.localStore,i.targetId,!0))})}function Ck(n,e){return x(this,null,function*(){let t=$(n),r=t.queryViewsByQuery.get(e),i=t.queriesByTarget.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Ap(t.remoteStore,r.targetId))})}function Ik(n,e,t){return x(this,null,function*(){let r=Lk(n);try{let i=yield p1(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),Ok(r,i.batchId,t),yield ia(r,i.changes),yield tc(r.remoteStore)}catch(i){let s=Op(i,"Failed to persist write");t.reject(s)}})}function VE(n,e){return x(this,null,function*(){let t=$(n);try{let r=yield v1(t.localStore,e);e.targetChanges.forEach((i,s)=>{let a=t.activeLimboResolutionsByTarget.get(s);a&&(le(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.receivedDocument=!0:i.modifiedDocuments.size>0?le(a.receivedDocument,14607):i.removedDocuments.size>0&&(le(a.receivedDocument,42227),a.receivedDocument=!1))}),yield ia(t,r,e)}catch(r){yield Hi(r)}})}function fT(n,e,t){let r=$(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.queryViewsByQuery.forEach((s,a)=>{let o=a.view.applyOnlineStateChange(e);o.snapshot&&i.push(o.snapshot)}),yk(r.eventManager,e),i.length&&r.syncEngineListener.onWatchChange(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Ak(n,e,t){return x(this,null,function*(){let r=$(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.activeLimboResolutionsByTarget.get(e),s=i&&i.key;if(s){let a=new _e(j.comparator);a=a.insert(s,qt.newNoDocument(s,Q.min()));let o=te().add(s),l=new vl(Q.min(),new Map,new _e(ne),a,o);yield VE(r,l),r.activeLimboTargetsByKey=r.activeLimboTargetsByKey.remove(s),r.activeLimboResolutionsByTarget.delete(e),Lp(r)}else yield xf(r.localStore,e,!1).then(()=>Zf(r,e,t)).catch(Hi)})}function Rk(n,e){return x(this,null,function*(){let t=$(n),r=e.batch.batchId;try{let i=yield m1(t.localStore,e);GE(t,r,null),zE(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield ia(t,i)}catch(i){yield Hi(i)}})}function Dk(n,e,t){return x(this,null,function*(){let r=$(n);try{let i=yield y1(r.localStore,e);GE(r,e,t),zE(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield ia(r,i)}catch(i){yield Hi(i)}})}function zE(n,e){(n.pendingWritesCallbacks.get(e)||[]).forEach(t=>{t.resolve()}),n.pendingWritesCallbacks.delete(e)}function Nk(n,e){n.pendingWritesCallbacks.forEach(t=>{t.forEach(r=>{r.reject(new M(I.CANCELLED,e))})}),n.pendingWritesCallbacks.clear()}function Ok(n,e,t){let r=n.mutationUserCallbacks[n.currentUser.toKey()];r||(r=new _e(ne)),r=r.insert(e,t),n.mutationUserCallbacks[n.currentUser.toKey()]=r}function GE(n,e,t){let r=$(n),i=r.mutationUserCallbacks[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.mutationUserCallbacks[r.currentUser.toKey()]=i}}function Zf(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.queriesByTarget.get(e))n.queryViewsByQuery.delete(r),t&&n.syncEngineListener.onWatchError(r,t);n.queriesByTarget.delete(e),n.isPrimaryClient&&n.limboDocumentRefs.removeReferencesForId(e).forEach(i=>{n.limboDocumentRefs.containsKey(i)||jE(n,i)})}function jE(n,e){n.enqueuedLimboResolutions.delete(e.path.canonicalString());let t=n.activeLimboTargetsByKey.get(e);t!==null&&(Ap(n.remoteStore,t),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(e),n.activeLimboResolutionsByTarget.delete(t),Lp(n))}function KE(n,e,t){for(let r of t)r instanceof xl?(n.limboDocumentRefs.addReference(r.key,e),xk(n,r)):r instanceof kl?(V(Mp,"Document no longer in limbo: "+r.key),n.limboDocumentRefs.removeReference(r.key,e),n.limboDocumentRefs.containsKey(r.key)||jE(n,r.key)):W(19791,{limboChange:r})}function xk(n,e){let t=e.key,r=t.path.canonicalString();!n.activeLimboTargetsByKey.get(t)&&!n.enqueuedLimboResolutions.has(r)&&(V(Mp,"New document in limbo: "+t),n.enqueuedLimboResolutions.add(r),Lp(n))}function Lp(n){for(;n.enqueuedLimboResolutions.size>0&&n.activeLimboTargetsByKey.size<n.maxConcurrentLimboResolutions;){let e=n.enqueuedLimboResolutions.values().next().value;n.enqueuedLimboResolutions.delete(e);let t=new j(ye.fromString(e)),r=n.limboTargetIdGenerator.next();n.activeLimboResolutionsByTarget.set(r,new Jf(t)),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.insert(t,r),xE(n.remoteStore,new Hs(Bt($l(t.path)),r,"TargetPurposeLimboResolution",pp.INVALID))}}function ia(n,e,t){return x(this,null,function*(){let r=$(n),i=[],s=[],a=[];r.queryViewsByQuery.isEmpty()||(r.queryViewsByQuery.forEach((o,l)=>{a.push(r.applyDocChanges(l,e,t).then(c=>{if((c||t)&&r.isPrimaryClient){let u=c?!c.fromCache:t?.targetChanges.get(l.targetId)?.current;r.sharedClientState.updateQueryState(l.targetId,u?"current":"not-current")}if(c){i.push(c);let u=$f.fromSnapshot(l.targetId,c);s.push(u)}}))}),yield Promise.all(a),r.syncEngineListener.onWatchChange(i),yield E1(r.localStore,s))})}function kk(n,e,t,r){return x(this,null,function*(){let i=e.view.computeDocChanges(t);i.needsRefill&&(i=yield NE(n.localStore,e.query,!1).then(({documents:l})=>e.view.computeDocChanges(l,i)));let s=r&&r.targetChanges.get(e.targetId),a=r&&r.targetMismatches.get(e.targetId)!=null,o=e.view.applyChanges(i,n.isPrimaryClient,s,a);return KE(n,e.targetId,o.limboChanges),o.snapshot})}function Pk(n,e){return x(this,null,function*(){let t=$(n);if(!t.currentUser.isEqual(e)){V(Mp,"User change. New user:",e.toKey());let i=yield RE(t.localStore,e);t.currentUser=e,Nk(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield ia(t,i.affectedDocuments)}})}function Mk(n,e){let t=$(n),r=t.activeLimboResolutionsByTarget.get(e);if(r&&r.receivedDocument)return te().add(r.key);{let i=te(),s=t.queriesByTarget.get(e);if(!s)return i;for(let a of s){let o=t.queryViewsByQuery.get(a);i=i.unionWith(o.view.syncedDocuments)}return i}}function WE(n){let e=$(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=VE.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Mk.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Ak.bind(null,e),e.syncEngineListener.onWatchChange=mk.bind(null,e.eventManager),e.syncEngineListener.onWatchError=gk.bind(null,e.eventManager),e}function Lk(n){let e=$(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Rk.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Dk.bind(null,e),e}function Oh(n,e){return x(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),V(ir,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>x(null,null,function*(){r.isEqual(i)||(yield RE(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function pT(n,e){return x(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield Gk(n);V(ir,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>hT(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>hT(e.remoteStore,i)),n._onlineComponents=e})}function zk(n){return n.name==="FirebaseError"?n.code===I.FAILED_PRECONDITION||n.code===I.UNIMPLEMENTED:typeof DOMException<"u"&&n instanceof DOMException?n.code===Vk||n.code===qk||n.code===Uk:!0}function Gk(n){return x(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){V(ir,"Using user provided OfflineComponentProvider");try{yield Oh(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!zk(t))throw t;Oi("Error using user provided cache. Falling back to memory cache: "+t),yield Oh(n,new HE)}}else V(ir,"Using default OfflineComponentProvider"),yield Oh(n,new ep(void 0));return n._offlineComponents})}function $E(n){return x(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(V(ir,"Using user provided OnlineComponentProvider"),yield pT(n,n._uninitializedComponentsProvider._online)):(V(ir,"Using default OnlineComponentProvider"),yield pT(n,new Fk))),n._onlineComponents})}function jk(n){return $E(n).then(e=>e.syncEngine)}function Pl(n){return x(this,null,function*(){let e=yield $E(n),t=e.eventManager;return t.onListen=Ek.bind(null,e.syncEngine),t.onUnlisten=wk.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=_k.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Ck.bind(null,e.syncEngine),t})}function Kk(n,e,t,r){let i=new Js(r),s=new Ys(e,i,t);return n.asyncQueue.enqueueAndForget(()=>x(null,null,function*(){let a=yield Pl(n);return xp(a,s)})),()=>{i.mute(),n.asyncQueue.enqueueAndForget(()=>x(null,null,function*(){let a=yield Pl(n);return kp(a,s)}))}}function Wk(n,e,t={}){let r=new At;return n.asyncQueue.enqueueAndForget(()=>x(null,null,function*(){let i=yield Pl(n);return Qk(i,n.asyncQueue,e,t,r)})),r.promise}function Hk(n,e,t={}){let r=new At;return n.asyncQueue.enqueueAndForget(()=>x(null,null,function*(){let i=yield Pl(n);return Yk(i,n.asyncQueue,e,t,r)})),r.promise}function $k(n,e){let t=new At;return n.asyncQueue.enqueueAndForget(()=>x(null,null,function*(){let r=yield jk(n);return Ik(r,e,t)})),t.promise}function Qk(n,e,t,r,i){let s=new Js({next:o=>{s.mute(),e.enqueueAndForget(()=>kp(n,a));let l=o.docs.has(t);!l&&o.fromCache?i.reject(new M(I.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&o.fromCache&&r&&r.source==="server"?i.reject(new M(I.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:o=>i.reject(o)}),a=new Ys($l(t.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return xp(n,a)}function Yk(n,e,t,r,i){let s=new Js({next:o=>{s.mute(),e.enqueueAndForget(()=>kp(n,a)),o.fromCache&&r.source==="server"?i.reject(new M(I.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(o)},error:o=>i.reject(o)}),a=new Ys(t,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return xp(n,a)}function Jk(n,e){return n.timeoutSeconds===e.timeoutSeconds}function QE(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}function Zk(n){let e=mT.get(n);e&&(V(Xk,"Removing Datastore"),mT.delete(n),e.terminate())}function eP(n,e,t,r){return new Vh(n,e,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,QE(r.experimentalLongPollingOptions),r.useFetchStreams,r.isUsingEmulator)}function nP(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new M(I.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<yT)throw new M(I.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is ${yT})`);if(n.timeoutSeconds>vT)throw new M(I.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is ${vT})`)}}function rP(n,e,t,r={}){n=nt(n,ji);let i=Yp(e),s=n._getSettings(),a=Ze(ee({},s),{emulatorOptions:n._getEmulatorOptions()}),o=`${e}:${t}`;i&&(Jp(`https://${o}`),Zp("Firestore",!0)),s.host!==YE&&s.host!==o&&Oi("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l=Ze(ee({},s),{host:o,ssl:i,emulatorOptions:r});if(!rm(l,a)&&(n._setSettings(l),r.mockUserToken)){let c,u;if(typeof r.mockUserToken=="string")c=r.mockUserToken,u=Ue.MOCK_USER;else{c=Xp(r.mockUserToken,n._app?.options.projectId);let p=r.mockUserToken.sub||r.mockUserToken.user_id;if(!p)throw new M(I.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new Ue(p)}n._authCredentials=new Ph(new dl(c,u))}}function v2(n,e,...t){if(n=ot(n),CT("collection","path",e),n instanceof ji){let r=ye.fromString(e,...t);return VS(r),new tr(n,null,r)}else{if(!(n instanceof Oe)&&!(n instanceof tr))throw new M(I.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ye.fromString(e,...t));return VS(r),new tr(n.firestore,null,r)}}function iP(n,e,...t){if(n=ot(n),arguments.length===1&&(e=ki.newId()),CT("doc","path",e),n instanceof ji){let r=ye.fromString(e,...t);return qS(r),new Oe(n,null,new j(r))}else{if(!(n instanceof Oe)&&!(n instanceof tr))throw new M(I.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ye.fromString(e,...t));return qS(r),new Oe(n.firestore,n instanceof tr?n.converter:null,new j(r))}}function ST(n){let e=n.message||"";return n.stack&&(n.stack.includes(n.message)?e=n.stack:e=n.message+`
`+n.stack),e}function JE(n,e){let t=typeof n=="object"?n:dm(),r=typeof n=="string"?n:e||zh,i=om(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=Qp("firestore");s&&rP(i,...s)}return i}function sa(n){if(n._terminated)throw new M(I.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||aP(n),n._firestoreClient}function aP(n){let e=n._freezeSettings(),t=eP(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new tp(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&oP(n._componentsProvider))}function oP(n){let e=n?._online.build();return{_offline:n?._offline.build(e),_online:e}}function lP(n,e=!0){jD(cm),am(new im("firestore",(t,{instanceIdentifier:r,options:i})=>{let s=t.getProvider("app").getImmediate(),a=new Rt(new Mh(t.getProvider("auth-internal")),new Bh(s,t.getProvider("app-check-internal")),ON(s,r),s);return i=ee({useFetchStreams:e},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Yi(FS,BS,n),Yi(FS,BS,"esm2020")}function XE(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw W(40011,{dataSource:n})}}function aa(n){let e=n._freezeSettings(),t=Zl(n._databaseId);return new Bl(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Fp(n,e,t,r,i,s={}){let a=n.createContext(s.merge||s.mergeFields?2:0,e,t,i);Up("Data must be an object, but it was:",a,r);let o=Bp(r,a),l,c;if(s.merge)l=new Ct(a.fieldMask),c=a.fieldTransforms;else if(s.mergeFields){let u=[];for(let p of s.mergeFields){let g=ip(e,p,t);if(!a.contains(g))throw new M(I.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);n_(u,g)||u.push(g)}l=new Ct(u),c=a.fieldTransforms.filter(p=>l.covers(p.field))}else l=null,c=a.fieldTransforms;return new np(new ft(o),l,c)}function ZE(n,e,t,r){let i=n.createContext(1,e,t);Up("Data must be an object, but it was:",i,r);let s=[],a=ft.empty();lr(r,(l,c)=>{let u=qp(e,l,t);c=ot(c);let p=i.childContextForFieldPath(u);if(c instanceof Ul)s.push(u);else{let g=oa(c,p);g!=null&&(s.push(u),a.set(u,g))}});let o=new Ct(s);return new Fl(a,o,i.fieldTransforms)}function e_(n,e,t,r,i,s){let a=n.createContext(1,e,t),o=[ip(e,r,t)],l=[i];if(s.length%2!==0)throw new M(I.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<s.length;g+=2)o.push(ip(e,s[g])),l.push(s[g+1]);let c=[],u=ft.empty();for(let g=o.length-1;g>=0;--g)if(!n_(c,o[g])){let T=o[g],_=l[g];_=ot(_);let w=a.childContextForFieldPath(T);if(_ instanceof Ul)c.push(T);else{let b=oa(_,w);b!=null&&(c.push(T),u.set(T,b))}}let p=new Ct(c);return new Fl(u,p,a.fieldTransforms)}function uP(n,e,t,r=!1){let i=n.createContext(r?4:3,e);return oa(t,i)}function oa(n,e){if(n=ot(n),t_(n))return Up("Unsupported field value:",e,n),Bp(n,e);if(n instanceof Xs)return hP(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return dP(n,e)}else return fP(n,e)}function Bp(n,e){let t={};return qT(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):lr(n,(r,i)=>{let s=oa(i,e.childContextForField(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function dP(n,e){let t=[],r=0;for(let i of n){let s=oa(i,e.childContextForArray(r));s==null&&(s={nullValue:"NULL_VALUE"}),t.push(s),r++}return{arrayValue:{values:t}}}function hP(n,e){if(!XE(e.dataSource))throw e.createError(`${n._methodName}() can only be used with update() and set()`);if(!e.path)throw e.createError(`${n._methodName}() is not currently supported inside arrays`);let t=n._toFieldTransform(e);t&&e.fieldTransforms.push(t)}function fP(n,e){if(n=ot(n),n===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return OO(e.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let t=Ee.fromDate(n);return{timestampValue:bn(e.serializer,t)}}else if(n instanceof Ee){let t=new Ee(n.seconds,Math.floor(n.nanoseconds/1e3)*1e3);return{timestampValue:bn(e.serializer,t)}}else{if(n instanceof ar)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof sr)return{bytesValue:SE(e.serializer,n._byteString)};if(n instanceof Oe){let t=e.databaseId,r=n.firestore._databaseId;if(!r.isEqual(t))throw e.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${t.projectId}/${t.database}`);return{referenceValue:Cp(n.firestore._databaseId||e.databaseId,n._key.path)}}else{if(n instanceof or)return pP(n,e);throw e.createError(`Unsupported field value: ${jl(n)}`)}}}function pP(n,e){return{mapValue:{fields:{[yp]:{stringValue:vp},[Pi]:{arrayValue:{values:n.toArray().map(r=>{if(typeof r!="number")throw e.createError("VectorValues must only contain numeric values.");return wp(e.serializer,r)})}}}}}}function t_(n){return typeof n=="object"&&n!==null&&!(n instanceof Array)&&!(n instanceof Date)&&!(n instanceof Ee)&&!(n instanceof ar)&&!(n instanceof sr)&&!(n instanceof Oe)&&!(n instanceof Xs)&&!(n instanceof or)}function Up(n,e,t){if(!t_(t)||!IT(t)){let r=jl(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function ip(n,e,t){if(e=ot(e),e instanceof Lr)return e._internalPath;if(typeof e=="string")return qp(n,e);throw ql("Field path arguments must be of type string or ",n,!1,void 0,t)}function qp(n,e,t){if(e.search(mP)>=0)throw ql(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Lr(...e.split("."))._internalPath}catch{throw ql(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function ql(n,e,t,r,i){let s=r&&!r.isEmpty(),a=i!==void 0,o=`Function ${e}() called with invalid data`;t&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new M(I.INVALID_ARGUMENT,o+n+l)}function n_(n,e){return n.some(t=>t.isEqual(e))}function nc(n,e){return typeof e=="string"?qp(n,e):e instanceof Lr?e._internalPath:e._delegate._internalPath}function r_(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new M(I.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function S2(n,e,...t){let r=[];e instanceof Zs&&r.push(e),r=r.concat(t),EP(r);for(let i of r)n=i._apply(n);return n}function T2(n,e,t){let r=e,i=nc("where",n);return zl._create(i,r,t)}function E2(n,e="asc"){let t=e,r=nc("orderBy",n);return op._create(r,t)}function _2(n){return ZD("limit",n),lp._create("limit",n,"F")}function gP(n,e,t,r,i,s,a){let o;if(i.isKeyField()){if(s==="array-contains"||s==="array-contains-any")throw new M(I.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if(s==="in"||s==="not-in"){ET(a,s);let c=[];for(let u of a)c.push(TT(r,n,u));o={arrayValue:{values:c}}}else o=TT(r,n,a)}else(s==="in"||s==="not-in"||s==="array-contains-any")&&ET(a,s),o=uP(t,e,a,s==="in"||s==="not-in");return De.create(i,s,o)}function yP(n,e,t){if(n.startAt!==null)throw new M(I.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(n.endAt!==null)throw new M(I.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Or(e,t)}function TT(n,e,t){if(t=ot(t),typeof t=="string"){if(t==="")throw new M(I.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!nE(e)&&t.indexOf("/")!==-1)throw new M(I.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(ye.fromString(t));if(!j.isDocumentKey(r))throw new M(I.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return HS(n,new j(r))}else{if(t instanceof Oe)return HS(n,t._key);throw new M(I.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${jl(t)}.`)}}function ET(n,e){if(!Array.isArray(n)||n.length===0)throw new M(I.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function vP(n){switch(n){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function i_(n,e){let t=TP(n.filters,vP(e.op));if(t!==null)throw t===e.op?new M(I.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new M(I.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function SP(n,e){let t=n,r=e.getFlattenedFilters();for(let i of r)i_(t,i),t=bp(t,i)}function TP(n,e){for(let t of n)for(let r of t.getFlattenedFilters())if(e.indexOf(r.op)>=0)return r.op;return null}function EP(n){let e=n.filter(r=>r instanceof ap).length,t=n.filter(r=>r instanceof zl).length;if(e>1||e>0&&t>0)throw new M(I.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}function Vp(n,e,t){let r;return n?t&&(t.merge||t.mergeFields)?r=n.toFirestore(e,t):r=n.toFirestore(e):r=e,r}function _T(n){return _P(n,["next","error","complete"])}function _P(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}function ur(n){let e=JSON.stringify(n);return`${up.encode(e).byteLength}${e}`}function xP(n,e,t,r){let i=new Gl(n,ki.newId());return i.addBundleDocument(s_(r,t,e)),i.build()}function kP(n,e,t,r,i,s,a){let o=[];for(let u=0;u<s.length;u++)o.push(s_(i[u],a[u],s[u]));let l={name:t,query:e,parent:r,docBundleDataArray:o},c=new Gl(n,t);return c.addBundleQuery(l),c.build()}function s_(n,e,t){return{documentData:e,documentKey:t.mutableCopy().key,documentPath:n,documentExists:!0,createdTime:t.createTime.toTimestamp(),readTime:t.readTime.toTimestamp(),versionTime:t.version.toTimestamp()}}function PP(n,e){if(n._snapshot.oldDocs.isEmpty()){let t=0;return n._snapshot.docChanges.map(r=>{let i=new Ki(n._firestore,n._userDataWriter,r.doc.key,r.doc,new Fr(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter);return r.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}else{let t=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(r=>e||r.type!==3).map(r=>{let i=new Ki(n._firestore,n._userDataWriter,r.doc.key,r.doc,new Fr(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter),s=-1,a=-1;return r.type!==0&&(s=t.indexOf(r.doc.key),t=t.delete(r.doc.key)),r.type!==1&&(t=t.add(r.doc),a=t.indexOf(r.doc.key)),{type:MP(r.type),doc:i,oldIndex:s,newIndex:a}})}}function MP(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return W(61501,{type:n})}}function b2(n){n=nt(n,Oe);let e=nt(n.firestore,Rt),t=sa(e);return Wk(t,n._key).then(r=>a_(e,n,r))}function w2(n){n=nt(n,Rn);let e=nt(n.firestore,Rt),t=sa(e),r=new ta(e);return r_(n._query),Hk(t,n._query).then(i=>new Ur(e,r,n,i))}function C2(n,e,t){n=nt(n,Oe);let r=nt(n.firestore,Rt),i=Vp(n.converter,e,t),s=aa(r),o=Fp(s,"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,pt.none());return la(r,[o])}function I2(n,e,t,...r){n=nt(n,Oe);let i=nt(n.firestore,Rt),s=aa(i);e=ot(e);let a;typeof e=="string"||e instanceof Lr?a=e_(s,"updateDoc",n._key,e,t,r):a=ZE(s,"updateDoc",n._key,e);let o=a.toMutation(n._key,pt.exists(!0));return la(i,[o])}function A2(n){let e=nt(n.firestore,Rt),t=[new zi(n._key,pt.none())];return la(e,t)}function R2(n,e){let t=nt(n.firestore,Rt),r=iP(n),i=Vp(n.converter,e),s=aa(n.firestore),o=Fp(s,"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,pt.exists(!1));return la(t,[o]).then(()=>r)}function D2(n,...e){n=ot(n);let t={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]=="object"&&!_T(e[r])&&(t=e[r++]);let i={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(_T(e[r])){let c=e[r];e[r]=c.next?.bind(c),e[r+1]=c.error?.bind(c),e[r+2]=c.complete?.bind(c)}let s,a,o;if(n instanceof Oe)a=nt(n.firestore,Rt),o=$l(n._key.path),s={next:c=>{e[r]&&e[r](a_(a,n,c))},error:e[r+1],complete:e[r+2]};else{let c=nt(n,Rn);a=nt(c.firestore,Rt),o=c._query;let u=new ta(a);s={next:p=>{e[r]&&e[r](new Ur(a,u,c,p))},error:e[r+1],complete:e[r+2]},r_(n._query)}let l=sa(a);return Kk(l,o,i,s)}function la(n,e){let t=sa(n);return $k(t,e)}function a_(n,e,t){let r=t.docs.get(e._key),i=new ta(n);return new Br(n,i,e._key,r,new Fr(t.hasPendingWrites,t.fromCache),e.converter)}function xh(n,e){if(n=ot(n),n.firestore!==e)throw new M(I.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}function N2(n){return n=nt(n,Rt),sa(n),new dp(n,e=>la(n,e))}var Ar,bT,FS,BS,Ue,GD,Wi,Rr,I,M,At,dl,kh,Ph,Mh,Lh,Fh,hl,Bh,ki,$D,QD,US,fl,ye,YD,mt,j,zS,GS,Ee,Q,Us,Nr,rN,Uh,N,d2,h2,pp,ll,sN,aN,oN,uN,AT,RT,DT,NT,dN,OT,xT,kT,PT,MT,LT,FT,BT,hN,fN,pN,UT,mN,gN,yN,vN,SN,TN,EN,f2,_N,bN,wN,p2,_e,Di,Ls,qh,Be,pl,Ct,$e,DN,VT,zT,GT,jT,Vh,zh,ml,gp,yp,KT,sl,vp,Pi,m2,ft,qt,Fi,Or,gl,De,Vt,Kh,Wh,Hh,$h,Qh,Yh,Jh,Xh,rr,In,wO,sE,IO,RO,DO,Bi,Ui,xr,kr,qi,ef,pt,Vi,Pr,cn,zi,tf,nf,rf,sf,af,Fe,of,$O,QO,lf,Ir,vl,Ks,xi,Sl,Tl,El,YO,cf,XO,ZO,ex,_l,Hs,ff,Kx,Wx,Hx,Ah,$x,Qx,Yx,Jx,Xx,Zx,e1,t1,n1,r1,bl,pf,mf,g2,Rh,$s,sT,Xl,AE,It,aT,oT,i1,s1,gf,yf,vf,Sf,Tf,Ef,_f,bf,wf,Qs,Ae,Cf,o1,If,Af,Rf,u1,wl,Df,Nf,Cl,y2,Ip,h1,Of,kf,A1,Pf,Il,Mf,Lf,Ff,ol,O1,tt,x1,Bf,OE,k1,P1,M1,U1,q1,V1,z1,Al,cT,G1,j1,Rl,Uf,qf,Vf,zf,$1,uT,dT,Gf,Mr,Q1,jf,fk,Kf,Nl,Ol,Gi,Wf,Hf,UE,Ys,$f,xl,kl,Qf,Mp,Yf,Jf,Xf,HE,ep,Fk,Js,ir,Bk,Uk,qk,Vk,tp,Xk,mT,YE,gT,yT,vT,tP,Ml,ji,Rn,Oe,tr,sP,Ll,Rt,sr,Lr,Xs,ar,or,cP,np,Fl,rp,Bl,Ul,mP,Vl,sp,Zs,ea,zl,ap,op,lp,cp,up,bP,wP,CP,IP,AP,RP,DP,NP,OP,Gl,Fr,Br,Ki,Ur,ta,dp,o_=dr(()=>{"use strict";ic();T_();E_();S_();mm();Ar=Kp(LS(),1),bT=Kp(td(),1),FS="@firebase/firestore",BS="4.9.0";Ue=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Ue.UNAUTHENTICATED=new Ue(null);Ue.GOOGLE_CREDENTIALS=new Ue("google-credentials-uid");Ue.FIRST_PARTY=new Ue("first-party-uid");Ue.MOCK_USER=new Ue("mock-user");GD="12.0.0";Wi=GD;Rr=new sm("@firebase/firestore");I={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},M=class extends nm{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};At=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};dl=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},kh=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ue.UNAUTHENTICATED))}shutdown(){}},Ph=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Mh=class{constructor(e){this.authProvider=e,this.currentUser=Ue.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){le(this.tokenListener===void 0,42304);let r=this.tokenCounter,i=l=>this.tokenCounter!==r?(r=this.tokenCounter,t(l)):Promise.resolve(),s=new At;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),s.resolve(),s=new At,e.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let l=s;e.enqueueRetryable(()=>x(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},o=l=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),a())};this.authProvider.onInit(l=>o(l)),setTimeout(()=>{if(!this.auth){let l=this.authProvider.getImmediate({optional:!0});l?o(l):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new At)}},0),a()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.tokenCounter!==e?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(le(typeof r.accessToken=="string",31837,{tokenData:r}),new dl(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let e=this.auth&&this.auth.getUid();return le(e===null||typeof e=="string",2055,{currentUid:e}),new Ue(e)}},Lh=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=Ue.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}},Fh=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new Lh(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(Ue.FIRST_PARTY))}shutdown(){}invalidateToken(){}},hl=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Bh=class{constructor(e,t){this.appCheckProvider=t,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null,this.serverAppAppCheckToken=null,lm(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken)}start(e,t){le(this.tokenListener===void 0,3512);let r=s=>{s.error!=null&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let a=s.token!==this.latestAppCheckToken;return this.latestAppCheckToken=s.token,V("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.tokenListener=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.appCheckProvider.getImmediate({optional:!0});s?i(s):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.serverAppAppCheckToken)return Promise.resolve(new hl(this.serverAppAppCheckToken));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(le(typeof t.token=="string",44558,{tokenResult:t}),this.latestAppCheckToken=t.token,new hl(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}};ki=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",i=20;for(;r.length<i;){let s=HD(40);for(let a=0;a<s.length;++a)r.length<i&&s[a]<t&&(r+=e.charAt(s[a]%e.length))}return r}};$D=55296,QD=57343;US="__name__",fl=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&W(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&W(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=n.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return ne(e.length,t.length)}static compareSegments(e,t){let r=n.isNumericId(e),i=n.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?n.extractNumericId(e).compare(n.extractNumericId(t)):fp(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return hn.fromString(e.substring(4,e.length-2))}},ye=class n extends fl{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new M(I.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},YD=/^[_a-zA-Z][_a-zA-Z0-9]*$/,mt=class n extends fl{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return YD.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===US}static keyField(){return new n([US])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new M(I.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},a=!1;for(;i<e.length;){let o=e[i];if(o==="\\"){if(i+1===e.length)throw new M(I.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(!(l==="\\"||l==="."||l==="`"))throw new M(I.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else o==="`"?(a=!a,i++):o==="."&&!a?(s(),i++):(r+=o,i++)}if(s(),a)throw new M(I.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};j=class n{constructor(e){this.path=e}static fromPath(e){return new n(ye.fromString(e))}static fromName(e){return new n(ye.fromString(e).popFirst(5))}static empty(){return new n(ye.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ye.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ye.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2===0}static fromSegments(e){return new n(new ye(e.slice()))}};zS=-62135596800,GS=1e6,Ee=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-t*1e3)*GS);return new n(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new M(I.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new M(I.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<zS)throw new M(I.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new M(I.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return this.seconds*1e3+this.nanoseconds/GS}_compareTo(e){return this.seconds===e.seconds?ne(this.nanoseconds,e.nanoseconds):ne(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(na(e,n._jsonSchema))return new n(e.seconds,e.nanoseconds)}valueOf(){let e=this.seconds-zS,t=String(e).padStart(12,"0"),r=String(this.nanoseconds).padStart(9,"0");return t+"."+r}};Ee._jsonSchemaVersion="firestore/timestamp/1.0";Ee._jsonSchema={type:Re("string",Ee._jsonSchemaVersion),seconds:Re("number"),nanoseconds:Re("number")};Q=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new Ee(0,0))}static max(){return new n(new Ee(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return this.timestamp.seconds*1e6+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};Us=-1;Nr=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(Q.min(),j.empty(),Us)}static max(){return new n(Q.max(),j.empty(),Us)}};rN="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Uh=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};N=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&W(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,a=!1;e.forEach(o=>{++i,o.next(()=>{++s,a&&s===i&&t()},l=>r(l))}),a=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,a=new Array(s),o=0;for(let l=0;l<s;l++){let c=l;t(e[c]).next(u=>{a[c]=u,++o,o===s&&r(a)},u=>i(u))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};d2=15*1e3,h2=60*1e3;pp=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.setPreviousValue(i),this.writeNewSequenceNumber=i=>r.writeSequenceNumber(i))}setPreviousValue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t}}n.INVALID=-1;return n})(),ll="",sN="",aN="",oN="";uN="remoteDocuments";AT="owner",RT="mutationQueues",DT="mutations",NT="documentMutations",dN="remoteDocumentsV14",OT="remoteDocumentGlobal",xT="targets",kT="targetDocuments",PT="targetGlobal",MT="collectionParents",LT="clientMetadata",FT="bundles",BT="namedQueries",hN="indexConfiguration",fN="indexState",pN="indexEntries",UT="documentOverlays",mN="globals",gN=[RT,DT,NT,uN,xT,AT,PT,kT],yN=gN,vN=[...yN,LT],SN=[...vN,OT],TN=[...SN,MT],EN=[...TN,FT,BT],f2=[...EN,UT],_N=[RT,DT,NT,dN,xT,AT,PT,kT,LT,OT,MT,FT,BT,UT],bN=_N,wN=[...bN,hN,fN,pN],p2=[...wN,mN];_e=class n{constructor(e,t){this.comparator=e,this.root=t||Ls.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ls.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ls.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Di(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Di(this.root,e,this.comparator,!1)}getReverseIterator(){return new Di(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Di(this.root,e,this.comparator,!0)}},Di=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)this.isReverse?e=e.left:e=e.right;else if(s===0){this.nodeStack.push(e);break}else this.nodeStack.push(e),this.isReverse?e=e.right:e=e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Ls=(()=>{class n{constructor(t,r,i,s,a){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??n.EMPTY,this.right=a??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,r,i,s,a){return new n(t??this.key,r??this.value,i??this.color,s??this.left,a??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,a=i(t,s.key);return a<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):a===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return!t.left.isRed()&&!t.left.left.isRed()&&(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,r){let i,s=this;if(r(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed()&&!s.left.left.isRed()&&(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,r),null);else{if(s.left.isRed()&&(s=s.rotateRight()),!s.right.isEmpty()&&!s.right.isRed()&&!s.right.left.isRed()&&(s=s.moveRedRight()),r(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,r))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw W(43730,{key:this.key,value:this.value});if(this.right.isRed())throw W(14113,{key:this.key,value:this.value});let t=this.left.check();if(t!==this.right.check())throw W(27949);return t+(this.isRed()?0:1)}}return n.EMPTY=null,n.RED=!0,n.BLACK=!1,n})(),qh=class{constructor(){this.size=0}get key(){throw W(57766)}get value(){throw W(16141)}get color(){throw W(16727)}get left(){throw W(29726)}get right(){throw W(36894)}copy(e,t,r,i,s){return this}insert(e,t,r){return new Ls(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};Ls.EMPTY=new qh;Be=class n{constructor(e){this.comparator=e,this.data=new _e(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(t!==void 0?r=this.data.getIteratorFrom(t):r=this.data.getIterator();r.hasNext();){let i=r.getNext();if(!e(i.key))return}}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new pl(this.data.getIterator())}getIteratorFrom(e){return new pl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},pl=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};Ct=class n{constructor(e){this.fields=e,e.sort(mt.comparator)}static empty(){return new n([])}unionWith(e){let t=new Be(mt.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Dr(this.fields,e.fields,(t,r)=>t.isEqual(r))}};$e=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=CN(e);return new n(t)}static fromUint8Array(e){let t=AN(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return IN(this.binaryString)}toUint8Array(){return RN(this.binaryString)}approximateByteSize(){return this.binaryString.length*2}compareTo(e){return ne(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};$e.EMPTY_BYTE_STRING=new $e("");DN=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);VT="server_timestamp",zT="__type__",GT="__previous_value__",jT="__local_write_time__";Vh=class{constructor(e,t,r,i,s,a,o,l,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=o,this.longPollingOptions=l,this.useFetchStreams=c,this.isUsingEmulator=u}},zh="(default)",ml=class n{constructor(e,t){this.projectId=e,this.database=t||zh}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===zh}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};gp=-1;yp="__type__",KT="__max__",sl={mapValue:{fields:{__type__:{stringValue:KT}}}},vp="__vector__",Pi="value";m2={mapValue:{fields:{[yp]:{stringValue:vp},[Pi]:{arrayValue:{}}}}};ft=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!cl(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){let r=this.getFieldsMap(e.popLast());r[e.lastSegment()]=Fs(t)}setAll(e){let t=mt.emptyPath(),r={},i=[];e.forEach((a,o)=>{if(!t.isImmediateParentOf(o)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=o.popLast()}a?r[o.lastSegment()]=Fs(a):i.push(o.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());cl(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ft(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];(!cl(i)||!i.mapValue.fields)&&(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){lr(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Fs(this.value))}};qt=class n{constructor(e,t,r,i,s,a,o){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=a,this.documentState=o}static newInvalidDocument(e){return new n(e,0,Q.min(),Q.min(),Q.min(),ft.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,Q.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,Q.min(),Q.min(),ft.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,Q.min(),Q.min(),ft.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(Q.min())&&(this.documentType===2||this.documentType===0)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ft.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ft.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Q.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};Fi=class{constructor(e,t){this.position=e,this.inclusive=t}};Or=class{constructor(e,t="asc"){this.field=e,this.dir=t}};gl=class{},De=class n extends gl{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Kh(e,t,r):t==="array-contains"?new $h(e,r):t==="in"?new Qh(e,r):t==="not-in"?new Yh(e,r):t==="array-contains-any"?new Jh(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Wh(e,r):new Hh(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Mi(t,this.value)):t!==null&&nr(this.value)===nr(t)&&this.matchesComparison(Mi(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return W(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Vt=class n extends gl{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new n(e,t)}matches(e){return JT(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.memoizedFlattenedFilters!==null?this.memoizedFlattenedFilters:(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[]),this.memoizedFlattenedFilters)}getFilters(){return Object.assign([],this.filters)}};Kh=class extends De{constructor(e,t,r){super(e,t,r),this.key=j.fromName(r.referenceValue)}matches(e){let t=j.comparator(e.key,this.key);return this.matchesComparison(t)}},Wh=class extends De{constructor(e,t){super(e,"in",t),this.keys=tE("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Hh=class extends De{constructor(e,t){super(e,"not-in",t),this.keys=tE("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};$h=class extends De{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Tp(t)&&zs(t.arrayValue,this.value)}},Qh=class extends De{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&zs(this.value.arrayValue,t)}},Yh=class extends De{constructor(e,t){super(e,"not-in",t)}matches(e){if(zs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!zs(this.value.arrayValue,t)}},Jh=class extends De{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!Tp(t)||!t.arrayValue.values?!1:t.arrayValue.values.some(r=>zs(this.value.arrayValue,r))}};Xh=class{constructor(e,t=null,r=[],i=[],s=null,a=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=a,this.endAt=o,this.memoizedCanonicalId=null}};rr=class{constructor(e,t=null,r=[],i=[],s=null,a="F",o=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=a,this.startAt=o,this.endAt=l,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}};In=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0){this.inner[r]=[[e,t]],this.innerSize++;return}for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e)){i[s]=[e,t];return}i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){lr(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return qT(this.inner)}size(){return this.innerSize}};wO=new _e(j.comparator);sE=new _e(j.comparator);IO=new _e(j.comparator);RO=new Be(j.comparator);DO=new Be(ne);Bi=class{constructor(){this._=void 0}};Ui=class extends Bi{},xr=class extends Bi{constructor(e){super(),this.elements=e}};kr=class extends Bi{constructor(e){super(),this.elements=e}};qi=class extends Bi{constructor(e,t){super(),this.serializer=e,this.operand=t}};ef=class{constructor(e,t){this.version=e,this.transformResults=t}},pt=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};Vi=class{};Pr=class extends Vi{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}};cn=class extends Vi{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};zi=class extends Vi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};tf=class extends Vi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};nf=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];if(s.key.isEqual(e.key)){let a=r[i];BO(s,e,a)}}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Bs(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Bs(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=oE();return this.mutations.forEach(i=>{let s=e.get(i.key),a=s.overlayedDocument,o=this.applyToLocalView(a,s.mutatedFields);o=t.has(i.key)?null:o;let l=fE(a,o);l!==null&&r.set(i.key,l),a.isValidDocument()||a.convertToNoDocument(Q.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),te())}isEqual(e){return this.batchId===e.batchId&&Dr(this.mutations,e.mutations,(t,r)=>eT(t,r))&&Dr(this.baseMutations,e.baseMutations,(t,r)=>eT(t,r))}},rf=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){le(e.mutations.length===r.length,58842,{mutationsSent:e.mutations.length,resultsReceived:r.length});let i=AO(),s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,r[a].version);return new n(e,t,r,i)}};sf=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};af=class{constructor(e,t){this.count=e,this.unchangedNames=t}};Fe=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n}(Fe||{});of=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};$O=null;QO=new hn([4294967295,4294967295],0);lf=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Ir(`Invalid padding: ${t}`);if(r<0)throw new Ir(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Ir(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Ir(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=e.length*8-t,this.bitCountInInteger=hn.fromNumber(this.bitCount)}getBitIndex(e,t,r){let i=e.add(t.multiply(hn.fromNumber(r)));return i.compare(QO)===1&&(i=new hn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){let t=this.bitmap[Math.floor(e/8)],r=e%8;return(t&1<<r)!==0}mightContain(e){if(this.bitCount===0)return!1;let t=tT(e),[r,i]=nT(t);for(let s=0;s<this.hashCount;s++){let a=this.getBitIndex(r,i,s);if(!this.isBitSet(a))return!1}return!0}static create(e,t,r){let i=e%8===0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new n(s,i,t);return r.forEach(o=>a.insert(o)),a}insert(e){if(this.bitCount===0)return;let t=tT(e),[r,i]=nT(t);for(let s=0;s<this.hashCount;s++){let a=this.getBitIndex(r,i,s);this.setBit(a)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Ir=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};vl=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Ks.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(Q.min(),i,new _e(ne),An(),te())}},Ks=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,te(),te(),te())}};xi=class{constructor(e,t,r,i){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=i}},Sl=class{constructor(e,t){this.targetId=e,this.existenceFilter=t}},Tl=class{constructor(e,t,r=$e.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},El=class{constructor(){this.pendingResponses=0,this.documentChanges=rT(),this._resumeToken=$e.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return this.pendingResponses!==0}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=te(),t=te(),r=te();return this.documentChanges.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:W(38017,{changeType:s})}}),new Ks(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=rT()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,le(this.pendingResponses>=0,3241,{pendingResponses:this.pendingResponses})}markCurrent(){this._hasPendingChanges=!0,this._current=!0}},YO="WatchChangeAggregator",cf=class{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=An(),this.pendingDocumentUpdatesByTarget=al(),this.pendingDocumentTargetMapping=al(),this.pendingTargetResets=new _e(ne)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:W(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((r,i)=>{this.isActiveTarget(i)&&t(i)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,i=this.targetDataForActiveTarget(t);if(i){let s=i.target;if(Zh(s))if(r===0){let a=new j(s.path);this.removeDocumentFromTarget(t,a,qt.newNoDocument(a,Q.min()))}else le(r===1,20013,{expectedCount:r});else{let a=this.getCurrentDocumentCountForTarget(t);if(a!==r){let o=this.parseBloomFilter(e),l=o?this.applyBloomFilter(o,e,a):1;if(l!==0){this.resetTarget(t);let c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,c)}$O?.notifyOnExistenceFilterMismatch(JO(a,e.existenceFilter,this.metadataProvider.getDatabaseId(),o,l))}}}}parseBloomFilter(e){let t=e.existenceFilter.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,a;try{a=Cn(r).toUint8Array()}catch(l){if(l instanceof of)return Oi("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}let o;try{o=new lf(a,i,s)}catch(l){return l instanceof Ir?Oi("BloomFilter error: ",l):Oi("Applying bloom filter failed: ",l),null}return o.bitCount===0?null:o}applyBloomFilter(e,t,r){let i=t.existenceFilter.count,s=this.filterRemovedDocuments(e,t.targetId);return i===r-s?0:2}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let a=this.metadataProvider.getDatabaseId(),o=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(o)||(this.removeDocumentFromTarget(t,s,null),i++)}),i}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((s,a)=>{let o=this.targetDataForActiveTarget(a);if(o){if(s.current&&Zh(o.target)){let l=new j(o.target.path);!this.ensureDocumentUpdateByTarget(l).has(a)&&!this.targetContainsDocument(a,l)&&this.removeDocumentFromTarget(a,l,qt.newNoDocument(l,e))}s.hasPendingChanges&&(t.set(a,s.toTargetChange()),s.clearPendingChanges())}});let r=te();this.pendingDocumentTargetMapping.forEach((s,a)=>{let o=!0;a.forEachWhile(l=>{let c=this.targetDataForActiveTarget(l);return c&&c.purpose!=="TargetPurposeLimboResolution"?(o=!1,!1):!0}),o&&(r=r.add(s))}),this.pendingDocumentUpdates.forEach((s,a)=>a.setReadTime(e));let i=new vl(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=An(),this.pendingDocumentUpdatesByTarget=al(),this.pendingDocumentTargetMapping=al(),this.pendingTargetResets=new _e(ne),i}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(t.key,this.ensureDocumentUpdateByTarget(t.key).add(e)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let i=this.ensureTargetState(e);this.targetContainsDocument(e,t)?i.addDocumentChange(t,1):i.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).add(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let r=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new El,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new Be(ne),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}ensureDocumentUpdateByTarget(e){let t=this.pendingDocumentUpdatesByTarget.get(e);return t||(t=new Be(ne),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(e,t)),t}isActiveTarget(e){let t=this.targetDataForActiveTarget(e)!==null;return t||V(YO,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new El),this.metadataProvider.getRemoteKeysForTarget(e).forEach(r=>{this.removeDocumentFromTarget(e,r,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}};XO=(()=>{let n={};return n.asc="ASCENDING",n.desc="DESCENDING",n})(),ZO=(()=>{let n={};return n["<"]="LESS_THAN",n["<="]="LESS_THAN_OR_EQUAL",n[">"]="GREATER_THAN",n[">="]="GREATER_THAN_OR_EQUAL",n["=="]="EQUAL",n["!="]="NOT_EQUAL",n["array-contains"]="ARRAY_CONTAINS",n.in="IN",n["not-in"]="NOT_IN",n["array-contains-any"]="ARRAY_CONTAINS_ANY",n})(),ex=(()=>{let n={};return n.and="AND",n.or="OR",n})(),_l=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};Hs=class n{constructor(e,t,r,i,s=Q.min(),a=Q.min(),o=$e.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=o,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};ff=class{constructor(e){this.remoteSerializer=e}};Kx=5,Wx=10,Hx=13,Ah=15,$x=20,Qx=25,Yx=30,Jx=37,Xx=45,Zx=50,e1=53,t1=55,n1=60,r1=2,bl=class{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,Kx);else if("booleanValue"in e)this.writeValueTypeLabel(t,Wx),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,Ah),t.writeNumber(ve(e.integerValue));else if("doubleValue"in e){let r=ve(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,Hx):(this.writeValueTypeLabel(t,Ah),Vs(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,$x),typeof r=="string"&&(r=wn(r)),t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,Yx),t.writeBytes(Cn(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,Xx),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?$T(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):HT(e)?this.writeIndexVector(e.mapValue,t):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):W(19022,{indexValue:e})}writeIndexString(e,t){this.writeValueTypeLabel(t,Qx),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,t1);for(let i of Object.keys(r))this.writeIndexString(i,t),this.writeIndexValueAux(r[i],t)}writeIndexVector(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,e1);let i=Pi,s=r[i].arrayValue?.values?.length||0;this.writeValueTypeLabel(t,Ah),t.writeNumber(ve(s)),this.writeIndexString(i,t),this.writeIndexValueAux(r[i],t)}writeIndexArray(e,t){let r=e.values||[];this.writeValueTypeLabel(t,Zx);for(let i of r)this.writeIndexValueAux(i,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,Jx),j.fromName(e).path.forEach(i=>{this.writeValueTypeLabel(t,n1),this.writeUnlabeledIndexString(i,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(r1)}};bl.INSTANCE=new bl;pf=class{constructor(){this.collectionParentIndex=new mf}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),N.resolve()}getCollectionParents(e,t){return N.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return N.resolve()}deleteFieldIndex(e,t){return N.resolve()}deleteAllFieldIndexes(e){return N.resolve()}createTargetIndexes(e,t){return N.resolve()}getDocumentsMatchingTarget(e,t){return N.resolve(null)}getIndexType(e,t){return N.resolve(0)}getFieldIndexes(e,t){return N.resolve([])}getNextCollectionGroupToUpdate(e){return N.resolve(null)}getMinOffset(e,t){return N.resolve(Nr.min())}getMinOffsetFromCollectionGroup(e,t){return N.resolve(Nr.min())}updateCollectionGroup(e,t,r){return N.resolve()}updateIndexEntries(e,t){return N.resolve()}},mf=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Be(ye.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Be(ye.comparator)).toArray()}};g2=new Uint8Array(0);Rh=2,$s=class n{constructor(e){this.lastId=e}next(){return this.lastId+=Rh,this.lastId}static forTargetCache(){return new n(2-Rh)}static forSyncEngine(){return new n(1-Rh)}};sT={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Xl=-1,AE=40*1024*1024,It=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}};It.DEFAULT_COLLECTION_PERCENTILE=10;It.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3;It.DEFAULT=new It(AE,It.DEFAULT_COLLECTION_PERCENTILE,It.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);It.DISABLED=new It(Xl,0,0);aT="LruGarbageCollector",oT=1*1024*1024,i1=1*60*1e3,s1=5*60*1e3;gf=class{constructor(e){this.maxElements=e,this.buffer=new Be(lT),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();lT(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},yf=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==Xl&&this.scheduleGC(i1)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return this.gcTask!==null}scheduleGC(e){V(aT,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>x(this,null,function*(){this.gcTask=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){$i(t)?V(aT,"Ignoring IndexedDB error during garbage collection: ",t):yield Hi(t)}yield this.scheduleGC(s1)}))}},vf=class{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return N.resolve(pp.INVALID);let r=new gf(t);return this.delegate.forEachTarget(e,i=>r.addElement(i.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,i=>r.addElement(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.delegate.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===Xl?(V("LruGarbageCollector","Garbage collection skipped; disabled"),N.resolve(sT)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),sT):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let r,i,s,a,o,l,c,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(V("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),i=this.params.maximumSequenceNumbersToCollect):i=p,a=Date.now(),this.nthSequenceNumber(e,i))).next(p=>(r=p,o=Date.now(),this.removeTargets(e,r,t))).next(p=>(s=p,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(p=>{if(c=Date.now(),Ii()<=jt.DEBUG){let g=`LRU Garbage Collection
	Counted targets in ${a-u}ms
	Determined least recently used ${i} in ${o-a}ms
	Removed ${s} targets in ${l-o}ms
	Removed ${p} documents in ${c-l}ms
Total Duration: ${c-u}ms`;V("LruGarbageCollector",g)}return N.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:p})})}};Sf=class{constructor(){this.changes=new In(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,qt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?N.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};Tf=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};Ef=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Bs(r.mutation,i,Ct.empty(),Ee.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,te()).next(()=>r))}getLocalViewOfDocuments(e,t,r=te()){let i=Cr();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let a=Ms();return s.forEach((o,l)=>{a=a.insert(o,l.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){let r=Cr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,te()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,o)=>{t.set(a,o)})})}computeViews(e,t,r,i){let s=An(),a=js(),o=CO();return t.forEach((l,c)=>{let u=r.get(c.key);i.has(c.key)&&(u===void 0||u.mutation instanceof cn)?s=s.insert(c.key,c):u!==void 0?(a.set(c.key,u.mutation.getFieldMask()),Bs(u.mutation,c,u.mutation.getFieldMask(),Ee.now())):a.set(c.key,Ct.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>a.set(c,u)),t.forEach((c,u)=>o.set(c,new Tf(u,a.get(c)??null))),o))}recalculateAndSaveOverlays(e,t){let r=js(),i=new _e((a,o)=>a-o),s=te();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(let o of a)o.keys().forEach(l=>{let c=t.get(l);if(c===null)return;let u=r.get(l)||Ct.empty();u=o.applyToLocalView(c,u),r.set(l,u);let p=(i.get(o.batchId)||te()).add(l);i=i.insert(o.batchId,p)})}).next(()=>{let a=[],o=i.getReverseIterator();for(;o.hasNext();){let l=o.getNext(),c=l.key,u=l.value,p=oE();u.forEach(g=>{if(!s.has(g)){let T=fE(t.get(g),r.get(g));T!==null&&p.set(g,T),s=s.add(g)}}),a.push(this.documentOverlayCache.saveOverlays(e,c,p))}return N.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return mO(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):nE(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):N.resolve(Cr()),o=Us,l=s;return a.next(c=>N.forEach(c,(u,p)=>(o<p.largestBatchId&&(o=p.largestBatchId),s.get(u)?N.resolve():this.remoteDocumentCache.getEntry(e,u).next(g=>{l=l.insert(u,g)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,te())).next(u=>({batchId:o,changes:aE(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new j(t)).next(r=>{let i=Ms();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,a=Ms();return this.indexManager.getCollectionParents(e,s).next(o=>N.forEach(o,l=>{let c=fO(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(u=>{u.forEach((p,g)=>{a=a.insert(p,g)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(a=>{s.forEach((l,c)=>{let u=c.getKey();a.get(u)===null&&(a=a.insert(u,qt.newInvalidDocument(u)))});let o=Ms();return a.forEach((l,c)=>{let u=s.get(l);u!==void 0&&Bs(u.mutation,c,Ct.empty(),Ee.now()),Yl(t,c)&&(o=o.insert(l,c))}),o})}};_f=class{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return N.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,jx(t)),N.resolve()}getNamedQuery(e,t){return N.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,Gx(t)),N.resolve()}};bf=class{constructor(){this.overlays=new _e(j.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return N.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Cr();return N.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.saveOverlay(e,t,s)}),N.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.overlayByBatchId.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.overlayByBatchId.delete(r)),N.resolve()}getOverlaysForCollection(e,t,r){let i=Cr(),s=t.length+1,a=new j(t.child("")),o=this.overlays.getIteratorFrom(a);for(;o.hasNext();){let c=o.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return N.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new _e((c,u)=>c-u),a=this.overlays.getIterator();for(;a.hasNext();){let u=a.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let g=s.get(u.largestBatchId);g===null&&(g=Cr(),s=s.insert(u.largestBatchId,g)),g.set(u.getKey(),u)}}let o=Cr(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((p,g)=>o.set(p,g)),!(o.size()>=i)););return N.resolve(o)}saveOverlay(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let a=this.overlayByBatchId.get(i.largestBatchId).delete(r.key);this.overlayByBatchId.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new sf(t,r));let s=this.overlayByBatchId.get(t);s===void 0&&(s=te(),this.overlayByBatchId.set(t,s)),this.overlayByBatchId.set(t,s.add(r.key))}};wf=class{constructor(){this.sessionToken=$e.EMPTY_BYTE_STRING}getSessionToken(e){return N.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,N.resolve()}};Qs=class{constructor(){this.refsByKey=new Be(Ae.compareByKey),this.refsByTarget=new Be(Ae.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new Ae(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.removeRef(new Ae(e,t))}removeReferences(e,t){e.forEach(r=>this.removeReference(r,t))}removeReferencesForId(e){let t=new j(new ye([])),r=new Ae(t,e),i=new Ae(t,e+1),s=[];return this.refsByTarget.forEachInRange([r,i],a=>{this.removeRef(a),s.push(a.key)}),s}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new j(new ye([])),r=new Ae(t,e),i=new Ae(t,e+1),s=te();return this.refsByTarget.forEachInRange([r,i],a=>{s=s.add(a.key)}),s}containsKey(e){let t=new Ae(e,0),r=this.refsByKey.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},Ae=class{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return j.comparator(e.key,t.key)||ne(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return ne(e.targetOrBatchId,t.targetOrBatchId)||j.comparator(e.key,t.key)}};Cf=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new Be(Ae.compareByKey)}checkEmpty(e){return N.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new nf(s,t,r,i);this.mutationQueue.push(a);for(let o of i)this.batchesByDocumentKey=this.batchesByDocumentKey.add(new Ae(o.key,s)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return N.resolve(a)}lookupMutationBatch(e,t){return N.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.indexOfBatchId(r),s=i<0?0:i;return N.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return N.resolve(this.mutationQueue.length===0?gp:this.nextBatchId-1)}getAllMutationBatches(e){return N.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new Ae(t,0),i=new Ae(t,Number.POSITIVE_INFINITY),s=[];return this.batchesByDocumentKey.forEachInRange([r,i],a=>{let o=this.findMutationBatch(a.targetOrBatchId);s.push(o)}),N.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Be(ne);return t.forEach(i=>{let s=new Ae(i,0),a=new Ae(i,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([s,a],o=>{r=r.add(o.targetOrBatchId)})}),N.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;j.isDocumentKey(s)||(s=s.child(""));let a=new Ae(new j(s),0),o=new Be(ne);return this.batchesByDocumentKey.forEachWhile(l=>{let c=l.key.path;return r.isPrefixOf(c)?(c.length===i&&(o=o.add(l.targetOrBatchId)),!0):!1},a),N.resolve(this.findMutationBatches(o))}findMutationBatches(e){let t=[];return e.forEach(r=>{let i=this.findMutationBatch(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){let r=this.indexOfExistingBatchId(t.batchId,"removed");le(r===0,55003),this.mutationQueue.shift();let i=this.batchesByDocumentKey;return N.forEach(t.mutations,s=>{let a=new Ae(s.key,t.batchId);return i=i.delete(a),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.batchesByDocumentKey=i})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new Ae(t,0),i=this.batchesByDocumentKey.firstAfterOrEqual(r);return N.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,N.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){if(this.mutationQueue.length===0)return 0;let t=this.mutationQueue[0].batchId;return e-t}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};o1="-9223372036854775808";If=class{constructor(e){this.sizer=e,this.docs=l1(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,a=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return N.resolve(r?r.document.mutableCopy():qt.newInvalidDocument(t))}getEntries(e,t){let r=An();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():qt.newInvalidDocument(i))}),N.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=An(),a=t.path,o=new j(a.child("__id"+o1+"__")),l=this.docs.getIteratorFrom(o);for(;l.hasNext();){let{key:c,value:{document:u}}=l.getNext();if(!a.isPrefixOf(c.path))break;c.path.length>a.length+1||nN(tN(u),r)<=0||!i.has(u.key)&&!Yl(t,u)||(s=s.insert(u.key,u.mutableCopy()))}return N.resolve(s)}getAllFromCollectionGroup(e,t,r,i){W(9500)}forEachDocumentKey(e,t){return N.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Af(this)}getSize(e){return N.resolve(this.size)}};Af=class extends Sf{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.documentCache.addEntry(e,i)):this.documentCache.removeEntry(r)}),N.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}};Rf=class{constructor(e){this.persistence=e,this.targets=new In(t=>Ep(t),_p),this.lastRemoteSnapshotVersion=Q.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new Qs,this.targetCount=0,this.targetIdGenerator=$s.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((r,i)=>t(i)),N.resolve()}getLastRemoteSnapshotVersion(e){return N.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return N.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),N.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),N.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new $s(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,N.resolve()}updateTargetData(e,t){return this.saveTargetData(t),N.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,N.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.targets.forEach((a,o)=>{o.sequenceNumber<=t&&r.get(o.targetId)===null&&(this.targets.delete(a),s.push(this.removeMatchingKeysForTargetId(e,o.targetId)),i++)}),N.waitFor(s).next(()=>i)}getTargetCount(e){return N.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return N.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),N.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),N.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),N.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return N.resolve(r)}containsKey(e,t){return N.resolve(this.references.containsKey(t))}};u1="MemoryPersistence",wl=class{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new pp(0),this._started=!1,this._started=!0,this.globalsCache=new wf,this.referenceDelegate=e(this),this.targetCache=new Rf(this);let r=i=>this.referenceDelegate.documentSize(i);this.indexManager=new pf,this.remoteDocumentCache=c1(r),this.serializer=new ff(t),this.bundleCache=new _f(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new bf,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new Cf(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){V(u1,"Starting transaction:",e);let i=new Df(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(i).next(s=>this.referenceDelegate.onTransactionCommitted(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}mutationQueuesContainKey(e,t){return N.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}},Df=class extends Uh{constructor(e){super(),this.currentSequenceNumber=e}},Nf=class n{constructor(e){this.persistence=e,this.localViewReferences=new Qs,this._orphanedDocuments=null}static factory(e){return new n(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw W(60996)}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),N.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),N.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),N.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(s=>this.orphanedDocuments.add(s.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(a=>this.orphanedDocuments.add(a.toString()))}).next(()=>i.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return N.forEach(this.orphanedDocuments,i=>{let s=j.fromPath(i);return this.isReferenced(e,s).next(a=>{a||r.removeEntry(s,Q.min())})}).next(()=>(this._orphanedDocuments=null,r.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(r=>{r?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return N.or([()=>N.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}},Cl=class n{constructor(e,t){this.persistence=e,this.orphanedSequenceNumbers=new In(r=>lN(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=a1(this,t)}static factory(e,t){return new n(e,t)}onTransactionStarted(){}onTransactionCommitted(e){return N.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.persistence.getTargetCache().getTargetCount(e).next(i=>t.next(s=>i+s))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,r=>{t++}).next(()=>t)}forEachOrphanedDocumentSequenceNumber(e,t){return N.forEach(this.orphanedSequenceNumbers,(r,i)=>this.isPinned(e,r,i).next(s=>s?N.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.forEachDocumentKey(e,o=>this.isPinned(e,o,t).next(l=>{l||(r++,s.removeEntry(o,Q.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),N.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.orphanedSequenceNumbers.set(r,e.currentSequenceNumber),N.resolve()}removeReference(e,t,r){return this.orphanedSequenceNumbers.set(r,e.currentSequenceNumber),N.resolve()}updateLimboDocument(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),N.resolve()}documentSize(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Hl(e.data.value)),t}isPinned(e,t,r){return N.or([()=>this.persistence.mutationQueuesContainKey(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.orphanedSequenceNumbers.get(t);return N.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};y2=30*60*1e3;Ip="LocalStore",h1=5*60*1e6,Of=class{constructor(e,t,r,i){this.persistence=e,this.queryEngine=t,this.serializer=i,this.targetDataByTarget=new _e(ne),this.targetIdByTarget=new In(s=>Ep(s),_p),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ef(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}};kf=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};A1=100;Pf=class{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=A1,this.relativeIndexReadCostPerDocument=R1()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.performQueryUsingIndex(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.performQueryUsingRemoteKeys(e,t,i,r).next(a=>{s.result=a})}).next(()=>{if(s.result)return;let a=new kf;return this.executeFullCollectionScan(e,t,a).next(o=>{if(s.result=o,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,a,o.size)})}).next(()=>s.result)}createCacheIndexes(e,t,r,i){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(Ii()<=jt.DEBUG&&V("QueryEngine","SDK will not create cache indexes for query:",Ai(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),N.resolve()):(Ii()<=jt.DEBUG&&V("QueryEngine","Query:",Ai(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*i?(Ii()<=jt.DEBUG&&V("QueryEngine","The SDK decides to create cache indexes for query:",Ai(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Bt(t))):N.resolve())}performQueryUsingIndex(e,t){if(XS(t))return N.resolve(null);let r=Bt(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=yl(t,null,"F"),r=Bt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let a=te(...s);return this.localDocumentsView.getDocuments(e,a).next(o=>this.indexManager.getMinOffset(e,r).next(l=>{let c=this.applyQuery(t,o);return this.needsRefill(t,c,a,l.readTime)?this.performQueryUsingIndex(e,yl(t,null,"F")):this.appendRemainingResults(e,c,t,l)}))})))}performQueryUsingRemoteKeys(e,t,r,i){return XS(t)||i.isEqual(Q.min())?N.resolve(null):this.localDocumentsView.getDocuments(e,r).next(s=>{let a=this.applyQuery(t,s);return this.needsRefill(t,a,r,i)?N.resolve(null):(Ii()<=jt.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Ai(t)),this.appendRemainingResults(e,a,t,eN(i,Us)).next(o=>o))})}applyQuery(e,t){let r=new Be(iE(e));return t.forEach((i,s)=>{Yl(e,s)&&(r=r.add(s))}),r}needsRefill(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return s?s.hasPendingWrites||s.version.compareTo(i)>0:!1}executeFullCollectionScan(e,t,r){return Ii()<=jt.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",Ai(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,Nr.min(),r)}appendRemainingResults(e,t,r,i){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}};Il=class{constructor(){this.activeTargetIds=NO()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},Mf=class{constructor(){this.localState=new Il,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new Il,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};Lf=class{addCallback(e){}shutdown(){}};Ff=class{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}};ol=null;O1="1.9.15",tt="GrpcConnection",x1=`gl-node/${process.versions.node} fire/${Wi} grpc/${O1}`;Bf=class{get shouldResourcePathBeIncludedInRequest(){return!0}constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}ensureActiveStub(){if(!this.cachedStub){V(tt,"Creating Firestore stub.");let e=this.databaseInfo.ssl?Ar.credentials.createSsl():Ar.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,i,s){let a=Dh(),o=this.ensureActiveStub(),l=Nh(this.databasePath,i,s,this.databaseInfo.appId),c=ee({database:this.databasePath},r);return N1(u=>(V(tt,`RPC '${e}' ${a} invoked with request:`,r),o[e](c,l,(p,g)=>{p?(V(tt,`RPC '${e}' ${a} failed with error:`,p),u(new M(ul(p.code),p.message))):(V(tt,`RPC '${e}' ${a} completed with response:`,g),u(void 0,g))})))}invokeStreamingRPC(e,t,r,i,s,a){let o=Dh(),l=[],c=new At;V(tt,`RPC '${e}' ${o} invoked (streaming) with request:`,r);let u=this.ensureActiveStub(),p=Nh(this.databasePath,i,s,this.databaseInfo.appId),g=Ze(ee({},r),{database:this.databasePath}),T=u[e](g,p),_=!1;return T.on("data",w=>{V(tt,`RPC ${e} ${o} received result:`,w),l.push(w),a!==void 0&&l.length===a&&(_=!0,c.resolve(l))}),T.on("end",()=>{V(tt,`RPC '${e}' ${o} completed.`),_||(_=!0,c.resolve(l))}),T.on("error",w=>{V(tt,`RPC '${e}' ${o} failed with error:`,w);let b=ul(w.code);c.reject(new M(b,w.message))}),c.promise}openStream(e,t,r){let i=Dh(),s=this.ensureActiveStub(),a=Nh(this.databasePath,t,r,this.databaseInfo.appId),o=s[e](a),l=!1,c=g=>{l||(l=!0,u.callOnClose(g),o.end())},u=new Ff({sendFn:g=>{if(l)V(tt,`RPC '${e}' stream ${i} not sending because gRPC stream is closed:`,g);else{V(tt,`RPC '${e}' stream ${i} sending:`,g);try{o.write(g)}catch(T){throw Ut("Failure sending:",g),Ut("Error:",T),T}}},closeFn:()=>{V(tt,`RPC '${e}' stream ${i} closed locally via close().`),c()}}),p=!1;return o.on("data",g=>{l||(V(tt,`RPC '${e}' stream ${i} received:`,g),p||(u.callOnConnected(),p=!0),u.callOnMessage(g))}),o.on("end",()=>{V(tt,`RPC '${e}' stream ${i} ended.`),c()}),o.on("error",g=>{if(!l){Oi(tt,`RPC '${e}' stream ${i} error. Code:`,g.code,"Message:",g.message);let T=ul(g.code);c(new M(T,g.message))}}),V(tt,`Opening RPC '${e}' stream ${i} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}},OE={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}},k1={nested:OE},P1=Object.freeze({__proto__:null,nested:OE,default:k1});M1={longs:String,enums:String,defaults:!0,oneofs:!1};U1="ExponentialBackoff",q1=1e3,V1=1.5,z1=60*1e3,Al=class{constructor(e,t,r=q1,i=V1,s=z1){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=i,this.maxDelayMs=s,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,t-r);i>0&&V(U1,`Backing off for ${i} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){this.timerPromise!==null&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){this.timerPromise!==null&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}};cT="PersistentStream",G1=60*1e3,j1=10*1e3,Rl=class{constructor(e,t,r,i,s,a,o,l){this.queue=e,this.idleTimerId=r,this.healthTimerId=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=o,this.listener=l,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new Al(e,t)}isStarted(){return this.state===1||this.state===5||this.isOpen()}isOpen(){return this.state===2||this.state===3}start(){if(this.responseCount=0,this.state===4){this.performBackoff();return}this.auth()}stop(){return x(this,null,function*(){this.isStarted()&&(yield this.close(0))})}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&this.idleTimer===null&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,G1,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}handleIdleCloseTimer(){return x(this,null,function*(){if(this.isOpen())return this.close(0)})}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}close(e,t){return x(this,null,function*(){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,e!==4?this.backoff.reset():t&&t.code===I.RESOURCE_EXHAUSTED?(Ut(t.toString()),Ut("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===I.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.onClose(t)})}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.closeCount===t&&this.startStream(r,i)},r=>{e(()=>{let i=new M(I.UNKNOWN,"Fetching auth token failed: "+r.message);return this.handleStreamClose(i)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{r(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,j1,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(i=>{r(()=>this.handleStreamClose(i))}),this.stream.onMessage(i=>{r(()=>++this.responseCount===1?this.onFirst(i):this.onNext(i))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(()=>x(this,null,function*(){this.state=0,this.start()}))}handleStreamClose(e){return V(cT,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(V(cT,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Uf=class extends Rl{constructor(e,t,r,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onFirst(e){return this.onNext(e)}onNext(e){this.backoff.reset();let t=ox(this.serializer,e),r=cx(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=hf(this.serializer),t.addTarget=Sx(this.serializer,e);let r=yx(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=hf(this.serializer),t.removeTarget=e,this.sendRequest(t)}},qf=class extends Rl{constructor(e,t,r,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onFirst(e){return le(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,le(!e.writeResults||e.writeResults.length===0,55816),this.listener.onHandshakeComplete()}onNext(e){le(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.backoff.reset();let t=fx(e.writeResults,e.commitTime),r=ln(e.commitTime);return this.listener.onMutationResult(r,t)}writeHandshake(){let e={};e.database=hf(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>ux(this.serializer,r))};this.sendRequest(t)}};Vf=class{},zf=class extends Vf{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new M(I.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,r,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.invokeRPC(e,df(t,r),i,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===I.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new M(I.UNKNOWN,s.toString())})}invokeStreamingRPC(e,t,r,i,s){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,o])=>this.connection.invokeStreamingRPC(e,df(t,r),i,a,o,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===I.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new M(I.UNKNOWN,a.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}};$1="OnlineStateTracker",uT=1,dT=10*1e3,Gf=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){this.watchStreamFailures===0&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",dT,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${dT/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){this.state==="Online"?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=uT&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${uT} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,e==="Online"&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(Ut(t),this.shouldWarnClientIsOffline=!1):V($1,t)}clearOnlineStateTimer(){this.onlineStateTimer!==null&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}};Mr="RemoteStore",Q1=10,jf=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=s,this.connectivityMonitor.addCallback(a=>{r.enqueueAndForget(()=>x(this,null,function*(){qr(this)&&(V(Mr,"Restarting streams for network reachability change."),yield dk(this))}))}),this.onlineStateTracker=new Gf(r,i)}};fk="AsyncQueue",Kf=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new At,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let a=Date.now()+r,o=new n(e,t,a,i,s);return o.start(r),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new M(I.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};Nl=class n{static emptySet(e){return new n(e.comparator)}constructor(e){e?this.comparator=(t,r)=>e(t,r)||j.comparator(t.key,r.key):this.comparator=(t,r)=>j.comparator(t.key,r.key),this.keyedMap=Ms(),this.sortedSet=new _e(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};Ol=class{constructor(){this.changeMap=new _e(j.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}e.type!==0&&r.type===3?this.changeMap=this.changeMap.insert(t,e):e.type===3&&r.type!==1?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.changeMap=this.changeMap.remove(t):e.type===1&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):W(63341,{change:e,oldChange:r})}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}},Gi=class n{constructor(e,t,r,i,s,a,o,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=o,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let a=[];return t.forEach(o=>{a.push({type:0,doc:o})}),new n(e,t,Nl.emptySet(t),a,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!Ql(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};Wf=class{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}};Hf=class{constructor(){this.queries=BE(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){vk(this,new M(I.ABORTED,"Firestore shutting down"))}};UE=function(n){return n.Default="default",n.Cache="cache",n}(UE||{}),Ys=class{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Gi(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let r=t!=="Offline";return this.options.waitForSyncWhenOnline&&r?!1:!e.docs.isEmpty()||e.hasCachedResults||t==="Offline"}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return e.syncStateChanged||t?this.options.includeMetadataChanges===!0:!1}raiseInitialEvent(e){e=Gi.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==UE.Cache}};$f=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=i}static fromSnapshot(e,t){let r=te(),i=te();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key);break}return new n(e,t.fromCache,r,i)}};xl=class{constructor(e){this.key=e}},kl=class{constructor(e){this.key=e}},Qf=class{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=te(),this.mutatedKeys=te(),this.docComparator=iE(e),this.documentSet=new Nl(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new Ol,i=t?t.documentSet:this.documentSet,s=t?t.mutatedKeys:this.mutatedKeys,a=i,o=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,p)=>{let g=i.get(u),T=Yl(this.query,p)?p:null,_=g?this.mutatedKeys.has(g.key):!1,w=T?T.hasLocalMutations||this.mutatedKeys.has(T.key)&&T.hasCommittedMutations:!1,b=!1;g&&T?g.data.isEqual(T.data)?_!==w&&(r.track({type:3,doc:T}),b=!0):this.shouldWaitForSyncedDocument(g,T)||(r.track({type:2,doc:T}),b=!0,(l&&this.docComparator(T,l)>0||c&&this.docComparator(T,c)<0)&&(o=!0)):!g&&T?(r.track({type:0,doc:T}),b=!0):g&&!T&&(r.track({type:1,doc:g}),b=!0,(l||c)&&(o=!0)),b&&(T?(a=a.add(T),w?s=s.add(u):s=s.delete(u)):(a=a.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let u=this.query.limitType==="F"?a.last():a.first();a=a.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{documentSet:a,changeSet:r,needsRefill:o,mutatedKeys:s}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let a=e.changeSet.getChanges();a.sort((p,g)=>Sk(p.type,g.type)||this.docComparator(p.doc,g.doc)),this.applyTargetChange(r),i=i??!1;let o=t&&!i?this.updateLimboDocuments():[],c=this.limboDocuments.size===0&&this.current&&!i?1:0,u=c!==this.syncState;return this.syncState=c,a.length===0&&!u?{limboChanges:o}:{snapshot:new Gi(this.query,e.documentSet,s,a,e.mutatedKeys,c===0,u,!1,r?r.resumeToken.approximateByteSize()>0:!1),limboChanges:o}}applyOnlineStateChange(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new Ol,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!(this._syncedDocuments.has(e)||!this.documentSet.has(e)||this.documentSet.get(e).hasLocalMutations)}applyTargetChange(e){e&&(e.addedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.delete(t)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=te(),this.documentSet.forEach(r=>{this.shouldBeInLimbo(r.key)&&(this.limboDocuments=this.limboDocuments.add(r.key))});let t=[];return e.forEach(r=>{this.limboDocuments.has(r)||t.push(new kl(r))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new xl(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=te();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return Gi.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===0,this.hasCachedResults)}};Mp="SyncEngine",Yf=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Jf=class{constructor(e){this.key=e,this.receivedDocument=!1}},Xf=class{constructor(e,t,r,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.syncEngineListener={},this.queryViewsByQuery=new In(o=>rE(o),Ql),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new _e(j.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new Qs,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=$s.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return this._isPrimaryClient===!0}};HE=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return x(this,null,function*(){this.serializer=Zl(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),yield this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)})}createGarbageCollectionScheduler(t,r){return null}createIndexBackfillerScheduler(t,r){return null}createLocalStore(t){return f1(this.persistence,new Pf,t.initialUser,this.serializer)}createPersistence(t){return new wl(Nf.factory,this.serializer)}createSharedClientState(t){return new Mf}terminate(){return x(this,null,function*(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),ep=class extends HE{constructor(e){super(),this.cacheSizeBytes=e}createGarbageCollectionScheduler(e,t){le(this.persistence.referenceDelegate instanceof Cl,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new yf(r,e.asyncQueue,t)}createPersistence(e){let t=this.cacheSizeBytes!==void 0?It.withCacheSize(this.cacheSizeBytes):It.DEFAULT;return new wl(r=>Cl.factory(r,t),this.serializer)}},Fk=(()=>{class n{initialize(t,r){return x(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>fT(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=Pk.bind(null,this.syncEngine),yield hk(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return pk()}createDatastore(t){let r=Zl(t.databaseInfo.databaseId),i=F1(t.databaseInfo);return K1(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return Y1(this.localStore,this.datastore,t.asyncQueue,r=>fT(this.syncEngine,r,0),B1())}createSyncEngine(t,r){return Tk(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return x(this,null,function*(){yield J1(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()})}}n.provider={build:()=>new n};return n})();Js=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,e):Ut("Uncaught Error in snapshot listener:",e.toString()))}mute(){this.muted=!0}scheduleEvent(e,t){setTimeout(()=>{this.muted||e(t)},0)}};ir="FirestoreClient",Bk=100,Uk=11,qk=20,Vk=22,tp=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Ue.UNAUTHENTICATED,this.clientId=ki.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,a=>x(this,null,function*(){V(ir,"Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,a=>(V(ir,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:Bk}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new At;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>x(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Op(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};Xk="ComponentProvider",mT=new Map;YE="firestore.googleapis.com",gT=!0,yT=5,vT=30,tP=!0,Ml=class{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new M(I.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=YE,this.ssl=gT}else this.host=e.host,this.ssl=e.ssl??gT;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=AE;else{if(e.cacheSizeBytes!==Xl&&e.cacheSizeBytes<oT)throw new M(I.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${oT}`);this.cacheSizeBytes=e.cacheSizeBytes}JD("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=tP:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=QE(e.experimentalLongPollingOptions??{}),nP(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&Jk(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}};ji=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ml({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new M(I.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new M(I.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ml(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=WD(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return x(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return Zk(this),Promise.resolve()}};Rn=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},Oe=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new tr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}toJSON(){return{type:n._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(na(t,n._jsonSchema))return new n(e,r||null,new j(ye.fromString(t.referencePath)))}};Oe._jsonSchemaVersion="firestore/documentReference/1.0";Oe._jsonSchema={type:Re("string",Oe._jsonSchemaVersion),referencePath:Re("string")};tr=class n extends Rn{constructor(e,t,r){super(e,t,$l(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Oe(this.firestore,null,new j(e))}withConverter(e){return new n(this.firestore,e,this._path)}};sP="AsyncQueue",Ll=class{constructor(e=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new Al(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=e}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new At;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}retryNextOp(){return x(this,null,function*(){if(this.retryableOps.length!==0){try{yield this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if($i(e))V(sP,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}})}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(r=>{this.failure=r,this.operationInProgress=!1;let i=ST(r);throw Ut("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.operationInProgress=!1,r))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let i=Kf.createAndSchedule(this,e,t,r,s=>this.removeDelayedOperation(s));return this.delayedOperations.push(i),i}verifyNotFailed(){this.failure&&W(47125,{messageOrStack:ST(this.failure)})}verifyOperationInProgress(){}drain(){return x(this,null,function*(){let e;do e=this.tail,yield e;while(e!==this.tail)})}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{this.delayedOperations.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.delayedOperations)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}};Rt=class extends ji{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Ll,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return x(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Ll(e),this._firestoreClient=void 0,yield e}})}};sr=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n($e.fromBase64String(e))}catch(t){throw new M(I.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n($e.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:n._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(na(e,n._jsonSchema))return n.fromBase64String(e.bytes)}};sr._jsonSchemaVersion="firestore/bytes/1.0";sr._jsonSchema={type:Re("string",sr._jsonSchemaVersion),bytes:Re("string")};Lr=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new M(I.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new mt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};Xs=class{constructor(e){this._methodName=e}};ar=class n{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new M(I.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new M(I.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return ne(this._lat,e._lat)||ne(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:n._jsonSchemaVersion}}static fromJSON(e){if(na(e,n._jsonSchema))return new n(e.latitude,e.longitude)}};ar._jsonSchemaVersion="firestore/geoPoint/1.0";ar._jsonSchema={type:Re("string",ar._jsonSchemaVersion),latitude:Re("number"),longitude:Re("number")};or=class n{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return d1(this._values,e._values)}toJSON(){return{type:n._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(na(e,n._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new n(e.vectorValues);throw new M(I.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};or._jsonSchemaVersion="firestore/vectorValue/1.0";or._jsonSchema={type:Re("string",or._jsonSchemaVersion),vectorValues:Re("object")};cP=/^__.*__$/,np=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new cn(e,this.data,this.fieldMask,t,this.fieldTransforms):new Pr(e,this.data,t,this.fieldTransforms)}},Fl=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new cn(e,this.data,this.fieldMask,t,this.fieldTransforms)}};rp=class n{constructor(e,t,r,i,s,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(ee(ee({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return ql(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(XE(this.dataSource)&&cP.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},Bl=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Zl(e)}createContext(e,t,r,i=!1){return new rp({dataSource:e,methodName:t,targetDoc:r,path:mt.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};Ul=class n extends Xs{_toFieldTransform(e){if(e.dataSource===2)e.fieldMask.push(e.path);else throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof n}};mP=new RegExp("[~\\*/\\[\\]]");Vl=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Oe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document)if(this._converter){let e=new sp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}else return this._userDataWriter.convertValue(this._document.data.value);else return}get(e){if(this._document){let t=this._document.data.field(nc("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},sp=class extends Vl{data(){return super.data()}};Zs=class{},ea=class extends Zs{};zl=class n extends ea{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return i_(e._query,t),new Rn(e.firestore,e.converter,bp(e._query,t))}_parse(e){let t=aa(e.firestore);return gP(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};ap=class n extends Zs{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Vt.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(SP(e._query,t),new Rn(e.firestore,e.converter,bp(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}},op=class n extends ea{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=yP(e._query,this._field,this._direction);return new Rn(e.firestore,e.converter,yO(e._query,t))}};lp=class n extends ea{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new Rn(e.firestore,e.converter,yl(e._query,this._limit,this._limitType))}};cp=class{convertValue(e,t="none"){switch(nr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ve(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Cn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw W(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return lr(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){let t=e.fields?.[Pi].arrayValue?.values?.map(r=>ve(r.doubleValue));return new or(t)}convertGeoPoint(e){return new ar(ve(e.latitude),ve(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=Kl(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(qs(e));default:return null}}convertTimestamp(e){let t=wn(e);return new Ee(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=ye.fromString(e);le(IE(r),9688,{name:e});let i=new ml(r.get(1),r.get(3)),s=new j(r.popFirst(5));return i.isEqual(t)||Ut(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};up=yE();bP={metadata:{id:"test-bundle",createTime:{seconds:1577836805,nanos:6},version:1,totalDocuments:1,totalBytes:416}};ur(bP);wP={documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",readTime:{seconds:5,nanos:6},exists:!0}};ur(wP);CP={document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value"},bar:{integerValue:-42}}}};ur(CP);IP={documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",readTime:{seconds:5,nanos:6},exists:!0}};ur(IP);AP={document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value1"},bar:{integerValue:42},emptyArray:{arrayValue:{}},emptyMap:{mapValue:{}}}}};ur(AP);RP={documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/nodoc",readTime:{seconds:5,nanos:6},exists:!1}};ur(RP);DP={namedQuery:{name:"limitQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"DESCENDING"}],limit:{value:1}},limitType:"FIRST"},readTime:{seconds:1590011379,nanos:191164e3}}};ur(DP);NP={namedQuery:{name:"limitToLastQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"ASCENDING"}],limit:{value:1}},limitType:"LAST"},readTime:{seconds:1590011379,nanos:543063e3}}};ur(NP);OP=1,Gl=class{constructor(e,t){this.firestore=e,this.bundleId=t,this.documents=new Map,this.namedQueries=new Map,this.latestReadTime=new Ee(0,0),this.databaseId=e._databaseId,this.serializer=new _l(this.databaseId,!0),this.userDataReader=new Bl(this.databaseId,!0,this.serializer)}addBundleDocument(e,t){let r=this.documents.get(e.documentPath),i=r?.metadata.queries,s=e.readTime,a=r?.metadata.readTime?vE(r.metadata.readTime):null,o=!s&&a==null,l=s!==void 0&&(a==null||a<s);if((o||l)&&this.documents.set(e.documentPath,{document:this.toBundleDocument(e),metadata:{name:Ws(this.serializer,e.documentKey),readTime:s?bn(this.serializer,s):void 0,exists:e.documentExists}}),s&&s>this.latestReadTime&&(this.latestReadTime=s),t){let c=this.documents.get(e.documentPath);c.metadata.queries=i||[],c.metadata.queries.push(t)}}addBundleQuery(e){if(this.namedQueries.has(e.name))throw new Error(`Query name conflict: ${name} has already been added.`);let t=new Ee(0,0);for(let s of e.docBundleDataArray)this.addBundleDocument(s,e.name),s.readTime&&s.readTime>t&&(t=s.readTime);let r=bE(this.serializer,Bt(e.query)),i={parent:e.parent,structuredQuery:r.queryTarget.structuredQuery};this.namedQueries.set(e.name,{name:e.name,bundledQuery:i,readTime:bn(this.serializer,t)})}toBundleDocument(e){let t=this.userDataReader.createContext(4,"internal toBundledDocument"),r=Bp(e.documentData,t);return{name:Ws(this.serializer,e.documentKey),fields:r.mapValue.fields,updateTime:bn(this.serializer,e.versionTime),createTime:bn(this.serializer,e.createdTime)}}lengthPrefixedString(e){let t=JSON.stringify(e);return`${up.encode(t).byteLength}${t}`}build(){let e="";for(let r of this.namedQueries.values())e+=this.lengthPrefixedString({namedQuery:r});for(let r of this.documents.values()){let i=r.metadata;e+=this.lengthPrefixedString({documentMetadata:i});let s=r.document;s&&(e+=this.lengthPrefixedString({document:s}))}let t={id:this.bundleId,createTime:bn(this.serializer,this.latestReadTime),version:OP,totalDocuments:this.documents.size,totalBytes:up.encode(e).length};return e=this.lengthPrefixedString({metadata:t})+e,e}};Fr=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Br=class n extends Vl{constructor(e,t,r,i,s,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document)if(this._converter){let t=new Ki(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}else return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);else return}get(e,t={}){if(this._document){let r=this._document.data.field(nc("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new M(I.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};if(t.type=n._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument())return t;let r=this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous");return t.bundle=xP(this._firestore,e,r,this.ref.path),t}};Br._jsonSchemaVersion="firestore/documentSnapshot/1.0";Br._jsonSchema={type:Re("string",Br._jsonSchemaVersion),bundleSource:Re("string","DocumentSnapshot"),bundleName:Re("string"),bundle:Re("string")};Ki=class extends Br{data(e={}){return super.data(e)}},Ur=class n{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Fr(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Ki(this._firestore,this._userDataWriter,r.key,r,new Fr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new M(I.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return(!this._cachedChanges||this._cachedChangesIncludeMetadataChanges!==t)&&(this._cachedChanges=PP(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new M(I.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=n._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=ki.newId();let t=this._firestore._databaseId.database,i=`projects/${this._firestore._databaseId.projectId}/databases/${t}/documents`,s=[],a=[],o=[];return this.docs.forEach(l=>{l._document!==null&&(s.push(l._document),a.push(this._userDataWriter.convertObjectMap(l._document.data.value.mapValue.fields,"previous")),o.push(l.ref.path))}),e.bundle=kP(this._firestore,this.query._query,e.bundleName,i,o,s,a),e}};Ur._jsonSchemaVersion="firestore/querySnapshot/1.0";Ur._jsonSchema={type:Re("string",Ur._jsonSchemaVersion),bundleSource:Re("string","QuerySnapshot"),bundleName:Re("string"),bundle:Re("string")};ta=class extends cp{constructor(e){super(),this.firestore=e}convertBytes(e){return new sr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Oe(this.firestore,null,t)}};dp=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=aa(e)}set(e,t,r){this._verifyNotCommitted();let i=xh(e,this._firestore),s=Vp(i.converter,t,r),a=Fp(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(a.toMutation(i._key,pt.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=xh(e,this._firestore);t=ot(t);let a;return typeof t=="string"||t instanceof Lr?a=e_(this._dataReader,"WriteBatch.update",s._key,t,r,i):a=ZE(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(a.toMutation(s._key,pt.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=xh(e,this._firestore);return this._mutations=this._mutations.concat(new zi(t._key,pt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new M(I.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};lP("node")});var l_=dr(()=>{"use strict";o_()});var LP,FP,c_=dr(()=>{"use strict";ic();ic();LP="firebase",FP="12.1.0";Yi(LP,FP,"app")});var u_={};jp(u_,{environmentVars:()=>BP});var BP,d_=dr(()=>{"use strict";BP={FIREBASE_CONFIG_JSON:"{",FIREBASE_API_KEY:"AIzaSyBaEWIKzLxSH9uZ6d8Jxnr1VvmDIaasjuU",FIREBASE_AUTH_DOMAIN:"",FIREBASE_PROJECT_ID:"",FIREBASE_STORAGE_BUCKET:"",FIREBASE_MESSAGING_SENDER_ID:"",FIREBASE_APP_ID:"",FIREBASE_MEASUREMENT_ID:""}});function Vr(n,e=""){return h_[n]||e}var h_,f_,p_=dr(()=>{"use strict";h_={};try{let{environmentVars:n}=(d_(),v_(u_));h_=n||{}}catch{console.log("No environment variables file found, using defaults")}f_={apiKey:Vr("FIREBASE_API_KEY"),authDomain:Vr("FIREBASE_AUTH_DOMAIN"),projectId:Vr("FIREBASE_PROJECT_ID"),storageBucket:Vr("FIREBASE_STORAGE_BUCKET"),messagingSenderId:Vr("FIREBASE_MESSAGING_SENDER_ID"),appId:Vr("FIREBASE_APP_ID"),measurementId:Vr("FIREBASE_MEASUREMENT_ID")}});var VP={};jp(VP,{auth:()=>qP,db:()=>UP,firebaseApp:()=>Gp});var Gp,UP,qP,zP=dr(()=>{"use strict";c_();__();l_();p_();Gp=um(f_),UP=JE(Gp),qP=hm(Gp)});var zp=class n{initialState={currentUser:null,isAuthenticated:!1,userAccounts:[],userStrategies:[],userPlan:null,pluginHistory:[],reportData:{accountHistory:[],stats:null,balanceData:null,monthlyReports:[]},overviewData:{allUsers:[],subscriptions:[],monthlyReports:[],allAccounts:[],allStrategies:[]},tradeLockerData:new Map,apiCache:new Map,isLoading:{user:!1,accounts:!1,strategies:!1,plan:!1,pluginHistory:!1,tradeLocker:!1,report:!1,overview:!1},errors:{user:null,accounts:null,strategies:null,plan:null,pluginHistory:null,tradeLocker:null,report:null,overview:null},cacheConfig:{tradeLockerTtl:5*60*1e3,apiTtl:10*60*1e3,maxCacheSize:100}};stateSubject=new Wp(this.initialState);state$=this.stateSubject.asObservable();currentUser=dn(null);isAuthenticated=dn(!1);userAccounts=dn([]);userStrategies=dn([]);userPlan=dn(null);pluginHistory=dn([]);reportData=dn({accountHistory:[],stats:null,balanceData:null,monthlyReports:[]});overviewData=dn({allUsers:[],subscriptions:[],monthlyReports:[],allAccounts:[],allStrategies:[]});activeStrategies=hr(()=>this.userStrategies().filter(e=>e.status===!0));totalAccounts=hr(()=>this.userAccounts().length);totalStrategies=hr(()=>this.userStrategies().length);canCreateAccount=hr(()=>{let e=this.userPlan(),t=this.totalAccounts();return e?t<e.maxAccounts:!1});canCreateStrategy=hr(()=>{let e=this.userPlan(),t=this.totalStrategies();return e?t<e.maxStrategies:!1});planLimitations=hr(()=>({maxAccounts:this.userPlan()?.maxAccounts||0,currentAccounts:this.totalAccounts(),maxStrategies:this.userPlan()?.maxStrategies||0,currentStrategies:this.totalStrategies(),canCreateAccount:this.canCreateAccount(),canCreateStrategy:this.canCreateStrategy()}));currentUser$=this.state$.pipe(zt(e=>e.currentUser),Gt());userAccounts$=this.state$.pipe(zt(e=>e.userAccounts),Gt());userStrategies$=this.state$.pipe(zt(e=>e.userStrategies),Gt());userPlan$=this.state$.pipe(zt(e=>e.userPlan),Gt());pluginHistory$=this.state$.pipe(zt(e=>e.pluginHistory),Gt());isLoading$=this.state$.pipe(zt(e=>e.isLoading),Gt());errors$=this.state$.pipe(zt(e=>e.errors),Gt());reportData$=this.state$.pipe(zt(e=>e.reportData),Gt());overviewData$=this.state$.pipe(zt(e=>e.overviewData),Gt());constructor(){$p(()=>{this.updateState({currentUser:this.currentUser(),isAuthenticated:this.isAuthenticated(),userAccounts:this.userAccounts(),userStrategies:this.userStrategies(),userPlan:this.userPlan(),pluginHistory:this.pluginHistory(),reportData:this.reportData(),overviewData:this.overviewData()})})}updateState(e){let t=this.stateSubject.value,r=ee(ee({},t),e);this.stateSubject.next(r)}setCurrentUser(e){this.currentUser.set(e),this.isAuthenticated.set(e!==null),e?this.updateState({currentUser:e,isAuthenticated:!0}):this.clearUserData()}updateUserData(e){let t=this.currentUser();if(t){let r=ee(ee({},t),e);this.currentUser.set(r)}}clearUserData(){this.currentUser.set(null),this.isAuthenticated.set(!1),this.userAccounts.set([]),this.userStrategies.set([]),this.userPlan.set(null),this.pluginHistory.set([]),this.updateState({currentUser:null,isAuthenticated:!1,userAccounts:[],userStrategies:[],userPlan:null,pluginHistory:[]})}setUserAccounts(e){this.userAccounts.set(e)}addAccount(e){let t=this.userAccounts();this.userAccounts.set([...t,e])}updateAccount(e,t){let i=this.userAccounts().map(s=>s.id===e?ee(ee({},s),t):s);this.userAccounts.set(i)}removeAccount(e){let r=this.userAccounts().filter(i=>i.id!==e);this.userAccounts.set(r)}setUserStrategies(e){this.userStrategies.set(e)}addStrategy(e){let t=this.userStrategies();this.userStrategies.set([...t,e])}updateStrategy(e,t){let i=this.userStrategies().map(s=>s.id===e?ee(ee({},s),t):s);this.userStrategies.set(i)}removeStrategy(e){let r=this.userStrategies().filter(i=>i.id!==e);this.userStrategies.set(r)}activateStrategy(e){let r=this.userStrategies().map(i=>Ze(ee({},i),{status:i.id===e}));this.userStrategies.set(r)}setUserPlan(e){this.userPlan.set(e)}updateUserPlan(e){let t=this.userPlan();if(t){let r=ee(ee({},t),e);this.userPlan.set(r)}}setPluginHistory(e){this.pluginHistory.set(e)}addPluginHistoryEntry(e){let t=this.pluginHistory();this.pluginHistory.set([e,...t])}setTradeLockerData(e,t){let r=this.stateSubject.value,i=new Map(r.tradeLockerData);i.set(e,t),this.updateState({tradeLockerData:i})}getTradeLockerData(e){return this.stateSubject.value.tradeLockerData.get(e)||null}isTradeLockerDataValid(e){let t=this.getTradeLockerData(e);if(!t)return!1;let r=Date.now(),i=this.stateSubject.value.cacheConfig.tradeLockerTtl;return r-t.lastUpdated<i}setApiCache(e,t,r){let i=this.stateSubject.value,s=new Map(i.apiCache),a=r||i.cacheConfig.apiTtl;if(s.set(e,{data:t,timestamp:Date.now(),ttl:a}),s.size>i.cacheConfig.maxCacheSize){let o=Array.from(s.entries());o.sort((c,u)=>c[1].timestamp-u[1].timestamp);let l=Math.floor(o.length*.2);for(let c=0;c<l;c++)s.delete(o[c][0])}this.updateState({apiCache:s})}getApiCache(e){let t=this.stateSubject.value,r=t.apiCache.get(e);if(!r)return null;if(Date.now()-r.timestamp>r.ttl){let s=new Map(t.apiCache);return s.delete(e),this.updateState({apiCache:s}),null}return r.data}clearApiCache(){this.updateState({tradeLockerData:new Map,apiCache:new Map})}setLoading(e,t){let r=this.stateSubject.value;this.updateState({isLoading:Ze(ee({},r.isLoading),{[e]:t})})}setError(e,t){let r=this.stateSubject.value;this.updateState({errors:Ze(ee({},r.errors),{[e]:t})})}clearErrors(){this.updateState({errors:{user:null,accounts:null,strategies:null,plan:null,pluginHistory:null,tradeLocker:null,report:null,overview:null}})}getCurrentState(){return this.stateSubject.value}resetState(){this.stateSubject.next(this.initialState),this.currentUser.set(null),this.isAuthenticated.set(!1),this.userAccounts.set([]),this.userStrategies.set([]),this.userPlan.set(null),this.pluginHistory.set([])}isDataStale(e,t=5*60*1e3){return!0}subscribeToUserChanges(){return this.currentUser$}subscribeToAccountsChanges(){return this.userAccounts$}subscribeToStrategiesChanges(){return this.userStrategies$}subscribeToPlanChanges(){return this.userPlan$}subscribeToPluginHistoryChanges(){return this.pluginHistory$}setReportData(e){let t=this.reportData();this.reportData.set(ee(ee({},t),e))}updateReportStats(e){let t=this.reportData();this.reportData.set(Ze(ee({},t),{stats:e}))}updateReportBalance(e){let t=this.reportData();this.reportData.set(Ze(ee({},t),{balanceData:e}))}updateReportHistory(e){let t=this.reportData();this.reportData.set(Ze(ee({},t),{accountHistory:e}))}setOverviewData(e){let t=this.overviewData();this.overviewData.set(ee(ee({},t),e))}updateOverviewUsers(e){let t=this.overviewData();this.overviewData.set(Ze(ee({},t),{allUsers:e}))}updateOverviewSubscriptions(e){let t=this.overviewData();this.overviewData.set(Ze(ee({},t),{subscriptions:e}))}updateOverviewAccounts(e){let t=this.overviewData();this.overviewData.set(Ze(ee({},t),{allAccounts:e}))}updateOverviewStrategies(e){let t=this.overviewData();this.overviewData.set(Ze(ee({},t),{allStrategies:e}))}static \u0275fac=function(t){return new(t||n)};static \u0275prov=Hp({token:n,factory:n.\u0275fac,providedIn:"root"})};export{Ee as a,v2 as b,iP as c,JE as d,S2 as e,T2 as f,E2 as g,_2 as h,b2 as i,w2 as j,C2 as k,I2 as l,A2 as m,R2 as n,D2 as o,N2 as p,l_ as q,Gp as r,UP as s,VP as t,zP as u,zp as v};
