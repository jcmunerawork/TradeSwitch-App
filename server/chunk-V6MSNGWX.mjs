import './polyfills.server.mjs';
import{a as K}from"./chunk-DX5WEOAP.mjs";import{a as S,b as D,c as b,d as k,e as z,f as U,i as $,j as I,l as E,q as G,r as A,u as J}from"./chunk-YWJXSM6M.mjs";import{Ab as x,Cb as g,Eb as m,Ja as H,Ka as l,Ob as q,Pa as V,Qb as L,Rb as s,Sb as h,Tb as O,Va as Y,W as R,Yc as N,_ as F,_a as w,ab as v,ea as f,fa as y,gd as W,ld as P,qb as _,rb as i,sb as r,tb as M,za as C}from"./chunk-YCCZPWYV.mjs";import{k as u}from"./chunk-H4UZCO6D.mjs";G();J();G();J();var T=class c{constructor(e){this.platformId=e;this.isBrowser=P(this.platformId),this.isBrowser&&(this.db=k(A))}isBrowser;db=null;updateAllStrategiesDaysActive(e){return u(this,null,function*(){if(!this.isBrowser||!this.db){console.warn("StrategyDaysUpdaterService: Cannot execute on server");return}try{let t=D(this.db,"configuration-overview"),n=z(t),o=yield I(n),a=[];o.forEach(d=>{let B=d.data();if(B.userId===e&&B.created_at){let Q=this.calculateDaysActive(B.created_at);a.push({id:d.id,daysActive:Q})}});let p=a.map(d=>E(b(this.db,"configuration-overview",d.id),{days_active:d.daysActive,updated_at:S.now()}));p.length>0&&(yield Promise.all(p))}catch(t){throw console.error("StrategyDaysUpdaterService: Error updating active days:",t),t}})}updateActiveStrategyDaysActive(e){return u(this,null,function*(){if(!this.isBrowser||!this.db){console.warn("StrategyDaysUpdaterService: Cannot execute on server");return}try{let t=D(this.db,"configuration-overview"),n=z(t,U("userId","==",e),U("status","==",!0)),o=yield I(n);if(o.empty){console.log("StrategyDaysUpdaterService: No active strategy found for user:",e);return}let a=o.docs[0],p=a.data();if(!p.created_at){console.warn("StrategyDaysUpdaterService: Active strategy without creation date");return}let d=this.calculateDaysActive(p.created_at);p.days_active!==d&&(yield E(a.ref,{days_active:d,updated_at:S.now()}),console.log(`StrategyDaysUpdaterService: Updated active strategy ${a.id} with ${d} active days`))}catch(t){throw console.error("StrategyDaysUpdaterService: Error updating active strategy days:",t),t}})}updateStrategyDaysActive(e,t){return u(this,null,function*(){if(!this.isBrowser||!this.db){console.warn("StrategyDaysUpdaterService: Cannot execute on server");return}try{let n=b(this.db,"configuration-overview",e),o=yield I(z(D(this.db,"configuration-overview"))),a=null;if(o.forEach(d=>{d.id===e&&d.data().userId===t&&(a=d.data())}),!a||!a.created_at){console.warn("StrategyDaysUpdaterService: Strategy not found or without creation date");return}let p=this.calculateDaysActive(a.created_at);a.days_active!==p&&(yield E(n,{days_active:p,updated_at:S.now()}))}catch(n){throw console.error("StrategyDaysUpdaterService: Error updating strategy active days:",n),n}})}calculateDaysActive(e){let t;if(e&&typeof e.toDate=="function")t=e.toDate();else if(e&&e.seconds)t=new Date(e.seconds*1e3);else if(e instanceof Date)t=e;else if(typeof e=="string")t=new Date(e);else return console.warn("StrategyDaysUpdaterService: Unrecognized date format:",e),0;let n=new Date,o=new Date(n.getFullYear(),n.getMonth(),n.getDate()),a=new Date(t.getFullYear(),t.getMonth(),t.getDate()),p=o.getTime()-a.getTime(),d=Math.floor(p/(1e3*60*60*24));return Math.max(0,d)}getDaysActive(e){return this.calculateDaysActive(e)}static \u0275fac=function(t){return new(t||c)(F(C))};static \u0275prov=R({token:c,factory:c.\u0275fac,providedIn:"root"})};function tt(c,e){if(c&1){let t=x();i(0,"div",28),g("click",function(o){return f(t),y(o.stopPropagation())}),i(1,"button",29),g("click",function(){f(t);let o=m();return y(o.onDuplicate())}),i(2,"span",16),s(3,"content_copy"),r(),i(4,"span"),s(5,"Duplicate"),r()(),i(6,"button",30),g("click",function(){f(t);let o=m();return y(o.onDelete())}),i(7,"span",16),s(8,"delete"),r(),i(9,"span"),s(10,"Delete"),r()()()}}function et(c,e){if(c&1){let t=x();i(0,"button",33),g("click",function(){f(t);let o=m(2);return y(o.onCustomize())}),s(1),r()}if(c&2){let t=m(2);l(),O(" ",t.customizeButtonText," ")}}function nt(c,e){if(c&1){let t=x();i(0,"div",31)(1,"button",32),g("click",function(){f(t);let o=m();return y(o.onEdit())}),s(2," Edit strategy "),r(),w(3,et,2,1,"button",27),r()}if(c&2){let t=m();l(3),_("ngIf",t.showCustomizeButton)}}function it(c,e){if(c&1){let t=x();i(0,"button",33),g("click",function(){f(t);let o=m();return y(o.onCustomize())}),s(1),r()}if(c&2){let t=m();l(),O(" ",t.customizeButtonText," ")}}var j=class c{constructor(e,t){this.daysUpdaterService=e;this.platformId=t;P(this.platformId)&&(this.db=k(A))}strategy={id:"",name:"",status:!1,lastModified:"",rules:0,days_active:0,winRate:0,isFavorite:!1,created_at:null,updated_at:null,userId:"",configurationId:"",dateActive:[],dateInactive:[]};showCustomizeButton=!0;customizeButtonText="Customize strategy";edit=new v;favorite=new v;moreOptions=new v;customize=new v;duplicate=new v;delete=new v;showOptionsMenu=!1;numberFormatter=new K;updateSubscription;userId;db;ngOnInit(){this.calculateActiveRules(),this.updateDaysActive()}ngOnDestroy(){}updateDaysActive(){return u(this,null,function*(){if(!(!this.strategy.id||!this.strategy.userId))try{if(this.strategy.created_at){let e=this.daysUpdaterService.getDaysActive(this.strategy.created_at);this.strategy.days_active=e}yield this.daysUpdaterService.updateStrategyDaysActive(this.strategy.id,this.strategy.userId)}catch(e){console.error("Error al actualizar d\xEDas activos:",e)}})}onEdit(){this.edit.emit(this.strategy.id)}onFavorite(){this.favorite.emit(this.strategy.id)}onMoreOptions(e){e.preventDefault(),e.stopPropagation(),this.showOptionsMenu=!this.showOptionsMenu}onCustomize(){this.customize.emit(this.strategy.id)}onDuplicate(){this.showOptionsMenu=!1,this.duplicate.emit(this.strategy.id)}onDelete(){this.showOptionsMenu=!1,this.delete.emit(this.strategy.id)}onCloseOptionsMenu(){this.showOptionsMenu=!1}onDocumentClick(e){let t=e.target,n=t.closest(".more-btn"),o=t.closest(".options-menu");this.showOptionsMenu&&!n&&!o&&(this.showOptionsMenu=!1)}getStatusClass(){return this.strategy.status?"active":"inactive"}getStatusText(){return this.strategy.status?"Active":"Inactive"}getWinRateWidth(){return`${this.strategy.winRate}%`}formatPercentage(e){return this.numberFormatter.formatPercentage(e)}calculateActiveRules(){return u(this,null,function*(){if(!(!this.db||!this.strategy.configurationId))try{let e=yield $(b(this.db,"configurations",this.strategy.configurationId));if(e.exists()){let t=e.data(),n=0;t.maxDailyTrades?.isActive&&n++,t.riskReward?.isActive&&n++,t.riskPerTrade?.isActive&&n++,t.daysAllowed?.isActive&&n++,t.hoursAllowed?.isActive&&n++,t.assetsAllowed?.isActive&&n++,this.strategy.rules=n}}catch(e){console.error("Error al calcular reglas activas:",e)}})}static \u0275fac=function(t){return new(t||c)(V(T),V(C))};static \u0275cmp=Y({type:c,selectors:[["app-strategy-card"]],hostBindings:function(t,n){t&1&&g("click",function(a){return n.onDocumentClick(a)},H)},inputs:{strategy:"strategy",showCustomizeButton:"showCustomizeButton",customizeButtonText:"customizeButtonText"},outputs:{edit:"edit",favorite:"favorite",moreOptions:"moreOptions",customize:"customize",duplicate:"duplicate",delete:"delete"},decls:45,vars:13,consts:[[1,"strategy-card"],[1,"card-header"],[1,"strategy-info"],[1,"strategy-icon"],[1,"icon-strategy"],[1,"strategy-details"],[1,"strategy-name-container"],[1,"strategy-name"],["title","Edit strategy",1,"action-btn","edit-btn",3,"click"],[1,"material-symbols-outlined",2,"font-size","18px"],[1,"strategy-status"],[1,"status-dot"],[1,"status-text"],[1,"card-actions"],[1,"more-options-container"],["title","More options",1,"action-btn","more-btn",3,"click","mousedown"],[1,"material-symbols-outlined",2,"font-size","20px"],["class","options-menu",3,"click",4,"ngIf"],[1,"last-modified"],[1,"metrics"],[1,"metric-row"],[1,"metric-label"],[1,"metric-value"],[1,"win-rate-container"],[1,"progress-bar"],[1,"progress-fill"],["class","action-buttons",4,"ngIf"],["class","customize-btn",3,"click",4,"ngIf"],[1,"options-menu",3,"click"],[1,"option-btn","duplicate-btn",3,"click"],[1,"option-btn","delete-btn",3,"click"],[1,"action-buttons"],[1,"edit-strategy-btn",3,"click"],[1,"customize-btn",3,"click"]],template:function(t,n){t&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),M(4,"div",4),r(),i(5,"div",5)(6,"div",6)(7,"h3",7),s(8),r(),i(9,"button",8),g("click",function(){return n.onEdit()}),i(10,"span",9),s(11,"edit"),r()()(),i(12,"div",10),M(13,"span",11),i(14,"span",12),s(15),r()()()(),i(16,"div",13)(17,"div",14)(18,"button",15),g("click",function(a){return n.onMoreOptions(a)})("mousedown",function(a){return a.preventDefault()}),i(19,"span",16),s(20,"more_horiz"),r()(),w(21,tt,11,0,"div",17),r()()(),i(22,"div",18),s(23),r(),i(24,"div",19)(25,"div",20)(26,"span",21),s(27,"Rules"),r(),i(28,"span",22),s(29),r()(),i(30,"div",20)(31,"span",21),s(32,"Days Active"),r(),i(33,"span",22),s(34),r()(),i(35,"div",20)(36,"span",21),s(37,"Win Rate"),r(),i(38,"div",23)(39,"span",22),s(40),r(),i(41,"div",24),M(42,"div",25),r()()()(),w(43,nt,4,1,"div",26)(44,it,2,1,"button",27),r()),t&2&&(l(8),h(n.strategy.name),l(5),L(n.getStatusClass()),l(2),h(n.getStatusText()),l(6),_("ngIf",n.showOptionsMenu),l(2),O(" Last modified: ",n.strategy.lastModified," "),l(6),h(n.strategy.rules),l(5),h(n.strategy.days_active),l(6),h(n.formatPercentage(n.strategy.winRate)),l(2),q("width",n.getWinRateWidth()),l(),_("ngIf",!n.strategy.status),l(),_("ngIf",n.showCustomizeButton&&n.strategy.status))},dependencies:[W,N],styles:[`@charset "UTF-8";.strategy-card[_ngcontent-%COMP%]{background:#1a1a1a;border:1px solid #2f2f2f;border-radius:12px;padding:20px;margin-bottom:16px;transition:all .2s ease;position:relative}.strategy-card[_ngcontent-%COMP%]:hover{border-color:#4a4a4a;transform:translateY(-2px);box-shadow:0 4px 12px #0000004d}.card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:stretch;margin-bottom:12px;min-height:60px}.strategy-info[_ngcontent-%COMP%]{display:flex;justify-content:start;gap:12px}.strategy-icon[_ngcontent-%COMP%]{width:50px;height:50px;min-width:50px;min-height:50px;display:flex;align-items:center;justify-content:center;background-color:#5186e433;border-radius:8px;flex-shrink:0}.strategy-icon[_ngcontent-%COMP%]   .icon-strategy[_ngcontent-%COMP%]{width:30px;height:30px;border:2px solid #5186E4;border-radius:50%;background:transparent;display:flex;align-items:center;justify-content:center}.strategy-icon[_ngcontent-%COMP%]   .icon-strategy[_ngcontent-%COMP%]:before{content:none}.strategy-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start;gap:0px;margin:0;min-width:0;height:100%}.strategy-name-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:flex-start;align-items:center;gap:8px;margin:0}.strategy-name[_ngcontent-%COMP%]{color:#e3e3e3;font-size:16px;font-weight:600;line-height:1.2;margin:0;flex:1}.strategy-status[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px}.status-dot[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:50%}.status-dot.active[_ngcontent-%COMP%]{background:#9bf526}.status-dot.inactive[_ngcontent-%COMP%]{background:#8e8e93}.status-dot.draft[_ngcontent-%COMP%]{background:#ff9500}.status-text[_ngcontent-%COMP%]{color:#8e8e93;font-size:12px;font-weight:500}.card-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;height:100%;align-self:stretch}.action-btn[_ngcontent-%COMP%]{width:32px;height:32px;border:none;background:transparent;border-radius:6px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;color:#8e8e93}.action-btn[_ngcontent-%COMP%]:hover{background:#2a2a2a;color:#e3e3e3}.action-btn.favorite-btn.active[_ngcontent-%COMP%]{color:#ff3b30}.action-btn[_ngcontent-%COMP%]   .icon-edit[_ngcontent-%COMP%], .action-btn[_ngcontent-%COMP%]   .icon-like[_ngcontent-%COMP%], .action-btn[_ngcontent-%COMP%]   .icon-more[_ngcontent-%COMP%]{font-size:14px}.last-modified[_ngcontent-%COMP%]{color:#8e8e93;font-size:12px;margin-bottom:16px}.metrics[_ngcontent-%COMP%]{margin-bottom:20px}.metric-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.metric-row[_ngcontent-%COMP%]:last-child{margin-bottom:0}.metric-label[_ngcontent-%COMP%]{color:#8e8e93;font-size:14px;font-weight:500}.metric-value[_ngcontent-%COMP%]{color:#e3e3e3;font-size:14px;font-weight:600}.win-rate-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;flex:1;justify-content:flex-end}.progress-bar[_ngcontent-%COMP%]{width:60px;height:4px;background:#2a2a2a;border-radius:2px;overflow:hidden;position:relative}.progress-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#9bf526,#34c759);border-radius:2px;transition:width .3s ease;position:relative}.progress-fill[_ngcontent-%COMP%]:after{content:"";position:absolute;right:0;top:0;width:2px;height:100%;background:#ff3b30}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:12px;width:100%}.edit-strategy-btn[_ngcontent-%COMP%]{flex:1;background:#2a2a2a;border:1px solid #4a4a4a;border-radius:8px;color:#e3e3e3;font-size:14px;font-weight:600;padding:12px 16px;cursor:pointer;transition:all .2s ease}.edit-strategy-btn[_ngcontent-%COMP%]:hover{background:#3a3a3a;border-color:#6a6a6a;transform:translateY(-1px)}.edit-strategy-btn[_ngcontent-%COMP%]:active{transform:translateY(0)}.customize-btn[_ngcontent-%COMP%]{flex:1;background:#1a3d1a;border:1px solid #9bf526;border-radius:8px;color:#9bf526;font-size:14px;font-weight:600;padding:12px 16px;cursor:pointer;transition:all .2s ease}.customize-btn[_ngcontent-%COMP%]:hover{background:#9bf526;color:#1a1a1a;transform:translateY(-1px)}.customize-btn[_ngcontent-%COMP%]:active{transform:translateY(0)}.customize-btn[_ngcontent-%COMP%]:not(.action-buttons .customize-btn){width:100%}.icon-strategy[_ngcontent-%COMP%]{font-family:icomoon!important;font-size:18px;font-weight:700}.icon-strategy[_ngcontent-%COMP%]:before{content:"\\1f4ca";font-family:Arial,sans-serif!important}.icon-edit[_ngcontent-%COMP%]{font-family:icomoon!important;font-size:14px;font-weight:700}.icon-edit[_ngcontent-%COMP%]:before{content:"\\270f";font-family:Arial,sans-serif!important}.icon-like[_ngcontent-%COMP%]{font-family:icomoon!important;font-size:14px;font-weight:700}.icon-like[_ngcontent-%COMP%]:before{content:"\\2764";font-family:Arial,sans-serif!important}.icon-more[_ngcontent-%COMP%]{font-family:icomoon!important;font-size:14px;font-weight:700;position:relative}.icon-more[_ngcontent-%COMP%]:before{content:"\\22ef";font-family:Arial,sans-serif!important;font-size:16px;font-weight:700;line-height:1}.more-options-container[_ngcontent-%COMP%]{position:relative}.options-menu[_ngcontent-%COMP%]{position:absolute;top:calc(100% + 4px);right:0;background:#2a2a2a;border:1px solid #404040;border-radius:8px;box-shadow:0 4px 12px #0006;z-index:9999;min-width:140px;overflow:hidden}.options-menu[_ngcontent-%COMP%]:before{content:"";position:absolute;top:-6px;right:12px;width:12px;height:12px;background:#2a2a2a;border:1px solid #404040;border-bottom:none;border-right:none;transform:rotate(45deg)}.option-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;width:100%;padding:10px 12px;background:transparent;border:none;color:#e0e0e0;font-size:14px;cursor:pointer;transition:background-color .2s ease;text-align:left}.option-btn[_ngcontent-%COMP%]:hover{background:#3a3a3a}.option-btn[_ngcontent-%COMP%]:first-child{border-bottom:1px solid #404040}.option-btn[_ngcontent-%COMP%]   .icon-copy[_ngcontent-%COMP%], .option-btn[_ngcontent-%COMP%]   .icon-trash[_ngcontent-%COMP%]{width:16px;height:16px;display:flex;align-items:center;justify-content:center}.option-btn[_ngcontent-%COMP%]   .icon-copy[_ngcontent-%COMP%]{background:#4a90e2;mask:url("data:image/svg+xml;utf8,<svg fill='currentColor' viewBox='0 0 24 24'><path d='M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z'/></svg>") no-repeat center;-webkit-mask-size:contain;mask-size:contain}.option-btn[_ngcontent-%COMP%]   .icon-trash[_ngcontent-%COMP%]{background:#e74c3c;mask:url("data:image/svg+xml;utf8,<svg fill='currentColor' viewBox='0 0 24 24'><path d='M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z'/></svg>") no-repeat center;-webkit-mask-size:contain;mask-size:contain}.duplicate-btn[_ngcontent-%COMP%]:hover{color:#4a90e2}.delete-btn[_ngcontent-%COMP%]:hover{color:#e74c3c}.days-active[_ngcontent-%COMP%]{color:#27ae60;font-weight:600;font-size:14px}`]})};export{T as a,j as b};
