import{a as pe,b as ue}from"./chunk-DIYGMRU6.js";import{a as le,b as ce}from"./chunk-EM2IW7TQ.js";import"./chunk-BYXBJQAS.js";import{a as H}from"./chunk-EDQT2HSC.js";import{a as ie,b as oe,c as ae}from"./chunk-HJWNCUMO.js";import{a as se}from"./chunk-5E6NCZTH.js";import{e as s,f as K,g as Q,j as X,m as ee,n as te,u as ne,w as re}from"./chunk-TB2EFIJE.js";import{l as F,m as z}from"./chunk-VOYPPBQ6.js";import{a as W}from"./chunk-4QJ6BWDT.js";import{v as J}from"./chunk-RJHESVFE.js";import{Cc as $,Ha as l,Kb as A,Ma as f,Mb as u,Nb as j,Ob as w,Oc as k,Sa as E,Xb as R,Za as N,dd as Z,ea as g,fa as h,ga as I,gb as _,ha as L,hb as C,ib as D,jb as U,kb as V,lb as b,mb as a,nb as o,ob as P,sb as G,tb as Y,vb as y,xb as v,zb as p}from"./chunk-UAHZMN6X.js";import"./chunk-CSZLD3FT.js";import{a as q,b as B,k as x}from"./chunk-BI7C37SH.js";var _e=r=>({"color-primary-500":r});function Ce(r,e){r&1&&P(0,"div",13)}function Pe(r,e){r&1&&P(0,"div",14)}function xe(r,e){r&1&&P(0,"div",15)}function be(r,e){r&1&&(a(0,"div",20)(1,"span",26),u(2,"Most Popular"),o()())}function ve(r,e){if(r&1&&(a(0,"p",28),u(1),o()),r&2){let t=p().$implicit;b("ngClass",R(2,_e,t.value==="YES")),l(),w(" ",t.value," ")}}function ye(r,e){r&1&&(I(),a(0,"svg",29),P(1,"path",30),o())}function Se(r,e){if(r&1&&(a(0,"li",23)(1,"p"),u(2),o(),a(3,"div",27),_(4,ve,2,4,"p",28)(5,ye,2,0,":svg:svg",29),o()()),r&2){let t=e.$implicit,n=p(2);l(2),j(t.label),l(2),C(n.isNumeric(t.value)?4:5)}}function we(r,e){if(r&1){let t=y();a(0,"div",10)(1,"div",11)(2,"div",12),_(3,Ce,1,0,"div",13),_(4,Pe,1,0,"div",14),_(5,xe,1,0,"div",15),o(),a(6,"div",16)(7,"h2",17),u(8),o(),a(9,"h2",18)(10,"span",19),u(11),o(),u(12),o()(),_(13,be,3,0,"div",20),o(),a(14,"div",21)(15,"ul",22),U(16,Se,6,2,"li",23,D),o()(),a(18,"div",24)(19,"button",25),v("click",function(){let i=g(t).$implicit,c=p();return h(c.onPlanSelect(i))}),u(20),o()()()}if(r&2){let t=e.$implicit;A("isMostPopular",t.mostPopular),l(2),A("isTriangle",t.icon==="triangle")("isCircle",t.icon==="circle")("isSquare",t.icon==="square"),l(),C(t.icon==="triangle"?3:-1),l(),C(t.icon==="circle"?4:-1),l(),C(t.icon==="square"?5:-1),l(3),j(t.name),l(3),w("$",t.price),l(),w(" ",t.period," "),l(),C(t.mostPopular?13:-1),l(3),V(t.features),l(4),w(" ",t.cta," ")}}var T=class r{constructor(e){this.router=e}userData=null;planSelected=new N;goBack=new N;plansData=[{name:"Free",price:0,period:"/month",icon:"triangle",color:"#4b7ee8",features:[{label:"Trading Accounts",value:1},{label:"Strategies",value:1},{label:"Consistency Rules",value:"YES"},{label:"Trading Journal",value:"YES"},{label:"Live Statistics",value:"YES"}],cta:"Get Free Now"},{name:"Starter",price:35,period:"/month",icon:"circle",color:"#4b7ee8",features:[{label:"Trading Accounts",value:2},{label:"Strategies",value:3},{label:"Consistency Rules",value:"YES"},{label:"Trading Journal",value:"YES"},{label:"Live Statistics",value:"YES"}],cta:"Get Starter Now"},{name:"Pro",price:99,period:"/month",mostPopular:!0,icon:"square",color:"#d1ff81",features:[{label:"Trading Accounts",value:6},{label:"Strategies",value:8},{label:"Consistency Rules",value:"YES"},{label:"Trading Journal",value:"YES"},{label:"Live Statistics",value:"YES"}],cta:"Get Pro Now"}];onPlanSelect(e){this.planSelected.emit(e)}onGoBack(){this.goBack.emit()}isNumeric(e){return typeof e=="number"?!0:typeof e=="string"?!isNaN(Number(e))&&!isNaN(parseFloat(e)):!1}static \u0275fac=function(t){return new(t||r)(f(F))};static \u0275cmp=E({type:r,selectors:[["app-plan-selection"]],inputs:{userData:"userData"},outputs:{planSelected:"planSelected",goBack:"goBack"},decls:13,vars:0,consts:[[1,"plan-selection-container"],[1,"header-section"],[1,"main-titles","color-background","d-flex","flex-col","mb-48"],[1,"titleText","mb-32"],[1,"regularText"],[1,"close-button",3,"click"],["width","24","height","24","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M18 6L6 18M6 6L18 18","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],[1,"plans-list","d-flex","items-center","justify-center","items-center","mb-64"],[1,"plan-card","d-flex","p-24","flex-col","items-start","color-background","regularText",3,"isMostPopular"],[1,"plan-card","d-flex","p-24","flex-col","items-start","color-background","regularText"],[1,"plan-card-header","d-flex","items-start","justify-start"],[1,"card-icon","d-flex","items-center","justify-center","p-10"],[1,"triangle-icon"],[1,"circle-icon"],[1,"square-icon"],[1,"plan-card-titles","d-flex","flex-col","items-start"],[1,"planName","subtitle"],[1,"subtitle","mt-12"],[1,"titleText"],[1,"popular","py-4","px-6"],[1,"plan-features"],[1,"d-flex","flex-col","items-start"],[1,"feature-item","d-flex","justify-between","regularText"],[1,"plan-card-footer","d-flex","items-center","justify-center"],[1,"btn-primary","regularSemiText",3,"click"],[1,"mostPopular","p-10","regularSemiText"],[1,"feature-value"],[3,"ngClass"],["width","16","height","16","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg",1,"check-icon"],["d","M20 6L9 17L4 12","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"]],template:function(t,n){t&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),u(4,"Start Subscription"),o(),a(5,"h3",4),u(6," Select the right plan for you "),o()(),a(7,"button",5),v("click",function(){return n.onGoBack()}),I(),a(8,"svg",6),P(9,"path",7),o()()(),L(),a(10,"section",8),U(11,we,21,16,"div",9,D),o()()),t&2&&(l(11),V(n.plansData))},dependencies:[k,$],styles:['.plan-selection-container[_ngcontent-%COMP%]{min-height:100vh;background:#0a0a0a;padding:1rem}.header-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:start;margin-bottom:.5rem;width:100%}.close-button[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;padding:.5rem;border-radius:.375rem;transition:background-color .2s ease}.close-button[_ngcontent-%COMP%]:hover{background-color:#ffffff1a}.plans-list[_ngcontent-%COMP%]{align-content:flex-start;gap:1rem;display:grid;grid-template-columns:repeat(3,1fr);width:100%}.plans-list[_ngcontent-%COMP%]   .plan-card[_ngcontent-%COMP%]{gap:32px;min-width:20rem;height:100%;border-radius:.5rem;border:.5px solid #4a4a4a;background:radial-gradient(circle at top center,#5186e41a,#5186e403 50%),#151516;display:flex;flex-direction:column;justify-content:space-between}.plans-list[_ngcontent-%COMP%]   .plan-card.isMostPopular[_ngcontent-%COMP%]{background:radial-gradient(circle at top center,#bcfe631a,#bcfe6303 50%)}.plans-list[_ngcontent-%COMP%]   .plan-card[_ngcontent-%COMP%]   .plan-card-header[_ngcontent-%COMP%]{gap:1rem;width:100%;position:relative;min-height:80px}.plans-list[_ngcontent-%COMP%]   .plan-card[_ngcontent-%COMP%]   .plan-card-header[_ngcontent-%COMP%]   .card-icon[_ngcontent-%COMP%]{border-radius:8.235px}.plans-list[_ngcontent-%COMP%]   .plan-card[_ngcontent-%COMP%]   .plan-card-header[_ngcontent-%COMP%]   .card-icon.isTriangle[_ngcontent-%COMP%], .plans-list[_ngcontent-%COMP%]   .plan-card[_ngcontent-%COMP%]   .plan-card-header[_ngcontent-%COMP%]   .card-icon.isCircle[_ngcontent-%COMP%]{background-color:#5186e433}.plans-list[_ngcontent-%COMP%]   .plan-card[_ngcontent-%COMP%]   .plan-card-header[_ngcontent-%COMP%]   .card-icon.isSquare[_ngcontent-%COMP%]{background-color:#bcfe6333}.plans-list[_ngcontent-%COMP%]   .plan-card[_ngcontent-%COMP%]   .plan-card-header[_ngcontent-%COMP%]   .card-icon[_ngcontent-%COMP%]   .triangle-icon[_ngcontent-%COMP%]{width:48px;height:48px;border:5px solid #5186e4;border-radius:8px;position:relative}.plans-list[_ngcontent-%COMP%]   .plan-card[_ngcontent-%COMP%]   .plan-card-header[_ngcontent-%COMP%]   .card-icon[_ngcontent-%COMP%]   .triangle-icon[_ngcontent-%COMP%]:before{content:"";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:0;height:0;border-left:12px solid transparent;border-right:12px solid transparent;border-bottom:20px solid #5186e4}.plans-list[_ngcontent-%COMP%]   .plan-card[_ngcontent-%COMP%]   .plan-card-header[_ngcontent-%COMP%]   .card-icon[_ngcontent-%COMP%]   .circle-icon[_ngcontent-%COMP%]{width:48px;height:48px;border:5px solid #5186e4;border-radius:50%}.plans-list[_ngcontent-%COMP%]   .plan-card[_ngcontent-%COMP%]   .plan-card-header[_ngcontent-%COMP%]   .card-icon[_ngcontent-%COMP%]   .square-icon[_ngcontent-%COMP%]{width:48px;height:48px;border:5px solid #bcfe63;border-radius:15px}.plans-list[_ngcontent-%COMP%]   .plan-card[_ngcontent-%COMP%]   .plan-card-header[_ngcontent-%COMP%]   .popular[_ngcontent-%COMP%]{position:absolute;top:0;right:0;background:#14ae5c26;border-radius:.25rem;color:#14ae5c;z-index:1}.plans-list[_ngcontent-%COMP%]   .plan-card[_ngcontent-%COMP%]   .plan-features[_ngcontent-%COMP%]{width:100%;flex:1}.plans-list[_ngcontent-%COMP%]   .plan-card[_ngcontent-%COMP%]   .plan-features[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0;gap:2.1875rem;width:100%;height:100%;display:flex;flex-direction:column;justify-content:space-between}.plans-list[_ngcontent-%COMP%]   .plan-card[_ngcontent-%COMP%]   .plan-features[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%], .plans-list[_ngcontent-%COMP%]   .plan-card[_ngcontent-%COMP%]   .plan-card-footer[_ngcontent-%COMP%]{width:100%}.plans-list[_ngcontent-%COMP%]   .plan-card[_ngcontent-%COMP%]   .plan-card-footer[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]{color:#222325;border-radius:.375rem;background:#9bf526;border:none;width:100%;padding:.625rem;cursor:pointer;transition:all .2s ease}.plans-list[_ngcontent-%COMP%]   .plan-card[_ngcontent-%COMP%]   .plan-card-footer[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]:hover{background:#8ae01f;transform:translateY(-1px)}.feature-value[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end}.feature-value[_ngcontent-%COMP%]   .check-icon[_ngcontent-%COMP%]{color:#9bf526;width:16px;height:16px}@media (max-width: 768px){.plans-list[_ngcontent-%COMP%]{flex-direction:column;align-items:center}.plans-list[_ngcontent-%COMP%]   .plan-card[_ngcontent-%COMP%]{min-width:100%;max-width:200px}}']})};function Oe(r,e){r&1&&(a(0,"p",16),u(1," Already have an account? "),a(2,"a",17),u(3,"Log in"),o()())}function Me(r,e){if(r&1){let t=y();a(0,"form",8),v("ngSubmit",function(){g(t);let i=p(2);return h(i.onSubmit())}),G(1),P(2,"app-text-input",9)(3,"app-text-input",10)(4,"app-text-input",11)(5,"app-password-input",12),a(6,"div"),P(7,"app-phone-input",13),o(),P(8,"app-birthday-input",14),a(9,"button",15),u(10," Next "),o(),_(11,Oe,4,0,"p",16),Y(),o()}if(r&2){let t,n,i=p(2);b("formGroup",i.signupForm),l(5),b("showValidation",!0)("userEmail",((t=i.signupForm.get("email"))==null?null:t.value)||"")("userName",((n=i.signupForm.get("firstName"))==null?null:n.value)||""),l(6),C(i.isAdminSignup?-1:11)}}function Ee(r,e){if(r&1&&(a(0,"div",0)(1,"div",3)(2,"div",4)(3,"h1",5),u(4,"Create account"),o(),a(5,"p",6),u(6,"Because trading with rules starts right here"),o()(),_(7,Me,12,5,"form",7),o()()),r&2){let t=p();l(7),C(t.currentStep===1||t.isAdminSignup?7:-1)}}function ke(r,e){if(r&1){let t=y();a(0,"app-plan-selection",18),v("planSelected",function(i){g(t);let c=p();return h(c.onPlanSelected(i))})("goBack",function(){g(t);let i=p();return h(i.onGoBackToSignup())}),o()}if(r&2){let t=p();b("userData",t.userData)}}function Fe(r,e){if(r&1){let t=y();a(0,"app-subscription-processing",19),v("paymentSuccess",function(){g(t);let i=p();return h(i.onPaymentProcessingSuccess())})("paymentError",function(){g(t);let i=p();return h(i.onPaymentProcessingError())})("goBack",function(){g(t);let i=p();return h(i.onPaymentProcessingGoBack())}),o()}if(r&2){let t=p();b("config",t.subscriptionProcessingConfig)}}function Te(r,e){if(r&1){let t=y();a(0,"app-order-summary",20),v("continue",function(){g(t);let i=p();return h(i.onOrderSummaryContinue())}),o()}if(r&2){let t=p();b("config",t.orderSummaryConfig)}}var de=class r{constructor(e,t,n,i,c,m,S){this.fb=e;this.authService=t;this.router=n;this.planService=i;this.subscriptionService=c;this.store=m;this.appContext=S;this.signupForm=this.fb.group({firstName:["",[s.required,s.minLength(2)]],lastName:["",[s.required,s.minLength(2)]],phoneNumber:["",[s.required,this.phoneValidator]],birthday:["",[s.required,this.ageValidator]],email:["",[s.required,s.email,this.emailValidator]],password:["",[s.required,s.minLength(6)]]}),this.accountForm=this.fb.group({emailTradingAccount:["",[s.required,s.email]],brokerPassword:["",[s.required,s.minLength(6)]],server:["",[s.required]],accountName:["",[s.required]],accountID:["",[s.required]],accountNumber:["",[s.required,s.pattern("^[0-9]*$")]]})}signupForm;accountForm;currentStep=1;isAdminSignup=!1;showPlanSelection=!1;showPaymentProcessing=!1;showOrderSummary=!1;userData=null;selectedPlan=null;selectedPlanId="";currentPaymentId="";currentUserId="";subscriptionProcessingConfig={paymentId:"",userId:"",context:"signup"};orderSummaryConfig={context:"signup",planName:"",price:0,userData:null};ngOnInit(){this.router.url==="/admin-signup"&&(this.isAdminSignup=!0)}onChange(){console.log("Form changed:",this.signupForm.value)}onSubmit(){this.signupForm.valid?(this.userData=this.signupForm.value,this.showPlanSelection=!0):this.showValidationErrors()}markFormGroupTouched(){Object.keys(this.signupForm.controls).forEach(e=>{this.signupForm.get(e)?.markAsTouched()})}signInWithGoogle(){console.log("Sign in with Google")}signInWithApple(){console.log("Sign in with Apple")}createUserCredentialsObject(){return{email:this.signupForm.value.email,password:this.signupForm.value.password}}createUserObject(e,t){return x(this,null,function*(){return{id:e,email:this.signupForm.value.email,tokenId:t,firstName:this.signupForm.value.firstName,lastName:this.signupForm.value.lastName,phoneNumber:this.signupForm.value.phoneNumber,birthday:this.signupForm.value.birthday,best_trade:0,netPnl:0,number_trades:0,profit:0,status:"created",strategy_followed:0,subscription_date:new Date().getTime(),lastUpdated:new Date().getTime(),total_spend:0,isAdmin:!1}})}createTokenObject(e){return{id:this.signupForm.value.email.split("@")[0]+e.substring(0,4),userId:e}}phoneValidator(e){if(!e.value)return null;let t=/^[\+]?[1-9][\d]{0,15}$/,n=e.value.replace(/[\s\-\(\)]/g,"");return t.test(n)?n.length<10||n.length>15?{invalidPhoneLength:!0}:null:{invalidPhone:!0}}ageValidator(e){if(!e.value)return null;let t=new Date,n=new Date(e.value),i=t.getFullYear()-n.getFullYear(),c=t.getMonth()-n.getMonth();return(c<0||c===0&&t.getDate()<n.getDate())&&i--,i<18?{underage:!0}:null}emailValidator(e){return e.value?/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e.value)?null:{invalidEmailFormat:!0}:null}showValidationErrors(){let e=[],t=this.signupForm.get("firstName"),n=this.signupForm.get("lastName"),i=this.signupForm.get("email"),c=this.signupForm.get("phoneNumber"),m=this.signupForm.get("birthday"),S=this.signupForm.get("password");t?.errors?.required?e.push("First name is required"):t?.errors?.minlength&&e.push("First name must be at least 2 characters"),n?.errors?.required?e.push("Last name is required"):n?.errors?.minlength&&e.push("Last name must be at least 2 characters"),i?.errors?.required?e.push("Email is required"):i?.errors?.email?e.push("Invalid email format"):i?.errors?.invalidEmailFormat&&e.push("Invalid email format. Must contain @ and a valid domain"),c?.errors?.required?e.push("Phone number is required"):c?.errors?.invalidPhone?e.push("Invalid phone number format"):c?.errors?.invalidPhoneLength&&e.push("Phone number must be between 10 and 15 digits"),m?.errors?.required?e.push("Birthday is required"):m?.errors?.underage&&e.push("You must be 18 years or older to register"),S?.errors?.required?e.push("Password is required"):S?.errors?.minlength&&e.push("Password must be at least 6 characters"),e.length>0&&alert(`Validation errors:

`+e.join(`
`)),this.markFormGroupTouched()}onPlanSelected(e){return x(this,null,function*(){try{this.selectedPlan=e,this.showPlanSelection=!1,this.showPaymentProcessing=!0,this.appContext.setLoading("user",!0),this.appContext.setError("user",null);let t=this.createUserCredentialsObject(),i=(yield this.authService.register(t)).user.uid,c=this.createTokenObject(i),m=yield this.createUserObject(i,c.id);this.isAdminSignup&&(m.isAdmin=!0,m.status="admin"),yield this.authService.createUser(m),yield this.authService.createLinkToken(c),this.currentUserId=i,this.appContext.setCurrentUser(m),this.authService.login(t).then(d=>{this.authService.getUserData(d.user.uid).then(M=>{this.appContext.setCurrentUser(M),this.store.dispatch(H({user:M})),this.appContext.setLoading("user",!1)}).catch(M=>{this.appContext.setLoading("user",!1),this.appContext.setError("user","Error al obtener datos del usuario"),console.error("Error in the login:",M)})}).catch(d=>{this.appContext.setLoading("user",!1),this.appContext.setError("user","Error de autenticaci\xF3n"),console.error("Error in the login:",d)});let S=yield this.authService.getBearerTokenFirebase(i),O=yield this.planService.searchPlansByName(e.name);if(!O||O.length===0)throw new Error(`Plan '${e.name}' no encontrado en Firebase`);this.selectedPlanId=O[0].id;let me=O[0].planPriceId||"";this.subscriptionProcessingConfig={paymentId:"",userId:i,context:"signup"},this.orderSummaryConfig={context:"signup",planName:e.name,price:e.price,userData:this.userData};try{let d=yield fetch("https://trade-manager-backend-836816769157.us-central1.run.app/payments/create-customer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:i})});if(!d.ok)throw new Error(`Error creating customer: ${d.status} ${d.statusText}`)}catch(d){throw console.error("Error creating customer:",d),yield this.cleanupFailedAccount(i),new Error("Error connecting to payment service. Please try again.")}try{yield this.simulatePaymentProcessing(me,S)}catch(d){throw console.error("Error in payment processing:",d),yield this.cleanupFailedAccount(i),new Error("Payment processing failed. Please try again.")}}catch(t){console.error("Error en el proceso de registro:",t),this.onPaymentError("Error processing the subscription. Please try again.")}})}onGoBackToSignup(){this.showPlanSelection=!1}simulatePaymentProcessing(e,t){return x(this,null,function*(){if(!e||!t)throw new Error("Price ID or bearer token not found");try{let n=yield fetch("https://trade-manager-backend-836816769157.us-central1.run.app/payments/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({priceId:e})});if(!n.ok){let m=yield n.text();throw new Error(`Error creating checkout session: ${n.status} ${n.statusText} - ${m}`)}let i=yield n.json(),c=i.body?.url||i.url;if(!c)throw new Error("Payment URL not found in response");window.location.href=c}catch(n){throw console.error("Fetch error details:",n),new Error("Error connecting to payment service. Please try again.")}})}onPaymentError(e){this.showPaymentProcessing=!1,this.showPlanSelection=!0,alert(e||"Error processing the subscription. Please try again.")}onPaymentProcessingSuccess(){return x(this,null,function*(){try{yield this.createUserSubscription()}catch(e){console.error("Error updating user and creating subscription:",e),this.onPaymentProcessingError()}})}onPaymentProcessingError(){this.showPaymentProcessing=!1,this.showPlanSelection=!0,alert("Error processing the subscription. Please try again.")}cleanupFailedAccount(e){return x(this,null,function*(){try{let t=this.authService.getCurrentUser();t&&(yield t.delete(),console.log("Firebase Auth user deleted")),yield this.authService.deleteUser(e);try{let n=this.createTokenObject(e);yield this.authService.deleteLinkToken(n.id)}catch(n){console.log("Token may not exist or already deleted:",n)}this.appContext.setCurrentUser(null),this.store.dispatch({type:"[User] Clear User"}),this.currentUserId="",this.selectedPlanId="",this.currentPaymentId=""}catch(t){console.error("Error during account cleanup:",t)}})}onPaymentProcessingGoBack(){this.showPaymentProcessing=!1,this.showPlanSelection=!0}onOrderSummaryContinue(){this.showOrderSummary=!1,alert("Registration completed successfully!"),this.router.navigate(["/login"])}updateUserWithPlan(){return x(this,null,function*(){if(!this.selectedPlan||!this.currentUserId)throw new Error("Plan selected or user ID not available");try{let e=yield this.authService.getUserById(this.currentUserId);if(!e)throw new Error("User not found in Firebase");let t=B(q({},e),{subscription_date:new Date().getTime(),lastUpdated:new Date().getTime(),status:"active"});yield this.authService.updateUser(this.currentUserId,t)}catch(e){throw console.error("\u274C Error updating user:",e),new Error(`Error actualizando usuario: ${e instanceof Error?e.message:"Error desconocido"}`)}})}createUserSubscription(){return x(this,null,function*(){if(!this.selectedPlan||!this.currentUserId||!this.selectedPlanId)throw new Error("Plan seleccionado, ID de usuario o ID de plan no disponible");try{let e={planId:"Cb1B0tpxdE6AP6eMZDo0",status:"created",userId:this.currentUserId},t=yield this.subscriptionService.createSubscription(this.currentUserId,e);this.currentPaymentId=t,this.subscriptionProcessingConfig.paymentId=t}catch(e){throw console.error("\u274C Error creando pago:",e),new Error(`Error creando pago: ${e instanceof Error?e.message:"Error desconocido"}`)}})}static \u0275fac=function(t){return new(t||r)(f(ne),f(W),f(F),f(ce),f(le),f(Z),f(J))};static \u0275cmp=E({type:r,selectors:[["app-signup"]],decls:4,vars:1,consts:[[1,"signup-container"],[3,"userData"],[3,"config"],[1,"signup-wrapper"],[1,"signup-header"],[1,"signup-title"],[1,"signup-subtitle"],[1,"signup-form",3,"formGroup"],[1,"signup-form",3,"ngSubmit","formGroup"],["name","firstName","label","First Name","placeholder","Your first name here","formControlName","firstName",1,"form-input"],["name","lastName","label","Last Name","placeholder","Your last name here","formControlName","lastName",1,"form-input"],["name","email","label","Email","placeholder","Your email here","formControlName","email","type","email",1,"form-input"],["label","Password","placeholder","Your password here","formControlName","password",1,"form-input",3,"showValidation","userEmail","userName"],["label","Phone number","placeholder","Your phone number here","formControlName","phoneNumber",1,"form-input"],["label","Birthday","placeholder","Your birthday here","formControlName","birthday",1,"form-input"],["type","submit",1,"submit-button"],[1,"login-text"],["routerLink","/login"],[3,"planSelected","goBack","userData"],[3,"paymentSuccess","paymentError","goBack","config"],[3,"continue","config"]],template:function(t,n){t&1&&_(0,Ee,8,1,"div",0)(1,ke,1,1,"app-plan-selection",1)(2,Fe,1,1,"app-subscription-processing",2)(3,Te,1,1,"app-order-summary",2),t&2&&C(!n.showPlanSelection&&!n.showPaymentProcessing&&!n.showOrderSummary?0:n.showPlanSelection?1:n.showPaymentProcessing?2:n.showOrderSummary?3:-1)},dependencies:[k,re,X,K,Q,ee,te,oe,ae,ie,se,z,T,pe,ue],styles:['.signup-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;height:100%;max-width:100%;overflow-x:hidden;box-sizing:border-box}.signup-wrapper[_ngcontent-%COMP%]{width:100%;max-width:480px;padding:40px 20px;min-height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;box-sizing:border-box}@media (max-width: 540px){.signup-wrapper[_ngcontent-%COMP%]{padding:20px 16px}}@media (max-width: 400px){.signup-wrapper[_ngcontent-%COMP%]{padding:16px 12px}}.signup-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:20px}.signup-title[_ngcontent-%COMP%]{color:var(--White, #eaf2f8);text-align:center;font-family:SF Pro Display;font-size:46px;font-feature-settings:"liga" off,"clig" off;letter-spacing:-.435px}.signup-subtitle[_ngcontent-%COMP%]{color:#ffffffb3;font-family:SF Pro Display;font-size:16px;font-style:normal;font-weight:400;line-height:14px;margin:10px 0 0}.progress-bar[_ngcontent-%COMP%]{width:50%;height:4px;background:#fff3;border-radius:2px;overflow:hidden}.progress-fill[_ngcontent-%COMP%]{width:100%;height:100%;background:#fff;border-radius:2px;transition:width .3s ease}.progress-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:10px}.signup-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px;padding:0;width:100%}.signup-form[_ngcontent-%COMP%]   .ng-container[_ngcontent-%COMP%]{width:100%;padding:0}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.input-label[_ngcontent-%COMP%]{color:#fff;font-family:SF Pro Display;font-size:14px;font-style:normal;font-weight:500;line-height:14px;margin:0}.submit-button[_ngcontent-%COMP%]{background:var(--Primary-400, #9bf526);color:#0a0a0a;border:none;border-radius:8px;padding:16px 24px;font-family:SF Pro Display;font-size:16px;font-style:normal;font-weight:700;line-height:14px;cursor:pointer;transition:all .2s ease;margin-top:4px}.submit-button[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--Primary-700, #468506);transform:translateY(-1px)}.submit-button[_ngcontent-%COMP%]:active:not(:disabled){transform:translateY(0)}.submit-button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed;transform:none}.signup-methods-separator[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;font-family:SF Pro Display;gap:8px;color:#eaf2f8;font-size:16px}.separator-line[_ngcontent-%COMP%]{flex:1;height:1px;background:#8e8e93}.social-button[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center;background:transparent;border:1px solid rgba(255,255,255,.3);border-radius:8px;padding:12px 16px;color:#fff;font-family:SF Pro Display;font-size:14px;font-style:normal;font-weight:500;line-height:14px;cursor:pointer;transition:all .2s ease}.social-button[_ngcontent-%COMP%]:hover{background:#ffffff1a}.social-buttons-container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:row;gap:16px}.login-text[_ngcontent-%COMP%]{color:#ffffffb3;font-family:SF Pro Display;font-size:14px;font-style:normal;font-weight:400;line-height:14px}.login-text[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--Primary-400, #9bf526);text-decoration:none}.login-text[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}']})};export{de as SignupComponent};
