import{a as it,b as at}from"./chunk-Q4UU5KEX.js";import{a as $t}from"./chunk-Q7LL5VG7.js";import{a as Ht}from"./chunk-QT3TED6C.js";import{a as Ut}from"./chunk-LJ2FCI6F.js";import{a as te,b as Wt}from"./chunk-JG5HE6JJ.js";import{a as Ft}from"./chunk-SKZDU2RJ.js";import{a as zt}from"./chunk-HLCVMOPQ.js";import{a as Nt,b as Vt,c as Yt,d as Gt,e as jt,g as ht,h as ft,i as nt}from"./chunk-SAK2ZTT3.js";import{g as et,h as K}from"./chunk-63WLWL6S.js";import{a as ut,b as j,c as At,d as Et,e as It,f as Rt,g as Lt}from"./chunk-KUEGTDR3.js";import{a as kt}from"./chunk-THDE5PKG.js";import"./chunk-BFDJ3X5L.js";import"./chunk-EM2IW7TQ.js";import"./chunk-BYXBJQAS.js";import{a as L}from"./chunk-6B66MAHI.js";import{v as tt,w as Tt}from"./chunk-TB2EFIJE.js";import{l as Mt}from"./chunk-VOYPPBQ6.js";import{a as Dt}from"./chunk-4QJ6BWDT.js";import{v as Ot}from"./chunk-RJHESVFE.js";import{$b as H,Cc as Q,Dc as wt,Ec as Z,Ga as Ct,Ha as l,Kb as gt,Kc as vt,Ma as M,Mb as s,Nb as b,Nc as Pt,Ob as P,Oc as I,Pb as V,Sa as E,Sc as B,Wb as bt,Xa as Y,Za as G,Zb as _t,bc as mt,cc as yt,dd as St,ea as f,fa as x,gb as S,hb as T,ib as $,jb as z,kb as N,lb as m,mb as a,nb as r,ob as k,ra as R,vb as v,xb as u,ya as X,zb as g}from"./chunk-UAHZMN6X.js";import"./chunk-CSZLD3FT.js";import{a as J,b as q,h as Zt,k as A}from"./chunk-BI7C37SH.js";function ne(c,e){if(c&1){let t=v();a(0,"div",12)(1,"div",13)(2,"span",14),s(3),H(4,"date"),H(5,"date"),r(),a(6,"button",15),u("click",function(){f(t);let n=g();return x(n.clearDateFilter())}),a(7,"span",16),s(8,"close"),r()()()()}if(c&2){let t=g();l(3),V(" ",mt(4,2,t.selectedStartDate,"short")," - ",mt(5,5,t.selectedEndDate,"short")," ")}}function ie(c,e){if(c&1){let t=v();a(0,"div",17)(1,"div",18)(2,"div",19)(3,"h4",20),s(4,"Filter by Date Range"),r(),a(5,"div",21)(6,"div",22)(7,"label",23),s(8,"From:"),r(),a(9,"input",24),u("change",function(n){f(t);let o=g();return x(o.onStartDateSelected(n.target.value))}),r()(),a(10,"div",22)(11,"label",23),s(12,"To:"),r(),a(13,"input",24),u("change",function(n){f(t);let o=g();return x(o.onEndDateSelected(n.target.value))}),r()()(),a(14,"div",25)(15,"button",26),u("click",function(){f(t);let n=g();return x(n.applyDateFilter())}),s(16," Apply "),r(),a(17,"button",27),u("click",function(){f(t);let n=g();return x(n.clearDateFilter())}),s(18," Clear "),r()()()()()}if(c&2){let t=g();l(9),m("value",t.selectedStartDate),l(4),m("value",t.selectedEndDate)}}var ot=class c{constructor(e){this.platformId=e}values;onYearChange=new G;chartOptions;numberFormatter=new L;year;dateRanges=[];showDateFilter=!1;selectedStartDate="";selectedEndDate="";filteredData=[];originalData=[];ngOnInit(){this.year=new Date().getFullYear().toString(),this.generateYearRangesPast(3),this.initializeData()}ngOnChanges(e){e.values&&this.values&&this.initializeData()}initializeData(){this.values&&this.values.length>0?(this.originalData=[...this.values],this.filteredData=[...this.values],this.chartOptions=this.getChartOptions(this.filteredData)):(this.originalData=[],this.filteredData=[],this.chartOptions=this.getEmptyChartOptions())}generateYearRangesPast(e){let i=new Date().getFullYear();this.dateRanges=[];for(let n=2;n>=0;n--){let o=i-n;this.dateRanges.push({label:`Jan ${o} - Dec ${o}`,value:`${o}`})}for(let n=1;n<=5;n++){let o=i+n;this.dateRanges.push({label:`Jan ${o} - Dec ${o}`,value:`${o}`})}}getChartOptions(e){let t=this.year,i=e;!this.selectedStartDate&&!this.selectedEndDate&&(i=this.applyYearFilter(e));let n=this.getMonthlyChartConfig(i,t);return{chart:{type:"area",height:350,toolbar:{show:!1},foreColor:"#fff",fontFamily:"Inter, Arial, sans-serif",background:"transparent"},series:[{name:"PnL",data:n.data}],xaxis:{categories:n.categories,labels:{style:{colors:"#d8d8d8"}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{style:{colors:"#d8d8d8"}}},grid:{borderColor:"#333",strokeDashArray:4,xaxis:{lines:{show:!0}}},dataLabels:{enabled:!1},stroke:{curve:"straight",width:1,colors:["#EAF2F8"]},fill:{type:"gradient",gradient:{shade:"dark",type:"vertical",gradientToColors:["#3967D7"],opacityFrom:.4,opacityTo:0}},tooltip:{theme:"dark",x:{show:!0},custom:({series:o,seriesIndex:p,dataPointIndex:d,w:h})=>{let _=o[p][d],O=h.globals.categoryLabels[d],D=d>0?o[p][d-1]:null,C=0,y=null,w="",F="";D!==null&&D!==0?(C=(_-D)/Math.abs(D)*100,y=C>0?"up":"down",y==="up"?(w="positive-container",F="positive-validator"):(w="negative-container",F="negative-validator")):(C=null,y=null);let U=this.getFormatedValue(_),xt=this.numberFormatter.formatPercentageValue(C);return`<div class=" ${w} regularText color-background d-flex flex-col toolTip-container items-start">
          <p class="smallText color-text-gray">${O}, ${t}</p>
          <div class="d-flex text-container items-center ">
                    <p class= "subtitle">
                    ${U}
          </p>
          ${C!=null?`<span class="smallText py-4 px-6 d-flex justify-center items-center ${F}">${xt}% <span class="${y==="up"?"icon-status-arrow-up":"icon-status-arrow"} ml-3"></span></span>`:""}
          </div>

        
          </div>`},position:function(o,p){return{left:o.point.x,top:o.point.y-160}}}}}applyYearFilter(e){if(!e||e.length===0)return[];let t=[...e],i=parseInt(this.year);return t=t.filter(n=>new Date(Number(n.lastModified)).getFullYear()===i),t}applyDateRangeFilter(e,t,i){if(!t&&!i)return e;let n=t?new Date(t):new Date(0),o=i?new Date(i):new Date;return t&&!i&&o.setHours(23,59,59,999),!t&&i&&n.setHours(0,0,0,0),e.filter(p=>{let d=new Date(Number(p.lastModified));return d>=n&&d<=o})}getMonthlyChartConfig(e,t){let i={};if(this.selectedStartDate||this.selectedEndDate)return this.getDateRangeChartConfig(e);e.forEach(d=>{let h=new Date(Number(d.lastModified)),_=h.getFullYear(),O=parseInt(t);if(_===O){let D=this.capitalizeFirstLetter(h.toLocaleString("en",{month:"short"})),C=(i[D]??0)+(d.pnl??0);i[D]=C<1?Math.round(C*100)/100:Math.round(C)}});let n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return{data:n.map(d=>i[d]??0),categories:n}}getDateRangeChartConfig(e){let t={},i,n;if(this.selectedStartDate&&this.selectedEndDate)i=new Date(this.selectedStartDate),n=new Date(this.selectedEndDate);else if(this.selectedStartDate)i=new Date(this.selectedStartDate),n=new Date;else if(this.selectedEndDate)i=new Date(0),n=new Date(this.selectedEndDate);else{let d=new Date().getFullYear();i=new Date(d,0,1),n=new Date(d,11,31)}e.forEach(d=>{let h=new Date(Number(d.lastModified));if(h>=i&&h<=n){let _=this.formatDateForChart(h),O=(t[_]??0)+(d.pnl??0);t[_]=O<1?Math.round(O*100)/100:Math.round(O)}});let o=this.generateDateRangeCategories(i,n);return{data:o.map(d=>t[d]??0),categories:o}}formatDateForChart(e){let t=e.toLocaleString("en",{month:"short"}),i=e.getDate();return`${t} ${i}`}generateDateRangeCategories(e,t){let i=[],n=new Date(e),o=t.getTime()-e.getTime(),p=Math.ceil(o/(1e3*60*60*24));if(p<=30)for(;n<=t;)i.push(this.formatDateForChart(new Date(n))),n.setDate(n.getDate()+1);else if(p<=90)for(;n<=t;){let d=new Date(n);d.setDate(d.getDate()+6),d>t&&d.setTime(t.getTime());let h=this.formatDateForChart(new Date(n)),_=this.formatDateForChart(d);i.push(`${h} - ${_}`),n.setDate(n.getDate()+7)}else for(;n<=t;){let d=n.toLocaleString("en",{month:"short"}),h=n.getFullYear();i.push(`${d} ${h}`),n.setMonth(n.getMonth()+1)}return i}capitalizeFirstLetter(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}onYearSelected(e){this.year=e,this.onYearChange.emit(e),this.updateChart()}get getTotalProfit(){let e=this.filteredData;!this.selectedStartDate&&!this.selectedEndDate&&(e=this.applyYearFilter(this.filteredData));let t=e.reduce((n,o)=>n+(o.pnl??0),0);return Math.round(t*100)/100}toggleDateFilter(){this.showDateFilter=!this.showDateFilter}closeDateFilter(){this.showDateFilter=!1}onDocumentClick(e){!e.target.closest(".filter-section")&&this.showDateFilter&&this.closeDateFilter()}onStartDateSelected(e){this.selectedStartDate=e}onEndDateSelected(e){this.selectedEndDate=e}applyDateFilter(){this.selectedStartDate||this.selectedEndDate?(this.filteredData=this.applyDateRangeFilter(this.originalData,this.selectedStartDate,this.selectedEndDate),this.updateYearFromDateRange()):this.filteredData=[...this.originalData],this.updateChart(),this.closeDateFilter()}updateYearFromDateRange(){if(this.selectedStartDate){let e=new Date(this.selectedStartDate);this.year=e.getFullYear().toString()}else if(this.selectedEndDate){let e=new Date(this.selectedEndDate);this.year=e.getFullYear().toString()}}clearDateFilter(){this.selectedStartDate="",this.selectedEndDate="",this.filteredData=[...this.originalData],this.updateChart()}updateChart(){this.chartOptions=this.getChartOptions(this.filteredData)}getAvailableYears(){if(!this.values||this.values.length===0)return[];let e=new Set;return this.values.forEach(t=>{let i=new Date(Number(t.lastModified));e.add(i.getFullYear())}),Array.from(e).sort((t,i)=>i-t).map(t=>t.toString())}getEmptyChartOptions(){let e=new Date().getFullYear(),t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return{chart:{type:"area",height:350,toolbar:{show:!1},foreColor:"#fff",fontFamily:"Inter, Arial, sans-serif",background:"transparent"},series:[{name:"PnL",data:new Array(12).fill(0)}],xaxis:{categories:t,labels:{style:{colors:"#d8d8d8"}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{style:{colors:"#d8d8d8"}}},grid:{borderColor:"#333",strokeDashArray:4,xaxis:{lines:{show:!0}}},dataLabels:{enabled:!1},stroke:{curve:"straight",width:1,colors:["#EAF2F8"]},fill:{type:"gradient",gradient:{shade:"dark",type:"vertical",gradientToColors:["#3967D7"],opacityFrom:.4,opacityTo:0}},tooltip:{theme:"dark",x:{show:!0},custom:function({series:i,seriesIndex:n,dataPointIndex:o,w:p}){return`
            <div style="padding: 8px 12px; background: #1a1a1a; border: 1px solid #333; border-radius: 6px;">
              <div style="color: #d8d8d8; font-size: 12px;">${t[o]} ${e}</div>
              <div style="color: #fff; font-size: 14px; font-weight: 600;">PnL: $0.00</div>
            </div>
          `}},noData:{text:"No data available",align:"center",verticalAlign:"middle",style:{color:"#d8d8d8",fontSize:"14px",fontFamily:"Inter, Arial, sans-serif"}}}}getFormatedValue(e){return this.numberFormatter.formatCurrencyValue(e)}static \u0275fac=function(t){return new(t||c)(M(X))};static \u0275cmp=E({type:c,selectors:[["app-PnL-Graph"]],hostBindings:function(t,i){t&1&&u("click",function(o){return i.onDocumentClick(o)},Ct)},inputs:{values:"values"},outputs:{onYearChange:"onYearChange"},features:[R],decls:17,vars:12,consts:[[1,"pnl-graph-container","d-flex","flex-col","items-start"],[1,"ml-10","up-title"],[1,"color-background"],[1,"regularText"],[1,"secondTitle"],[1,"filter-section"],["class","active-filters-container",4,"ngIf"],[1,"controls-row","d-flex","align-items-center","gap-12"],[1,"filter-btn",3,"click"],[1,"material-symbols-outlined","filter-icon",2,"font-size","20px"],["class","filter-dropdown",4,"ngIf"],[2,"width","100%",3,"series","chart","xaxis","yaxis","stroke","fill","grid","dataLabels","tooltip"],[1,"active-filters-container"],[1,"filter-chip"],[1,"filter-label"],[1,"remove-filter-btn",3,"click"],[1,"material-symbols-outlined",2,"font-size","18px"],[1,"filter-dropdown"],[1,"filter-dropdown-content"],[1,"date-filter-section"],[1,"filter-title"],[1,"date-inputs-container"],[1,"date-input-group"],[1,"date-label"],["type","date",1,"date-input",3,"change","value"],[1,"filter-actions"],[1,"apply-btn",3,"click"],[1,"clear-btn",3,"click"]],template:function(t,i){t&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"p",3),s(4,"Total Profit"),r(),a(5,"p",4),s(6),r()(),a(7,"div",5),Y(8,ne,9,8,"div",6),a(9,"div",7)(10,"button",8),u("click",function(){return i.toggleDateFilter()}),a(11,"span"),s(12,"Date Filter"),r(),a(13,"span",9),s(14,"calendar_today"),r()()(),Y(15,ie,19,2,"div",10),r()(),k(16,"apx-chart",11),r()),t&2&&(l(6),P("$",i.getFormatedValue(i.getTotalProfit)),l(2),m("ngIf",i.selectedStartDate||i.selectedEndDate),l(7),m("ngIf",i.showDateFilter),l(),m("series",i.chartOptions.series)("chart",i.chartOptions.chart)("xaxis",i.chartOptions.xaxis)("yaxis",i.chartOptions.yaxis)("stroke",i.chartOptions.stroke)("fill",i.chartOptions.fill)("grid",i.chartOptions.grid)("dataLabels",i.chartOptions.dataLabels)("tooltip",i.chartOptions.tooltip))},dependencies:[I,Z,at,it,tt,vt],styles:['.pnl-graph-container[_ngcontent-%COMP%]{border-radius:8px;border:.5px solid #434343;background:radial-gradient(ellipse 36% 42% at top center,#5186e41a,#5186e403);padding:24px}@media (max-width: 1024px){.pnl-graph-container[_ngcontent-%COMP%]{padding:18px}}@media (max-width: 480px){.pnl-graph-container[_ngcontent-%COMP%]{padding:24px 10px 20px}}.up-title[_ngcontent-%COMP%]{width:100%;position:relative;display:flex;align-items:center;justify-content:space-between}@media (max-width: 1024px){.up-title[_ngcontent-%COMP%]{flex-direction:column;gap:16px;align-items:flex-start;justify-content:flex-start}}@media (max-width: 768px){.up-title[_ngcontent-%COMP%]{gap:12px}}select[_ngcontent-%COMP%]{border-radius:4px;background:#9ec4f21a}option[_ngcontent-%COMP%]{background-color:#23293b;color:#b6c7de;font-size:1rem;padding:14px 0}option[_ngcontent-%COMP%]:checked{background-color:#363d4f;color:#f4faff}  apx-chart .apexcharts-tooltip{display:flex;flex-direction:column;align-items:flex-start;border-radius:8px;border:.5px solid #4a4a4a;background:#101010e6!important;box-shadow:0 4px 4px #00000040}  apx-chart .toolTip-container{gap:1rem;width:100%;height:100%;padding:20px}  apx-chart .negative-container{background:radial-gradient(ellipse 60% 80% at center,#fe63661f,#fe63660a 70%,#101010e6),#101010e6}  apx-chart .positive-container{background:radial-gradient(ellipse 60% 80% at top center,#bcfe6329,#bcfe6303),#101010e6}  apx-chart .text-container{gap:.375rem}  apx-chart .positive-validator{border-radius:var(--Corner-Extra-small, 4px);background:#468506;color:#bcfe63}  apx-chart .negative-validator{border-radius:var(--Corner-Extra-small, 4px);background:#ec221f26;color:#ec221f}.filter-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;gap:8px;position:relative}@media (max-width: 1024px){.filter-section[_ngcontent-%COMP%]{align-items:flex-start;width:100%}}@media (max-width: 768px){.filter-section[_ngcontent-%COMP%]{gap:6px}}.active-filters-container[_ngcontent-%COMP%]{margin-bottom:4px}.active-filters-scroll[_ngcontent-%COMP%]{display:flex;gap:8px;overflow-x:auto;overflow-y:hidden;max-width:300px;padding:4px 0;scrollbar-width:thin;scrollbar-color:#4a4a4a transparent}.active-filters-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{height:4px}.active-filters-scroll[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.active-filters-scroll[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#4a4a4a;border-radius:2px}.filter-chip[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;background:#5186e426;border:1px solid rgba(81,134,228,.4);border-radius:20px;padding:8px 16px;white-space:nowrap;flex-shrink:0;min-width:fit-content;box-shadow:0 2px 4px #0000001a}.filter-label[_ngcontent-%COMP%]{color:#e3e3e3;font-size:13px;font-weight:500;font-family:Inter,Arial,sans-serif}.remove-filter-btn[_ngcontent-%COMP%]{background:none;border:none;color:#8e8e93;cursor:pointer;padding:0;width:16px;height:16px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:all .2s ease}.remove-filter-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;color:#e3e3e3}.icon-close[_ngcontent-%COMP%]{font-size:12px;line-height:1}.controls-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}@media (max-width: 768px){.controls-row[_ngcontent-%COMP%]{gap:8px;flex-wrap:wrap}}.year-select[_ngcontent-%COMP%]{border-radius:4px;background:#9ec4f21a;border:1px solid #4a4a4a;color:#b6c7de;font-size:14px;padding:6px 8px;cursor:pointer}.year-select[_ngcontent-%COMP%]:focus{outline:none;border-color:#9bf526}.year-select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]{background:#1a1a1a;color:#e3e3e3}.filter-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;background:#9ec4f21a;border:1px solid rgba(158,196,242,.3);border-radius:6px;padding:10px 16px;color:#b6c7de;font-size:14px;font-weight:500;font-family:Inter,Arial,sans-serif;cursor:pointer;transition:all .2s ease}.filter-btn[_ngcontent-%COMP%]:hover{background:#9ec4f233;border-color:#9ec4f280;color:#e3e3e3}.filter-btn[_ngcontent-%COMP%]:active{transform:translateY(1px)}@media (max-width: 768px){.filter-btn[_ngcontent-%COMP%]{padding:8px 12px;font-size:13px;gap:6px}}.filter-icon[_ngcontent-%COMP%]{font-size:12px;transition:transform .2s ease}.filter-dropdown[_ngcontent-%COMP%]{position:absolute;top:100%;right:0;margin-top:8px;background:#1a1a1a;border:1px solid #2f2f2f;border-radius:8px;box-shadow:0 4px 12px #0000004d;z-index:20;min-width:240px;max-width:300px}@media (max-width: 1024px){.filter-dropdown[_ngcontent-%COMP%]{right:auto;top:-200%;left:20%;width:80%;max-width:80%;min-width:unset}}@media (max-width: 768px){.filter-dropdown[_ngcontent-%COMP%]{margin-top:6px}}.filter-dropdown-content[_ngcontent-%COMP%]{padding:16px}.date-filter-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.date-inputs-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}@media (max-width: 1024px){.date-inputs-container[_ngcontent-%COMP%]{width:100%;flex-direction:row;gap:8px}}.date-input-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;width:100%}.date-label[_ngcontent-%COMP%]{color:#b6c7de;font-size:12px;font-weight:500;margin:0;font-family:SF Pro Display,Arial,sans-serif}.filter-title[_ngcontent-%COMP%]{color:#e3e3e3;font-size:16px;font-weight:600;margin:0 0 8px;font-family:Inter,Arial,sans-serif}.date-input[_ngcontent-%COMP%]{width:100%;padding:12px 16px;background:#9ec4f21a;border:1px solid #4a4a4a;border-radius:6px;color:#e3e3e3;font-size:14px;font-family:Inter,Arial,sans-serif;transition:all .2s ease}.date-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#9bf526;background:#9ec4f226}.date-input[_ngcontent-%COMP%]::-webkit-calendar-picker-indicator{filter:invert(1);cursor:pointer}.date-input[_ngcontent-%COMP%]::-webkit-datetime-edit-text{color:#b6c7de}.date-input[_ngcontent-%COMP%]::-webkit-datetime-edit-month-field, .date-input[_ngcontent-%COMP%]::-webkit-datetime-edit-day-field, .date-input[_ngcontent-%COMP%]::-webkit-datetime-edit-year-field{color:#e3e3e3}.filter-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:8px;margin-top:8px}@media (max-width: 1024px){.filter-actions[_ngcontent-%COMP%]{flex-direction:column;gap:8px}}.apply-btn[_ngcontent-%COMP%]{background:#9bf526;border:1px solid #9bf526;border-radius:6px;padding:8px 16px;color:#1a1a1a;font-size:14px;font-weight:500;font-family:Inter,Arial,sans-serif;cursor:pointer;transition:all .2s ease;flex:1}.apply-btn[_ngcontent-%COMP%]:hover{background:#8ae01a;border-color:#8ae01a}.clear-btn[_ngcontent-%COMP%]{background:#ec221f1a;border:1px solid #ec221f;border-radius:6px;padding:8px 16px;color:#ec221f;font-size:14px;font-weight:500;font-family:Inter,Arial,sans-serif;cursor:pointer;transition:all .2s ease;flex:1}.clear-btn[_ngcontent-%COMP%]:hover{background:#ec221f33;border-color:#ff4441;color:#ff4441}.clear-btn[_ngcontent-%COMP%]:active{transform:translateY(1px)}.filter-options[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;margin-bottom:16px}.filter-option[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;cursor:pointer;position:relative}.filter-option[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{display:none}.filter-option[_ngcontent-%COMP%]   .checkmark[_ngcontent-%COMP%]{width:16px;height:16px;border:1px solid #4a4a4a;border-radius:3px;background:transparent;position:relative;transition:all .2s ease}.filter-option[_ngcontent-%COMP%]   .checkmark[_ngcontent-%COMP%]:after{content:"";position:absolute;left:4px;top:1px;width:4px;height:8px;border:solid #9bf526;border-width:0 2px 2px 0;transform:rotate(45deg);opacity:0;transition:opacity .2s ease}.filter-option[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:checked + .checkmark[_ngcontent-%COMP%]{background:#9bf526;border-color:#9bf526}.filter-option[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:checked + .checkmark[_ngcontent-%COMP%]:after{opacity:1}.filter-option[_ngcontent-%COMP%]   .option-label[_ngcontent-%COMP%]{color:#e3e3e3;font-size:14px;font-weight:500}.filter-option[_ngcontent-%COMP%]:hover   .checkmark[_ngcontent-%COMP%]{border-color:#6a6a6a}.compare-years[_ngcontent-%COMP%]{border-top:1px solid #2f2f2f;padding-top:16px}.compare-title[_ngcontent-%COMP%]{color:#e3e3e3;font-size:14px;font-weight:600;margin:0 0 12px}.year-selectors[_ngcontent-%COMP%]{display:flex;gap:12px}.year-selector[_ngcontent-%COMP%]{flex:1}.year-selector[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;color:#8e8e93;font-size:12px;margin-bottom:4px}.year-selector[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;background:#9ec4f21a;border:1px solid #4a4a4a;border-radius:4px;color:#b6c7de;padding:6px 8px;font-size:12px;cursor:pointer}.year-selector[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{outline:none;border-color:#9bf526}.year-selector[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]{background:#1a1a1a;color:#e3e3e3}']})};function ae(c,e){if(c&1&&(a(0,"div",27)(1,"div",28),s(2),r(),a(3,"div",29)(4,"span",30),s(5),r()(),a(6,"div",31),s(7),r(),a(8,"div",32)(9,"span",33),s(10),r()(),a(11,"div",34),k(12,"span",35),r(),a(13,"div",36),s(14),r()()),c&2){let t=e.$implicit,i=g(2);l(2),b(t.openTime),l(3),b(t.ticker),l(2),b(t.side),l(),m("ngClass",t.netPnl>=0?"positive":"negative"),l(2),V("",t.netPnl>=0?"+":"","",i.formatCurrency(t.netPnl)),l(2),m("ngClass",t.followedStrategy?"followed":"not-followed"),l(2),b(t.strategyName)}}function oe(c,e){if(c&1){let t=v();a(0,"div",1),u("click",function(){f(t);let n=g();return x(n.onClose())}),a(1,"div",2),u("click",function(n){return f(t),x(n.stopPropagation())}),a(2,"div",3)(3,"div",4)(4,"div",5)(5,"span",6),s(6),r(),a(7,"span",7),s(8,"|"),r(),a(9,"span",8),s(10),r(),a(11,"div",9)(12,"span",10),s(13),r(),a(14,"span",11),s(15),r()()()(),a(16,"button",12),u("click",function(){f(t);let n=g();return x(n.onClose())}),s(17,"\xD7"),r()(),a(18,"div",13)(19,"div",14)(20,"h3",15),s(21,"Trades information"),r(),a(22,"div",16)(23,"button",17),u("click",function(){f(t);let n=g();return x(n.onSortByTime())}),a(24,"span"),s(25,"Sort by: Time"),r(),a(26,"span",18),s(27,"\u2195"),r()(),a(28,"button",19),u("click",function(){f(t);let n=g();return x(n.onFilter())}),a(29,"span",20),s(30,"\u29C9"),r(),a(31,"span"),s(32,"Filter"),r()()()(),a(33,"div",21)(34,"div",22)(35,"div",23)(36,"div",24),s(37,"Open time"),r(),a(38,"div",24),s(39,"Ticker"),r(),a(40,"div",24),s(41,"Side"),r(),a(42,"div",24),s(43,"P&L"),r(),a(44,"div",24),s(45,"Followed strategy"),r(),a(46,"div",24),s(47,"Strategy name"),r()(),a(48,"div",25),Y(49,ae,15,8,"div",26),r()()()()()()}if(c&2){let t=g();l(6),b(t.selectedDate),l(3),m("ngClass",t.netPnl>=0?"positive":"negative"),l(),V(" P&L ",t.netPnl>=0?"+":"","",t.formatCurrency(t.netPnl)," "),l(),m("ngClass",t.netPnl>=0?"positive":"negative"),l(2),b(t.formatPercentage(t.Math.abs(t.netRoi))),l(),m("ngClass",t.netPnl>=0?"up":"down"),l(),P(" ",t.netPnl>=0?"\u2197":"\u2198"," "),l(34),m("ngForOf",t.trades)}}var lt=class c{visible=!1;selectedDay=null;strategies=[];close=new G;trades=[];netPnl=0;netRoi=0;numberFormatter=new L;selectedDate="";Math=Math;ngOnChanges(){this.selectedDay&&this.visible&&this.loadTradesData()}loadTradesData(){this.selectedDay&&(this.selectedDate=this.formatDate(this.selectedDay.date),this.netPnl=this.selectedDay.pnlTotal,console.log(this.selectedDay.trades),this.trades=this.selectedDay.trades.map((e,t)=>({openTime:this.formatTime(new Date(Number(e.lastModified))),ticker:e.instrument??"N/A",side:this.determineSide(e),netPnl:e.pnl??0,followedStrategy:this.selectedDay?.followedStrategy??!1,strategyName:this.getStrategyNameForTrade(e)})),this.trades.sort((e,t)=>t.openTime.localeCompare(e.openTime)))}formatDate(e){let t={weekday:"long",year:"numeric",month:"long",day:"numeric"};return e.toLocaleDateString("en-US",t)}formatTime(e){return e.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})}determineSide(e){return e.side==="buy"?"Long":e.side==="sell"?"Short":(e.pnl??0)>=0?"Long":"Short"}getStrategyNameForTrade(e){if(!this.strategies||this.strategies.length===0)return"Swing Trading Strategy";let t=new Date(Number(e.lastModified)),i=new Date;i.setHours(23,59,59,999);for(let n of this.strategies)if(n.dateActive&&n.dateActive.length>0)for(let o=0;o<n.dateActive.length;o++){let p=new Date(n.dateActive[o].seconds*1e3),d;if(n.dateInactive&&n.dateInactive.length>o)d=new Date(n.dateInactive[o].seconds*1e3);else if(n.dateActive.length>(n.dateInactive?.length||0))d=i;else continue;if(t>=p&&t<=d)return n.name}return"Swing Trading Strategy"}getTickerColor(e){return{YM:"rgba(139, 92, 246, 0.8)",MYM:"rgba(139, 92, 246, 0.6)",ES:"rgba(59, 130, 246, 0.8)",NQ:"rgba(16, 185, 129, 0.8)",RTY:"rgba(245, 158, 11, 0.8)"}[e]||"rgba(107, 114, 128, 0.8)"}getPnlColor(e){return e>=0?"#10B981":"#EF4444"}getStrategyIcon(e){return e?"icon-check-box":"icon-uncheck-box"}getStrategyColor(e){return e?"#10B981":"#EF4444"}onClose(){this.close.emit()}onSortByTime(){this.trades.sort((e,t)=>t.openTime.localeCompare(e.openTime))}onFilter(){console.log("Filter clicked")}formatCurrency(e){return this.numberFormatter.formatCurrency(e)}formatPercentage(e){return this.numberFormatter.formatPercentage(e)}static \u0275fac=function(t){return new(t||c)};static \u0275cmp=E({type:c,selectors:[["app-trades-popup"]],inputs:{visible:"visible",selectedDay:"selectedDay",strategies:"strategies"},outputs:{close:"close"},features:[R],decls:1,vars:1,consts:[["class","trades-popup-overlay",3,"click",4,"ngIf"],[1,"trades-popup-overlay",3,"click"],[1,"trades-popup",3,"click"],[1,"popup-header"],[1,"header-content"],[1,"date-info"],[1,"date"],[1,"separator"],[1,"net-pnl",3,"ngClass"],[1,"roi-badge",3,"ngClass"],[1,"roi-value"],[1,"roi-arrow",3,"ngClass"],[1,"close-btn",3,"click"],[1,"popup-content"],[1,"content-header"],[1,"content-title"],[1,"controls"],[1,"sort-btn",3,"click"],[1,"sort-icon"],[1,"filter-btn",3,"click"],[1,"filter-icon"],[1,"trades-table-container"],[1,"trades-table"],[1,"table-header"],[1,"header-cell"],[1,"table-body"],["class","table-row",4,"ngFor","ngForOf"],[1,"table-row"],[1,"table-cell","time-cell"],[1,"table-cell","ticker-cell"],[1,"ticker-badge"],[1,"table-cell","side-cell"],[1,"table-cell","pnl-cell",3,"ngClass"],[1,"pnl-value"],[1,"table-cell","strategy-cell"],[1,"strategy-icon",3,"ngClass"],[1,"table-cell","strategy-name-cell"]],template:function(t,i){t&1&&Y(0,oe,50,9,"div",0),t&2&&m("ngIf",i.visible)},dependencies:[I,Q,wt,Z],styles:['@charset "UTF-8";.trades-popup-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#000c;display:flex;align-items:center;justify-content:center;z-index:1000;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}.trades-popup[_ngcontent-%COMP%]{background:#1a1a1a;border:1px solid #333;border-radius:8px;width:90%;max-width:600px;max-height:60vh;overflow:hidden;box-shadow:0 8px 20px #00000080}@media (max-width: 1024px){.trades-popup[_ngcontent-%COMP%]{width:95%;max-width:500px;max-height:65vh}}@media (max-width: 768px){.trades-popup[_ngcontent-%COMP%]{width:98%;max-height:70vh;border-radius:6px}}@media (max-width: 480px){.trades-popup[_ngcontent-%COMP%]{width:100%;height:100vh;max-height:100vh;border-radius:0;border:none}}.popup-header[_ngcontent-%COMP%]{background:#2a2a2a;padding:12px 16px;border-bottom:1px solid #333;display:flex;justify-content:space-between;align-items:center}@media (max-width: 768px){.popup-header[_ngcontent-%COMP%]{padding:16px 20px}}@media (max-width: 480px){.popup-header[_ngcontent-%COMP%]{padding:12px 16px}}.header-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.popup-title[_ngcontent-%COMP%]{color:#e3e3e3;font-size:16px;font-weight:500;margin:0;font-family:Inter,Arial,sans-serif}.date-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:12px}.date[_ngcontent-%COMP%]{color:#e3e3e3;font-weight:500;font-family:Inter,Arial,sans-serif;font-size:12px}.separator[_ngcontent-%COMP%]{color:#666}.net-pnl[_ngcontent-%COMP%]{font-weight:600;font-family:Inter,Arial,sans-serif;font-size:14px}.net-pnl.positive[_ngcontent-%COMP%]{color:#10b981}.net-pnl.negative[_ngcontent-%COMP%]{color:#ef4444}.roi-badge[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;padding:4px 8px;border-radius:4px;font-size:12px;font-weight:600;font-family:Inter,Arial,sans-serif}.roi-badge.positive[_ngcontent-%COMP%]{background:#10b9811a;color:#10b981}.roi-badge.negative[_ngcontent-%COMP%]{background:#ef44441a;color:#ef4444}.roi-arrow[_ngcontent-%COMP%]{font-size:10px}.roi-arrow.up[_ngcontent-%COMP%]{color:#10b981}.roi-arrow.down[_ngcontent-%COMP%]{color:#ef4444}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#e3e3e3;font-size:24px;cursor:pointer;padding:4px;border-radius:4px;transition:background-color .2s}.close-btn[_ngcontent-%COMP%]:hover{background:#333}.popup-content[_ngcontent-%COMP%]{padding:16px;max-height:calc(60vh - 80px);overflow-y:auto}@media (max-width: 768px){.popup-content[_ngcontent-%COMP%]{padding:20px;max-height:calc(90vh - 100px)}}@media (max-width: 480px){.popup-content[_ngcontent-%COMP%]{padding:16px;max-height:calc(100vh - 80px)}}.content-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.content-title[_ngcontent-%COMP%]{color:#e3e3e3;font-size:18px;font-weight:700;margin:0;font-family:Inter,Arial,sans-serif}.controls[_ngcontent-%COMP%]{display:flex;gap:12px}@media (max-width: 768px){.controls[_ngcontent-%COMP%]{gap:8px}}@media (max-width: 480px){.controls[_ngcontent-%COMP%]{flex-direction:column;gap:6px;width:100%}}.sort-btn[_ngcontent-%COMP%], .filter-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;background:#3b82f61a;border:1px solid rgba(59,130,246,.3);color:#b6c7de;padding:8px 12px;border-radius:6px;font-size:14px;font-family:Inter,Arial,sans-serif;cursor:pointer;transition:all .2s}.sort-btn[_ngcontent-%COMP%]:hover, .filter-btn[_ngcontent-%COMP%]:hover{background:#3b82f633;border-color:#3b82f680}@media (max-width: 768px){.sort-btn[_ngcontent-%COMP%], .filter-btn[_ngcontent-%COMP%]{padding:6px 10px;font-size:13px;gap:4px}}@media (max-width: 480px){.sort-btn[_ngcontent-%COMP%], .filter-btn[_ngcontent-%COMP%]{padding:8px 12px;font-size:14px;justify-content:center}}.sort-icon[_ngcontent-%COMP%], .filter-icon[_ngcontent-%COMP%]{font-size:12px}.trades-table-container[_ngcontent-%COMP%]{overflow-x:auto;overflow-y:hidden;border-radius:8px;width:100%}.trades-table-container[_ngcontent-%COMP%]::-webkit-scrollbar{height:6px}.trades-table-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#1a1a1a}.trades-table-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#444;border-radius:3px}.trades-table-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}.trades-table[_ngcontent-%COMP%]{background:#3b82f61a;border:1px solid rgba(59,130,246,.2);border-radius:6px;overflow:hidden;padding:0;min-width:500px;width:max-content}.table-header[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr .8fr .8fr 1.5fr 1fr 1.5fr;background:#3b82f60d;border-bottom:1px solid rgba(59,130,246,.2)}.header-cell[_ngcontent-%COMP%]{padding:8px 12px;color:#b0b0b0;font-size:10px;font-weight:500;font-family:Inter,Arial,sans-serif;text-transform:uppercase;letter-spacing:.2px;text-align:center;display:flex;align-items:center;justify-content:center}@media (max-width: 768px){.header-cell[_ngcontent-%COMP%]{padding:10px 12px;font-size:11px}}@media (max-width: 480px){.header-cell[_ngcontent-%COMP%]{padding:8px 10px;font-size:10px}}.table-body[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}.table-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr .8fr .8fr 1.5fr 1fr 1.5fr;border-bottom:1px solid rgba(59,130,246,.2);transition:background-color .2s}.table-row[_ngcontent-%COMP%]:hover{background:#3b82f60d}.table-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.table-cell[_ngcontent-%COMP%]{padding:8px 12px;color:#e0e0e0;font-size:12px;font-family:Inter,Arial,sans-serif;display:flex;align-items:center;justify-content:center;text-align:center}@media (max-width: 768px){.table-cell[_ngcontent-%COMP%]{padding:10px 12px;font-size:13px}}@media (max-width: 480px){.table-cell[_ngcontent-%COMP%]{padding:8px 10px;font-size:12px}}.time-cell[_ngcontent-%COMP%]{font-family:Inter,Arial,sans-serif;font-size:14px;font-weight:400}.ticker-badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 8px;border-radius:12px;background:#6b7280;color:#fff;font-size:12px;font-weight:500;font-family:Inter,Arial,sans-serif;text-transform:uppercase;letter-spacing:.5px}.side-cell[_ngcontent-%COMP%]{font-weight:400;font-family:Inter,Arial,sans-serif;font-size:14px}.instrument-cell[_ngcontent-%COMP%]{font-family:Inter,Arial,sans-serif;font-size:14px;font-weight:400}.pnl-cell[_ngcontent-%COMP%]{font-weight:500;font-family:Inter,Arial,sans-serif;font-size:14px}.pnl-cell.positive[_ngcontent-%COMP%]{color:#10b981}.pnl-cell.positive[_ngcontent-%COMP%]   .pnl-value[_ngcontent-%COMP%]{background:#10b9811a;padding:4px 8px;border-radius:4px;display:inline-block}.pnl-cell.negative[_ngcontent-%COMP%]{color:#ef4444}.pnl-cell.negative[_ngcontent-%COMP%]   .pnl-value[_ngcontent-%COMP%]{background:#ef44441a;padding:4px 8px;border-radius:4px;display:inline-block}.roi-cell[_ngcontent-%COMP%]{font-family:Inter,Arial,sans-serif;font-size:14px;font-weight:400}.roi-cell.positive[_ngcontent-%COMP%]{color:#10b981}.roi-cell.negative[_ngcontent-%COMP%]{color:#ef4444}.strategy-icon[_ngcontent-%COMP%]{width:16px;height:16px;border-radius:2px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700}.strategy-icon.followed[_ngcontent-%COMP%]{background:#10b981;color:#fff}.strategy-icon.followed[_ngcontent-%COMP%]:before{content:"\\2713"}.strategy-icon.not-followed[_ngcontent-%COMP%]{background:#ef4444;color:#fff}.strategy-icon.not-followed[_ngcontent-%COMP%]:before{content:"\\2212"}.strategy-name-cell[_ngcontent-%COMP%]{font-size:14px;color:#e0e0e0;font-family:Inter,Arial,sans-serif;font-weight:400}.table-body[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.table-body[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#1a1a1a}.table-body[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#444;border-radius:3px}.table-body[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}@media (max-width: 768px){.trades-popup[_ngcontent-%COMP%]{width:95%;max-height:90vh}.controls[_ngcontent-%COMP%]{flex-direction:column;gap:8px}.trades-table[_ngcontent-%COMP%]{min-width:500px}}']})};var se=()=>["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],le=(c,e,t,i)=>({active:c,"positive-cell":e,"negative-cell":t,clickable:i});function ce(c,e){if(c&1&&(a(0,"div",12),s(1),H(2,"slice"),r()),c&2){let t=e.$implicit;l(),P(" ",yt(2,1,t,0,3)," ")}}function de(c,e){if(c&1&&(a(0,"div",29)(1,"span",8),s(2),r()()),c&2){let t=g().$implicit;m("ngClass",t.followedStrategy?"positive-icon":"negative-icon"),l(2),b(t.followedStrategy?"check_box":"indeterminate_check_box")}}function pe(c,e){c&1&&k(0,"div",30)}function ge(c,e){if(c&1&&(a(0,"div",32)(1,"div",33),s(2),r(),a(3,"div",34),s(4),r(),a(5,"div",35),s(6),r()()),c&2){let t=g().$implicit,i=g(2);l(2),P(" ",i.formatCurrency(t.pnlTotal)," "),l(2),V(" ",t.tradesCount," Trade",t.tradesCount>1?"s":""," "),l(2),P(" ",i.formatPercentage(t.tradeWinPercent)," ")}}function me(c,e){if(c&1){let t=v();a(0,"div",27),u("click",function(){let n=f(t).$implicit,o=g(2);return x(o.onDayClick(n))}),a(1,"div",28),S(2,de,3,2,"div",29)(3,pe,1,0,"div",30),a(4,"div",31),s(5),r()(),S(6,ge,7,4,"div",32),r()}if(c&2){let t=e.$implicit;m("ngClass",_t(4,le,t.tradesCount>0,t.tradesCount>0&&t.followedStrategy,t.tradesCount>0&&!t.followedStrategy,t.tradesCount>0)),l(2),T(t.tradesCount>0?2:3),l(3),P(" ",t.date.getDate()," "),l(),T(t.tradesCount>0?6:-1)}}function ue(c,e){if(c&1&&(a(0,"div",16),z(1,me,7,9,"div",20,$),a(3,"div",21)(4,"div",22)(5,"h4",23),s(6),r()(),a(7,"div",24)(8,"div",25),s(9),r(),a(10,"div",26),s(11),r()()()()),c&2){let t=e.$implicit,i=e.$index,n=g();l(),N(t),l(5),P("Week ",i+1),l(2),m("ngClass",n.getWeekTotal(t)>=0?"positive":"negative"),l(),P(" ",n.formatCurrency(n.getWeekTotal(t))," "),l(2),P(" ",n.getWeekActiveDays(t)," days ")}}function he(c,e){if(c&1&&(a(0,"div",18)(1,"div",22)(2,"h4",23),s(3),r()(),a(4,"div",24)(5,"div",25),s(6),r(),a(7,"div",26),s(8),r()()()),c&2){let t=e.$implicit,i=e.$index,n=g();l(3),P("Week ",i+1),l(2),m("ngClass",n.getWeekTotal(t)>=0?"positive":"negative"),l(),P(" ",n.formatCurrency(n.getWeekTotal(t))," "),l(2),P(" ",n.getWeekActiveDays(t)," days ")}}var ct=class c{constructor(e,t){this.reportSvc=e;this.pluginHistoryService=t}groupedTrades;strategyFollowedPercentageChange=new G;strategies;userId;calendar=[];currentDate;selectedMonth;showTradesPopup=!1;selectedDay=null;pluginHistory=null;numberFormatter=new L;ngOnChanges(e){this.currentDate=new Date,this.selectedMonth=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth()),this.userId&&this.loadPluginHistory(),this.generateCalendar(this.selectedMonth),this.strategies&&this.strategies.length>0&&this.getPercentageStrategyFollowedLast30Days()}emitStrategyFollowedPercentage(e){this.strategyFollowedPercentageChange.emit(e)}loadPluginHistory(){return A(this,null,function*(){try{let e=yield this.pluginHistoryService.getPluginUsageHistory(this.userId);e.length>0?(this.pluginHistory=e[0],console.log("Plugin history loaded:",this.pluginHistory)):(this.pluginHistory=null,console.log("No plugin history found for user"))}catch(e){console.error("Error loading plugin history:",e),this.pluginHistory=null}})}didFollowStrategy(e){if(!this.pluginHistory||!this.pluginHistory.dateActive||!this.pluginHistory.dateInactive)return!1;let t=this.pluginHistory.dateActive,i=this.pluginHistory.dateInactive,n=new Date;if(t.length>i.length){let o=new Date(t[t.length-1]);return e>=o&&e<=n}if(t.length===i.length)for(let o=0;o<t.length;o++){let p=new Date(t[o]),d=new Date(i[o]);if(e>=p&&e<=d)return!0}return!1}generateCalendar(e){let t={};this.groupedTrades.forEach(y=>{let w=new Date(Number(y.lastModified)),F=`${w.getFullYear()}-${w.getMonth()}-${w.getDate()}`;t[F]||(t[F]=[]),t[F].push(y)});let n=Object.values(t).flat().filter((y,w,F)=>w===F.findIndex(U=>U.positionId===y.positionId)),o=e.getFullYear(),p=e.getMonth(),d=new Date(o,p,1),h=new Date(o,p+1,0),_=new Date(d);_.setDate(d.getDate()-d.getDay());let O=new Date(h);O.setDate(h.getDate()+(6-h.getDay()));let D=[],C=new Date(_);for(;C<=O;){let y=`${C.getFullYear()}-${C.getMonth()}-${C.getDate()}`,w=t[y]||[],F=w.reduce((W,Qt)=>W+(Qt.pnl??0),0),U=w.filter(W=>(W.pnl??0)>0).length,xt=w.filter(W=>(W.pnl??0)<0).length,pt=w.length,qt=pt>0?Math.round(U/pt*1e3)/10:0,Xt=pt>0?this.didFollowStrategy(C):!1;D.push({date:new Date(C),trades:w,pnlTotal:F,tradesCount:w.length,followedStrategy:Xt,tradeWinPercent:Math.round(qt)}),C.setDate(C.getDate()+1)}this.calendar=[];for(let y=0;y<D.length;y+=7)this.calendar.push(D.slice(y,y+7))}getDateNDaysAgo(e){let t=new Date;return t.setDate(t.getDate()-e),t}filterDaysInRange(e,t,i){return e.filter(n=>n.date>=t&&n.date<=i)}countStrategyFollowedDays(e){return e.filter(t=>t.followedStrategy&&t.tradesCount>0).length}calculateStrategyFollowedPercentage(e,t){if(e.length===0)return 0;let i=this.getDateNDaysAgo(t-1),n=new Date,o=this.filterDaysInRange(e,i,n),d=this.countStrategyFollowedDays(o)/t*100;return Math.round(d*10)/10}getPercentageStrategyFollowedLast30Days(){let e=this.calculateStrategyFollowedPercentage(this.calendar.flat(),30);this.emitStrategyFollowedPercentage(e)}get currentMonthYear(){let e={month:"short"},t=this.selectedMonth.toLocaleString("en-US",e),i=this.selectedMonth.getFullYear();return`${t}, ${i}`}canNavigateLeft(){if(!this.groupedTrades||this.groupedTrades.length===0)return!1;let e=this.getEarliestTradeDate(),t=new Date(this.selectedMonth.getFullYear(),this.selectedMonth.getMonth(),1);return e<t}canNavigateRight(){if(!this.groupedTrades||this.groupedTrades.length===0)return!1;let e=this.getLatestTradeDate(),t=new Date(this.selectedMonth.getFullYear(),this.selectedMonth.getMonth()+1,0);return e>t}getEarliestTradeDate(){if(!this.groupedTrades||this.groupedTrades.length===0)return new Date;let e=this.groupedTrades.map(t=>new Date(Number(t.lastModified)));return new Date(Math.min(...e.map(t=>t.getTime())))}getLatestTradeDate(){if(!this.groupedTrades||this.groupedTrades.length===0)return new Date;let e=this.groupedTrades.map(t=>new Date(Number(t.lastModified)));return new Date(Math.max(...e.map(t=>t.getTime())))}navigateToPreviousMonth(){this.canNavigateLeft()&&(this.selectedMonth=new Date(this.selectedMonth.getFullYear(),this.selectedMonth.getMonth()-1),this.generateCalendar(this.selectedMonth))}navigateToNextMonth(){this.canNavigateRight()&&(this.selectedMonth=new Date(this.selectedMonth.getFullYear(),this.selectedMonth.getMonth()+1),this.generateCalendar(this.selectedMonth))}navigateToCurrentMonth(){this.selectedMonth=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth()),this.generateCalendar(this.selectedMonth)}exportData(){let e=this.generateCSVData();this.downloadCSV(e,`trading-data-${this.currentMonthYear.replace(", ","-").toLowerCase()}.csv`)}generateCSVData(){let t=[["Date","PnL Total","Trades Count","Win Percentage","Strategy Followed"].join(",")];return this.calendar.flat().forEach(i=>{let n=i.date.toISOString().split("T")[0],o=i.pnlTotal.toFixed(2),p=i.tradesCount,d=i.tradeWinPercent,h=i.followedStrategy?"Yes":"No";t.push([n,o,p,d,h].join(","))}),t.join(`
`)}downloadCSV(e,t){let i=new Blob([e],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a");if(n.download!==void 0){let o=URL.createObjectURL(i);n.setAttribute("href",o),n.setAttribute("download",t),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)}}getWeekTotal(e){return e.reduce((t,i)=>t+i.pnlTotal,0)}getWeekActiveDays(e){return e.filter(t=>t.tradesCount>0).length}onDayClick(e){e.tradesCount>0&&(this.selectedDay=e,this.showTradesPopup=!0)}onClosePopup(){this.showTradesPopup=!1,this.selectedDay=null}formatCurrency(e){return this.numberFormatter.formatCurrency(e)}formatPercentage(e){return this.numberFormatter.formatPercentage(e)}static \u0275fac=function(t){return new(t||c)(M(nt),M(Wt))};static \u0275cmp=E({type:c,selectors:[["app-calendar"]],inputs:{groupedTrades:"groupedTrades",strategies:"strategies",userId:"userId"},outputs:{strategyFollowedPercentageChange:"strategyFollowedPercentageChange"},features:[R],decls:32,vars:11,consts:[[1,"calendar-grid","d-flex","flex-col","p-22"],[1,"calendar-titles","mb-14","d-flex","flex-col","gap-12"],[1,"calendar-header-row","d-flex","items-center","justify-between"],[1,"calendar-title"],[1,"export-btn","d-flex","align-items-center","gap-8",3,"click"],[1,"material-symbols-outlined",2,"font-size","18px"],[1,"month-navigation","d-flex","align-items-center","justify-center","gap-12"],[1,"nav-arrow","nav-arrow-left",3,"click","disabled"],[1,"material-symbols-outlined",2,"font-size","20px"],[1,"actual-month"],[1,"nav-arrow","nav-arrow-right",3,"click","disabled"],[1,"calendar-header","mb-14","d-flex","flex-center","items-center","justify-between"],[1,"calendar-day-header","smallText","color-background"],[1,"week-header-title","smallText","color-background"],[1,"calendar-content-wrapper","d-flex"],[1,"calendar-main"],[1,"calendar-week","d-flex","smallText","color-background"],[1,"weekly-summary-grid","mobile-only"],[1,"week-summary-card-mobile"],[3,"close","visible","selectedDay","strategies"],[1,"calendar-cell",3,"ngClass"],[1,"week-summary-card","desktop-only"],[1,"week-header"],[1,"week-title"],[1,"week-content"],[1,"week-total",3,"ngClass"],[1,"week-days"],[1,"calendar-cell",3,"click","ngClass"],[1,"cell-header"],[1,"strategy-icon",3,"ngClass"],[1,"strategy-icon","empty"],[1,"day-number"],[1,"cell-content","d-flex","flex-col"],[1,"pnl-amount"],[1,"trades-info"],[1,"win-percentage"]],template:function(t,i){t&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"p",3),s(4,"My Strategy"),r(),a(5,"button",4),u("click",function(){return i.exportData()}),a(6,"span"),s(7,"Export Data"),r(),a(8,"span",5),s(9,"call_made"),r()()(),a(10,"div",6)(11,"button",7),u("click",function(){return i.navigateToPreviousMonth()}),a(12,"span",8),s(13,"chevron_left"),r()(),a(14,"p",9),s(15),r(),a(16,"button",10),u("click",function(){return i.navigateToNextMonth()}),a(17,"span",8),s(18,"chevron_right"),r()()()(),a(19,"div",11),z(20,ce,3,5,"div",12,$),a(22,"div",13),s(23," Week "),r()(),a(24,"div",14)(25,"div",15),z(26,ue,12,4,"div",16,$),r()(),a(28,"div",17),z(29,he,9,4,"div",18,$),r(),a(31,"app-trades-popup",19),u("close",function(){return i.onClosePopup()}),r()()),t&2&&(l(11),gt("disabled",!i.canNavigateLeft()),m("disabled",!i.canNavigateLeft()),l(4),b(i.currentMonthYear),l(),gt("disabled",!i.canNavigateRight()),m("disabled",!i.canNavigateRight()),l(4),N(bt(10,se)),l(6),N(i.calendar),l(3),N(i.calendar),l(2),m("visible",i.showTradesPopup)("selectedDay",i.selectedDay)("strategies",i.strategies))},dependencies:[I,Q,lt,Pt],styles:['@charset "UTF-8";.calendar-grid[_ngcontent-%COMP%]{border-radius:8px;border:.955px solid #424242;background:radial-gradient(ellipse 36% 42% at top center,#5186e41a,#5186e403);gap:8px;padding:22px!important}@media (max-width: 1024px){.calendar-grid[_ngcontent-%COMP%]{padding:8px!important}}@media (max-width: 768px){.calendar-grid[_ngcontent-%COMP%]{padding:4px!important;gap:2px}}@media (max-width: 480px){.calendar-grid[_ngcontent-%COMP%]{padding:2px!important;gap:1px}}@media (max-width: 360px){.calendar-grid[_ngcontent-%COMP%]{padding:1px!important;gap:0px}}.calendar-gap[_ngcontent-%COMP%]{flex:1}.actual-month[_ngcontent-%COMP%]{text-align:center;margin:0;min-width:120px}.calendar-title[_ngcontent-%COMP%]{text-align:center;font-family:SF Pro Display,Arial,sans-serif;color:#e3e3e3;font-weight:600;font-size:18px}.calendar-titles[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:12px;margin-bottom:14px}@media (max-width: 768px){.calendar-titles[_ngcontent-%COMP%]{gap:8px;margin-bottom:12px}}@media (max-width: 480px){.calendar-titles[_ngcontent-%COMP%]{gap:6px;margin-bottom:8px;padding:8px}}.calendar-header-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%}.month-navigation[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:12px;width:100%;font-family:SF Pro Display,Arial,sans-serif;color:#e3e3e3;font-size:14px;font-weight:500}.calendar-day-header[_ngcontent-%COMP%], .calendar-cell[_ngcontent-%COMP%]{flex:1 1 0px;min-width:70px;border-radius:8px;margin:1px;box-sizing:border-box}@media (max-width: 1024px){.calendar-day-header[_ngcontent-%COMP%], .calendar-cell[_ngcontent-%COMP%]{min-width:60px;flex:1 1 14.2857142857%;margin:0;border-radius:0}}@media (max-width: 768px){.calendar-day-header[_ngcontent-%COMP%], .calendar-cell[_ngcontent-%COMP%]{min-width:30px;flex:1 1 14.2857142857%;margin:0;border-radius:0}}@media (max-width: 480px){.calendar-day-header[_ngcontent-%COMP%], .calendar-cell[_ngcontent-%COMP%]{min-width:25px;flex:1 1 14.2857142857%;margin:0;border-radius:0}}@media (max-width: 360px){.calendar-day-header[_ngcontent-%COMP%], .calendar-cell[_ngcontent-%COMP%]{min-width:20px;flex:1 1 14.2857142857%;margin:0;border-radius:0}}.calendar-day-header[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;background:transparent}.calendar-cell[_ngcontent-%COMP%]{min-height:80px;padding:8px;background:#1f1f20;display:flex;flex-direction:column;justify-content:space-between}@media (max-width: 1024px){.calendar-cell[_ngcontent-%COMP%]{min-height:90px;padding:4px;margin:0;border-radius:0;border:1px solid #292929}}@media (max-width: 768px){.calendar-cell[_ngcontent-%COMP%]{min-height:100px;padding:2px;margin:0;border-radius:0;border:1px solid #292929}}@media (max-width: 480px){.calendar-cell[_ngcontent-%COMP%]{min-height:110px;padding:1px;margin:0;border-radius:0;border:1px solid #292929}}@media (max-width: 360px){.calendar-cell[_ngcontent-%COMP%]{min-height:120px;padding:.5px;margin:0;border-radius:0;border:1px solid #292929}}.calendar-cell.clickable[_ngcontent-%COMP%]{cursor:pointer;transition:all .2s ease}.calendar-cell.clickable[_ngcontent-%COMP%]:hover{background:#2a2a2a;transform:translateY(-1px);box-shadow:0 2px 8px #0000004d}.positive-cell[_ngcontent-%COMP%]{background:radial-gradient(ellipse 36% 42% at top center,#bcfe6329,#bcfe6303),#1f1f20}.negative-cell[_ngcontent-%COMP%]{background:radial-gradient(ellipse 60% 80% at top center,#fe63661f,#fe63660a 70%,#101010e6),#101010e6}.positive-strategy[_ngcontent-%COMP%], .negative-strategy[_ngcontent-%COMP%]{width:fit-content}.positive-strategy[_ngcontent-%COMP%]{border-radius:var(--Corner-Extra-small, 3.821px);background:#14ae5c26;color:#14ae5c}.negative-strategy[_ngcontent-%COMP%]{border-radius:var(--Corner-Extra-small, 3.821px);background:#ec221f26;color:#ec221f}.cell-header[_ngcontent-%COMP%]{width:100%;margin-bottom:6px;display:flex;flex-direction:row;justify-content:space-between;align-items:center}@media (max-width: 1024px){.cell-header[_ngcontent-%COMP%]{flex-direction:column;gap:2px;align-items:flex-end;justify-content:flex-end}}.strategy-icon[_ngcontent-%COMP%]{width:16px;height:16px;border-radius:3px;display:flex;align-items:center;justify-content:center}.strategy-icon.positive-icon[_ngcontent-%COMP%]{background:#14ae5c26;color:#14ae5c}.strategy-icon.negative-icon[_ngcontent-%COMP%]{background:#ec221f26;color:#ec221f}.strategy-icon.empty[_ngcontent-%COMP%]{background:transparent}.day-number[_ngcontent-%COMP%]{font-weight:700;font-size:14px;color:#e3e3e3}@media (max-width: 1024px){.day-number[_ngcontent-%COMP%]{font-size:13px}}@media (max-width: 768px){.day-number[_ngcontent-%COMP%]{font-size:12px}}@media (max-width: 480px){.day-number[_ngcontent-%COMP%]{font-size:10px}}.cell-content[_ngcontent-%COMP%]{width:100%;min-height:60px;gap:2px;align-items:flex-end;justify-content:flex-end}@media (max-width: 1024px){.cell-content[_ngcontent-%COMP%]{min-height:50px}}@media (max-width: 768px){.cell-content[_ngcontent-%COMP%]{min-height:40px}}@media (max-width: 480px){.cell-content[_ngcontent-%COMP%]{min-height:30px}}.pnl-amount[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#e3e3e3;line-height:1.2;overflow:hidden;white-space:nowrap}@media (max-width: 1024px){.pnl-amount[_ngcontent-%COMP%]{font-size:14px}}@media (max-width: 768px){.pnl-amount[_ngcontent-%COMP%]{font-size:12px;animation:_ngcontent-%COMP%_scrollText 4s linear infinite}}.trades-info[_ngcontent-%COMP%]{font-size:14px;color:#8e8e93;line-height:1.2;overflow:hidden;white-space:nowrap}@media (max-width: 1024px){.trades-info[_ngcontent-%COMP%]{font-size:12px}}@media (max-width: 768px){.trades-info[_ngcontent-%COMP%]{font-size:10px;animation:_ngcontent-%COMP%_scrollText 4s linear infinite}}.win-percentage[_ngcontent-%COMP%]{font-size:12px;color:#8e8e93;line-height:1.2;overflow:hidden;white-space:nowrap}@media (max-width: 1024px){.win-percentage[_ngcontent-%COMP%]{font-size:10px}}@media (max-width: 768px){.win-percentage[_ngcontent-%COMP%]{font-size:9px;animation:_ngcontent-%COMP%_scrollText 4s linear infinite}}.calendar-week[_ngcontent-%COMP%]{gap:6px;align-items:stretch}@media (max-width: 1024px){.calendar-week[_ngcontent-%COMP%]{gap:0px}}.calendar-week[_ngcontent-%COMP%]   .calendar-cell[_ngcontent-%COMP%]:last-of-type{margin-right:12px;margin-bottom:12px}@media (max-width: 768px){.calendar-week[_ngcontent-%COMP%]   .calendar-cell[_ngcontent-%COMP%]:last-of-type{margin-right:6px;margin-bottom:6px}}@media (max-width: 480px){.calendar-week[_ngcontent-%COMP%]   .calendar-cell[_ngcontent-%COMP%]:last-of-type{margin-right:2px;margin-bottom:2px}}@media (max-width: 360px){.calendar-week[_ngcontent-%COMP%]   .calendar-cell[_ngcontent-%COMP%]:last-of-type{margin-right:0;margin-bottom:0}}.week-header-title[_ngcontent-%COMP%]{flex:0 0 120px;display:flex;justify-content:center;align-items:center;background:transparent;border-radius:8px;margin:1px;box-sizing:border-box;font-weight:600}@media (max-width: 1024px){.week-header-title[_ngcontent-%COMP%]{display:none!important}}.export-btn[_ngcontent-%COMP%]{background:#5186e41a;border:1px solid rgba(81,134,228,.3);border-radius:6px;padding:8px 12px;color:#b6c7de;font-size:14px;cursor:pointer;transition:all .2s ease;display:flex;align-items:center;gap:8px}.export-btn[_ngcontent-%COMP%]:hover{background:#5186e433;border-color:#5186e480}.calendar-content-wrapper[_ngcontent-%COMP%]{gap:4px;align-items:flex-start}@media (max-width: 480px){.calendar-content-wrapper[_ngcontent-%COMP%]{padding:0 8px}}.calendar-main[_ngcontent-%COMP%]{flex:1;width:100%}.weekly-summary[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;min-width:200px}.week-summary-card[_ngcontent-%COMP%]{background:#1f1f20;border:1px solid #424242;border-radius:8px;padding:8px;min-height:80px;display:flex;flex-direction:column;justify-content:space-between;flex:0 0 120px;margin:1px;box-sizing:border-box}.week-header[_ngcontent-%COMP%]{margin-bottom:4px}.week-title[_ngcontent-%COMP%]{color:#e3e3e3;font-size:12px;font-weight:600;margin:0}.week-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.week-total[_ngcontent-%COMP%]{font-size:14px;font-weight:700}.week-total.positive[_ngcontent-%COMP%]{color:#14ae5c}.week-total.negative[_ngcontent-%COMP%]{color:#ec221f}.week-days[_ngcontent-%COMP%]{color:#8e8e93;font-size:10px;font-weight:500}.desktop-only[_ngcontent-%COMP%]{display:block}@media (max-width: 1024px){.desktop-only[_ngcontent-%COMP%]{display:none}}.mobile-only[_ngcontent-%COMP%]{display:none}@media (max-width: 1024px){.mobile-only[_ngcontent-%COMP%]{display:block}}.weekly-summary-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:16px}@media (min-width: 1025px){.weekly-summary-grid[_ngcontent-%COMP%]{display:none!important}}@media (max-width: 768px){.weekly-summary-grid[_ngcontent-%COMP%]{gap:8px;margin-top:12px}}@media (max-width: 480px){.weekly-summary-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:6px;margin-top:8px;padding:0 8px 12px}}@keyframes _ngcontent-%COMP%_scrollText{0%{transform:translate(0)}20%{transform:translate(0)}80%{transform:translate(0)}to{transform:translate(0)}}.week-summary-card-mobile[_ngcontent-%COMP%]{background:#1f1f20;border:1px solid #424242;border-radius:8px;padding:8px;min-height:60px;display:flex;flex-direction:column;justify-content:space-between;font-family:SF Pro Display,Arial,sans-serif}@media (max-width: 768px){.week-summary-card-mobile[_ngcontent-%COMP%]{padding:6px;min-height:50px}}@media (max-width: 480px){.week-summary-card-mobile[_ngcontent-%COMP%]{padding:4px;min-height:40px}}.month-navigation[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.nav-arrow[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:32px;height:32px;background:#9ec4f21a;border:1px solid rgba(158,196,242,.3);border-radius:6px;color:#b6c7de;cursor:pointer;transition:all .2s ease}.nav-arrow[_ngcontent-%COMP%]:hover:not(.disabled){background:#9ec4f233;border-color:#9ec4f280;color:#e3e3e3}.nav-arrow[_ngcontent-%COMP%]:active:not(.disabled){transform:translateY(1px)}.nav-arrow.disabled[_ngcontent-%COMP%]{opacity:.3;cursor:not-allowed;background:#9ec4f20d;border-color:#9ec4f21a;color:#6a6a6a}']})};function fe(c,e){c&1&&(a(0,"div",5)(1,"div",8),s(2,"No Data"),r(),a(3,"div",9),s(4,"0"),r()())}function xe(c,e){if(c&1&&(a(0,"div",7)(1,"div",10)(2,"div",11),s(3),r(),a(4,"div",12),s(5),r()(),a(6,"div",13)(7,"div",11),s(8),r(),a(9,"div",14),s(10),r()()()),c&2){let t=g();l(3),b(t.formatCurrency(t.winLossData.lossValue)),l(2),b(t.formatPercentage(t.winLossData.lossPercentage)),l(3),b(t.formatCurrency(t.winLossData.winValue)),l(2),b(t.formatPercentage(t.winLossData.winPercentage))}}var dt=class c{values;chartOptions;numberFormatter=new L;winLossData={winValue:0,lossValue:0,winPercentage:0,lossPercentage:0};getDonutSize(){if(typeof window<"u"){if(window.innerWidth<=480)return"80%";if(window.innerWidth<=768)return"75%";if(window.innerWidth<=1024)return"70%"}return"80%"}getChartSize(){return 100}ngOnInit(){this.winLossData=this.calculateWinLossData(),this.chartOptions=this.getChartOptions(),typeof window<"u"&&window.addEventListener("resize",()=>{this.chartOptions=this.getChartOptions()})}ngOnChanges(e){e.values&&this.values&&(this.winLossData=this.calculateWinLossData(),this.chartOptions=this.getChartOptions())}getChartOptions(){return!this.values||this.values.length===0?{chart:{type:"donut",height:"100%",width:"100%",toolbar:{show:!1},foreColor:"#fff",fontFamily:"Inter, Arial, sans-serif",background:"transparent"},series:[1],labels:["No Data"],colors:["#6B7280"],dataLabels:{enabled:!1},plotOptions:{pie:{donut:{size:this.getDonutSize(),labels:{show:!1}}}},legend:{show:!1},tooltip:{enabled:!1},stroke:{show:!1}}:{chart:{type:"donut",height:"100%",width:"100%",toolbar:{show:!1},foreColor:"#fff",fontFamily:"Inter, Arial, sans-serif",background:"transparent"},series:[this.winLossData.winPercentage,this.winLossData.lossPercentage],labels:["Win","Loss"],colors:["#9BF526","#EC221F"],dataLabels:{enabled:!1},plotOptions:{pie:{donut:{size:this.getDonutSize(),labels:{show:!1}}}},legend:{show:!1},tooltip:{enabled:!0,custom:({series:e,seriesIndex:t,dataPointIndex:i,w:n})=>{let o=n.globals.seriesPercent[t],p=t===0,d=p?"#9BF526":"#EC221F",h=p?this.winLossData.winValue:this.winLossData.lossValue,_=this.numberFormatter.formatCurrency(h),O=this.numberFormatter.formatPercentageValue(o);return`
            <div class="custom-tooltip" style="
              background: rgba(255, 255, 255, 0.95);
              border: 1px solid #e0e0e0;
              border-radius: 8px;
              padding: 12px;
              box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
              color: #333;
              font-family: Inter, Arial, sans-serif;
              min-width: 80px;
              text-align: center;
              font-weight: 600;
            ">
              <div style="
                font-size: 16px;
                font-weight: 700;
                color: #333;
                margin-bottom: 4px;
              ">${_}</div>
              <div style="
                font-size: 12px;
                font-weight: 500;
                color: ${d};
              ">${O}%</div>
            </div>
          `}},stroke:{show:!1}}}calculateWinLossData(){if(!this.values||this.values.length===0)return{winValue:0,lossValue:0,winPercentage:0,lossPercentage:0};let e=0,t=0,i=0,n=0;this.values.forEach(D=>{let C=D.pnl??0;C>0?(e++,i+=C):C<0&&(t++,n+=Math.abs(C))});let o=i,p=e+t,d=p>0?e/p*100:0,h=n,_=100-d;return{winValue:Math.round(o*100)/100,lossValue:Math.round(h*100)/100,winPercentage:Math.round(d*10)/10,lossPercentage:Math.round(_*10)/10}}getWinLossData(){return this.calculateWinLossData()}formatCurrency(e){return this.numberFormatter.formatCurrency(e)}formatPercentage(e){return this.numberFormatter.formatPercentage(e)}static \u0275fac=function(t){return new(t||c)};static \u0275cmp=E({type:c,selectors:[["app-win-loss-chart"]],inputs:{values:"values"},features:[R],decls:9,vars:11,consts:[[1,"win-loss-chart-container","p-30"],[1,"chart-header","d-flex","justify-between","items-center","mb-20"],[1,"subtitle","color-background"],[1,"chart-content","d-flex","justify-center","items-center"],[1,"chart-wrapper"],[1,"no-data-overlay"],[3,"series","chart","labels","colors","dataLabels","plotOptions","legend","tooltip","stroke"],[1,"chart-labels-overlay"],[1,"no-data-text"],[1,"no-data-value"],[1,"loss-segment"],[1,"segment-value"],[1,"segment-percentage","loss-color"],[1,"win-segment"],[1,"segment-percentage","win-color"]],template:function(t,i){t&1&&(a(0,"div",0)(1,"div",1)(2,"h2",2),s(3,"Average win/loss trades"),r()(),a(4,"div",3)(5,"div",4),S(6,fe,5,0,"div",5),k(7,"apx-chart",6),r(),S(8,xe,11,4,"div",7),r()()),t&2&&(l(6),T(!i.values||i.values.length===0?6:-1),l(),m("series",i.chartOptions.series)("chart",i.chartOptions.chart)("labels",i.chartOptions.labels)("colors",i.chartOptions.colors)("dataLabels",i.chartOptions.dataLabels)("plotOptions",i.chartOptions.plotOptions)("legend",i.chartOptions.legend)("tooltip",i.chartOptions.tooltip)("stroke",i.chartOptions.stroke),l(),T(i.values&&i.values.length>0?8:-1))},dependencies:[I,at,it],styles:[".win-loss-chart-container[_ngcontent-%COMP%]{background:#1f1f20;border-radius:8px;border:1px solid #424242;height:500px;display:flex;flex-direction:column}@media (max-width: 1024px){.win-loss-chart-container[_ngcontent-%COMP%]{height:450px;padding:16px}}@media (max-width: 768px){.win-loss-chart-container[_ngcontent-%COMP%]{height:400px;padding:12px}}@media (max-width: 480px){.win-loss-chart-container[_ngcontent-%COMP%]{height:350px;padding:8px}}.chart-header[_ngcontent-%COMP%]{padding-bottom:8px}@media (max-width: 1024px){.chart-header[_ngcontent-%COMP%]{padding-bottom:4px}}@media (max-width: 768px){.chart-header[_ngcontent-%COMP%]{padding-bottom:2px}}.subtitle[_ngcontent-%COMP%]{color:#e3e3e3;font-size:18px;font-weight:600;font-family:SF Pro Display,-apple-system,BlinkMacSystemFont,sans-serif;margin:0}@media (max-width: 1024px){.subtitle[_ngcontent-%COMP%]{font-size:16px}}.more-options-btn[_ngcontent-%COMP%]{background:none;border:none;color:#8e8e93;cursor:pointer;padding:4px;border-radius:4px;transition:all .2s ease}.more-options-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;color:#e3e3e3}.icon-more-options[_ngcontent-%COMP%]{font-size:16px;font-weight:700}.chart-content[_ngcontent-%COMP%]{flex:1;position:relative;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px}@media (max-width: 1024px){.chart-content[_ngcontent-%COMP%]{gap:12px}}@media (max-width: 768px){.chart-content[_ngcontent-%COMP%]{gap:8px}}.chart-wrapper[_ngcontent-%COMP%]{position:relative;height:100%;max-height:100%;width:100%;max-width:100%;padding-bottom:0}.chart-wrapper[_ngcontent-%COMP%]   apx-chart[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%!important;height:100%!important}.no-data-overlay[_ngcontent-%COMP%]{position:absolute;top:-60px;left:50%;transform:translate(-50%);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10;pointer-events:none}.no-data-text[_ngcontent-%COMP%]{color:#6b7280;font-size:14px;font-weight:500;font-family:SF Pro Display,-apple-system,BlinkMacSystemFont,sans-serif;margin-bottom:4px}.no-data-value[_ngcontent-%COMP%]{color:#6b7280;font-size:24px;font-weight:700;font-family:SF Pro Display,-apple-system,BlinkMacSystemFont,sans-serif}.chart-labels-overlay[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%;gap:16px}@media (max-width: 1024px){.chart-labels-overlay[_ngcontent-%COMP%]{gap:12px}}@media (max-width: 768px){.chart-labels-overlay[_ngcontent-%COMP%]{gap:8px}}@media (max-width: 480px){.chart-labels-overlay[_ngcontent-%COMP%]{gap:6px}}.loss-segment[_ngcontent-%COMP%], .win-segment[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;flex:1}.segment-value[_ngcontent-%COMP%]{font-size:18px;font-weight:700;color:#e3e3e3;font-family:SF Pro Display,-apple-system,BlinkMacSystemFont,sans-serif;line-height:1.3;margin-bottom:2px}@media (max-width: 1024px){.segment-value[_ngcontent-%COMP%]{font-size:16px}}.segment-percentage[_ngcontent-%COMP%]{font-size:14px;font-weight:500;font-family:SF Pro Display,-apple-system,BlinkMacSystemFont,sans-serif;line-height:1.3}.segment-percentage.loss-color[_ngcontent-%COMP%]{color:#ec221f}.segment-percentage.win-color[_ngcontent-%COMP%]{color:#9bf526}@media (max-width: 1024px){.segment-percentage[_ngcontent-%COMP%]{font-size:12px}}  .custom-tooltip{z-index:1000;pointer-events:none}"]})};var Jt=Zt(te());var Ce=(c,e)=>e.id;function be(c,e){if(c&1){let t=v();a(0,"button",17),u("click",function(){f(t);let n=g(2);return x(n.exportAllData())}),a(1,"span"),s(2,"Export Data"),r(),a(3,"span",15),s(4,"call_made"),r()()}}function _e(c,e){if(c&1){let t=v();a(0,"button",18),u("click",function(){f(t);let n=g(2);return x(n.exportAllData())}),a(1,"span"),s(2,"Export Data"),r(),a(3,"span",15),s(4,"call_made"),r()(),a(5,"button",19),u("click",function(){f(t);let n=g(2);return x(n.goToEditStrategy())}),a(6,"span"),s(7,"Edit Strategy"),r(),a(8,"span",15),s(9,"edit_square"),r()()}}function ye(c,e){if(c&1){let t=v();a(0,"div",25),u("click",function(){let n=f(t).$implicit,o=g(3);return x(o.selectAccount(n))}),a(1,"div",26),s(2),r(),a(3,"div",27),s(4),r()()}if(c&2){let t=e.$implicit;l(2),b(t.accountName),l(2),b(t.server)}}function we(c,e){if(c&1){let t=v();a(0,"div",16)(1,"div",20)(2,"span",21),s(3,"Select Account"),r(),a(4,"button",22),u("click",function(){f(t);let n=g(2);return x(n.refreshAccounts())}),a(5,"span",23),s(6,"refresh"),r()()(),z(7,ye,5,2,"div",24,Ce),r()}if(c&2){let t=g(2);l(7),N(t.accountsData)}}function ve(c,e){if(c&1){let t=v();a(0,"div",3)(1,"div",6)(2,"div",7)(3,"h2",8),s(4),r(),S(5,be,5,0,"button",9),r(),a(6,"div",10)(7,"span",11),s(8),r()()(),a(9,"div",12),S(10,_e,10,0),a(11,"div",13)(12,"button",14),u("click",function(){f(t);let n=g();return x(n.toggleAccountDropdown())}),a(13,"span"),s(14,"Change account"),r(),a(15,"span",15),s(16,"keyboard_arrow_down"),r()(),S(17,we,9,0,"div",16),r()()()}if(c&2){let t=g();l(4),b(t.getCurrentAccountName()),l(),T(t.loading?-1:5),l(3),b(t.getCurrentAccountServer()),l(2),T(t.loading?-1:10),l(7),T(t.showAccountDropdown?17:-1)}}function Pe(c,e){if(c&1){let t=v();a(0,"div",4)(1,"div",28)(2,"span",29),s(3,"group_add"),r()(),a(4,"h3",30),s(5,"No trading accounts found"),r(),a(6,"p",31),s(7,"You need to add a trading account before creating strategies."),r(),a(8,"button",32),u("click",function(){f(t);let n=g();return x(n.navigateToTradingAccounts())}),s(9," Add Trading Account "),r()()}}function Me(c,e){if(c&1){let t=v();a(0,"button",38),u("click",function(){f(t);let n=g(2);return x(n.reloadData())}),a(1,"span",15),s(2,"refresh"),r(),s(3," Reload Data "),r()}}function Oe(c,e){if(c&1&&(a(0,"div",5)(1,"div",33),k(2,"div",34),r(),a(3,"h3",35),s(4,"Loading your trading data..."),r(),a(5,"p",36),s(6,"Please wait while we fetch your account information."),r(),S(7,Me,4,0,"button",37),r()),c&2){let t=g();l(7),T(t.showReloadButton?7:-1)}}function De(c,e){if(c&1){let t=v();a(0,"div",39),k(1,"app-stat-card",40)(2,"app-stat-card",41)(3,"app-stat-card",42)(4,"app-stat-card",43)(5,"app-stat-card",44),r(),a(6,"div",45)(7,"app-PnL-Graph",46),u("onYearChange",function(n){f(t);let o=g();return x(o.onYearChange(n))}),r(),k(8,"app-win-loss-chart",47),r(),a(9,"app-calendar",48),u("strategyFollowedPercentageChange",function(n){f(t);let o=g();return x(o.onStrategyPercentageChange(n))}),r(),a(10,"app-plan-limitation-modal",49),u("closeModal",function(){f(t);let n=g();return x(n.onClosePlanLimitationModal())}),r()}if(c&2){let t=g();l(),m("value",t.balanceData==null?null:t.balanceData.balance),l(),m("value",t.stats!=null&&t.stats.netPnl?t.stats==null?null:t.stats.netPnl:0),l(),m("value",t.stats==null?null:t.stats.tradeWinPercent),l(),m("value",t.stats==null?null:t.stats.profitFactor),l(),m("value",t.stats==null?null:t.stats.totalTrades),l(2),m("values",t.accountHistory),l(),m("values",t.accountHistory),l(),m("strategies",t.strategies)("groupedTrades",t.accountHistory),l(),m("modalData",t.planLimitationModal)}}var Kt=class c{constructor(e,t,i,n,o,p,d,h){this.platformId=e;this.store=t;this.reportService=i;this.userService=n;this.strategySvc=o;this.router=p;this.planLimitationsGuard=d;this.appContext=h}accessToken=null;accountDetails=null;accountsData=[];accountHistory=[];errorMessage=null;stats;userKey;config;loading=!1;fromDate="";toDate="";user=null;requestYear=0;updateSubscription;loadingTimeout;strategies=[];currentAccount=null;showAccountDropdown=!1;showReloadButton=!1;balanceData=null;STORAGE_KEYS={REPORT_DATA:"tradeSwitch_reportData",ACCOUNTS_DATA:"tradeSwitch_accountsData",CURRENT_ACCOUNT:"tradeSwitch_currentAccount",USER_DATA:"tradeSwitch_userData"};planLimitationModal={showModal:!1,modalType:"blocked",title:"",message:"",primaryButtonText:"",onPrimaryAction:()=>{}};ngAfterViewInit(){if(B(this.platformId)){let e=document.querySelector(".stats-card-container");e&&e.addEventListener("wheel",function(t){t.deltaY!==0&&(t.preventDefault(),e.scrollLeft+=t.deltaY)})}}ngOnInit(){this.loadSavedData(),this.subscribeToContextData(),this.getUserData(),this.initializeStrategies(),this.listenGroupedTrades(),this.fetchUserRules(),this.checkUserAccess()}subscribeToContextData(){this.appContext.currentUser$.subscribe(e=>{this.user=e}),this.appContext.userAccounts$.subscribe(e=>{this.accountsData=e,e.length>0&&!this.currentAccount&&(this.currentAccount=e[0])}),this.appContext.userStrategies$.subscribe(e=>{this.strategies=e}),this.appContext.isLoading$.subscribe(e=>{e.accounts?this.startLoading():this.stopLoading()}),this.appContext.errors$.subscribe(e=>{e.accounts&&(this.errorMessage=e.accounts)})}startLoading(){this.loading=!0,this.loadingTimeout&&clearTimeout(this.loadingTimeout),this.loadingTimeout=setTimeout(()=>{this.loading=!1,this.showReloadButton=!0},1e4)}stopLoading(){this.loading=!1,this.showReloadButton=!1,this.loadingTimeout&&(clearTimeout(this.loadingTimeout),this.loadingTimeout=null)}loadSavedData(){if(B(this.platformId))try{let e=localStorage.getItem(this.STORAGE_KEYS.REPORT_DATA);if(e){let o=JSON.parse(e);if(o.accountHistory&&o.stats){this.accountHistory=o.accountHistory,this.stats=o.stats;let p=Array.isArray(o.accountHistory)?o.accountHistory.map(d=>q(J({},d),{pnl:d.pnl??0,isWon:d.isWon??!1,isOpen:d.isOpen??!1})):[];this.store.dispatch(j({groupedTrades:p}))}}let t=localStorage.getItem(this.STORAGE_KEYS.ACCOUNTS_DATA);t&&(this.accountsData=JSON.parse(t));let i=localStorage.getItem(this.STORAGE_KEYS.CURRENT_ACCOUNT);i&&(this.currentAccount=JSON.parse(i));let n=localStorage.getItem(this.STORAGE_KEYS.USER_DATA);n&&(this.user=JSON.parse(n))}catch(e){console.error("Error cargando datos guardados:",e),this.clearSavedData()}}saveDataToStorage(){if(B(this.platformId))try{if(this.accountHistory.length>0&&this.stats){let e={accountHistory:this.accountHistory,stats:this.stats,lastUpdated:Date.now()};localStorage.setItem(this.STORAGE_KEYS.REPORT_DATA,JSON.stringify(e))}this.accountsData.length>0&&localStorage.setItem(this.STORAGE_KEYS.ACCOUNTS_DATA,JSON.stringify(this.accountsData)),this.currentAccount&&localStorage.setItem(this.STORAGE_KEYS.CURRENT_ACCOUNT,JSON.stringify(this.currentAccount)),this.user&&localStorage.setItem(this.STORAGE_KEYS.USER_DATA,JSON.stringify(this.user))}catch(e){console.error("Error guardando datos:",e)}}clearSavedData(){if(B(this.platformId))try{localStorage.removeItem(this.STORAGE_KEYS.REPORT_DATA),localStorage.removeItem(this.STORAGE_KEYS.ACCOUNTS_DATA),localStorage.removeItem(this.STORAGE_KEYS.CURRENT_ACCOUNT),localStorage.removeItem(this.STORAGE_KEYS.USER_DATA)}catch(e){console.error("Error limpiando datos guardados:",e)}}initializeStrategies(){return A(this,null,function*(){if(this.user?.id)try{this.strategies=yield this.strategySvc.getUserStrategyViews(this.user.id)}catch(e){console.error("Error loading strategies:",e)}})}ngOnDestroy(){this.updateSubscription?.unsubscribe(),this.loadingTimeout&&clearTimeout(this.loadingTimeout)}getUserData(){this.store.select(kt).subscribe({next:e=>{this.user=e.user,this.user&&(this.saveDataToStorage(),this.fetchUserAccounts())},error:e=>{console.error("Error fetching user data",e)}})}fetchUserAccounts(){this.userService.getUserAccounts(this.user?.id).then(e=>{if(!e||e.length===0)this.accountsData=[],this.currentAccount=null,this.stopLoading();else if(this.accountsData=e,this.currentAccount?this.accountsData.find(i=>i.id===this.currentAccount?.id)||(this.currentAccount=this.accountsData[0]):this.currentAccount=this.accountsData[0],this.saveDataToStorage(),this.accountsData.length===0)this.stopLoading();else{let t=this.currentAccount||this.accountsData[0];setTimeout(()=>{this.fetchUserKey(t)},1e3)}}).catch(e=>{console.error("Error fetching user accounts:",e),this.accountsData=[],this.currentAccount=null,this.stopLoading()})}fetchUserRules(){this.strategySvc.getStrategyConfig(this.user?.id).then(e=>{e?(this.store.dispatch(et({config:e})),this.config=this.prepareConfigDisplayData(e)):(this.store.dispatch(et({config:K})),this.config=this.prepareConfigDisplayData(K))}).catch(e=>{this.store.dispatch(et({config:K})),this.config=this.prepareConfigDisplayData(K),this.stopLoading(),console.error("Error to get the config",e)})}onStrategyPercentageChange(e){this.user&&this.updateFirebaseUserData(e)}updateFirebaseUserData(e){if(this.user){let t=q(J({},this.user),{best_trade:ht(this.accountHistory),netPnl:this.stats?.netPnl??0,lastUpdated:new Date().getTime(),number_trades:this.stats?.totalTrades??0,strategy_followed:e,profit:this.stats?.netPnl??0,total_spend:ft(this.accountHistory)}),i=new Date().getFullYear(),n=this.requestYear;i===n&&this.userService.createUser(t);let o={id:this.user?.id,best_trade:ht(this.accountHistory),netPnl:this.stats?.netPnl??0,number_trades:this.stats?.totalTrades??0,profit:this.stats?.netPnl??0,strategy_followed:e,total_spend:ft(this.accountHistory),month:new Date().getMonth()+1,year:new Date().getFullYear()};this.reportService.updateMonthlyReport(o)}}listenGroupedTrades(){this.store.select(Ft).subscribe({next:e=>{this.accountHistory=e,this.updateReportStats(this.store,e)}})}computeStats(e){return{netPnl:Nt(e),tradeWinPercent:Vt(e),profitFactor:Yt(e),avgWinLossTrades:Gt(e),totalTrades:jt(e),activePositions:0}}computeStatsFromBalance(e,t){let i=this.getCompletedTrades(t),n=this.getActivePositions(t);return{netPnl:this.calculateNetPnlFromTrades(i),tradeWinPercent:this.calculateTradeWinPercentFromTrades(i),profitFactor:this.calculateProfitFactorFromTrades(i),avgWinLossTrades:this.calculateAvgWinLossFromTrades(i),totalTrades:i.length,activePositions:n.length}}getCompletedTrades(e){return e.filter(t=>t.isOpen===!1&&t.pnl!==void 0&&t.pnl!==null)}getActivePositions(e){return e.filter(t=>t.isOpen===!0)}calculateNetPnlFromTrades(e){if(e.length===0)return 0;let t=e.filter(o=>o.pnl>0).reduce((o,p)=>o+p.pnl,0),i=Math.abs(e.filter(o=>o.pnl<0).reduce((o,p)=>o+p.pnl,0)),n=t-i;return Math.round(n*100)/100}calculateTradeWinPercentFromTrades(e){if(e.length===0)return 0;let i=e.filter(n=>n.pnl>0).length/e.length*100;return Math.round(i*100)/100}calculateProfitFactorFromTrades(e){if(e.length===0)return 0;let t=e.filter(o=>o.pnl>0).reduce((o,p)=>o+p.pnl,0),i=Math.abs(e.filter(o=>o.pnl<0).reduce((o,p)=>o+p.pnl,0));if(i===0)return t>0?999.99:0;if(t===0)return 0;let n=t/i;return Math.round(n*100)/100}calculateAvgWinLossFromTrades(e){if(e.length===0)return 0;let t=e.filter(d=>d.pnl>0),i=e.filter(d=>d.pnl<0),n=t.length>0?t.reduce((d,h)=>d+h.pnl,0)/t.length:0,o=i.length>0?Math.abs(i.reduce((d,h)=>d+h.pnl,0)/i.length):0;if(o===0)return n>0?999.99:0;if(n===0)return 0;let p=n/o;return Math.round(p*100)/100}fetchUserKey(e){this.reportService.getUserKey(e.emailTradingAccount,e.brokerPassword,e.server).subscribe({next:t=>{this.userKey=t;let n=new Date().getUTCFullYear();this.fromDate=Date.UTC(n,0,1,0,0,0,0).toString(),this.toDate=Date.UTC(n,11,31,23,59,59,999).toString(),this.requestYear=n,this.fetchHistoryData(t,e.accountID,1),this.store.dispatch(ut({userKey:t}))},error:t=>{console.error("Error fetching user key:",t),this.store.dispatch(ut({userKey:""})),this.stopLoading()}})}fetchHistoryData(e,t,i){this.reportService.getBalanceData(t,e,i).subscribe({next:n=>{this.balanceData=n},error:n=>{console.error("Error fetching balance data:",n)}}),this.reportService.getHistoryData(t,e,i).subscribe({next:n=>{this.store.dispatch(j({groupedTrades:n})),this.saveDataToStorage(),this.stopLoading()},error:n=>{console.error("Error fetching history data:",n),this.store.dispatch(j({groupedTrades:[]})),this.stopLoading()}})}updateReportStats(e,t){let i=t.map(n=>q(J({},n),{pnl:n.pnl??0,entryPrice:n.avgPrice??0,exitPrice:n.avgPrice??0,buy_price:n.side==="buy"?n.price:"0",sell_price:n.side==="sell"?n.price:"0",quantity:Number(n.qty)??0}));this.stats={netPnl:this.calculateNetPnlFromTrades(i),tradeWinPercent:this.calculateTradeWinPercentFromTrades(i),profitFactor:this.calculateProfitFactorFromTrades(i),avgWinLossTrades:this.calculateAvgWinLossFromTrades(i),totalTrades:i.length,activePositions:t.filter(n=>n.isOpen===!0).length},e.dispatch(At({netPnL:this.stats?.netPnl||0})),e.dispatch(Et({tradeWin:this.stats?.tradeWinPercent||0})),e.dispatch(It({profitFactor:this.stats?.profitFactor||0})),e.dispatch(Rt({avgWnL:this.stats?.avgWinLossTrades||0})),e.dispatch(Lt({totalTrades:this.stats?.totalTrades||0})),this.saveDataToStorage()}prepareConfigDisplayData(e){return this.transformStrategyStateToDisplayData(e)}transformStrategyStateToDisplayData(e){let t=[];return Object.entries(e).forEach(([i,n])=>{if(n.type){let o="";if(n.type==="MAX DAILY TRADES")o="Max Daily Trades";else if(n.type==="RISK REWARD RATIO")o=`${n.riskRewardRatio} Risk Reward`;else if(n.type==="MAX RISK PER TRADE")o=`Limit my Risk per Trade: $${n.maxRiskPerTrade}`;else if(n.type==="DAYS ALLOWED"){let p={Monday:"Mon",Tuesday:"Tues",Wednesday:"Wed",Thursday:"Thurs",Friday:"Fri",Saturday:"Sat",Sunday:"Sun"};o=`Only allow trades on: ${n.tradingDays.map(h=>p[h]??h).join(", ")}.`}else if(n.type==="ASSETS ALLOWED")o=`Only allow trades on the following assets: ${n.assetsAllowed.join(", ")}`;else if(n.type==="TRADING HOURS"){let p=Jt.default.tz(n.timezone).zoneAbbr();o=`Only allow trades between: ${n.tradingOpenTime} - ${n.tradingCloseTime} ${p}`}t.push({title:o,type:n.type,isActive:n.isActive})}}),t.sort((i,n)=>i.isActive&&!n.isActive?-1:!i.isActive&&n.isActive?1:0)}onYearChange(e){this.startLoading(),this.fromDate=Date.UTC(Number(e),0,1,0,0,0,0).toString(),this.toDate=Date.UTC(Number(e),11,31,23,59,59,999).toString(),this.requestYear=Number(e),this.user&&this.fetchUserAccounts()}getCurrentAccountName(){return this.currentAccount?.accountName||"No Account Selected"}getCurrentAccountServer(){return this.currentAccount?.server||"No Server"}getCurrentAccountPlan(){return A(this,null,function*(){return yield this.getAccountPlan(this.currentAccount)})}getAccountPlan(e){return A(this,null,function*(){return!e||!this.user?.id?"Free":yield this.getUserPlanName()})}getUserPlanName(){return A(this,null,function*(){if(!this.user?.id)return"Free";try{return(yield this.planLimitationsGuard.checkUserLimitations(this.user.id)).planName}catch(e){return console.error("Error getting user plan name:",e),"Free"}})}toggleAccountDropdown(){this.showAccountDropdown=!this.showAccountDropdown}selectAccount(e){this.currentAccount=e,this.showAccountDropdown=!1,this.saveDataToStorage(),this.startLoading(),this.store.dispatch(j({groupedTrades:[]})),this.fetchUserKey(e)}goToEditStrategy(){this.router.navigate(["/edit-strategy"])}exportAllData(){return A(this,null,function*(){let e=yield this.generateAllReportsCSV();this.downloadCSV(e,`my-reports-${new Date().toISOString().split("T")[0]}.csv`)})}generateAllReportsCSV(){return A(this,null,function*(){let t=[["Date","Account Name","Plan","Net P&L","Trades Count","Win Percentage","Strategy Followed","Profit Factor","Avg Win/Loss Trades"].join(",")],i=yield this.getCurrentAccountPlan(),n=[new Date().toISOString().split("T")[0],this.getCurrentAccountName(),i,this.stats?.netPnl?.toFixed(2)||"0",this.stats?.totalTrades?.toString()||"0",`${this.stats?.tradeWinPercent?.toFixed(1)||"0"}%`,"Yes",this.stats?.profitFactor?.toFixed(2)||"0",this.stats?.avgWinLossTrades?.toFixed(2)||"0"];return t.push(n.join(",")),this.accountHistory.forEach(o=>{let d=[new Date(Number(o.lastModified)).toISOString().split("T")[0],this.getCurrentAccountName(),i,(o.pnl||0).toFixed(2),"1",o.pnl&&o.pnl>0?"100":"0","Yes","1.00",(o.pnl||0).toFixed(2)];t.push(d.join(","))}),t.join(`
`)})}downloadCSV(e,t){let i=new Blob([e],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a");if(n.download!==void 0){let o=URL.createObjectURL(i);n.setAttribute("href",o),n.setAttribute("download",t),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)}}navigateToTradingAccounts(){this.router.navigate(["/trading-accounts"])}reloadData(){this.showReloadButton=!1,this.startLoading(),this.store.dispatch(j({groupedTrades:[]})),this.accountHistory=[],this.stats=void 0,this.clearSavedData(),this.user?this.fetchUserAccounts():this.getUserData()}refreshAccounts(){this.user&&this.fetchUserAccounts()}checkUserAccess(){return A(this,null,function*(){if(this.user?.id)try{let e=yield this.planLimitationsGuard.checkReportAccessWithModal(this.user.id);!e.canAccess&&e.modalData&&(this.planLimitationModal=e.modalData)}catch(e){console.error("Error checking user access:",e)}})}onClosePlanLimitationModal(){this.planLimitationModal.showModal=!1}static \u0275fac=function(t){return new(t||c)(M(X),M(St),M(nt),M(Dt),M(zt),M(Mt),M(Ut),M(Ot))};static \u0275cmp=E({type:c,selectors:[["app-report"]],decls:9,vars:2,consts:[[1,"main-titles","color-background","d-flex","flex-col","mb-50"],[1,"titleText","mb-20"],[1,"regularText"],[1,"account-header","d-flex","justify-between","align-items-center","mb-32"],[1,"empty-strategies","d-flex","flex-col","align-items-center"],[1,"loading-content","d-flex","flex-col","align-items-center"],[1,"account-info","d-flex","flex-col"],[1,"account-title-row","d-flex","align-items-center"],[1,"account-name","color-background"],[1,"export-btn","export-btn-title","d-flex","align-items-center","gap-8"],[1,"account-details","d-flex","align-items-center"],[1,"account-server","color-secondary-300"],[1,"action-buttons","d-flex","gap-12"],[1,"change-account-dropdown"],[1,"change-account-btn","d-flex","align-items-center","gap-8",3,"click"],[1,"material-symbols-outlined",2,"font-size","18px"],[1,"account-dropdown"],[1,"export-btn","export-btn-title","d-flex","align-items-center","gap-8",3,"click"],[1,"export-btn","export-btn-desktop","d-flex","align-items-center","gap-8",3,"click"],[1,"edit-strategy-btn","d-flex","align-items-center","gap-8",3,"click"],[1,"account-dropdown-header","d-flex","justify-between","align-items-center","p-12"],[1,"smallText","color-secondary-300"],["title","Refresh accounts",1,"refresh-accounts-btn",3,"click"],[1,"material-symbols-outlined",2,"font-size","16px"],[1,"account-option"],[1,"account-option",3,"click"],[1,"account-option-name"],[1,"account-option-server"],[1,"empty-icon"],[1,"material-symbols-outlined",2,"font-size","28px"],[1,"empty-title"],[1,"empty-description"],[1,"create-first-btn",3,"click"],[1,"loading-spinner-container"],[1,"loading-spinner"],[1,"loading-title"],[1,"loading-message"],[1,"reload-btn"],[1,"reload-btn",3,"click"],[1,"stats-card-container"],["title","Balance","formatType","currency",1,"stat-card",3,"value"],["title","Total P&L","formatType","currency",1,"stat-card",3,"value"],["title","Trade win %","formatType","percentage",1,"stat-card",3,"value"],["title","Profit Factor","formatType","number",1,"stat-card",3,"value"],["title","Total trades","formatType","number",1,"stat-card",3,"value"],[1,"middle-container","d-flex","mb-24"],[3,"onYearChange","values"],[3,"values"],[3,"strategyFollowedPercentageChange","strategies","groupedTrades"],[3,"closeModal","modalData"]],template:function(t,i){t&1&&(a(0,"div",0)(1,"h1",1),s(2,"My Reports"),r(),a(3,"h3",2),s(4," Visualize your consistency while growing with TradeSwitch. "),r()(),S(5,ve,18,5,"div",3),S(6,Pe,10,0,"div",4)(7,Oe,8,1,"div",5)(8,De,11,10)),t&2&&(l(5),T(i.accountsData.length>0?5:-1),l(),T(i.accountsData.length===0?6:i.loading?7:8))},dependencies:[I,tt,Tt,$t,ot,ct,dt,Ht],styles:[".report-container[_ngcontent-%COMP%]{position:relative;width:100%;max-width:100%;overflow-x:hidden}@media (max-width: 768px){.report-container[_ngcontent-%COMP%]{padding:0 8px}}@media (max-width: 480px){.report-container[_ngcontent-%COMP%]{padding:0 4px}}@media (max-width: 768px){.main-titles[_ngcontent-%COMP%]{margin-bottom:24px}}@media (max-width: 480px){.main-titles[_ngcontent-%COMP%]{margin-bottom:16px}}.loading-content[_ngcontent-%COMP%]{padding:60px 20px;text-align:center}@media (max-width: 768px){.loading-content[_ngcontent-%COMP%]{padding:40px 16px}}@media (max-width: 480px){.loading-content[_ngcontent-%COMP%]{padding:30px 12px}}.loading-spinner-container[_ngcontent-%COMP%]{margin-bottom:24px}.loading-spinner[_ngcontent-%COMP%]{width:48px;height:48px;border:4px solid rgba(255,255,255,.2);border-top:4px solid #9bf526;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:0 auto}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.loading-title[_ngcontent-%COMP%]{color:#e3e3e3;font-family:SF Pro Display,-apple-system,BlinkMacSystemFont,sans-serif;font-size:18px;font-weight:600;margin:0 0 8px}.loading-message[_ngcontent-%COMP%]{color:#8e8e93;font-family:SF Pro Display,-apple-system,BlinkMacSystemFont,sans-serif;font-size:14px;font-weight:400;margin:0 0 24px;line-height:1.5}.reload-btn[_ngcontent-%COMP%]{background:#9bf526;color:#1a1a1a;border:none;border-radius:8px;padding:12px 24px;font-family:SF Pro Display,-apple-system,BlinkMacSystemFont,sans-serif;font-size:14px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:8px;margin:0 auto;transition:all .2s ease}.reload-btn[_ngcontent-%COMP%]:hover{background:#8ae01a;transform:translateY(-1px);box-shadow:0 4px 12px #9bf5264d}.empty-strategies[_ngcontent-%COMP%]{text-align:center;align-items:center;padding:40px 20px}.empty-strategies[_ngcontent-%COMP%]   .empty-icon[_ngcontent-%COMP%]{width:64px;height:64px;background:#2a2a2a;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 16px}.empty-strategies[_ngcontent-%COMP%]   .empty-icon[_ngcontent-%COMP%]   .material-symbols-outlined[_ngcontent-%COMP%]{font-size:28px;color:#fff}.empty-strategies[_ngcontent-%COMP%]   .empty-title[_ngcontent-%COMP%]{color:#e3e3e3;font-family:SF Pro Display,-apple-system,BlinkMacSystemFont,sans-serif;font-size:18px;font-weight:600;margin:0 0 8px}.empty-strategies[_ngcontent-%COMP%]   .empty-description[_ngcontent-%COMP%]{color:#8e8e93;font-family:SF Pro Display,-apple-system,BlinkMacSystemFont,sans-serif;font-size:14px;font-weight:400;margin:0 0 20px;line-height:1.5}.empty-strategies[_ngcontent-%COMP%]   .create-first-btn[_ngcontent-%COMP%]{background:#9bf526;color:#1a1a1a;border:none;border-radius:8px;padding:12px 24px;font-family:SF Pro Display,-apple-system,BlinkMacSystemFont,sans-serif;font-size:14px;font-weight:600;cursor:pointer;transition:all .2s ease}.empty-strategies[_ngcontent-%COMP%]   .create-first-btn[_ngcontent-%COMP%]:hover{background:#8ae01a;transform:translateY(-1px);box-shadow:0 4px 12px #9bf5264d}a[_ngcontent-%COMP%]{text-decoration:none;color:inherit}.add-account-btn[_ngcontent-%COMP%]{border-radius:6px}.stats-card-container[_ngcontent-%COMP%]{width:100%;display:flex!important;flex-wrap:wrap!important;gap:16px;align-items:stretch;justify-content:flex-start;margin-bottom:24px;overflow:visible!important}.stats-card-container[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]{flex:1 1 0;min-width:fit-content;width:auto;height:auto;flex-shrink:1;overflow:hidden;text-overflow:ellipsis}@media (max-width: 768px){.stats-card-container[_ngcontent-%COMP%]{gap:12px}}@media (max-width: 480px){.stats-card-container[_ngcontent-%COMP%]{gap:8px}}.middle-container[_ngcontent-%COMP%]{width:100%;gap:24px;display:flex;flex-wrap:nowrap}.middle-container[_ngcontent-%COMP%]   app-PnL-Graph[_ngcontent-%COMP%]{flex:0 0 60%;min-width:400px}.middle-container[_ngcontent-%COMP%]   app-win-loss-chart[_ngcontent-%COMP%]{flex:0 0 40%;min-width:300px}@media (max-width: 1200px){.middle-container[_ngcontent-%COMP%]{gap:16px}.middle-container[_ngcontent-%COMP%]   app-PnL-Graph[_ngcontent-%COMP%]{flex:0 0 65%;min-width:350px}.middle-container[_ngcontent-%COMP%]   app-win-loss-chart[_ngcontent-%COMP%]{flex:0 0 35%;min-width:250px}}@media (max-width: 1024px){.middle-container[_ngcontent-%COMP%]{flex-direction:column;gap:16px}.middle-container[_ngcontent-%COMP%]   app-PnL-Graph[_ngcontent-%COMP%]{flex:1;min-width:unset;width:100%}.middle-container[_ngcontent-%COMP%]   app-win-loss-chart[_ngcontent-%COMP%]{flex:1;min-width:unset;width:100%}}@media (max-width: 768px){.middle-container[_ngcontent-%COMP%]{gap:12px}}.middle-container[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.my-rules[_ngcontent-%COMP%]{width:40%;border-radius:8px;border:.5px solid #2f2f2f;background:radial-gradient(ellipse 36% 42% at top center,#5186e41a,#5186e403)}.strategy-btn[_ngcontent-%COMP%]{height:fit-content;border-radius:6px;border:none;cursor:pointer;text-decoration:none}.account-header[_ngcontent-%COMP%]{background:transparent;margin-bottom:24px}@media (max-width: 1024px){.account-header[_ngcontent-%COMP%]{flex-direction:column;gap:12px;align-items:flex-start}}@media (max-width: 480px){.account-header[_ngcontent-%COMP%]{margin-bottom:16px;gap:8px}}.account-info[_ngcontent-%COMP%]{width:auto;gap:2px}@media (max-width: 1024px){.account-info[_ngcontent-%COMP%]{width:100%;gap:0px}}.account-info[_ngcontent-%COMP%]   .account-title-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:4px;width:auto}@media (max-width: 1024px){.account-info[_ngcontent-%COMP%]   .account-title-row[_ngcontent-%COMP%]{width:100%;justify-content:space-between;align-items:center;gap:6px}}.account-info[_ngcontent-%COMP%]   .account-name[_ngcontent-%COMP%]{font-size:18px;font-weight:600;margin:0;font-family:Inter,Arial,sans-serif}@media (max-width: 1024px){.account-info[_ngcontent-%COMP%]   .account-name[_ngcontent-%COMP%]{font-size:16px}}.account-info[_ngcontent-%COMP%]   .account-details[_ngcontent-%COMP%]{gap:4px;margin-top:0}@media (max-width: 1024px){.account-info[_ngcontent-%COMP%]   .account-details[_ngcontent-%COMP%]{margin-top:0}}.account-info[_ngcontent-%COMP%]   .account-details[_ngcontent-%COMP%]   .account-server[_ngcontent-%COMP%]{font-size:14px;font-family:Inter,Arial,sans-serif}@media (max-width: 1024px){.account-info[_ngcontent-%COMP%]   .account-details[_ngcontent-%COMP%]   .account-server[_ngcontent-%COMP%]{font-size:12px}}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center;flex-wrap:wrap;width:100%;justify-content:flex-end;gap:8px}@media (max-width: 1024px){.action-buttons[_ngcontent-%COMP%]{flex-wrap:nowrap;display:flex;flex-direction:row;gap:8px;align-items:center;justify-content:center;width:100%}}.export-btn[_ngcontent-%COMP%], .edit-strategy-btn[_ngcontent-%COMP%], .change-account-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:10px 16px;border-radius:6px;font-size:14px;font-weight:500;font-family:Inter,Arial,sans-serif;cursor:pointer;transition:all .2s ease;border:none;text-decoration:none}@media (max-width: 768px){.export-btn[_ngcontent-%COMP%], .edit-strategy-btn[_ngcontent-%COMP%], .change-account-btn[_ngcontent-%COMP%]{padding:8px 12px;font-size:13px;gap:6px}}@media (max-width: 480px){.export-btn[_ngcontent-%COMP%], .edit-strategy-btn[_ngcontent-%COMP%], .change-account-btn[_ngcontent-%COMP%]{padding:10px 16px;font-size:14px;justify-content:center}}@media (max-width: 1024px){.edit-strategy-btn[_ngcontent-%COMP%]{width:100%}}@media (max-width: 1024px){.change-account-btn[_ngcontent-%COMP%]{width:100%}}.export-btn[_ngcontent-%COMP%]{background:#1e3250cc;color:#b6c7de;border:1px solid #4A6FA5}.export-btn[_ngcontent-%COMP%]:hover{background:#1e3250e6;border-color:#4a6fa5}@media (min-width: 1024px){.export-btn-title[_ngcontent-%COMP%]{display:none!important}}@media (max-width: 1024px){.export-btn-title[_ngcontent-%COMP%]{display:flex!important;padding:6px 12px;font-size:13px;gap:6px}}@media (max-width: 1024px){.export-btn-desktop[_ngcontent-%COMP%]{display:none!important}}.edit-strategy-btn[_ngcontent-%COMP%]{background:#9bf5261a;color:#9bf526;border:1px solid #9BF526}.edit-strategy-btn[_ngcontent-%COMP%]:hover{background:#9bf52633;border-color:#9bf526}.change-account-btn[_ngcontent-%COMP%]{background:#9bf526;color:#1a1a1a;border:1px solid #9BF526;position:relative}.change-account-btn[_ngcontent-%COMP%]:hover{background:#8ae01a;border-color:#8ae01a}.change-account-dropdown[_ngcontent-%COMP%]{position:relative}@media (max-width: 1024px){.change-account-dropdown[_ngcontent-%COMP%]{width:100%}}.account-dropdown[_ngcontent-%COMP%]{position:absolute;top:100%;right:0;background:#1a1a1a;border:1px solid #333;border-radius:8px;box-shadow:0 8px 24px #0000004d;z-index:1000;min-width:200px;margin-top:4px}@media (max-width: 480px){.account-dropdown[_ngcontent-%COMP%]{right:auto;left:0;width:100%;min-width:unset}}.account-dropdown-header[_ngcontent-%COMP%]{border-bottom:1px solid #333;background:#ffffff0d;border-radius:8px 8px 0 0}.refresh-accounts-btn[_ngcontent-%COMP%]{background:transparent;border:none;color:#9ca3af;cursor:pointer;padding:4px;border-radius:4px;transition:all .2s ease;display:flex;align-items:center;justify-content:center}.refresh-accounts-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;color:#9bf526}.refresh-accounts-btn[_ngcontent-%COMP%]   .material-symbols-outlined[_ngcontent-%COMP%]{font-size:16px}.account-option[_ngcontent-%COMP%]{padding:12px 16px;cursor:pointer;transition:background-color .2s ease;border-bottom:1px solid #2a2a2a}.account-option[_ngcontent-%COMP%]:last-child{border-bottom:none}.account-option[_ngcontent-%COMP%]:hover{background:#2a2a2a}.account-option-name[_ngcontent-%COMP%]{font-size:14px;font-weight:500;color:#e3e3e3;margin-bottom:2px;font-family:Inter,Arial,sans-serif}.account-option-server[_ngcontent-%COMP%]{font-size:12px;color:#8e8e93;font-family:Inter,Arial,sans-serif}.icon-refresh[_ngcontent-%COMP%], .icon-edit[_ngcontent-%COMP%], .icon-chevron[_ngcontent-%COMP%]{font-size:12px;font-weight:700}"]})};export{Kt as ReportComponent};
